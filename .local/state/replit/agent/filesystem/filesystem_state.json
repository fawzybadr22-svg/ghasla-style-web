{"file_contents":{"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { z } from \"zod\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { \n  insertServicePackageSchema, insertOrderSchema, insertContactMessageSchema,\n  insertBlogPostSchema, insertTestimonialSchema, insertGalleryItemSchema,\n  getServiceAreas\n} from \"@shared/schema\";\nimport { \n  setSuperAdmin, \n  setAdminRole, \n  requireSuperAdmin, \n  requireAdmin,\n  type AuthenticatedRequest \n} from \"./firebase-admin\";\nimport { \n  generalApiLimiter, \n  authLimiter, \n  orderLimiter, \n  internalLimiter, \n  contactLimiter \n} from \"./security\";\n\n// Configure multer for file uploads\nconst uploadsDir = path.join(process.cwd(), \"uploads\", \"offers\");\nif (!fs.existsSync(uploadsDir)) {\n  fs.mkdirSync(uploadsDir, { recursive: true });\n}\n\nconst offerImageStorage = multer.diskStorage({\n  destination: (req, file, cb) => {\n    cb(null, uploadsDir);\n  },\n  filename: (req, file, cb) => {\n    const uniqueSuffix = Date.now() + \"-\" + Math.round(Math.random() * 1e9);\n    const ext = path.extname(file.originalname);\n    cb(null, `offer-${uniqueSuffix}${ext}`);\n  },\n});\n\nconst uploadOfferImage = multer({\n  storage: offerImageStorage,\n  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB max\n  fileFilter: (req, file, cb) => {\n    const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/webp\", \"image/gif\"];\n    if (allowedTypes.includes(file.mimetype)) {\n      cb(null, true);\n    } else {\n      cb(new Error(\"Only JPEG, PNG, WebP, and GIF images are allowed\"));\n    }\n  },\n});\n\n// Default service packages for seeding\nconst defaultPackages = [\n  {\n    nameAr: \"غسيل خارجي\",\n    nameEn: \"Exterior Wash\",\n    nameFr: \"Lavage Extérieur\",\n    descriptionAr: \"غسيل شامل للجسم الخارجي مع تنظيف الإطارات والجنوط\",\n    descriptionEn: \"Complete exterior wash with tire and rim cleaning\",\n    descriptionFr: \"Lavage extérieur complet avec nettoyage des pneus et jantes\",\n    priceSedanKD: 3,\n    priceSuvKD: 4,\n    estimatedMinutes: 30,\n    category: \"exterior\" as const,\n    isActive: true,\n  },\n  {\n    nameAr: \"تنظيف داخلي\",\n    nameEn: \"Interior Clean\",\n    nameFr: \"Nettoyage Intérieur\",\n    descriptionAr: \"تنظيف شامل للمقصورة الداخلية مع كنس وتعقيم\",\n    descriptionEn: \"Complete interior cleaning with vacuuming and sanitization\",\n    descriptionFr: \"Nettoyage intérieur complet avec aspiration et désinfection\",\n    priceSedanKD: 5,\n    priceSuvKD: 7,\n    estimatedMinutes: 45,\n    category: \"interior\" as const,\n    isActive: true,\n  },\n  {\n    nameAr: \"غسيل كامل\",\n    nameEn: \"Full Wash\",\n    nameFr: \"Lavage Complet\",\n    descriptionAr: \"غسيل خارجي وداخلي شامل مع التعقيم والتعطير\",\n    descriptionEn: \"Complete exterior and interior wash with sanitization and freshening\",\n    descriptionFr: \"Lavage extérieur et intérieur complet avec désinfection\",\n    priceSedanKD: 7,\n    priceSuvKD: 10,\n    estimatedMinutes: 60,\n    category: \"full\" as const,\n    isActive: true,\n  },\n  {\n    nameAr: \"VIP تفصيلي\",\n    nameEn: \"VIP Detailing\",\n    nameFr: \"Détaillage VIP\",\n    descriptionAr: \"خدمة تفصيلية شاملة مع تلميع السيارة وحماية الطلاء\",\n    descriptionEn: \"Full detailing service with car polish and paint protection\",\n    descriptionFr: \"Service de détaillage complet avec polish et protection\",\n    priceSedanKD: 15,\n    priceSuvKD: 20,\n    estimatedMinutes: 120,\n    category: \"vip\" as const,\n    isActive: true,\n  },\n  {\n    nameAr: \"اشتراك شهري (4 غسلات)\",\n    nameEn: \"Monthly Package (4 washes)\",\n    nameFr: \"Forfait Mensuel (4 lavages)\",\n    descriptionAr: \"4 غسلات كاملة شهرياً بسعر مخفض\",\n    descriptionEn: \"4 full washes per month at discounted rate\",\n    descriptionFr: \"4 lavages complets par mois à tarif réduit\",\n    priceSedanKD: 25,\n    priceSuvKD: 35,\n    estimatedMinutes: 60,\n    category: \"monthly\" as const,\n    isActive: true,\n  },\n];\n\n// Seed service packages if none exist\nasync function seedServicePackages() {\n  const existing = await storage.getServicePackages();\n  if (existing.length === 0) {\n    for (const pkg of defaultPackages) {\n      await storage.createServicePackage(pkg);\n    }\n    console.log(\"Seeded default service packages\");\n  }\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // Seed data on startup\n  await seedServicePackages();\n\n  // ====================\n  // APPLY RATE LIMITERS TO ROUTE GROUPS\n  // ====================\n  \n  // General API rate limit\n  app.use(\"/api\", generalApiLimiter);\n  \n  // Specific stricter limits for sensitive routes\n  app.use(\"/api/auth\", authLimiter);\n  app.use(\"/api/users\", authLimiter);\n  app.use(\"/api/orders\", orderLimiter);\n  app.use(\"/api/contact\", contactLimiter);\n  app.use(\"/internal\", internalLimiter);\n\n  // ====================\n  // INTERNAL ROUTES (One-time setup, requires SUPER_ADMIN_SECRET)\n  // ====================\n\n  const verifySuperAdminSecret = (req: any, res: any, next: any) => {\n    const secret = process.env.SUPER_ADMIN_SECRET;\n    const providedSecret = req.headers[\"x-super-admin-secret\"] || req.body.secret;\n    \n    if (!secret) {\n      return res.status(503).json({ \n        error: \"SUPER_ADMIN_SECRET not configured. Set this environment variable first.\" \n      });\n    }\n    \n    if (providedSecret !== secret) {\n      return res.status(403).json({ error: \"Invalid super admin secret\" });\n    }\n    \n    next();\n  };\n\n  app.post(\"/internal/make-super-admin\", verifySuperAdminSecret, async (req, res) => {\n    const { email } = req.body;\n    if (!email) {\n      return res.status(400).json({ error: \"email is required\" });\n    }\n\n    try {\n      const result = await setSuperAdmin(email);\n      \n      const user = await storage.getUserByEmail(email);\n      if (user) {\n        await storage.updateUser(user.id, { role: \"super_admin\" });\n      }\n      \n      return res.json({ \n        ok: true, \n        uid: result.uid, \n        superAdmin: true,\n        message: `Super admin set for ${email}` \n      });\n    } catch (err: any) {\n      console.error(\"make-super-admin error:\", err);\n      return res.status(500).json({ error: err.message || \"failed to set super admin\" });\n    }\n  });\n\n  app.post(\"/internal/set-admin\", verifySuperAdminSecret, async (req, res) => {\n    const { email, isAdmin } = req.body;\n    if (!email) {\n      return res.status(400).json({ error: \"email is required\" });\n    }\n\n    try {\n      const result = await setAdminRole(email, isAdmin !== false);\n      \n      const user = await storage.getUserByEmail(email);\n      if (user) {\n        await storage.updateUser(user.id, { role: isAdmin !== false ? \"admin\" : \"customer\" });\n      }\n      \n      return res.json({ \n        ok: true, \n        uid: result.uid, \n        admin: isAdmin !== false,\n        message: `Admin role ${isAdmin !== false ? \"granted\" : \"revoked\"} for ${email}` \n      });\n    } catch (err: any) {\n      console.error(\"set-admin error:\", err);\n      return res.status(500).json({ error: err.message || \"failed to set admin role\" });\n    }\n  });\n\n  // ====================\n  // PUBLIC ROUTES\n  // ====================\n\n  // Service Packages (public)\n  app.get(\"/api/packages\", async (req, res) => {\n    try {\n      const packages = await storage.getServicePackages(true);\n      res.json(packages);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/packages/:id\", async (req, res) => {\n    try {\n      const pkg = await storage.getServicePackage(req.params.id);\n      if (!pkg) {\n        return res.status(404).json({ error: \"Package not found\" });\n      }\n      res.json(pkg);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Loyalty Config (public read)\n  app.get(\"/api/loyalty/config\", async (req, res) => {\n    try {\n      const config = await storage.getLoyaltyConfig();\n      res.json(config);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Kuwait Areas (public) - with availability status\n  app.get(\"/api/areas\", (req, res) => {\n    const areas = getServiceAreas();\n    res.json(areas);\n  });\n\n  // Blog Posts (public)\n  app.get(\"/api/blog\", async (req, res) => {\n    try {\n      const posts = await storage.getBlogPosts(true);\n      res.json(posts);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/blog/:id\", async (req, res) => {\n    try {\n      const post = await storage.getBlogPost(req.params.id);\n      if (!post || !post.isPublished) {\n        return res.status(404).json({ error: \"Post not found\" });\n      }\n      res.json(post);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Testimonials (public approved)\n  app.get(\"/api/testimonials\", async (req, res) => {\n    try {\n      const testimonials = await storage.getTestimonials(true);\n      res.json(testimonials);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Gallery (public)\n  app.get(\"/api/gallery\", async (req, res) => {\n    try {\n      const items = await storage.getGalleryItems(true);\n      res.json(items);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Contact Messages (public create)\n  app.post(\"/api/contact\", async (req, res) => {\n    try {\n      const data = insertContactMessageSchema.parse(req.body);\n      const message = await storage.createContactMessage(data);\n      res.status(201).json(message);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ====================\n  // AUTHENTICATION ROUTES\n  // ====================\n\n  // Register with email (creates user in database after Firebase auth)\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const { uid, email, name, phone, referralCode } = req.body;\n      \n      if (!uid || !email) {\n        return res.status(400).json({ error: \"User ID and email are required\" });\n      }\n\n      // Check if user already exists\n      const existing = await storage.getUser(uid);\n      if (existing) {\n        const { twoFactorSecret, ...safeUser } = existing;\n        return res.json(safeUser);\n      }\n\n      // Check if referred by someone\n      let referredBy: string | undefined;\n      if (referralCode) {\n        const referrer = await storage.getUserByReferralCode(referralCode);\n        if (referrer) {\n          referredBy = referrer.id;\n        }\n      }\n\n      // Create user\n      const user = await storage.createUser({\n        id: uid,\n        email,\n        name: name || email.split(\"@\")[0],\n        phone,\n        referredBy,\n        role: \"customer\",\n        status: \"active\",\n      });\n\n      // Create referral record if referred\n      if (referredBy) {\n        await storage.createReferral({\n          referrerId: referredBy,\n          referredCustomerId: uid,\n          status: \"pending\",\n        });\n      }\n\n      const { twoFactorSecret, ...safeUser } = user;\n      res.status(201).json(safeUser);\n    } catch (error: any) {\n      console.error(\"Registration error:\", error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Login/Register with Google (creates or returns existing user)\n  app.post(\"/api/auth/google\", async (req, res) => {\n    try {\n      const { uid, email, name, phone } = req.body;\n      \n      if (!uid || !email) {\n        return res.status(400).json({ error: \"User ID and email are required\" });\n      }\n\n      // Check if user already exists\n      const existing = await storage.getUser(uid);\n      if (existing) {\n        const { twoFactorSecret, ...safeUser } = existing;\n        return res.json(safeUser);\n      }\n\n      // Create new user for Google login\n      const user = await storage.createUser({\n        id: uid,\n        email,\n        name: name || email.split(\"@\")[0],\n        phone,\n        role: \"customer\",\n        status: \"active\",\n      });\n\n      const { twoFactorSecret, ...safeUser } = user;\n      res.status(201).json(safeUser);\n    } catch (error: any) {\n      console.error(\"Google auth error:\", error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ====================\n  // USER ROUTES (requires authentication)\n  // ====================\n\n  // User Profile\n  app.get(\"/api/users/:id\", async (req, res) => {\n    try {\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      // Remove sensitive fields\n      const { twoFactorSecret, ...safeUser } = user;\n      res.json(safeUser);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/users/email/:email\", async (req, res) => {\n    try {\n      const user = await storage.getUserByEmail(req.params.email);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      const { twoFactorSecret, ...safeUser } = user;\n      res.json(safeUser);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/users\", async (req, res) => {\n    try {\n      const { id, ...userData } = req.body;\n      if (!id) {\n        return res.status(400).json({ error: \"User ID is required (from Firebase)\" });\n      }\n      \n      // Check if user exists\n      const existing = await storage.getUser(id);\n      if (existing) {\n        return res.json(existing);\n      }\n\n      // Check if referred by someone\n      let referredBy = userData.referredBy;\n      if (referredBy) {\n        const referrer = await storage.getUserByReferralCode(referredBy);\n        if (referrer) {\n          referredBy = referrer.id;\n        } else {\n          referredBy = undefined;\n        }\n      }\n\n      const user = await storage.createUser({ ...userData, id, referredBy });\n      \n      // Create referral record if referred\n      if (referredBy) {\n        await storage.createReferral({\n          referrerId: referredBy,\n          referredCustomerId: id,\n          status: \"pending\",\n        });\n      }\n\n      res.status(201).json(user);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", async (req, res) => {\n    try {\n      const updated = await storage.updateUser(req.params.id, req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n      const { twoFactorSecret, ...safeUser } = updated;\n      res.json(safeUser);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // User's Loyalty Transactions\n  app.get(\"/api/users/:id/loyalty\", async (req, res) => {\n    try {\n      const transactions = await storage.getLoyaltyTransactions(req.params.id);\n      res.json(transactions);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // User's Referrals\n  app.get(\"/api/users/:id/referrals\", async (req, res) => {\n    try {\n      const referrals = await storage.getReferralsByReferrer(req.params.id);\n      res.json(referrals);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Account Deletion Request (GDPR/Google Play compliance)\n  app.post(\"/api/users/:id/delete-request\", async (req, res) => {\n    try {\n      const userId = req.params.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Log the deletion request for audit purposes\n      await storage.createAuditLog({\n        actionType: \"ACCOUNT_DELETION_REQUESTED\",\n        performedBy: userId,\n        targetCollection: \"users\",\n        targetId: userId,\n        oldValue: JSON.stringify({ email: user.email, name: user.name }),\n        newValue: JSON.stringify({ status: \"deletion_scheduled\" }),\n      });\n\n      // Mark user as pending deletion by setting status to blocked\n      await storage.updateUser(userId, { \n        status: \"blocked\",\n      });\n\n      res.json({ \n        success: true, \n        message: \"Account deletion request submitted. Your account will be deleted within 30 days.\",\n        scheduledDeletionDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n      });\n    } catch (error: any) {\n      console.error(\"Account deletion request error:\", error);\n      res.status(500).json({ error: \"Failed to process deletion request\" });\n    }\n  });\n\n  // Referral code lookup\n  app.get(\"/api/referral/:code\", async (req, res) => {\n    try {\n      const user = await storage.getUserByReferralCode(req.params.code);\n      if (!user) {\n        return res.status(404).json({ error: \"Invalid referral code\" });\n      }\n      res.json({ valid: true, referrerName: user.name });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ====================\n  // ORDERS\n  // ====================\n\n  // Public order tracking (returns limited info, no sensitive data)\n  app.get(\"/api/orders/track/:orderId\", async (req, res) => {\n    try {\n      // Clean the order ID: remove #, spaces, and trim\n      const cleanOrderId = req.params.orderId.replace(/^#/, \"\").replace(/\\s+/g, \"\").trim();\n      \n      // Use partial matching to find the order\n      const order = await storage.getOrderByPartialId(cleanOrderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n\n      // Get service package for display name\n      const servicePackage = await storage.getServicePackage(order.servicePackageId);\n\n      // Return only non-sensitive public info\n      res.json({\n        id: order.id,\n        status: order.status,\n        carType: order.carType,\n        preferredDate: order.preferredDate,\n        preferredTime: order.preferredTime,\n        area: order.area,\n        createdAt: order.createdAt,\n        completedAt: order.completedAt,\n        assignedDriver: order.assignedDriver ? \"Assigned\" : null,\n        serviceName: servicePackage ? {\n          ar: servicePackage.nameAr,\n          en: servicePackage.nameEn,\n          fr: servicePackage.nameFr,\n        } : null,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Customer's orders\n  app.get(\"/api/orders/customer/:customerId\", async (req, res) => {\n    try {\n      const orders = await storage.getOrdersByCustomer(req.params.customerId);\n      res.json(orders);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Create order\n  app.post(\"/api/orders\", async (req, res) => {\n    try {\n      console.log(\"POST /api/orders - Request body:\", JSON.stringify(req.body, null, 2));\n      \n      const orderData = insertOrderSchema.parse(req.body);\n      \n      // Get customer for loyalty calculations\n      const customer = await storage.getUser(orderData.customerId);\n      if (!customer) {\n        return res.status(400).json({ error: \"Customer not found\" });\n      }\n      if (customer.status === \"blocked\") {\n        return res.status(403).json({ \n          error: \"Account is blocked\",\n          errorAr: \"حسابك محظور. يرجى التواصل مع الدعم\",\n          errorFr: \"Votre compte est bloqué. Veuillez contacter le support\"\n        });\n      }\n\n      // Get service package to calculate proper price server-side\n      const servicePackage = await storage.getServicePackage(orderData.servicePackageId);\n      if (!servicePackage) {\n        return res.status(400).json({ error: \"Invalid service package\" });\n      }\n\n      // Calculate base price from package and car type\n      const carType = orderData.carType as \"sedan\" | \"suv\";\n      const basePrice = carType === \"suv\" ? servicePackage.priceSuvKD : servicePackage.priceSedanKD;\n\n      // Get loyalty config\n      const loyaltyConfig = await storage.getLoyaltyConfig();\n\n      // Validate points redemption\n      let pointsToRedeem = orderData.loyaltyPointsRedeemed || 0;\n      let discountApplied = 0;\n      \n      if (pointsToRedeem > 0) {\n        if (pointsToRedeem > customer.loyaltyPoints) {\n          return res.status(400).json({ error: \"Insufficient loyalty points\" });\n        }\n        const maxDiscount = basePrice * loyaltyConfig.maxRedeemPercentage;\n        const pointValue = pointsToRedeem * loyaltyConfig.conversionRate;\n        discountApplied = Math.min(pointValue, maxDiscount);\n      }\n\n      // Calculate final price\n      const finalPrice = Math.max(0, basePrice - discountApplied);\n\n      // Create order with server-calculated price\n      const order = await storage.createOrder({\n        ...orderData,\n        priceKD: finalPrice,\n        discountApplied,\n        loyaltyPointsRedeemed: pointsToRedeem,\n      });\n\n      // Deduct redeemed points\n      if (pointsToRedeem > 0) {\n        await storage.updateUser(customer.id, {\n          loyaltyPoints: customer.loyaltyPoints - pointsToRedeem,\n        });\n        await storage.createLoyaltyTransaction({\n          customerId: customer.id,\n          orderId: order.id,\n          pointsChange: -pointsToRedeem,\n          type: \"redeem\",\n          note: `Redeemed for order ${order.id}`,\n          createdBy: \"system\",\n        });\n      }\n\n      res.status(201).json(order);\n    } catch (error: any) {\n      console.error(\"POST /api/orders - Error:\", error.message);\n      console.error(\"Request body was:\", JSON.stringify(req.body, null, 2));\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get single order\n  app.get(\"/api/orders/:id\", async (req, res) => {\n    try {\n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n      res.json(order);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Update order status (with loyalty points on completion)\n  app.patch(\"/api/orders/:id\", async (req, res) => {\n    try {\n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n\n      const { status, cancelReason, ...rest } = req.body;\n\n      // Handle order completion - award loyalty points\n      if (status === \"completed\" && order.status !== \"completed\") {\n        const loyaltyConfig = await storage.getLoyaltyConfig();\n        const customer = await storage.getUser(order.customerId);\n        \n        if (customer) {\n          // Calculate points earned\n          const pointsEarned = Math.floor(order.priceKD * loyaltyConfig.pointsPerKD);\n          \n          // Update order with points earned\n          const updateData: any = { status, loyaltyPointsEarned: pointsEarned, completedAt: new Date() };\n          const updated = await storage.updateOrder(req.params.id, updateData);\n\n          // Award points to customer\n          await storage.updateUser(customer.id, {\n            loyaltyPoints: customer.loyaltyPoints + pointsEarned,\n          });\n\n          // Create transaction record\n          await storage.createLoyaltyTransaction({\n            customerId: customer.id,\n            orderId: order.id,\n            pointsChange: pointsEarned,\n            type: \"earn\",\n            note: `Earned from order ${order.id}`,\n            createdBy: \"system\",\n          });\n\n          // Check if this is first order for referral bonus\n          const customerOrders = await storage.getOrdersByCustomer(customer.id);\n          const completedOrders = customerOrders.filter(o => o.status === \"completed\");\n          \n          if (completedOrders.length === 1 && customer.referredBy) {\n            // First completed order - award referral bonuses\n            const referral = await storage.getReferralByReferred(customer.id);\n            if (referral && referral.status === \"pending\") {\n              const referrer = await storage.getUser(referral.referrerId);\n              \n              if (referrer) {\n                // Award referrer bonus\n                await storage.updateUser(referrer.id, {\n                  loyaltyPoints: referrer.loyaltyPoints + loyaltyConfig.referrerBonusPoints,\n                });\n                await storage.createLoyaltyTransaction({\n                  customerId: referrer.id,\n                  orderId: order.id,\n                  pointsChange: loyaltyConfig.referrerBonusPoints,\n                  type: \"referral_bonus\",\n                  note: `Referral bonus for ${customer.name}`,\n                  createdBy: \"system\",\n                });\n\n                // Award referred welcome bonus\n                await storage.updateUser(customer.id, {\n                  loyaltyPoints: customer.loyaltyPoints + pointsEarned + loyaltyConfig.referredWelcomePoints,\n                });\n                await storage.createLoyaltyTransaction({\n                  customerId: customer.id,\n                  orderId: order.id,\n                  pointsChange: loyaltyConfig.referredWelcomePoints,\n                  type: \"welcome_bonus\",\n                  note: \"Welcome bonus from referral\",\n                  createdBy: \"system\",\n                });\n\n                // Complete referral\n                await storage.updateReferral(referral.id, {\n                  status: \"completed\",\n                  firstOrderId: order.id,\n                  completedAt: new Date(),\n                });\n              }\n            }\n          }\n\n          return res.json(updated);\n        }\n      }\n\n      // Handle cancellation\n      if (status === \"cancelled\") {\n        const updated = await storage.updateOrder(req.params.id, { status, cancelReason });\n        return res.json(updated);\n      }\n\n      // Regular update\n      const updated = await storage.updateOrder(req.params.id, { status, ...rest });\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ====================\n  // ADMIN ROUTES\n  // ====================\n\n  // Admin: Get all packages (including inactive)\n  app.get(\"/api/admin/packages\", async (req, res) => {\n    try {\n      const packages = await storage.getServicePackages(false);\n      res.json(packages);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Create package\n  app.post(\"/api/admin/packages\", async (req, res) => {\n    try {\n      const data = insertServicePackageSchema.parse(req.body);\n      const pkg = await storage.createServicePackage(data);\n      \n      // Audit log\n      await storage.createAuditLog({\n        actionType: \"create_package\",\n        performedBy: req.body.performedBy || \"admin\",\n        targetCollection: \"service_packages\",\n        targetId: pkg.id,\n        newValue: JSON.stringify(pkg),\n      });\n\n      res.status(201).json(pkg);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Admin: Update package\n  app.patch(\"/api/admin/packages/:id\", async (req, res) => {\n    try {\n      const oldPkg = await storage.getServicePackage(req.params.id);\n      const updated = await storage.updateServicePackage(req.params.id, req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"Package not found\" });\n      }\n\n      // Audit log\n      await storage.createAuditLog({\n        actionType: \"update_package\",\n        performedBy: req.body.performedBy || \"admin\",\n        targetCollection: \"service_packages\",\n        targetId: updated.id,\n        oldValue: JSON.stringify(oldPkg),\n        newValue: JSON.stringify(updated),\n      });\n\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Admin: Delete package\n  app.delete(\"/api/admin/packages/:id\", async (req, res) => {\n    try {\n      const pkg = await storage.getServicePackage(req.params.id);\n      if (!pkg) {\n        return res.status(404).json({ error: \"Package not found\" });\n      }\n\n      await storage.deleteServicePackage(req.params.id);\n\n      // Audit log\n      await storage.createAuditLog({\n        actionType: \"delete_package\",\n        performedBy: req.query.performedBy as string || \"admin\",\n        targetCollection: \"service_packages\",\n        targetId: req.params.id,\n        oldValue: JSON.stringify(pkg),\n      });\n\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Get all orders\n  app.get(\"/api/admin/orders\", async (req, res) => {\n    try {\n      const { status, startDate, endDate } = req.query;\n      const filters: any = {};\n      if (status) filters.status = status as string;\n      if (startDate) filters.startDate = new Date(startDate as string);\n      if (endDate) filters.endDate = new Date(endDate as string);\n      \n      const orders = await storage.getOrders(filters);\n      res.json(orders);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Get all users\n  app.get(\"/api/admin/users\", async (req, res) => {\n    try {\n      const { role, status } = req.query;\n      const filters: any = {};\n      if (role) filters.role = role as string;\n      if (status) filters.status = status as string;\n      \n      const users = await storage.getUsers(filters);\n      // Remove sensitive data\n      const safeUsers = users.map(({ twoFactorSecret, ...u }) => u);\n      res.json(safeUsers);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Block/unblock user\n  app.patch(\"/api/admin/users/:id/status\", async (req, res) => {\n    try {\n      const { status, performedBy } = req.body;\n      if (![\"active\", \"blocked\"].includes(status)) {\n        return res.status(400).json({ error: \"Invalid status\" });\n      }\n\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const updated = await storage.updateUser(req.params.id, { status });\n\n      // Audit log\n      await storage.createAuditLog({\n        actionType: status === \"blocked\" ? \"block_user\" : \"unblock_user\",\n        performedBy: performedBy || \"admin\",\n        targetCollection: \"users\",\n        targetId: req.params.id,\n        oldValue: JSON.stringify({ status: user.status }),\n        newValue: JSON.stringify({ status }),\n      });\n\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Admin: Adjust user points\n  app.post(\"/api/admin/users/:id/points\", async (req, res) => {\n    try {\n      const { pointsChange, note, performedBy } = req.body;\n      if (typeof pointsChange !== \"number\") {\n        return res.status(400).json({ error: \"Points change must be a number\" });\n      }\n\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      const newPoints = Math.max(0, user.loyaltyPoints + pointsChange);\n      await storage.updateUser(req.params.id, { loyaltyPoints: newPoints });\n\n      const tx = await storage.createLoyaltyTransaction({\n        customerId: req.params.id,\n        pointsChange,\n        type: \"admin_adjustment\",\n        note,\n        createdBy: performedBy || \"admin\",\n      });\n\n      // Audit log\n      await storage.createAuditLog({\n        actionType: \"adjust_points\",\n        performedBy: performedBy || \"admin\",\n        targetCollection: \"users\",\n        targetId: req.params.id,\n        oldValue: JSON.stringify({ loyaltyPoints: user.loyaltyPoints }),\n        newValue: JSON.stringify({ loyaltyPoints: newPoints, adjustment: pointsChange }),\n        note,\n      });\n\n      res.json({ newPoints, transaction: tx });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Admin: Update loyalty config\n  app.patch(\"/api/admin/loyalty/config\", async (req, res) => {\n    try {\n      const { performedBy, ...configData } = req.body;\n      const oldConfig = await storage.getLoyaltyConfig();\n      const updated = await storage.updateLoyaltyConfig(configData);\n\n      // Audit log\n      await storage.createAuditLog({\n        actionType: \"update_loyalty_config\",\n        performedBy: performedBy || \"admin\",\n        targetCollection: \"loyalty_config\",\n        targetId: updated.id,\n        oldValue: JSON.stringify(oldConfig),\n        newValue: JSON.stringify(updated),\n      });\n\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Admin: Blog posts CRUD\n  app.get(\"/api/admin/blog\", async (req, res) => {\n    try {\n      const posts = await storage.getBlogPosts(false);\n      res.json(posts);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/admin/blog\", async (req, res) => {\n    try {\n      const data = insertBlogPostSchema.parse(req.body);\n      const post = await storage.createBlogPost(data);\n      res.status(201).json(post);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.patch(\"/api/admin/blog/:id\", async (req, res) => {\n    try {\n      const updated = await storage.updateBlogPost(req.params.id, req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"Post not found\" });\n      }\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/admin/blog/:id\", async (req, res) => {\n    try {\n      await storage.deleteBlogPost(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Testimonials CRUD\n  app.get(\"/api/admin/testimonials\", async (req, res) => {\n    try {\n      const testimonials = await storage.getTestimonials(false);\n      res.json(testimonials);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/admin/testimonials\", async (req, res) => {\n    try {\n      const data = insertTestimonialSchema.parse(req.body);\n      const testimonial = await storage.createTestimonial(data);\n      res.status(201).json(testimonial);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.patch(\"/api/admin/testimonials/:id\", async (req, res) => {\n    try {\n      const updated = await storage.updateTestimonial(req.params.id, req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"Testimonial not found\" });\n      }\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/admin/testimonials/:id\", async (req, res) => {\n    try {\n      await storage.deleteTestimonial(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Gallery CRUD\n  app.get(\"/api/admin/gallery\", async (req, res) => {\n    try {\n      const items = await storage.getGalleryItems(false);\n      res.json(items);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/admin/gallery\", async (req, res) => {\n    try {\n      const data = insertGalleryItemSchema.parse(req.body);\n      const item = await storage.createGalleryItem(data);\n      res.status(201).json(item);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.patch(\"/api/admin/gallery/:id\", async (req, res) => {\n    try {\n      const updated = await storage.updateGalleryItem(req.params.id, req.body);\n      if (!updated) {\n        return res.status(404).json({ error: \"Gallery item not found\" });\n      }\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/admin/gallery/:id\", async (req, res) => {\n    try {\n      await storage.deleteGalleryItem(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Offers CRUD\n  app.get(\"/api/admin/offers\", async (req, res) => {\n    try {\n      const offers = await storage.getOffers(false);\n      res.json(offers);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/admin/offers\", async (req, res) => {\n    try {\n      const { titleAr, titleEn, titleFr, descriptionAr, descriptionEn, descriptionFr,\n        discountPercentage, discountAmountKD, imageUrl, startDate, endDate, isActive } = req.body;\n      \n      const offer = await storage.createOffer({\n        titleAr,\n        titleEn,\n        titleFr,\n        descriptionAr,\n        descriptionEn,\n        descriptionFr,\n        discountPercentage: discountPercentage || null,\n        discountAmountKD: discountAmountKD || null,\n        imageUrl: imageUrl || null,\n        startDate: new Date(startDate),\n        endDate: new Date(endDate),\n        isActive: isActive ?? true,\n      });\n      res.status(201).json(offer);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.patch(\"/api/admin/offers/:id\", async (req, res) => {\n    try {\n      const updateData: any = { ...req.body };\n      if (updateData.startDate) updateData.startDate = new Date(updateData.startDate);\n      if (updateData.endDate) updateData.endDate = new Date(updateData.endDate);\n      \n      const updated = await storage.updateOffer(req.params.id, updateData);\n      if (!updated) {\n        return res.status(404).json({ error: \"Offer not found\" });\n      }\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/admin/offers/:id\", async (req, res) => {\n    try {\n      await storage.deleteOffer(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Upload offer image\n  app.post(\"/api/admin/offers/upload-image\", uploadOfferImage.single(\"image\"), (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"No file uploaded\" });\n      }\n      const imageUrl = `/uploads/offers/${req.file.filename}`;\n      res.json({ imageUrl });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Public: Active offers\n  app.get(\"/api/offers/active\", async (req, res) => {\n    try {\n      const offers = await storage.getActiveOffers();\n      res.json(offers);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Contact messages\n  app.get(\"/api/admin/messages\", async (req, res) => {\n    try {\n      const messages = await storage.getContactMessages();\n      res.json(messages);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.patch(\"/api/admin/messages/:id/read\", async (req, res) => {\n    try {\n      await storage.markContactMessageRead(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/admin/messages/:id\", async (req, res) => {\n    try {\n      await storage.deleteContactMessage(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Audit logs\n  app.get(\"/api/admin/audit-logs\", async (req, res) => {\n    try {\n      const { performedBy, targetCollection } = req.query;\n      const filters: any = {};\n      if (performedBy) filters.performedBy = performedBy as string;\n      if (targetCollection) filters.targetCollection = targetCollection as string;\n      \n      const logs = await storage.getAuditLogs(filters);\n      res.json(logs);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Clear audit logs (superAdmin only)\n  app.delete(\"/api/admin/audit-logs\", requireSuperAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { olderThanDays, clearAll } = req.query;\n      \n      // Validate input - require explicit clearAll=true for full deletion\n      if (olderThanDays) {\n        const days = parseInt(olderThanDays as string);\n        if (Number.isNaN(days) || days <= 0) {\n          return res.status(400).json({ error: \"olderThanDays must be a positive number\" });\n        }\n        \n        const deletedCount = await storage.clearAuditLogs(days);\n        \n        await storage.createAuditLog({\n          actionType: \"clear_audit_logs\",\n          performedBy: req.user?.uid || \"system\",\n          targetCollection: \"auditLogs\",\n          targetId: \"bulk\",\n          newValue: JSON.stringify({ deletedCount, olderThanDays: days }),\n        });\n        \n        return res.json({ success: true, deletedCount });\n      }\n      \n      // Require explicit clearAll=true for full deletion\n      if (clearAll === \"true\") {\n        const deletedCount = await storage.clearAuditLogs();\n        \n        await storage.createAuditLog({\n          actionType: \"clear_audit_logs\",\n          performedBy: req.user?.uid || \"system\",\n          targetCollection: \"auditLogs\",\n          targetId: \"bulk\",\n          newValue: JSON.stringify({ deletedCount, clearAll: true }),\n        });\n        \n        return res.json({ success: true, deletedCount });\n      }\n      \n      return res.status(400).json({ error: \"Must specify olderThanDays or clearAll=true\" });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Analytics\n  app.get(\"/api/admin/analytics\", async (req, res) => {\n    try {\n      const { startDate, endDate } = req.query;\n      const start = startDate ? new Date(startDate as string) : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n      const end = endDate ? new Date(endDate as string) : new Date();\n      \n      const analytics = await storage.getAnalytics(start, end);\n      res.json(analytics);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: CSV Export\n  app.get(\"/api/admin/export/orders\", async (req, res) => {\n    try {\n      const { startDate, endDate } = req.query;\n      const filters: any = {};\n      if (startDate) filters.startDate = new Date(startDate as string);\n      if (endDate) filters.endDate = new Date(endDate as string);\n      \n      const orders = await storage.getOrders(filters);\n      \n      const csv = [\n        \"ID,Customer ID,Status,Car Type,Service Package,Price (KD),Payment Method,Area,Date,Time,Points Earned,Points Redeemed,Discount,Created At\",\n        ...orders.map(o => \n          `${o.id},${o.customerId},${o.status},${o.carType},${o.servicePackageId},${o.priceKD},${o.paymentMethod},${o.area},${o.preferredDate},${o.preferredTime},${o.loyaltyPointsEarned},${o.loyaltyPointsRedeemed},${o.discountApplied},${o.createdAt}`\n        )\n      ].join(\"\\n\");\n\n      res.setHeader(\"Content-Type\", \"text/csv\");\n      res.setHeader(\"Content-Disposition\", \"attachment; filename=orders.csv\");\n      res.send(csv);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ====================\n  // SUPER ADMIN ROUTES - Admin Management (Protected)\n  // ====================\n\n  // Get all admins and delegates (superAdmin only)\n  app.get(\"/api/admin/admins\", requireSuperAdmin, async (req: any, res) => {\n    try {\n      const delegates = await storage.getUsers({ role: \"delegate\" });\n      const admins = await storage.getUsers({ role: \"admin\" });\n      const superAdmins = await storage.getUsers({ role: \"super_admin\" });\n      const allAdmins = [...superAdmins, ...admins, ...delegates].map(({ twoFactorSecret, ...u }) => u);\n      res.json(allAdmins);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Create new admin (superAdmin only)\n  app.post(\"/api/admin/admins\", requireSuperAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { email, name, phone, role, password } = req.body;\n      \n      // Use authenticated user from middleware\n      const authenticatedUserId = req.user?.uid;\n      if (!authenticatedUserId) {\n        return res.status(401).json({ error: \"Authentication required\" });\n      }\n\n      if (!email || !name) {\n        return res.status(400).json({ error: \"Email and name are required\" });\n      }\n\n      const validRoles = [\"delegate\", \"admin\", \"super_admin\"];\n      const adminRole = validRoles.includes(role) ? role : \"admin\";\n\n      // Check if user exists in database\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ error: \"User with this email already exists\" });\n      }\n\n      // Create user in Firebase Auth\n      const { getFirebaseAdmin } = await import(\"./firebase-admin\");\n      const firebaseAdmin = getFirebaseAdmin();\n      \n      let firebaseUser;\n      try {\n        firebaseUser = await firebaseAdmin.auth().getUserByEmail(email);\n      } catch (e: any) {\n        if (e.code === \"auth/user-not-found\") {\n          firebaseUser = await firebaseAdmin.auth().createUser({\n            email,\n            password: password || `${email.split(\"@\")[0]}@Temp123!`,\n            displayName: name,\n          });\n        } else {\n          throw e;\n        }\n      }\n\n      // Set custom claims based on role\n      await firebaseAdmin.auth().setCustomUserClaims(firebaseUser.uid, {\n        delegate: adminRole === \"delegate\",\n        admin: adminRole === \"admin\" || adminRole === \"super_admin\",\n        superAdmin: adminRole === \"super_admin\",\n      });\n\n      // Create user in database\n      const user = await storage.createUser({\n        id: firebaseUser.uid,\n        email,\n        name,\n        phone: phone || null,\n        role: adminRole,\n        status: \"active\",\n      });\n\n      // Audit log with verified authenticated user\n      await storage.createAuditLog({\n        actionType: \"create_admin\",\n        performedBy: authenticatedUserId,\n        targetCollection: \"users\",\n        targetId: user.id,\n        newValue: JSON.stringify({ email, name, role: adminRole }),\n      });\n\n      const { twoFactorSecret, ...safeUser } = user;\n      res.status(201).json(safeUser);\n    } catch (error: any) {\n      console.error(\"Create admin error:\", error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update admin (superAdmin only)\n  app.patch(\"/api/admin/admins/:id\", requireSuperAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      const { name, phone, role, status } = req.body;\n      \n      // Use authenticated user from middleware\n      const authenticatedUserId = req.user?.uid;\n      if (!authenticatedUserId) {\n        return res.status(401).json({ error: \"Authentication required\" });\n      }\n\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ error: \"Admin not found\" });\n      }\n\n      const updateData: any = {};\n      if (name) updateData.name = name;\n      if (phone !== undefined) updateData.phone = phone;\n      if (status && [\"active\", \"blocked\"].includes(status)) updateData.status = status;\n      \n      // Handle role change with transactional safety\n      if (role && [\"delegate\", \"admin\", \"super_admin\", \"customer\"].includes(role)) {\n        // Prevent demoting last super admin\n        if (user.role === \"super_admin\" && role !== \"super_admin\") {\n          const superAdmins = await storage.getUsers({ role: \"super_admin\" });\n          const activeSuperAdmins = superAdmins.filter(u => u.status === \"active\");\n          if (activeSuperAdmins.length <= 1) {\n            return res.status(400).json({ error: \"Cannot demote the last super admin\" });\n          }\n        }\n        \n        // Update Firebase custom claims FIRST before storage\n        const { getFirebaseAdmin } = await import(\"./firebase-admin\");\n        const firebaseAdmin = getFirebaseAdmin();\n        try {\n          await firebaseAdmin.auth().setCustomUserClaims(req.params.id, {\n            delegate: role === \"delegate\",\n            admin: role === \"admin\" || role === \"super_admin\",\n            superAdmin: role === \"super_admin\",\n          });\n          \n          // Revoke refresh tokens to force claim refresh on next auth\n          await firebaseAdmin.auth().revokeRefreshTokens(req.params.id);\n        } catch (claimError: any) {\n          console.error(\"Firebase claim update failed:\", claimError);\n          return res.status(500).json({ error: \"Failed to update user permissions in authentication system\" });\n        }\n        \n        updateData.role = role;\n      }\n\n      const updated = await storage.updateUser(req.params.id, updateData);\n\n      // Post-mutation verification: ensure at least one active super admin exists\n      const postUpdateSuperAdmins = await storage.getUsers({ role: \"super_admin\" });\n      const activePostUpdate = postUpdateSuperAdmins.filter(u => u.status === \"active\");\n      if (activePostUpdate.length === 0) {\n        // Rollback: restore original role\n        await storage.updateUser(req.params.id, { role: user.role });\n        const { getFirebaseAdmin } = await import(\"./firebase-admin\");\n        const firebaseAdmin = getFirebaseAdmin();\n        await firebaseAdmin.auth().setCustomUserClaims(req.params.id, {\n          delegate: user.role === \"delegate\",\n          admin: user.role === \"admin\" || user.role === \"super_admin\",\n          superAdmin: user.role === \"super_admin\",\n        });\n        return res.status(400).json({ error: \"Operation would remove all super admins. Rolled back.\" });\n      }\n\n      // Audit log with verified authenticated user\n      await storage.createAuditLog({\n        actionType: \"update_admin\",\n        performedBy: authenticatedUserId,\n        targetCollection: \"users\",\n        targetId: req.params.id,\n        oldValue: JSON.stringify({ name: user.name, role: user.role, status: user.status }),\n        newValue: JSON.stringify(updateData),\n      });\n\n      const { twoFactorSecret, ...safeUser } = updated!;\n      res.json(safeUser);\n    } catch (error: any) {\n      console.error(\"Update admin error:\", error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Deactivate admin (soft delete - superAdmin only)\n  app.delete(\"/api/admin/admins/:id\", requireSuperAdmin, async (req: AuthenticatedRequest, res) => {\n    try {\n      // Use authenticated user from middleware\n      const authenticatedUserId = req.user?.uid;\n      if (!authenticatedUserId) {\n        return res.status(401).json({ error: \"Authentication required\" });\n      }\n\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ error: \"Admin not found\" });\n      }\n\n      // Don't allow deleting yourself\n      if (authenticatedUserId === req.params.id) {\n        return res.status(400).json({ error: \"Cannot deactivate your own account\" });\n      }\n\n      // Prevent deactivating last super admin\n      if (user.role === \"super_admin\") {\n        const superAdmins = await storage.getUsers({ role: \"super_admin\" });\n        const activeSuperAdmins = superAdmins.filter(u => u.status === \"active\");\n        if (activeSuperAdmins.length <= 1) {\n          return res.status(400).json({ error: \"Cannot deactivate the last super admin\" });\n        }\n      }\n\n      // Remove Firebase admin claims FIRST with transactional safety\n      const { getFirebaseAdmin } = await import(\"./firebase-admin\");\n      const firebaseAdmin = getFirebaseAdmin();\n      try {\n        await firebaseAdmin.auth().setCustomUserClaims(req.params.id, {\n          admin: false,\n          superAdmin: false,\n        });\n        \n        // Revoke refresh tokens to force claim refresh\n        await firebaseAdmin.auth().revokeRefreshTokens(req.params.id);\n      } catch (claimError: any) {\n        console.error(\"Firebase claim removal failed:\", claimError);\n        return res.status(500).json({ error: \"Failed to revoke user permissions in authentication system\" });\n      }\n\n      // Soft delete - set status to blocked and role to customer\n      await storage.updateUser(req.params.id, { status: \"blocked\", role: \"customer\" });\n\n      // Post-mutation verification: ensure at least one active super admin exists\n      const postUpdateSuperAdmins = await storage.getUsers({ role: \"super_admin\" });\n      const activePostUpdate = postUpdateSuperAdmins.filter(u => u.status === \"active\");\n      if (activePostUpdate.length === 0) {\n        // Rollback: restore original role and status\n        await storage.updateUser(req.params.id, { role: user.role, status: user.status });\n        await firebaseAdmin.auth().setCustomUserClaims(req.params.id, {\n          admin: user.role !== \"customer\",\n          superAdmin: user.role === \"super_admin\",\n        });\n        return res.status(400).json({ error: \"Operation would remove all super admins. Rolled back.\" });\n      }\n\n      // Audit log with verified authenticated user\n      await storage.createAuditLog({\n        actionType: \"deactivate_admin\",\n        performedBy: authenticatedUserId,\n        targetCollection: \"users\",\n        targetId: req.params.id,\n        oldValue: JSON.stringify({ role: user.role, status: user.status }),\n        newValue: JSON.stringify({ role: \"customer\", status: \"blocked\" }),\n      });\n\n      res.json({ success: true, message: \"Admin deactivated\" });\n    } catch (error: any) {\n      console.error(\"Delete admin error:\", error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ==========================================\n  // DELEGATE (DRIVER) ROUTES\n  // ==========================================\n  \n  const { requireDelegate, requireAuth } = await import(\"./firebase-admin\");\n\n  // Get delegate profile\n  app.get(\"/api/delegate/profile\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const delegate = await storage.getUser(delegateId);\n      if (!delegate || (delegate.role !== \"delegate\" && delegate.role !== \"admin\" && delegate.role !== \"super_admin\")) {\n        return res.status(403).json({ error: \"Not a delegate\" });\n      }\n      \n      const { twoFactorSecret, ...safeDelegate } = delegate;\n      res.json(safeDelegate);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Update delegate settings (auto-accept, availability)\n  app.patch(\"/api/delegate/profile\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const { autoAcceptOrders, isAvailable, currentLatitude, currentLongitude } = req.body;\n      \n      const updateData: any = {};\n      if (typeof autoAcceptOrders === \"boolean\") updateData.autoAcceptOrders = autoAcceptOrders;\n      if (typeof isAvailable === \"boolean\") updateData.isAvailable = isAvailable;\n      if (currentLatitude !== undefined) updateData.currentLatitude = currentLatitude;\n      if (currentLongitude !== undefined) updateData.currentLongitude = currentLongitude;\n      \n      const updated = await storage.updateUser(delegateId, updateData);\n      const { twoFactorSecret, ...safeDelegate } = updated!;\n      res.json(safeDelegate);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get available orders for delegate (pending orders in their coverage area)\n  app.get(\"/api/delegate/orders/available\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const delegate = await storage.getUser(delegateId);\n      if (!delegate) {\n        return res.status(404).json({ error: \"Delegate not found\" });\n      }\n      \n      // Get pending orders\n      const allOrders = await storage.getOrders({ status: \"pending\" });\n      \n      // Filter by delegate's coverage areas if set\n      let availableOrders = allOrders;\n      if (delegate.coverageAreas && delegate.coverageAreas.length > 0) {\n        availableOrders = allOrders.filter(order => \n          delegate.coverageAreas!.includes(order.area)\n        );\n      }\n      \n      // Enrich with service package info\n      const enrichedOrders = await Promise.all(availableOrders.map(async (order) => {\n        const servicePackage = await storage.getServicePackage(order.servicePackageId);\n        const customer = await storage.getUser(order.customerId);\n        return {\n          ...order,\n          serviceName: servicePackage?.nameEn || \"Unknown\",\n          serviceNameAr: servicePackage?.nameAr || \"غير معروف\",\n          customerName: customer?.name || \"Customer\",\n          customerPhone: customer?.phone || \"\",\n        };\n      }));\n      \n      res.json(enrichedOrders);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get delegate's current (assigned) orders\n  app.get(\"/api/delegate/orders/current\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      // Get orders assigned to this delegate that are not completed/cancelled\n      const assignedOrders = await storage.getOrders({ assignedDriver: delegateId });\n      const activeOrders = assignedOrders.filter(o => \n        o.status === \"assigned\" || o.status === \"on_the_way\" || o.status === \"in_progress\"\n      );\n      \n      // Enrich with service package and customer info\n      const enrichedOrders = await Promise.all(activeOrders.map(async (order) => {\n        const servicePackage = await storage.getServicePackage(order.servicePackageId);\n        const customer = await storage.getUser(order.customerId);\n        return {\n          ...order,\n          serviceName: servicePackage?.nameEn || \"Unknown\",\n          serviceNameAr: servicePackage?.nameAr || \"غير معروف\",\n          customerName: customer?.name || \"Customer\",\n          customerPhone: customer?.phone || \"\",\n        };\n      }));\n      \n      res.json(enrichedOrders);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get delegate's completed orders (history)\n  app.get(\"/api/delegate/orders/history\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const assignedOrders = await storage.getOrders({ assignedDriver: delegateId });\n      const completedOrders = assignedOrders.filter(o => \n        o.status === \"completed\" || o.status === \"cancelled\"\n      );\n      \n      // Enrich with service package info\n      const enrichedOrders = await Promise.all(completedOrders.map(async (order) => {\n        const servicePackage = await storage.getServicePackage(order.servicePackageId);\n        return {\n          ...order,\n          serviceName: servicePackage?.nameEn || \"Unknown\",\n          serviceNameAr: servicePackage?.nameAr || \"غير معروف\",\n        };\n      }));\n      \n      res.json(enrichedOrders);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get order details for delegate\n  app.get(\"/api/delegate/orders/:id\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n      \n      // Only allow access if order is pending or assigned to this delegate\n      if (order.status !== \"pending\" && order.assignedDriver !== delegateId) {\n        return res.status(403).json({ error: \"Not authorized to view this order\" });\n      }\n      \n      const servicePackage = await storage.getServicePackage(order.servicePackageId);\n      const customer = await storage.getUser(order.customerId);\n      \n      res.json({\n        ...order,\n        serviceName: servicePackage?.nameEn || \"Unknown\",\n        serviceNameAr: servicePackage?.nameAr || \"غير معروف\",\n        estimatedMinutes: servicePackage?.estimatedMinutes || 0,\n        customerName: customer?.name || \"Customer\",\n        customerPhone: customer?.phone || \"\",\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Accept an order\n  app.post(\"/api/delegate/orders/:id/accept\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n      \n      if (order.status !== \"pending\") {\n        return res.status(400).json({ error: \"Order is not available for acceptance\" });\n      }\n      \n      // Check delegate's max active orders\n      const delegate = await storage.getUser(delegateId);\n      if (!delegate) {\n        return res.status(404).json({ error: \"Delegate not found\" });\n      }\n      \n      const currentOrders = await storage.getOrders({ assignedDriver: delegateId });\n      const activeCount = currentOrders.filter(o => \n        o.status === \"assigned\" || o.status === \"on_the_way\" || o.status === \"in_progress\"\n      ).length;\n      \n      if (activeCount >= (delegate.maxActiveOrders || 3)) {\n        return res.status(400).json({ error: \"Maximum active orders reached\" });\n      }\n      \n      const updated = await storage.updateOrder(req.params.id, {\n        status: \"assigned\",\n        assignedDriver: delegateId,\n        assignedAt: new Date(),\n      });\n      \n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Reject an order (log rejection - order stays in pending for other delegates)\n  app.post(\"/api/delegate/orders/:id/reject\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const { reason } = req.body;\n      const order = await storage.getOrder(req.params.id);\n      \n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n      \n      if (order.status !== \"pending\") {\n        return res.status(400).json({ error: \"Order is not available for rejection\" });\n      }\n      \n      // Log the rejection for analytics\n      await storage.createAuditLog({\n        actionType: \"delegate_reject_order\",\n        performedBy: delegateId,\n        targetCollection: \"orders\",\n        targetId: order.id,\n        newValue: JSON.stringify({ reason: reason || \"No reason provided\" }),\n      });\n      \n      res.json({ success: true, message: \"Order rejected\" });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update order status (on_the_way, in_progress, completed)\n  app.patch(\"/api/delegate/orders/:id/status\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const { status, finalPriceKD, isPaid, delegateNotes, beforePhotoUrl, afterPhotoUrl } = req.body;\n      \n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n      \n      if (order.assignedDriver !== delegateId) {\n        return res.status(403).json({ error: \"Not authorized to update this order\" });\n      }\n      \n      // Validate status transitions\n      const validTransitions: Record<string, string[]> = {\n        assigned: [\"on_the_way\", \"cancelled\"],\n        on_the_way: [\"in_progress\", \"cancelled\"],\n        in_progress: [\"completed\", \"cancelled\"],\n      };\n      \n      if (!validTransitions[order.status]?.includes(status)) {\n        return res.status(400).json({ error: `Cannot transition from ${order.status} to ${status}` });\n      }\n      \n      const updateData: any = { status };\n      \n      // Set timestamp based on status\n      if (status === \"on_the_way\") {\n        updateData.onTheWayAt = new Date();\n      } else if (status === \"in_progress\") {\n        updateData.startedAt = new Date();\n      } else if (status === \"completed\") {\n        updateData.completedAt = new Date();\n        if (finalPriceKD !== undefined) updateData.finalPriceKD = finalPriceKD;\n        if (isPaid !== undefined) updateData.isPaid = isPaid;\n        \n        // Calculate and award loyalty points on completion\n        const priceForPoints = finalPriceKD || order.priceKD;\n        const loyaltyConfigData = await storage.getLoyaltyConfig();\n        const pointsPerKD = loyaltyConfigData?.pointsPerKD || 35;\n        const pointsEarned = Math.floor(priceForPoints * pointsPerKD);\n        \n        updateData.loyaltyPointsEarned = pointsEarned;\n        \n        // Add points to customer\n        const customer = await storage.getUser(order.customerId);\n        if (customer) {\n          await storage.updateUser(order.customerId, {\n            loyaltyPoints: customer.loyaltyPoints + pointsEarned,\n          });\n          \n          // Create loyalty transaction\n          await storage.createLoyaltyTransaction({\n            customerId: order.customerId,\n            orderId: order.id,\n            pointsChange: pointsEarned,\n            type: \"earn\",\n            note: `Points earned from order ${order.id}`,\n            createdBy: delegateId,\n          });\n        }\n      }\n      \n      if (delegateNotes) updateData.delegateNotes = delegateNotes;\n      if (beforePhotoUrl) updateData.beforePhotoUrl = beforePhotoUrl;\n      if (afterPhotoUrl) updateData.afterPhotoUrl = afterPhotoUrl;\n      \n      const updated = await storage.updateOrder(req.params.id, updateData);\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get delegate statistics (enhanced with completion time and ratings)\n  app.get(\"/api/delegate/stats\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const { period } = req.query; // today, week, month\n      \n      const assignedOrders = await storage.getOrders({ assignedDriver: delegateId });\n      const ratings = await storage.getOrderRatingsByDelegate(delegateId);\n      \n      // Filter by period\n      const now = new Date();\n      let startDate: Date;\n      \n      switch (period) {\n        case \"today\":\n          startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n          break;\n        case \"week\":\n          startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n          break;\n        case \"month\":\n        default:\n          startDate = new Date(now.getFullYear(), now.getMonth(), 1);\n          break;\n      }\n      \n      const periodOrders = assignedOrders.filter(o => \n        o.completedAt && new Date(o.completedAt) >= startDate\n      );\n      \n      const completedOrders = periodOrders.filter(o => o.status === \"completed\");\n      const totalRevenue = completedOrders.reduce((sum, o) => sum + (o.finalPriceKD || o.priceKD), 0);\n      \n      // Calculate average completion time (from startedAt to completedAt)\n      const ordersWithTime = completedOrders.filter(o => o.startedAt && o.completedAt);\n      let avgCompletionMinutes = 0;\n      if (ordersWithTime.length > 0) {\n        const totalMinutes = ordersWithTime.reduce((sum, o) => {\n          const started = new Date(o.startedAt!).getTime();\n          const completed = new Date(o.completedAt!).getTime();\n          return sum + (completed - started) / 60000;\n        }, 0);\n        avgCompletionMinutes = Math.round(totalMinutes / ordersWithTime.length);\n      }\n      \n      // Calculate average rating\n      const periodRatings = ratings.filter(r => new Date(r.createdAt) >= startDate);\n      const avgRating = periodRatings.length > 0 \n        ? periodRatings.reduce((sum, r) => sum + r.rating, 0) / periodRatings.length \n        : 0;\n      \n      res.json({\n        completedOrdersCount: completedOrders.length,\n        totalRevenue,\n        period: period || \"month\",\n        activeOrdersCount: assignedOrders.filter(o => \n          o.status === \"assigned\" || o.status === \"on_the_way\" || o.status === \"in_progress\"\n        ).length,\n        avgCompletionMinutes,\n        avgRating: Math.round(avgRating * 10) / 10,\n        totalRatings: periodRatings.length,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Update delegate location\n  app.patch(\"/api/delegate/location\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const { latitude, longitude } = req.body;\n      \n      if (typeof latitude !== \"number\" || typeof longitude !== \"number\") {\n        return res.status(400).json({ error: \"Invalid coordinates\" });\n      }\n      \n      const updated = await storage.updateUser(delegateId, {\n        currentLatitude: latitude,\n        currentLongitude: longitude,\n      });\n      \n      res.json({ success: true, location: { latitude, longitude } });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Upload order photos (before/after)\n  app.patch(\"/api/delegate/orders/:id/photos\", requireDelegate, async (req: AuthenticatedRequest, res) => {\n    try {\n      const delegateId = req.user?.uid;\n      if (!delegateId) {\n        return res.status(401).json({ error: \"Not authenticated\" });\n      }\n      \n      const { beforePhotoUrl, afterPhotoUrl } = req.body;\n      \n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n      \n      if (order.assignedDriver !== delegateId) {\n        return res.status(403).json({ error: \"Not authorized to update this order\" });\n      }\n      \n      const updateData: any = {};\n      if (beforePhotoUrl) updateData.beforePhotoUrl = beforePhotoUrl;\n      if (afterPhotoUrl) updateData.afterPhotoUrl = afterPhotoUrl;\n      \n      const updated = await storage.updateOrder(req.params.id, updateData);\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Customer rating for completed order\n  app.post(\"/api/orders/:id/rating\", async (req, res) => {\n    try {\n      const { customerId, rating, comment } = req.body;\n      \n      if (!customerId || !rating || rating < 1 || rating > 5) {\n        return res.status(400).json({ error: \"Invalid rating data\" });\n      }\n      \n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n      \n      if (order.status !== \"completed\") {\n        return res.status(400).json({ error: \"Can only rate completed orders\" });\n      }\n      \n      if (order.customerId !== customerId) {\n        return res.status(403).json({ error: \"Not authorized to rate this order\" });\n      }\n      \n      if (!order.assignedDriver) {\n        return res.status(400).json({ error: \"Order has no assigned delegate\" });\n      }\n      \n      // Check if already rated\n      const existingRating = await storage.getOrderRating(order.id);\n      if (existingRating) {\n        return res.status(400).json({ error: \"Order already rated\" });\n      }\n      \n      const newRating = await storage.createOrderRating({\n        orderId: order.id,\n        customerId,\n        delegateId: order.assignedDriver,\n        rating,\n        comment,\n      });\n      \n      res.json(newRating);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get delegate location for admin/customer tracking\n  app.get(\"/api/orders/:id/delegate-location\", async (req, res) => {\n    try {\n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n      \n      if (!order.assignedDriver) {\n        return res.status(400).json({ error: \"No delegate assigned\" });\n      }\n      \n      if (order.status !== \"on_the_way\") {\n        return res.json({ tracking: false, message: \"Delegate not en route\" });\n      }\n      \n      const delegate = await storage.getUser(order.assignedDriver);\n      if (!delegate) {\n        return res.status(404).json({ error: \"Delegate not found\" });\n      }\n      \n      res.json({\n        tracking: true,\n        latitude: delegate.currentLatitude,\n        longitude: delegate.currentLongitude,\n        delegateName: delegate.name,\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ====================\n  // PAYMENTS ROUTES\n  // ====================\n\n  // Create payment for an order\n  app.post(\"/api/payments/create\", async (req, res) => {\n    try {\n      const { orderId, customerId, amountKD, customerEmail, customerPhone, paymentGateway } = req.body;\n\n      if (!orderId || !customerId || !amountKD) {\n        return res.status(400).json({ error: \"orderId, customerId and amountKD are required\" });\n      }\n\n      // Check if order exists\n      const order = await storage.getOrder(orderId);\n      if (!order) {\n        return res.status(404).json({ error: \"Order not found\" });\n      }\n\n      // Check if payment already exists for this order\n      const existingPayment = await storage.getPaymentByOrderId(orderId);\n      if (existingPayment && existingPayment.status === \"captured\") {\n        return res.status(400).json({ error: \"Order already paid\" });\n      }\n\n      // Create payment record\n      const baseUrl = `${req.protocol}://${req.get(\"host\")}`;\n      const payment = await storage.createPayment({\n        orderId,\n        customerId,\n        amountKD,\n        currency: \"KWD\",\n        status: \"pending\",\n        paymentGateway: paymentGateway || \"tap\",\n        customerEmail,\n        customerPhone,\n        callbackUrl: `${baseUrl}/api/payments/callback`,\n      });\n\n      // TODO: Integrate with actual Tap Payments API\n      // For now, return a mock payment URL that simulates the gateway\n      // In production, this would call Tap Payments API to create a charge\n      const mockPaymentUrl = `${baseUrl}/payment/checkout/${payment.id}`;\n\n      const updated = await storage.updatePayment(payment.id, {\n        status: \"initiated\",\n        paymentUrl: mockPaymentUrl,\n      });\n\n      res.status(201).json({\n        paymentId: payment.id,\n        paymentUrl: mockPaymentUrl,\n        status: \"initiated\",\n      });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Payment webhook callback (for Tap Payments)\n  app.post(\"/api/payments/webhook\", async (req, res) => {\n    try {\n      const { id, status, reference, source, amount, currency, transaction } = req.body;\n\n      // Find payment by gateway charge ID or reference\n      let payment = await storage.getPaymentByGatewayId(id);\n      \n      if (!payment && reference?.payment) {\n        payment = await storage.getPayment(reference.payment);\n      }\n\n      if (!payment) {\n        console.log(\"Payment not found for webhook:\", id);\n        return res.status(200).json({ received: true });\n      }\n\n      // Map Tap status to our status\n      let newStatus: \"pending\" | \"initiated\" | \"captured\" | \"failed\" | \"refunded\" | \"cancelled\" = \"pending\";\n      if (status === \"CAPTURED\") newStatus = \"captured\";\n      else if (status === \"FAILED\") newStatus = \"failed\";\n      else if (status === \"REFUNDED\") newStatus = \"refunded\";\n      else if (status === \"CANCELLED\" || status === \"DECLINED\") newStatus = \"cancelled\";\n\n      const updateData: any = {\n        status: newStatus,\n        gatewayChargeId: id,\n        gatewayResponse: JSON.stringify(req.body),\n      };\n\n      if (source?.payment_method) updateData.cardBrand = source.payment_method;\n      if (source?.last_four) updateData.cardLastFour = source.last_four;\n      if (transaction?.id) updateData.gatewayTransactionId = transaction.id;\n\n      if (newStatus === \"captured\") {\n        updateData.paidAt = new Date();\n        \n        // Update order as paid\n        await storage.updateOrder(payment.orderId, { isPaid: true });\n      }\n\n      await storage.updatePayment(payment.id, updateData);\n\n      res.json({ received: true });\n    } catch (error: any) {\n      console.error(\"Webhook error:\", error);\n      res.status(200).json({ received: true, error: error.message });\n    }\n  });\n\n  // Get payment status\n  app.get(\"/api/payments/:id\", async (req, res) => {\n    try {\n      const payment = await storage.getPayment(req.params.id);\n      if (!payment) {\n        return res.status(404).json({ error: \"Payment not found\" });\n      }\n      res.json(payment);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get payment by order ID\n  app.get(\"/api/payments/order/:orderId\", async (req, res) => {\n    try {\n      const payment = await storage.getPaymentByOrderId(req.params.orderId);\n      if (!payment) {\n        return res.status(404).json({ error: \"Payment not found for this order\" });\n      }\n      res.json(payment);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Simulate successful payment (DEVELOPMENT ONLY - for testing without real gateway)\n  // In production, payments should ONLY be confirmed via webhook from Tap/KNET\n  app.post(\"/api/payments/:id/simulate-success\", async (req, res) => {\n    // SECURITY: Only allow in development environment\n    if (process.env.NODE_ENV === \"production\") {\n      return res.status(403).json({ \n        error: \"Payment simulation is disabled in production. Use real payment gateway.\" \n      });\n    }\n\n    try {\n      const payment = await storage.getPayment(req.params.id);\n      if (!payment) {\n        return res.status(404).json({ error: \"Payment not found\" });\n      }\n\n      if (payment.status === \"captured\") {\n        return res.status(400).json({ error: \"Payment already completed\" });\n      }\n\n      // Update payment as successful\n      await storage.updatePayment(payment.id, {\n        status: \"captured\",\n        paidAt: new Date(),\n        cardBrand: \"KNET\",\n        gatewayTransactionId: `SIM-${Date.now()}`,\n      });\n\n      // Update order as paid\n      await storage.updateOrder(payment.orderId, { isPaid: true });\n\n      res.json({ success: true, message: \"Payment simulated successfully (DEV ONLY)\" });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Simulate failed payment (DEVELOPMENT ONLY - for testing)\n  app.post(\"/api/payments/:id/simulate-failure\", async (req, res) => {\n    // SECURITY: Only allow in development environment\n    if (process.env.NODE_ENV === \"production\") {\n      return res.status(403).json({ \n        error: \"Payment simulation is disabled in production. Use real payment gateway.\" \n      });\n    }\n\n    try {\n      const payment = await storage.getPayment(req.params.id);\n      if (!payment) {\n        return res.status(404).json({ error: \"Payment not found\" });\n      }\n\n      if (payment.status === \"captured\") {\n        return res.status(400).json({ error: \"Cannot fail a completed payment\" });\n      }\n\n      await storage.updatePayment(payment.id, {\n        status: \"failed\",\n        errorMessage: req.body.errorMessage || \"Payment declined\",\n      });\n\n      res.json({ success: true, message: \"Payment failure simulated (DEV ONLY)\" });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Customer payment history\n  app.get(\"/api/payments/customer/:customerId\", async (req, res) => {\n    try {\n      const payments = await storage.getPaymentsByCustomer(req.params.customerId);\n      res.json(payments);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Reverse geocoding endpoint (proxied through backend for proper headers)\n  app.get(\"/api/geocode/reverse\", async (req, res) => {\n    try {\n      const { lat, lon, lang } = req.query;\n      \n      if (!lat || !lon) {\n        return res.status(400).json({ error: \"lat and lon are required\" });\n      }\n\n      const response = await fetch(\n        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=${lang || 'ar'}`,\n        {\n          headers: {\n            \"User-Agent\": \"GhaslaStyle-CarWash/1.0 (https://ghaslastyle.com)\",\n            \"Accept\": \"application/json\",\n          },\n        }\n      );\n      \n      const data = await response.json();\n      res.json(data);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // IP-based location fallback (for when browser geolocation fails)\n  app.get(\"/api/geocode/ip-location\", async (req, res) => {\n    try {\n      // Use ip-api.com for IP-based location (free, no API key needed)\n      const clientIP = req.headers[\"x-forwarded-for\"] || req.socket.remoteAddress || \"\";\n      const ip = typeof clientIP === \"string\" ? clientIP.split(\",\")[0].trim() : \"\";\n      \n      // For localhost/private IPs, return Kuwait City as default\n      if (!ip || ip === \"127.0.0.1\" || ip === \"::1\" || ip.startsWith(\"192.168.\") || ip.startsWith(\"10.\")) {\n        return res.json({\n          success: true,\n          country: \"Kuwait\",\n          city: \"Kuwait City\",\n          lat: 29.3759,\n          lon: 47.9774,\n          isDefault: true,\n        });\n      }\n\n      const response = await fetch(`http://ip-api.com/json/${ip}?fields=status,country,city,lat,lon`);\n      const data = await response.json();\n      \n      if (data.status === \"success\") {\n        res.json({\n          success: true,\n          country: data.country,\n          city: data.city,\n          lat: data.lat,\n          lon: data.lon,\n          isDefault: false,\n        });\n      } else {\n        // Fallback to Kuwait City\n        res.json({\n          success: true,\n          country: \"Kuwait\",\n          city: \"Kuwait City\",\n          lat: 29.3759,\n          lon: 47.9774,\n          isDefault: true,\n        });\n      }\n    } catch (error: any) {\n      // Fallback to Kuwait City on error\n      res.json({\n        success: true,\n        country: \"Kuwait\",\n        city: \"Kuwait City\",\n        lat: 29.3759,\n        lon: 47.9774,\n        isDefault: true,\n      });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":84146,"size_tokens":null},"client/src/components/layout/WhatsAppButton.tsx":{"content":"import { SiWhatsapp } from \"react-icons/si\";\n\nexport function WhatsAppButton() {\n  return (\n    <a\n      href=\"https://wa.me/96597960808\"\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className=\"fixed bottom-6 end-6 z-50 flex h-14 w-14 items-center justify-center rounded-full bg-[#25D366] text-white shadow-lg transition-transform hover:scale-110 animate-pulse hover:animate-none\"\n      data-testid=\"whatsapp-floating-button\"\n      aria-label=\"Contact via WhatsApp\"\n    >\n      <SiWhatsapp className=\"h-7 w-7\" />\n    </a>\n  );\n}\n","path":null,"size_bytes":544,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/pages/Home.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { \n  Car, Sparkles, Crown, Calendar, MapPin, Clock, Shield, Star, \n  Users, Truck, Phone, X, Check, ChevronDown, MessageCircle, Search, Package, Tag, ShoppingCart\n} from \"lucide-react\";\nimport type { Offer, ServicePackage } from \"@shared/schema\";\nimport { SiWhatsapp } from \"react-icons/si\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { Badge } from \"@/components/ui/badge\";\nimport heroImage from \"@assets/generated_images/luxury_car_with_water_droplets.png\";\nimport fleetImage from \"@assets/generated_images/branded_mobile_wash_van.png\";\nimport beforeAfterExterior from \"@assets/generated_images/range_rover_wash_comparison.png\";\nimport beforeAfterInterior from \"@assets/generated_images/bmw_interior_cleaning_comparison.png\";\nimport beforeAfterDetailing from \"@assets/generated_images/mercedes_detailing_before_after.png\";\nimport serviceExteriorBg from \"@assets/generated_images/premium_sedan_car_wash.png\";\nimport serviceInteriorBg from \"@assets/generated_images/premium_car_interior_clean.png\";\nimport serviceVipBg from \"@assets/generated_images/luxury_suv_detailing_studio.png\";\n\nconst fadeInUp = {\n  hidden: { opacity: 0, y: 30 },\n  visible: { opacity: 1, y: 0, transition: { duration: 0.6, ease: \"easeOut\" } }\n};\n\nconst fadeIn = {\n  hidden: { opacity: 0 },\n  visible: { opacity: 1, transition: { duration: 0.5 } }\n};\n\nconst staggerContainer = {\n  hidden: { opacity: 0 },\n  visible: { opacity: 1, transition: { staggerChildren: 0.15 } }\n};\n\nconst slideInLeft = {\n  hidden: { opacity: 0, x: -50 },\n  visible: { opacity: 1, x: 0, transition: { duration: 0.6, ease: \"easeOut\" } }\n};\n\nconst slideInRight = {\n  hidden: { opacity: 0, x: 50 },\n  visible: { opacity: 1, x: 0, transition: { duration: 0.6, ease: \"easeOut\" } }\n};\n\nconst scaleIn = {\n  hidden: { opacity: 0, scale: 0.9 },\n  visible: { opacity: 1, scale: 1, transition: { duration: 0.5 } }\n};\n\n// Order tracking types\ninterface TrackedOrder {\n  id: string;\n  status: string;\n  carType: string;\n  preferredDate: string;\n  preferredTime: string;\n  area: string;\n  createdAt: string;\n  completedAt: string | null;\n  assignedDriver: string | null;\n  serviceName: { ar: string; en: string; fr: string } | null;\n}\n\nexport default function Home() {\n  const { t, i18n } = useTranslation();\n  const { user } = useAuth();\n  const [showOffer, setShowOffer] = useState(false);\n  const [carType, setCarType] = useState<\"sedan\" | \"suv\">(\"sedan\");\n  const [service, setService] = useState(\"full\");\n  const [scheduleType, setScheduleType] = useState<\"now\" | \"later\">(\"now\");\n  const [sliderPositions, setSliderPositions] = useState<{[key: number]: number}>({1: 50, 2: 50, 3: 50});\n\n  // Fetch active offers\n  const { data: activeOffers } = useQuery<Offer[]>({\n    queryKey: [\"/api/offers/active\"],\n  });\n\n  // Fetch service packages for actual prices\n  const { data: servicePackages } = useQuery<ServicePackage[]>({\n    queryKey: [\"/api/packages\"],\n  });\n  \n  // Order tracking state\n  const [trackingId, setTrackingId] = useState(\"\");\n  const [trackedOrder, setTrackedOrder] = useState<TrackedOrder | null>(null);\n  const [trackingError, setTrackingError] = useState(\"\");\n  const [isTracking, setIsTracking] = useState(false);\n\n  const handleTrackOrder = async () => {\n    if (!trackingId.trim()) {\n      setTrackingError(getLocalizedText(\n        \"الرجاء إدخال رقم الطلب\",\n        \"Please enter an order ID\",\n        \"Veuillez entrer un numéro de commande\"\n      ));\n      return;\n    }\n    \n    setIsTracking(true);\n    setTrackingError(\"\");\n    setTrackedOrder(null);\n    \n    try {\n      const response = await fetch(`/api/orders/track/${trackingId.trim()}`);\n      if (!response.ok) {\n        throw new Error(\"not_found\");\n      }\n      const data = await response.json();\n      setTrackedOrder(data);\n    } catch (error) {\n      setTrackingError(getLocalizedText(\n        \"الطلب غير موجود - يرجى التحقق من رقم الطلب أو تسجيل الدخول إلى حسابك\",\n        \"Order not found – please check your ID or log in to your account\",\n        \"Commande non trouvée – veuillez vérifier votre numéro ou vous connecter\"\n      ));\n    } finally {\n      setIsTracking(false);\n    }\n  };\n\n  const getStatusStep = (status: string) => {\n    const steps = [\"pending\", \"assigned\", \"in_progress\", \"completed\"];\n    return steps.indexOf(status) + 1;\n  };\n\n  const getStatusLabel = (status: string) => {\n    const labels: Record<string, { ar: string; en: string; fr: string }> = {\n      pending: { ar: \"قيد الانتظار\", en: \"Pending\", fr: \"En attente\" },\n      assigned: { ar: \"تم التخصيص\", en: \"Assigned\", fr: \"Assigné\" },\n      in_progress: { ar: \"قيد التنفيذ\", en: \"In Progress\", fr: \"En cours\" },\n      completed: { ar: \"مكتمل\", en: \"Completed\", fr: \"Terminé\" },\n      cancelled: { ar: \"ملغي\", en: \"Cancelled\", fr: \"Annulé\" },\n    };\n    const label = labels[status] || labels.pending;\n    return getLocalizedText(label.ar, label.en, label.fr);\n  };\n\n  const handleSliderChange = (id: number, value: number) => {\n    setSliderPositions(prev => ({ ...prev, [id]: value }));\n  };\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  useEffect(() => {\n    const hasSeenOffer = localStorage.getItem(\"ghasla_offer_seen\");\n    if (!hasSeenOffer) {\n      const timer = setTimeout(() => setShowOffer(true), 1500);\n      return () => clearTimeout(timer);\n    }\n  }, []);\n\n  const closeOffer = () => {\n    setShowOffer(false);\n    localStorage.setItem(\"ghasla_offer_seen\", \"true\");\n  };\n\n  // Get prices from API or use fallback\n  const getPackagePrice = (category: string, type: \"sedan\" | \"suv\"): number => {\n    const pkg = servicePackages?.find(p => p.category === category);\n    if (pkg) {\n      return type === \"suv\" ? pkg.priceSuvKD : pkg.priceSedanKD;\n    }\n    // Fallback prices if API not loaded yet\n    const fallbackPrices: Record<string, { sedan: number; suv: number }> = {\n      exterior: { sedan: 3.5, suv: 4.5 },\n      interior: { sedan: 5, suv: 7 },\n      full: { sedan: 7, suv: 10 },\n      vip: { sedan: 15, suv: 20 },\n      monthly: { sedan: 10, suv: 14 },\n    };\n    return fallbackPrices[category]?.[type] ?? 3;\n  };\n\n  const services = [\n    { id: \"exterior\", nameAr: \"غسيل خارجي\", nameEn: \"Exterior Wash\", nameFr: \"Lavage Extérieur\", sedanPrice: getPackagePrice(\"exterior\", \"sedan\"), suvPrice: getPackagePrice(\"exterior\", \"suv\") },\n    { id: \"interior\", nameAr: \"تنظيف داخلي\", nameEn: \"Interior Clean\", nameFr: \"Nettoyage Intérieur\", sedanPrice: getPackagePrice(\"interior\", \"sedan\"), suvPrice: getPackagePrice(\"interior\", \"suv\") },\n    { id: \"full\", nameAr: \"غسيل كامل\", nameEn: \"Full Wash\", nameFr: \"Lavage Complet\", sedanPrice: getPackagePrice(\"full\", \"sedan\"), suvPrice: getPackagePrice(\"full\", \"suv\") },\n    { id: \"vip\", nameAr: \"VIP / تفصيلي\", nameEn: \"VIP Detailing\", nameFr: \"Détaillage VIP\", sedanPrice: getPackagePrice(\"vip\", \"sedan\"), suvPrice: getPackagePrice(\"vip\", \"suv\") },\n    { id: \"monthly\", nameAr: \"اشتراك شهري\", nameEn: \"Monthly Package\", nameFr: \"Forfait Mensuel\", sedanPrice: getPackagePrice(\"monthly\", \"sedan\"), suvPrice: getPackagePrice(\"monthly\", \"suv\") },\n  ];\n\n  const selectedService = services.find(s => s.id === service) || services[2];\n  const currentPrice = carType === \"suv\" ? selectedService.suvPrice : selectedService.sedanPrice;\n\n  const fleetStats = [\n    { value: \"20\", labelAr: \"دقيقة متوسط الوصول\", labelEn: \"Min Avg Arrival\", labelFr: \"Min Arrivée Moy\" },\n    { value: \"5\", labelAr: \"سيارات مجهزة\", labelEn: \"Equipped Vans\", labelFr: \"Fourgons Équipés\" },\n    { value: \"24/7\", labelAr: \"دعم متواصل\", labelEn: \"Support\", labelFr: \"Support\" },\n  ];\n\n  const serviceCards = [\n    {\n      icon: Car,\n      nameAr: \"غسيل خارجي\",\n      nameEn: \"Exterior Wash\",\n      nameFr: \"Lavage Extérieur\",\n      descAr: \"غسيل شامل للجسم الخارجي مع تنظيف الإطارات والجنوط وتلميع الزجاج\",\n      descEn: \"Complete exterior wash with tire cleaning, rim shine, and window polish\",\n      descFr: \"Lavage extérieur complet avec nettoyage des pneus et polish vitres\",\n      features: [\n        { ar: \"غسيل بالرغوة الكثيفة\", en: \"Foam wash\", fr: \"Lavage mousse\" },\n        { ar: \"تنظيف الإطارات والجنوط\", en: \"Tire & rim clean\", fr: \"Pneus et jantes\" },\n        { ar: \"تلميع الزجاج\", en: \"Glass polish\", fr: \"Polish vitres\" },\n      ],\n      price: getPackagePrice(\"exterior\", \"sedan\"),\n      bgImage: serviceExteriorBg,\n    },\n    {\n      icon: Sparkles,\n      nameAr: \"تنظيف داخلي\",\n      nameEn: \"Interior Cleaning\",\n      nameFr: \"Nettoyage Intérieur\",\n      descAr: \"تنظيف شامل للمقصورة الداخلية مع كنس وتلميع لوحة القيادة والتعقيم\",\n      descEn: \"Complete interior cleaning with vacuuming, dashboard polish, and sanitization\",\n      descFr: \"Nettoyage intérieur complet avec aspiration et désinfection\",\n      features: [\n        { ar: \"كنس شامل\", en: \"Full vacuuming\", fr: \"Aspiration complète\" },\n        { ar: \"تلميع لوحة القيادة\", en: \"Dashboard polish\", fr: \"Polish tableau\" },\n        { ar: \"تعقيم وتعطير\", en: \"Sanitize & freshen\", fr: \"Désinfection\" },\n      ],\n      price: getPackagePrice(\"interior\", \"sedan\"),\n      bgImage: serviceInteriorBg,\n    },\n    {\n      icon: Crown,\n      nameAr: \"VIP تفصيلي\",\n      nameEn: \"VIP Detailing\",\n      nameFr: \"Détaillage VIP\",\n      descAr: \"خدمة تفصيلية شاملة مع تلميع السيارة وحماية الطلاء وتنظيف عميق\",\n      descEn: \"Full detailing service with car polish, paint protection, and deep cleaning\",\n      descFr: \"Service détaillé complet avec polish et protection peinture\",\n      features: [\n        { ar: \"تلميع وحماية الطلاء\", en: \"Polish & protect\", fr: \"Polish & protection\" },\n        { ar: \"تنظيف عميق للمقاعد\", en: \"Deep seat clean\", fr: \"Nettoyage sièges\" },\n        { ar: \"تجديد البلاستيك والجلد\", en: \"Plastic & leather\", fr: \"Plastique & cuir\" },\n      ],\n      price: getPackagePrice(\"vip\", \"sedan\"),\n      bgImage: serviceVipBg,\n    },\n  ];\n\n  const beforeAfterComparisons = [\n    {\n      id: 1,\n      image: beforeAfterDetailing,\n      titleAr: \"تفصيل كامل\",\n      titleEn: \"Full Detailing\",\n      titleFr: \"Détaillage Complet\",\n      ctaAr: \"حوّل الطلاء الباهت إلى لمعان مرآة كصالة العرض.\",\n      ctaEn: \"Turn dull paint into a mirror-finish showroom shine.\",\n      ctaFr: \"Transformez une peinture terne en une brillance de showroom.\",\n      whatsappMessageAr: \"مرحباً، أريد حجز خدمة التفصيل الكامل.\",\n      whatsappMessageEn: \"Hi, I'd like to book a Full Detailing service.\",\n      whatsappMessageFr: \"Bonjour, je voudrais réserver un service de détaillage complet.\",\n    },\n    {\n      id: 2,\n      image: beforeAfterInterior,\n      titleAr: \"تنظيف داخلي عميق\",\n      titleEn: \"Interior Deep Clean\",\n      titleFr: \"Nettoyage Intérieur Profond\",\n      ctaAr: \"استنشق هواءً نقياً في مقصورة نظيفة كل رحلة.\",\n      ctaEn: \"Breathe in a fresh, spotless cabin - every trip.\",\n      ctaFr: \"Respirez un air frais dans un habitacle impeccable.\",\n      whatsappMessageAr: \"مرحباً، أريد حجز خدمة التنظيف الداخلي العميق.\",\n      whatsappMessageEn: \"Hi, I'd like to book an Interior Deep Clean.\",\n      whatsappMessageFr: \"Bonjour, je voudrais réserver un nettoyage intérieur profond.\",\n    },\n    {\n      id: 3,\n      image: beforeAfterExterior,\n      titleAr: \"غسيل خارجي\",\n      titleEn: \"Exterior Wash\",\n      titleFr: \"Lavage Extérieur\",\n      ctaAr: \"أزل أوساخ أسابيع في غسلة واحدة فاخرة.\",\n      ctaEn: \"Remove weeks of dirt in just one premium wash.\",\n      ctaFr: \"Enlevez des semaines de saleté en un seul lavage premium.\",\n      whatsappMessageAr: \"مرحباً، أريد حجز خدمة الغسيل الخارجي.\",\n      whatsappMessageEn: \"Hi, I'd like to book an Exterior Wash.\",\n      whatsappMessageFr: \"Bonjour, je voudrais réserver un lavage extérieur.\",\n    },\n  ];\n\n  return (\n    <div className=\"flex flex-col overflow-hidden\">\n      {/* Opening Offer Modal */}\n      <AnimatePresence>\n        {showOffer && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4\"\n            onClick={closeOffer}\n          >\n            <motion.div\n              initial={{ scale: 0.8, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.8, opacity: 0 }}\n              transition={{ type: \"spring\", duration: 0.5 }}\n              className=\"relative w-full max-w-md bg-gradient-to-br from-primary via-primary to-chart-1 rounded-2xl p-8 text-white text-center shadow-2xl\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <button\n                onClick={closeOffer}\n                className=\"absolute top-4 end-4 p-1 rounded-full bg-white/20 hover:bg-white/30 transition-colors\"\n                data-testid=\"close-offer-modal\"\n              >\n                <X className=\"h-5 w-5\" />\n              </button>\n              <div className=\"mb-4\">\n                <span className=\"inline-block px-4 py-1 bg-white/20 rounded-full text-sm font-medium mb-4\">\n                  {getLocalizedText(\"عرض الافتتاح\", \"Opening Offer\", \"Offre d'Ouverture\")}\n                </span>\n                <h2 className=\"text-4xl md:text-5xl font-bold mb-2\">15% OFF</h2>\n                <p className=\"text-lg opacity-90\">\n                  {getLocalizedText(\n                    \"خصم 15٪ على أول غسلة!\",\n                    \"15% discount on your first wash!\",\n                    \"15% de réduction sur votre premier lavage!\"\n                  )}\n                </p>\n              </div>\n              <Button\n                size=\"lg\"\n                variant=\"secondary\"\n                className=\"w-full text-lg\"\n                onClick={() => {\n                  closeOffer();\n                  document.getElementById(\"booking-card\")?.scrollIntoView({ behavior: \"smooth\" });\n                }}\n                data-testid=\"claim-offer-button\"\n              >\n                {getLocalizedText(\"احجز الآن بخصم 15%\", \"Book Now with 15% OFF\", \"Réserver avec 15% OFF\")}\n              </Button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Hero Section */}\n      <section className=\"relative min-h-[90vh] flex items-center overflow-hidden bg-gradient-to-br from-[#0a1628] via-[#0f2744] to-[#0a1628]\">\n        {/* Background Image */}\n        <div className=\"absolute inset-0\">\n          <img\n            src={heroImage}\n            alt=\"Luxury car wash\"\n            className=\"w-full h-full object-cover opacity-40\"\n          />\n          <div className=\"absolute inset-0 bg-gradient-to-r from-[#0a1628]/90 via-[#0a1628]/70 to-transparent\" />\n        </div>\n\n        {/* Animated particles/gradient overlay */}\n        <div className=\"absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-primary/20 via-transparent to-transparent\" />\n\n        <div className=\"container mx-auto px-4 py-20 relative z-10\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center\">\n            {/* Left Content */}\n            <motion.div\n              initial=\"hidden\"\n              animate=\"visible\"\n              variants={staggerContainer}\n              className=\"text-white space-y-6\"\n            >\n              {/* Logo Placeholder */}\n              <motion.div variants={fadeInUp} className=\"flex items-center gap-3 mb-8\">\n                <div className=\"relative\">\n                  <div className=\"w-14 h-14 rounded-xl bg-gradient-to-br from-primary to-chart-1 flex items-center justify-center\">\n                    <Car className=\"h-8 w-8 text-white\" />\n                    <Sparkles className=\"h-4 w-4 text-white absolute -top-1 -end-1\" />\n                  </div>\n                </div>\n                <div>\n                  <h1 className=\"text-2xl font-bold\">\n                    <span className=\"text-primary\">Ghasla</span> <span className=\"font-normal\">Style</span>\n                  </h1>\n                  <p className=\"text-sm text-white/70 font-arabic\">غسلة ستايل</p>\n                </div>\n              </motion.div>\n\n              <motion.h2 variants={fadeInUp} className=\"text-4xl md:text-5xl lg:text-6xl font-bold leading-tight\">\n                {getLocalizedText(\n                  \"لمعة احترافية عند باب بيتك\",\n                  \"Shiny Car, Happy Journey\",\n                  \"Voiture Brillante, Voyage Heureux\"\n                )}\n              </motion.h2>\n\n              <motion.p variants={fadeInUp} className=\"text-xl text-white/80 max-w-lg\">\n                {t(\"hero.description\")}\n              </motion.p>\n\n              <motion.div variants={fadeInUp} className=\"flex flex-wrap items-center gap-4 pt-4\">\n                <div className=\"flex items-center gap-2 text-white/70\">\n                  <Shield className=\"h-5 w-5 text-primary\" />\n                  <span>{getLocalizedText(\"جودة مضمونة\", \"Quality Guaranteed\", \"Qualité Garantie\")}</span>\n                </div>\n                <div className=\"flex items-center gap-2 text-white/70\">\n                  <Clock className=\"h-5 w-5 text-primary\" />\n                  <span>{getLocalizedText(\"خدمة سريعة\", \"Fast Service\", \"Service Rapide\")}</span>\n                </div>\n                <div className=\"flex items-center gap-2 text-white/70\">\n                  <MapPin className=\"h-5 w-5 text-primary\" />\n                  <span>{getLocalizedText(\"19 منطقة متاحة\", \"19 Areas Available\", \"19 zones disponibles\")}</span>\n                </div>\n              </motion.div>\n            </motion.div>\n\n            {/* Right - Booking Card */}\n            <motion.div\n              id=\"booking-card\"\n              initial={{ opacity: 0, y: 50, x: 20 }}\n              animate={{ opacity: 1, y: 0, x: 0 }}\n              transition={{ duration: 0.8, delay: 0.3, ease: \"easeOut\" }}\n              className=\"relative\"\n            >\n              <Card className=\"bg-white/95 dark:bg-card/95 backdrop-blur-md shadow-2xl border-0\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"text-xl flex items-center gap-2\">\n                    <Car className=\"h-5 w-5 text-primary\" />\n                    {getLocalizedText(\"احجز غسلتك الآن\", \"Book Your Wash Now\", \"Réservez Maintenant\")}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-5\">\n                  {/* Car Type Toggle */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">{t(\"booking.carType\")}</label>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      {([\"sedan\", \"suv\"] as const).map((type) => (\n                        <button\n                          key={type}\n                          onClick={() => setCarType(type)}\n                          className={`p-3 rounded-lg border-2 transition-all ${\n                            carType === type\n                              ? \"border-primary bg-primary/10 text-primary\"\n                              : \"border-muted hover:border-primary/50\"\n                          }`}\n                          data-testid={`car-type-${type}`}\n                        >\n                          <Car className=\"h-6 w-6 mx-auto mb-1\" />\n                          <span className=\"text-sm font-medium\">\n                            {type === \"sedan\" ? t(\"services.sedan\") : t(\"services.suv\")}\n                          </span>\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n\n                  {/* Service Select */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">{t(\"booking.step2\")}</label>\n                    <Select value={service} onValueChange={setService}>\n                      <SelectTrigger data-testid=\"service-select\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {services.map((s) => (\n                          <SelectItem key={s.id} value={s.id}>\n                            {getLocalizedText(s.nameAr, s.nameEn, s.nameFr)} - {carType === \"suv\" ? s.suvPrice : s.sedanPrice} {t(\"services.kd\")}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  {/* Schedule Toggle */}\n                  <div className=\"space-y-2\">\n                    <label className=\"text-sm font-medium\">\n                      {getLocalizedText(\"وقت الخدمة\", \"Service Time\", \"Heure du Service\")}\n                    </label>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <button\n                        onClick={() => setScheduleType(\"now\")}\n                        className={`p-3 rounded-lg border-2 transition-all text-sm ${\n                          scheduleType === \"now\"\n                            ? \"border-primary bg-primary/10 text-primary\"\n                            : \"border-muted hover:border-primary/50\"\n                        }`}\n                        data-testid=\"schedule-now\"\n                      >\n                        {getLocalizedText(\"اغسل الآن\", \"Wash Now\", \"Laver Maintenant\")}\n                      </button>\n                      <button\n                        onClick={() => setScheduleType(\"later\")}\n                        className={`p-3 rounded-lg border-2 transition-all text-sm ${\n                          scheduleType === \"later\"\n                            ? \"border-primary bg-primary/10 text-primary\"\n                            : \"border-muted hover:border-primary/50\"\n                        }`}\n                        data-testid=\"schedule-later\"\n                      >\n                        {getLocalizedText(\"جدول لاحقاً\", \"Schedule Later\", \"Planifier\")}\n                      </button>\n                    </div>\n                  </div>\n\n                  {/* Dynamic Price */}\n                  <div className=\"p-4 rounded-lg bg-gradient-to-r from-primary/10 to-chart-1/10 border border-primary/20\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-muted-foreground\">\n                        {getLocalizedText(\"السعر الإجمالي\", \"Total Price\", \"Prix Total\")}\n                      </span>\n                      <span className=\"text-3xl font-bold text-primary\">\n                        {currentPrice} <span className=\"text-lg\">{t(\"services.kd\")}</span>\n                      </span>\n                    </div>\n                  </div>\n\n                  {/* Confirm Button */}\n                  <Link href=\"/booking\" className=\"block\">\n                    <Button className=\"w-full text-lg py-6\" size=\"lg\" data-testid=\"hero-confirm-booking\">\n                      {t(\"booking.confirm\")}\n                    </Button>\n                  </Link>\n\n                  {/* WhatsApp Quick Order */}\n                  <a\n                    href={`https://wa.me/96597960808?text=${encodeURIComponent(\n                      getLocalizedText(\n                        `مرحباً، أريد حجز ${getLocalizedText(selectedService.nameAr, selectedService.nameEn, selectedService.nameFr)} لسيارة ${carType === \"suv\" ? \"SUV\" : \"سيدان\"}`,\n                        `Hi, I want to book ${selectedService.nameEn} for a ${carType} car`,\n                        `Bonjour, je veux réserver ${selectedService.nameFr} pour une voiture ${carType}`\n                      )\n                    )}`}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"block\"\n                  >\n                    <Button\n                      variant=\"outline\"\n                      className=\"w-full bg-[#25D366]/10 border-[#25D366] text-[#25D366] hover:bg-[#25D366] hover:text-white\"\n                      data-testid=\"whatsapp-quick-order\"\n                    >\n                      <SiWhatsapp className=\"h-5 w-5 me-2\" />\n                      {getLocalizedText(\"واتساب - حجز سريع\", \"WhatsApp – Quick Book\", \"WhatsApp – Réserver\")}\n                    </Button>\n                  </a>\n                </CardContent>\n              </Card>\n\n              {/* Pulsing WhatsApp Button near card */}\n              <motion.a\n                href=\"https://wa.me/96597960808\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"absolute -bottom-4 start-4 flex items-center gap-2 px-4 py-2 bg-[#25D366] text-white rounded-full shadow-lg\"\n                animate={{ scale: [1, 1.05, 1] }}\n                transition={{ duration: 2, repeat: Infinity, ease: \"easeInOut\" }}\n                data-testid=\"hero-whatsapp-pulse\"\n              >\n                <SiWhatsapp className=\"h-5 w-5\" />\n                <span className=\"text-sm font-medium\">\n                  {getLocalizedText(\"حجز سريع\", \"Quick Book\", \"Réservation\")}\n                </span>\n              </motion.a>\n            </motion.div>\n          </div>\n        </div>\n      </section>\n\n      {/* Active Offers Section */}\n      {activeOffers && activeOffers.length > 0 && (\n        <section className=\"py-12 bg-gradient-to-r from-primary/10 via-chart-1/10 to-primary/10\" data-testid=\"offers-section\">\n          <div className=\"container mx-auto px-4\">\n            <motion.div\n              initial=\"hidden\"\n              whileInView=\"visible\"\n              viewport={{ once: true, margin: \"-50px\" }}\n              variants={staggerContainer}\n            >\n              <motion.div variants={fadeInUp} className=\"text-center mb-8\">\n                <div className=\"flex items-center justify-center gap-2 mb-2\">\n                  <Tag className=\"h-6 w-6 text-primary\" />\n                  <h2 className=\"text-2xl md:text-3xl font-bold\">\n                    {getLocalizedText(\"عروض حصرية\", \"Exclusive Offers\", \"Offres Exclusives\")}\n                  </h2>\n                </div>\n                <p className=\"text-muted-foreground\">\n                  {getLocalizedText(\"استفد من عروضنا المميزة لفترة محدودة\", \"Take advantage of our limited-time offers\", \"Profitez de nos offres à durée limitée\")}\n                </p>\n              </motion.div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {activeOffers.map((offer, index) => (\n                  <motion.div key={offer.id} variants={fadeInUp}>\n                    <Card className=\"overflow-hidden border-2 border-primary/20 bg-gradient-to-br from-card to-card/80 hover-elevate\" data-testid={`home-offer-${offer.id}`}>\n                      {offer.imageUrl && (\n                        <div className=\"relative h-40 overflow-hidden\">\n                          <img src={offer.imageUrl} alt={getLocalizedText(offer.titleAr, offer.titleEn, offer.titleFr)} className=\"w-full h-full object-cover\" />\n                          <div className=\"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent\" />\n                        </div>\n                      )}\n                      <CardContent className={`${offer.imageUrl ? \"pt-4\" : \"pt-6\"} pb-6`}>\n                        <div className=\"flex items-start justify-between gap-2 mb-3\">\n                          <h3 className=\"text-lg font-bold\">\n                            {getLocalizedText(offer.titleAr, offer.titleEn, offer.titleFr)}\n                          </h3>\n                          {(offer.discountPercentage || offer.discountAmountKD) && (\n                            <Badge className=\"bg-primary text-primary-foreground shrink-0\">\n                              {offer.discountPercentage ? `${offer.discountPercentage}%` : `${offer.discountAmountKD} KD`}\n                            </Badge>\n                          )}\n                        </div>\n                        <p className=\"text-muted-foreground text-sm mb-4\">\n                          {getLocalizedText(offer.descriptionAr, offer.descriptionEn, offer.descriptionFr)}\n                        </p>\n                        <div className=\"text-xs text-muted-foreground mb-3\">\n                          {getLocalizedText(\"ينتهي:\", \"Ends:\", \"Expire:\")} {new Date(offer.endDate).toLocaleDateString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\")}\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Link href=\"/booking\" className=\"flex-1\">\n                            <Button size=\"sm\" className=\"w-full\" data-testid={`offer-book-regular-${offer.id}`}>\n                              <ShoppingCart className=\"h-4 w-4 me-1\" />\n                              {getLocalizedText(\"احجز الآن\", \"Book Now\", \"Réserver\")}\n                            </Button>\n                          </Link>\n                          <a href=\"https://wa.me/96597960808\" target=\"_blank\" rel=\"noopener noreferrer\">\n                            <Button size=\"sm\" variant=\"outline\" className=\"border-[#25D366] text-[#25D366]\" data-testid={`offer-book-whatsapp-${offer.id}`}>\n                              <SiWhatsapp className=\"h-4 w-4\" />\n                            </Button>\n                          </a>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </motion.div>\n                ))}\n              </div>\n            </motion.div>\n          </div>\n        </section>\n      )}\n\n      {/* Track Your Order Section */}\n      <section className=\"py-16 bg-gradient-to-br from-muted/50 to-muted/30\">\n        <div className=\"container mx-auto px-4\">\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true, margin: \"-50px\" }}\n            variants={staggerContainer}\n            className=\"max-w-2xl mx-auto\"\n          >\n            <motion.div variants={fadeInUp} className=\"text-center mb-8\">\n              <h2 className=\"text-3xl md:text-4xl font-bold mb-3\">\n                {getLocalizedText(\"تتبع طلبك\", \"Track Your Order\", \"Suivre Votre Commande\")}\n              </h2>\n              <p className=\"text-muted-foreground text-lg\">\n                تتبع حالة طلب غسلتك خطوة بخطوة برقم الطلب أو من حسابك مباشرة\n              </p>\n            </motion.div>\n\n            <motion.div variants={fadeInUp}>\n              <Card className=\"shadow-lg\">\n                <CardContent className=\"p-6 space-y-4\">\n                  <div className=\"flex flex-col sm:flex-row gap-3\">\n                    <div className=\"flex-1 relative\">\n                      <Search className=\"absolute start-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground\" />\n                      <Input\n                        placeholder={getLocalizedText(\"أدخل رقم الطلب\", \"Enter Order ID\", \"Entrez le numéro de commande\")}\n                        value={trackingId}\n                        onChange={(e) => {\n                          setTrackingId(e.target.value);\n                          setTrackingError(\"\");\n                        }}\n                        onKeyDown={(e) => e.key === \"Enter\" && handleTrackOrder()}\n                        className=\"ps-10\"\n                        data-testid=\"input-tracking-id\"\n                      />\n                    </div>\n                    <Button \n                      onClick={handleTrackOrder} \n                      disabled={isTracking}\n                      className=\"min-w-[120px]\"\n                      data-testid=\"button-track-order\"\n                    >\n                      {isTracking ? (\n                        <motion.div\n                          animate={{ rotate: 360 }}\n                          transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                          className=\"h-4 w-4 border-2 border-white border-t-transparent rounded-full\"\n                        />\n                      ) : (\n                        getLocalizedText(\"تتبع الآن\", \"Track Now\", \"Suivre\")\n                      )}\n                    </Button>\n                  </div>\n\n                  {/* Error Message */}\n                  {trackingError && (\n                    <motion.p\n                      initial={{ opacity: 0, y: -10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      className=\"text-destructive text-sm text-center\"\n                    >\n                      {trackingError}\n                    </motion.p>\n                  )}\n\n                  {/* Tracked Order Result */}\n                  <AnimatePresence>\n                    {trackedOrder && (\n                      <motion.div\n                        initial={{ opacity: 0, height: 0 }}\n                        animate={{ opacity: 1, height: \"auto\" }}\n                        exit={{ opacity: 0, height: 0 }}\n                        className=\"overflow-hidden\"\n                      >\n                        <div className=\"mt-4 p-4 rounded-lg bg-muted/50 border space-y-4\">\n                          {/* Order Info */}\n                          <div className=\"flex flex-wrap items-center justify-between gap-2\">\n                            <div className=\"flex items-center gap-2\">\n                              <Package className=\"h-5 w-5 text-primary\" />\n                              <span className=\"font-medium\">\n                                {trackedOrder.serviceName \n                                  ? getLocalizedText(\n                                      trackedOrder.serviceName.ar,\n                                      trackedOrder.serviceName.en,\n                                      trackedOrder.serviceName.fr\n                                    )\n                                  : \"Service\"}\n                              </span>\n                            </div>\n                            <Badge variant={trackedOrder.status === \"completed\" ? \"default\" : trackedOrder.status === \"cancelled\" ? \"destructive\" : \"secondary\"}>\n                              {getStatusLabel(trackedOrder.status)}\n                            </Badge>\n                          </div>\n\n                          {/* Order Details */}\n                          <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                            <div className=\"flex items-center gap-2\">\n                              <Car className=\"h-4 w-4 text-muted-foreground\" />\n                              <span className=\"text-muted-foreground\">\n                                {trackedOrder.carType === \"suv\" ? \"SUV\" : getLocalizedText(\"سيدان\", \"Sedan\", \"Berline\")}\n                              </span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                              <span className=\"text-muted-foreground\">{trackedOrder.area}</span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                              <span className=\"text-muted-foreground\">{trackedOrder.preferredDate}</span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                              <span className=\"text-muted-foreground\">{trackedOrder.preferredTime}</span>\n                            </div>\n                          </div>\n\n                          {/* Progress Stepper */}\n                          {trackedOrder.status !== \"cancelled\" && (\n                            <div className=\"pt-4\">\n                              <div className=\"flex items-center justify-between relative\">\n                                <div className=\"absolute top-3 start-0 end-0 h-1 bg-muted rounded-full\">\n                                  <motion.div\n                                    initial={{ width: 0 }}\n                                    animate={{ width: `${Math.min((getStatusStep(trackedOrder.status) / 4) * 100, 100)}%` }}\n                                    transition={{ duration: 0.5, delay: 0.2 }}\n                                    className=\"h-full bg-primary rounded-full\"\n                                  />\n                                </div>\n                                {[\"pending\", \"assigned\", \"in_progress\", \"completed\"].map((step, index) => (\n                                  <div key={step} className=\"relative z-10 flex flex-col items-center\">\n                                    <div\n                                      className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium ${\n                                        getStatusStep(trackedOrder.status) > index\n                                          ? \"bg-primary text-white\"\n                                          : \"bg-muted border-2 border-muted-foreground/30 text-muted-foreground\"\n                                      }`}\n                                    >\n                                      {getStatusStep(trackedOrder.status) > index ? (\n                                        <Check className=\"h-3 w-3\" />\n                                      ) : (\n                                        index + 1\n                                      )}\n                                    </div>\n                                    <span className=\"text-xs text-muted-foreground mt-1 hidden sm:block\">\n                                      {getStatusLabel(step)}\n                                    </span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      </motion.div>\n                    )}\n                  </AnimatePresence>\n\n                  {/* View All Orders Link (for logged-in users) */}\n                  {user && (\n                    <motion.div variants={fadeIn} className=\"text-center pt-2\">\n                      <Link href=\"/track-order\">\n                        <Button variant=\"ghost\" className=\"text-primary underline underline-offset-4\" data-testid=\"link-view-all-orders\">\n                          {getLocalizedText(\"عرض جميع طلباتي\", \"View all my orders\", \"Voir toutes mes commandes\")}\n                        </Button>\n                      </Link>\n                    </motion.div>\n                  )}\n                </CardContent>\n              </Card>\n            </motion.div>\n          </motion.div>\n        </div>\n      </section>\n\n      {/* Fleet Section */}\n      <section className=\"py-20 bg-muted/30\">\n        <div className=\"container mx-auto px-4\">\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true, margin: \"-100px\" }}\n            variants={staggerContainer}\n            className=\"text-center mb-12\"\n          >\n            <motion.h2 variants={fadeInUp} className=\"text-3xl md:text-4xl font-bold mb-4\">\n              {getLocalizedText(\"أسطولنا جاهز لخدمتك\", \"Our Fleet is Ready for Your Wash\", \"Notre Flotte est Prête\")}\n            </motion.h2>\n            <motion.p variants={fadeInUp} className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              {getLocalizedText(\n                \"فريقنا المحترف يغطي 19 منطقة في الكويت بسيارات مجهزة بأحدث المعدات\",\n                \"Our professional team covers 19 areas in Kuwait with fully equipped vehicles\",\n                \"Notre équipe professionnelle couvre 19 zones au Koweït avec des véhicules équipés\"\n              )}\n            </motion.p>\n          </motion.div>\n\n          {/* Stats */}\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true }}\n            variants={staggerContainer}\n            className=\"grid grid-cols-3 gap-6 max-w-2xl mx-auto mb-12\"\n          >\n            {fleetStats.map((stat, index) => (\n              <motion.div key={index} variants={scaleIn} className=\"text-center\">\n                <div className=\"text-4xl md:text-5xl font-bold text-primary mb-2\">{stat.value}</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  {getLocalizedText(stat.labelAr, stat.labelEn, stat.labelFr)}\n                </div>\n              </motion.div>\n            ))}\n          </motion.div>\n\n          {/* Fleet Image */}\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true, margin: \"-50px\" }}\n            variants={fadeInUp}\n            className=\"relative max-w-4xl mx-auto rounded-2xl overflow-hidden shadow-2xl\"\n          >\n            <img\n              src={fleetImage}\n              alt=\"Ghasla Style Fleet\"\n              className=\"w-full h-auto\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent\" />\n            <div className=\"absolute bottom-6 start-6 end-6 flex items-center justify-between\">\n              <div className=\"text-white\">\n                <p className=\"text-lg font-semibold\">\n                  {getLocalizedText(\"5 سيارات متنقلة\", \"5 Mobile Vans\", \"5 Fourgons Mobiles\")}\n                </p>\n                <p className=\"text-sm text-white/70\">\n                  {getLocalizedText(\"فريق من 5 محترفين\", \"Team of 5 professionals\", \"Équipe de 5 professionnels\")}\n                </p>\n              </div>\n              <Badge className=\"bg-primary/90\">\n                <Truck className=\"h-4 w-4 me-1\" />\n                {getLocalizedText(\"تغطية شاملة\", \"Full Coverage\", \"Couverture Totale\")}\n              </Badge>\n            </div>\n          </motion.div>\n        </div>\n      </section>\n\n      {/* Services Section */}\n      <section className=\"py-20\">\n        <div className=\"container mx-auto px-4\">\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true }}\n            variants={staggerContainer}\n            className=\"text-center mb-12\"\n          >\n            <motion.h2 variants={fadeInUp} className=\"text-3xl md:text-4xl font-bold mb-4\">\n              {t(\"services.title\")}\n            </motion.h2>\n            <motion.p variants={fadeInUp} className=\"text-lg text-muted-foreground\">\n              {t(\"services.subtitle\")}\n            </motion.p>\n          </motion.div>\n\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true }}\n            variants={staggerContainer}\n            className=\"grid grid-cols-1 md:grid-cols-3 gap-8\"\n          >\n            {serviceCards.map((card, index) => (\n              <motion.div key={index} variants={fadeInUp}>\n                <Card className=\"h-full overflow-hidden group hover:shadow-2xl transition-all duration-500 hover:-translate-y-2\">\n                  <div className=\"h-52 relative overflow-hidden\">\n                    <img\n                      src={card.bgImage}\n                      alt={getLocalizedText(card.nameAr, card.nameEn, card.nameFr)}\n                      className=\"w-full h-full object-cover transition-all duration-700 group-hover:scale-110 group-hover:brightness-110\"\n                    />\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-black/20\" />\n                    <div className=\"absolute inset-0 flex items-center justify-center\">\n                      <div className=\"w-20 h-20 rounded-full bg-primary/90 flex items-center justify-center transition-transform duration-500 group-hover:scale-110 shadow-lg\">\n                        <card.icon className=\"h-10 w-10 text-primary-foreground\" />\n                      </div>\n                    </div>\n                    <div className=\"absolute bottom-4 start-4 end-4\">\n                      <h3 className=\"text-xl font-bold text-white drop-shadow-lg\">\n                        {getLocalizedText(card.nameAr, card.nameEn, card.nameFr)}\n                      </h3>\n                    </div>\n                  </div>\n                  <CardContent className=\"space-y-4 pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">\n                      {getLocalizedText(card.descAr, card.descEn, card.descFr)}\n                    </p>\n                    <ul className=\"space-y-2\">\n                      {card.features.map((feature, i) => (\n                        <li key={i} className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                          <Check className=\"h-4 w-4 text-primary flex-shrink-0\" />\n                          {getLocalizedText(feature.ar, feature.en, feature.fr)}\n                        </li>\n                      ))}\n                    </ul>\n                    <div className=\"pt-4 border-t\">\n                      <p className=\"text-sm text-muted-foreground mb-1\">\n                        {getLocalizedText(\"يبدأ من\", \"From\", \"À partir de\")}\n                      </p>\n                      <p className=\"text-2xl font-bold text-primary\">\n                        {card.price} {t(\"services.kd\")}\n                      </p>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <Link href=\"/booking\" className=\"flex-1\">\n                        <Button className=\"w-full\" data-testid={`book-service-${index}`}>\n                          {t(\"hero.bookNow\")}\n                        </Button>\n                      </Link>\n                      <a\n                        href=\"https://wa.me/96597960808\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        <Button variant=\"outline\" size=\"icon\" className=\"border-[#25D366] text-[#25D366] hover:bg-[#25D366] hover:text-white\">\n                          <SiWhatsapp className=\"h-5 w-5\" />\n                        </Button>\n                      </a>\n                    </div>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            ))}\n          </motion.div>\n\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true }}\n            variants={fadeIn}\n            className=\"text-center mt-10\"\n          >\n            <Link href=\"/services\">\n              <Button variant=\"outline\" size=\"lg\">\n                {getLocalizedText(\"عرض جميع الخدمات\", \"View All Services\", \"Voir Tous les Services\")}\n              </Button>\n            </Link>\n          </motion.div>\n        </div>\n      </section>\n\n      {/* Before & After Section */}\n      <section className=\"py-20 bg-gradient-to-br from-[#0a1628] to-[#0f2744] text-white\">\n        <div className=\"container mx-auto px-4\">\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true }}\n            variants={staggerContainer}\n            className=\"text-center mb-12\"\n          >\n            <motion.h2 variants={fadeInUp} className=\"text-3xl md:text-4xl font-bold mb-4\">\n              {getLocalizedText(\"نتائج قبل وبعد\", \"Before & After Results\", \"Résultats Avant & Après\")}\n            </motion.h2>\n            <motion.p variants={fadeInUp} className=\"text-lg text-white/70 max-w-2xl mx-auto\">\n              {getLocalizedText(\n                \"شاهد الفرق الذي نصنعه - نتائج حقيقية من عملائنا السعداء\",\n                \"See the difference we make - real results from our happy customers\",\n                \"Voyez la différence que nous faisons - résultats réels de nos clients satisfaits\"\n              )}\n            </motion.p>\n          </motion.div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {beforeAfterComparisons.map((comparison, index) => (\n              <motion.div\n                key={comparison.id}\n                initial={{ opacity: 0, y: 40 }}\n                whileInView={{ opacity: 1, y: 0 }}\n                viewport={{ once: true }}\n                transition={{ duration: 0.6, delay: index * 0.15, ease: \"easeOut\" }}\n                className=\"group\"\n              >\n                <div className=\"relative rounded-xl overflow-hidden shadow-2xl bg-black/30 backdrop-blur-sm border border-white/10 transition-all duration-500 group-hover:shadow-[0_0_30px_rgba(249,115,22,0.3)] group-hover:border-primary/30\">\n                  <div className=\"relative aspect-video overflow-hidden select-none\">\n                    <img\n                      src={comparison.image}\n                      alt={comparison.titleEn}\n                      className=\"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110\"\n                      draggable={false}\n                    />\n                    <div \n                      className=\"absolute inset-0 bg-gradient-to-r from-black/60 to-transparent transition-opacity duration-300 group-hover:opacity-80\"\n                      style={{ \n                        clipPath: `inset(0 ${100 - sliderPositions[comparison.id]}% 0 0)` \n                      }}\n                    />\n                    <div \n                      className=\"absolute top-0 bottom-0 w-1 bg-white shadow-lg cursor-ew-resize z-10 transition-all duration-300 group-hover:shadow-[0_0_15px_rgba(255,255,255,0.5)]\"\n                      style={{ left: `${sliderPositions[comparison.id]}%`, transform: 'translateX(-50%)' }}\n                    >\n                      <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white rounded-full shadow-lg flex items-center justify-center transition-transform duration-300 group-hover:scale-110\">\n                        <div className=\"flex gap-0.5\">\n                          <div className=\"w-0.5 h-3 bg-gray-400 rounded-full\" />\n                          <div className=\"w-0.5 h-3 bg-gray-400 rounded-full\" />\n                        </div>\n                      </div>\n                    </div>\n                    <input\n                      type=\"range\"\n                      min=\"0\"\n                      max=\"100\"\n                      value={sliderPositions[comparison.id]}\n                      onChange={(e) => handleSliderChange(comparison.id, parseInt(e.target.value))}\n                      className=\"absolute inset-0 w-full h-full opacity-0 cursor-ew-resize z-20\"\n                      data-testid={`slider-before-after-${comparison.id}`}\n                    />\n                    <motion.div \n                      initial={{ opacity: 0, x: -10 }}\n                      whileInView={{ opacity: 1, x: 0 }}\n                      transition={{ delay: 0.3 + index * 0.15 }}\n                      className=\"absolute top-3 left-3 z-10\"\n                    >\n                      <Badge className=\"bg-gray-600/90 text-white shadow-lg backdrop-blur-sm px-3 py-1\">\n                        {getLocalizedText(\"قبل\", \"Before\", \"Avant\")}\n                      </Badge>\n                    </motion.div>\n                    <motion.div \n                      initial={{ opacity: 0, x: 10 }}\n                      whileInView={{ opacity: 1, x: 0 }}\n                      transition={{ delay: 0.3 + index * 0.15 }}\n                      className=\"absolute top-3 right-3 z-10\"\n                    >\n                      <Badge className=\"bg-primary text-primary-foreground shadow-lg backdrop-blur-sm px-3 py-1\">\n                        {getLocalizedText(\"بعد\", \"After\", \"Après\")}\n                      </Badge>\n                    </motion.div>\n                  </div>\n                  <div className=\"p-5 text-center space-y-3\">\n                    <h3 className=\"text-xl font-bold\">\n                      {getLocalizedText(comparison.titleAr, comparison.titleEn, comparison.titleFr)}\n                    </h3>\n                    <p className=\"text-sm text-white/70 leading-relaxed\">\n                      {getLocalizedText(comparison.ctaAr, comparison.ctaEn, comparison.ctaFr)}\n                    </p>\n                    <a\n                      href={`https://wa.me/96597960808?text=${encodeURIComponent(getLocalizedText(comparison.whatsappMessageAr, comparison.whatsappMessageEn, comparison.whatsappMessageFr))}`}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"inline-block\"\n                    >\n                      <Button \n                        className=\"bg-[#25D366] hover:bg-[#128C7E] text-white font-medium transition-all duration-300 hover:scale-105 shadow-lg hover:shadow-[0_0_20px_rgba(37,211,102,0.4)]\"\n                        data-testid={`whatsapp-order-${comparison.id}`}\n                      >\n                        <SiWhatsapp className=\"h-5 w-5 me-2\" />\n                        {getLocalizedText(\"اطلب عبر واتساب\", \"Order on WhatsApp\", \"Commander sur WhatsApp\")}\n                      </Button>\n                    </a>\n                  </div>\n                </div>\n              </motion.div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Google Map Section */}\n      <section className=\"relative h-[500px]\">\n        <iframe\n          src=\"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d446529.73695167716!2d47.48265545!3d29.31166095!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3fc5363fbeea51a1%3A0x74726bcd92d8edd2!2sKuwait!5e0!3m2!1sen!2sus!4v1703000000000!5m2!1sen!2sus\"\n          className=\"w-full h-full border-0\"\n          allowFullScreen\n          loading=\"lazy\"\n          referrerPolicy=\"no-referrer-when-downgrade\"\n          title=\"Ghasla Style Coverage Area\"\n        />\n        \n        {/* Floating Contact Card */}\n        <motion.div\n          initial={{ opacity: 0, x: -50 }}\n          whileInView={{ opacity: 1, x: 0 }}\n          viewport={{ once: true }}\n          transition={{ duration: 0.6, delay: 0.3, type: \"spring\", bounce: 0.3 }}\n          className=\"absolute bottom-8 start-8 max-w-xs\"\n        >\n          <Card className=\"bg-white/95 dark:bg-card/95 backdrop-blur-md shadow-xl\">\n            <CardContent className=\"p-5\">\n              <div className=\"flex items-start gap-4\">\n                <div className=\"w-12 h-12 rounded-full bg-[#25D366] flex items-center justify-center flex-shrink-0\">\n                  <MessageCircle className=\"h-6 w-6 text-white\" />\n                </div>\n                <div className=\"space-y-2\">\n                  <p className=\"font-medium\">\n                    {getLocalizedText(\n                      \"تحتاج مساعدة؟\",\n                      \"Need help?\",\n                      \"Besoin d'aide?\"\n                    )}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {getLocalizedText(\n                      \"أرسل موقعك عبر واتساب\",\n                      \"Send us your location on WhatsApp\",\n                      \"Envoyez-nous votre position sur WhatsApp\"\n                    )}\n                  </p>\n                  <a href=\"https://wa.me/96597960808\" target=\"_blank\" rel=\"noopener noreferrer\">\n                    <Button className=\"bg-[#25D366] hover:bg-[#128C7E] w-full\" data-testid=\"map-whatsapp-button\">\n                      <SiWhatsapp className=\"h-4 w-4 me-2\" />\n                      {getLocalizedText(\"تواصل الآن\", \"Chat Now\", \"Discuter\")}\n                    </Button>\n                  </a>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n      </section>\n\n      {/* Loyalty & Friends Club Section */}\n      <section className=\"py-20 bg-muted/30\">\n        <div className=\"container mx-auto px-4\">\n          <motion.div\n            initial=\"hidden\"\n            whileInView=\"visible\"\n            viewport={{ once: true }}\n            variants={staggerContainer}\n            className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\"\n          >\n            {/* Loyalty Program */}\n            <motion.div variants={slideInLeft}>\n              <Card className=\"h-full overflow-hidden\">\n                <div className=\"bg-gradient-to-br from-primary to-primary/80 p-8 text-primary-foreground\">\n                  <Star className=\"h-12 w-12 mb-4\" />\n                  <h3 className=\"text-2xl font-bold mb-2\">{t(\"loyalty.title\")}</h3>\n                  <p className=\"opacity-90\">{t(\"loyalty.subtitle\")}</p>\n                </div>\n                <CardContent className=\"p-6 space-y-4\">\n                  <div className=\"grid grid-cols-3 gap-4 text-center\">\n                    <div>\n                      <div className=\"text-2xl font-bold text-primary\">35</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {getLocalizedText(\"نقطة/دينار\", \"pts/KD\", \"pts/KD\")}\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"text-2xl font-bold text-primary\">100</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {getLocalizedText(\"= 0.4 د.ك\", \"= 0.4 KD\", \"= 0.4 KD\")}\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"text-2xl font-bold text-primary\">200</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {getLocalizedText(\"مكافأة ترحيب\", \"Welcome\", \"Bienvenue\")}\n                      </div>\n                    </div>\n                  </div>\n                  <Link href=\"/loyalty\">\n                    <Button className=\"w-full\" data-testid=\"learn-loyalty-home\">\n                      {t(\"hero.learnMore\")}\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            </motion.div>\n\n            {/* Friends Club */}\n            <motion.div variants={slideInRight}>\n              <Card className=\"h-full overflow-hidden\">\n                <div className=\"bg-gradient-to-br from-chart-1 to-chart-1/80 p-8 text-white\">\n                  <Users className=\"h-12 w-12 mb-4\" />\n                  <h3 className=\"text-2xl font-bold mb-2\">{t(\"friendsClub.title\")}</h3>\n                  <p className=\"opacity-90\">{t(\"friendsClub.subtitle\")}</p>\n                </div>\n                <CardContent className=\"p-6 space-y-4\">\n                  <div className=\"grid grid-cols-3 gap-4 text-center\">\n                    <div>\n                      <div className=\"text-2xl font-bold text-chart-1\">400</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {getLocalizedText(\"للمُحيل\", \"Referrer\", \"Parrain\")}\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"text-2xl font-bold text-chart-1\">200</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {getLocalizedText(\"للصديق\", \"Friend\", \"Ami\")}\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"text-2xl font-bold text-chart-1\">∞</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {getLocalizedText(\"بلا حدود\", \"Unlimited\", \"Illimité\")}\n                      </div>\n                    </div>\n                  </div>\n                  <Link href=\"/friends-club\">\n                    <Button variant=\"outline\" className=\"w-full border-chart-1 text-chart-1 hover:bg-chart-1/10\" data-testid=\"learn-friends-home\">\n                      {t(\"hero.learnMore\")}\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            </motion.div>\n          </motion.div>\n        </div>\n      </section>\n\n      {/* Final CTA */}\n      <section className=\"py-20 bg-gradient-to-br from-primary via-primary to-chart-1 text-white\">\n        <motion.div\n          initial=\"hidden\"\n          whileInView=\"visible\"\n          viewport={{ once: true }}\n          variants={staggerContainer}\n          className=\"container mx-auto px-4 text-center\"\n        >\n          <motion.h2 variants={fadeInUp} className=\"text-3xl md:text-4xl font-bold mb-4\">\n            {getLocalizedText(\n              \"جاهز لتجربة أفضل غسيل سيارات؟\",\n              \"Ready for the Best Car Wash?\",\n              \"Prêt pour le Meilleur Lavage?\"\n            )}\n          </motion.h2>\n          <motion.p variants={fadeInUp} className=\"text-xl opacity-90 mb-8 max-w-2xl mx-auto\">\n            {getLocalizedText(\n              \"احجز الآن واستمتع بخدمة متميزة ونظام مكافآت حصري\",\n              \"Book now and enjoy premium service with exclusive rewards\",\n              \"Réservez maintenant et profitez d'un service premium\"\n            )}\n          </motion.p>\n          <motion.div variants={fadeInUp} className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\n            <Link href=\"/booking\">\n              <Button size=\"lg\" variant=\"secondary\" className=\"text-lg px-8 py-6\" data-testid=\"cta-book-final\">\n                {t(\"hero.bookNow\")}\n              </Button>\n            </Link>\n            <a href=\"https://wa.me/96597960808\" target=\"_blank\" rel=\"noopener noreferrer\">\n              <Button size=\"lg\" variant=\"outline\" className=\"text-lg px-8 py-6 border-white text-white hover:bg-white/10\">\n                <SiWhatsapp className=\"h-5 w-5 me-2\" />\n                {t(\"contact.whatsapp\")}\n              </Button>\n            </a>\n          </motion.div>\n        </motion.div>\n      </section>\n    </div>\n  );\n}\n","path":null,"size_bytes":63673,"size_tokens":null},"client/src/types/firestore-order.ts":{"content":"import { Timestamp } from \"firebase/firestore\";\n\n/**\n * Firestore Order Model for Ghasla Style\n * \n * This interface defines the structure of orders stored in Cloud Firestore\n * for real-time tracking and synchronization.\n */\n\n// Order status enum for type safety\nexport type FirestoreOrderStatus = \n  | \"pending\"      // Order received, awaiting assignment\n  | \"assigned\"     // Driver/team assigned\n  | \"on_the_way\"   // Driver is on the way to customer\n  | \"in_progress\"  // Wash in progress\n  | \"completed\"    // Service completed\n  | \"cancelled\";   // Order cancelled\n\n// Vehicle information embedded in order\nexport interface VehicleInfo {\n  make: string;       // Car brand (Toyota, BMW, etc.)\n  model: string;      // Car model (Camry, X5, etc.)\n  plateLast: string;  // Last digits of plate or short identifier\n  color: string;      // Car color\n}\n\n// Address information for service location\nexport interface OrderAddress {\n  area: string;       // Area/district name\n  block?: string;     // Optional block number\n  street?: string;    // Optional street name\n  notes?: string;     // Additional notes for driver\n}\n\n// Payment methods supported\nexport type PaymentMethod = \n  | \"cash\" \n  | \"knet\" \n  | \"visa\" \n  | \"apple_pay\" \n  | \"loyalty_points\";\n\n// Order source for analytics\nexport type OrderSource = \n  | \"web_app\" \n  | \"mobile_app\" \n  | \"whatsapp\" \n  | \"call_center\";\n\n/**\n * Main Firestore Order Interface\n * \n * Collection: orders\n * Document ID: Auto-generated or orderCode\n */\nexport interface FirestoreOrder {\n  // Unique order code visible to customer (e.g., GS-1045)\n  orderCode: string;\n  \n  // Firebase Auth UID of the customer\n  // Used for querying all orders: where(\"customerId\", \"==\", auth.currentUser.uid)\n  customerId: string;\n  \n  // Current order status - used for Timeline and filters\n  status: FirestoreOrderStatus;\n  \n  // Timestamps\n  createdAt: Timestamp;    // serverTimestamp() on creation\n  updatedAt: Timestamp;    // Updated on each status change\n  \n  // Service details\n  serviceType: string;     // Service package name (Exterior Wash, Full Wash, etc.)\n  servicePackageId: string; // Reference to service package\n  \n  // Vehicle information\n  vehicleInfo: VehicleInfo;\n  \n  // Service address\n  address: OrderAddress;\n  \n  // Pricing\n  totalPrice: number;      // Final price after discounts (in KWD)\n  originalPrice: number;   // Price before discounts\n  discountApplied: number; // Discount amount applied\n  \n  // Payment\n  paymentMethod: PaymentMethod;\n  isPaid: boolean;\n  \n  // Loyalty points\n  // loyaltyPointsEarned: Points earned from this order (calculated on completion)\n  loyaltyPointsEarned: number;\n  // loyaltyPointsRedeemed: Points used as discount\n  loyaltyPointsRedeemed: number;\n  // isPointsApplied: Flag to prevent adding points twice\n  // false on creation, true after points are credited to user\n  isPointsApplied: boolean;\n  \n  // Assignment\n  driverId: string | null; // Driver/team ID for tracking\n  driverName?: string;     // Driver name for display\n  \n  // Cancellation\n  cancelReason: string | null;\n  \n  // Source tracking for analytics\n  source: OrderSource;\n  \n  // Referral tracking\n  referralCode?: string;\n}\n\n/**\n * Create Order Input - used when creating new orders\n * Excludes auto-generated fields\n */\nexport interface CreateFirestoreOrder {\n  customerId: string;\n  serviceType: string;\n  servicePackageId: string;\n  vehicleInfo: VehicleInfo;\n  address: OrderAddress;\n  totalPrice: number;\n  originalPrice: number;\n  discountApplied: number;\n  paymentMethod: PaymentMethod;\n  loyaltyPointsRedeemed: number;\n  source: OrderSource;\n  referralCode?: string;\n}\n\n/**\n * Order with document ID for display\n */\nexport interface FirestoreOrderWithId extends FirestoreOrder {\n  id: string;\n}\n\n/**\n * Generate unique order code\n * Format: GS-XXXX (X = alphanumeric)\n */\nexport function generateOrderCode(): string {\n  const chars = \"0123456789ABCDEFGHJKLMNPQRSTUVWXYZ\";\n  let code = \"GS-\";\n  for (let i = 0; i < 4; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return code;\n}\n\n/**\n * Status display configuration\n */\nexport const ORDER_STATUS_CONFIG: Record<FirestoreOrderStatus, {\n  labelAr: string;\n  labelEn: string;\n  labelFr: string;\n  color: string;\n  step: number;\n}> = {\n  pending: {\n    labelAr: \"قيد الانتظار\",\n    labelEn: \"Pending\",\n    labelFr: \"En attente\",\n    color: \"yellow\",\n    step: 1\n  },\n  assigned: {\n    labelAr: \"تم التخصيص\",\n    labelEn: \"Assigned\",\n    labelFr: \"Assigné\",\n    color: \"blue\",\n    step: 2\n  },\n  on_the_way: {\n    labelAr: \"في الطريق\",\n    labelEn: \"On the Way\",\n    labelFr: \"En route\",\n    color: \"cyan\",\n    step: 3\n  },\n  in_progress: {\n    labelAr: \"قيد التنفيذ\",\n    labelEn: \"In Progress\",\n    labelFr: \"En cours\",\n    color: \"orange\",\n    step: 4\n  },\n  completed: {\n    labelAr: \"مكتمل\",\n    labelEn: \"Completed\",\n    labelFr: \"Terminé\",\n    color: \"green\",\n    step: 5\n  },\n  cancelled: {\n    labelAr: \"ملغي\",\n    labelEn: \"Cancelled\",\n    labelFr: \"Annulé\",\n    color: \"red\",\n    step: -1\n  }\n};\n","path":null,"size_bytes":5109,"size_tokens":null},"client/src/components/layout/Layout.tsx":{"content":"import type { ReactNode } from \"react\";\nimport { Header } from \"./Header\";\nimport { Footer } from \"./Footer\";\nimport { WhatsAppButton } from \"./WhatsAppButton\";\n\ninterface LayoutProps {\n  children: ReactNode;\n}\n\nexport function Layout({ children }: LayoutProps) {\n  return (\n    <div className=\"min-h-screen flex flex-col bg-background\">\n      <Header />\n      <main className=\"flex-1\">\n        {children}\n      </main>\n      <Footer />\n      <WhatsAppButton />\n    </div>\n  );\n}\n","path":null,"size_bytes":480,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/lib/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\nconst resources = {\n  ar: {\n    translation: {\n      brand: \"غسلة ستايل\",\n      nav: {\n        home: \"الرئيسية\",\n        about: \"من نحن\",\n        services: \"الخدمات\",\n        offers: \"العروض\",\n        booking: \"احجز الآن\",\n        loyalty: \"برنامج الولاء\",\n        friendsClub: \"نادي الأصدقاء\",\n        blog: \"المدونة\",\n        gallery: \"المعرض\",\n        reviews: \"آراء العملاء\",\n        contact: \"تواصل معنا\",\n        login: \"تسجيل الدخول\",\n        register: \"إنشاء حساب\",\n        account: \"حسابي\",\n        logout: \"تسجيل الخروج\",\n        admin: \"لوحة التحكم\"\n      },\n      hero: {\n        title: \"خدمة غسيل السيارات المتنقلة\",\n        subtitle: \"نأتي إليك أينما كنت في الكويت\",\n        description: \"احصل على سيارتك نظيفة ولامعة دون مغادرة منزلك أو مكتبك. خدمة احترافية، أسعار منافسة، ونظام مكافآت حصري.\",\n        bookNow: \"احجز الآن\",\n        learnMore: \"اعرف المزيد\"\n      },\n      services: {\n        title: \"خدماتنا\",\n        subtitle: \"اختر الباقة المناسبة لسيارتك\",\n        exterior: \"غسيل خارجي\",\n        interior: \"تنظيف داخلي\",\n        full: \"غسيل كامل\",\n        vip: \"VIP / تفصيلي\",\n        monthly: \"اشتراك شهري\",\n        sedan: \"سيدان\",\n        suv: \"دفع رباعي\",\n        duration: \"المدة المتوقعة\",\n        minutes: \"دقيقة\",\n        select: \"اختر هذه الباقة\",\n        kd: \"د.ك\"\n      },\n      booking: {\n        title: \"احجز موعدك\",\n        step1: \"نوع السيارة\",\n        step2: \"اختر الخدمة\",\n        step3: \"الموقع والوقت\",\n        step4: \"الدفع\",\n        carType: \"نوع السيارة\",\n        carDetails: \"تفاصيل السيارة (اختياري)\",\n        address: \"العنوان\",\n        area: \"المنطقة\",\n        date: \"التاريخ\",\n        time: \"الوقت\",\n        paymentMethod: \"طريقة الدفع\",\n        cash: \"نقداً عند الخدمة\",\n        online: \"دفع إلكتروني\",\n        redeemPoints: \"استخدم نقاط الولاء\",\n        availablePoints: \"نقاطك المتاحة\",\n        pointsToRedeem: \"النقاط المراد استخدامها\",\n        discount: \"الخصم\",\n        total: \"المجموع\",\n        confirm: \"تأكيد الحجز\",\n        back: \"رجوع\",\n        next: \"التالي\",\n        success: \"تم الحجز بنجاح!\",\n        orderNumber: \"رقم الطلب\"\n      },\n      loyalty: {\n        title: \"برنامج الولاء\",\n        subtitle: \"اكسب نقاطاً مع كل خدمة\",\n        howItWorks: \"كيف يعمل البرنامج\",\n        earnTitle: \"اكسب النقاط\",\n        earnDesc: \"احصل على 35 نقطة مقابل كل دينار كويتي تنفقه\",\n        redeemTitle: \"استبدل النقاط\",\n        redeemDesc: \"كل 100 نقطة تساوي 0.4 د.ك خصم\",\n        welcomeTitle: \"مكافأة الترحيب\",\n        welcomeDesc: \"احصل على 200 نقطة عند أول طلب مدفوع\",\n        currentBalance: \"رصيدك الحالي\",\n        points: \"نقطة\",\n        history: \"سجل النقاط\",\n        earned: \"مكتسبة\",\n        redeemed: \"مستخدمة\",\n        bonus: \"مكافأة\"\n      },\n      friendsClub: {\n        title: \"نادي الأصدقاء\",\n        subtitle: \"ادعُ أصدقاءك واربح المزيد\",\n        howItWorks: \"كيف يعمل النظام\",\n        step1Title: \"شارك رابطك\",\n        step1Desc: \"أرسل رابط الإحالة الخاص بك لأصدقائك\",\n        step2Title: \"صديقك يسجل\",\n        step2Desc: \"عندما يسجل صديقك ويكمل أول طلب\",\n        step3Title: \"كلاكما يربح\",\n        step3Desc: \"تحصل على 400 نقطة وصديقك على 200 نقطة\",\n        yourCode: \"رمز الإحالة الخاص بك\",\n        yourLink: \"رابط الإحالة\",\n        copyLink: \"نسخ الرابط\",\n        copied: \"تم النسخ!\",\n        stats: \"إحصائياتك\",\n        totalReferrals: \"إجمالي الإحالات\",\n        successfulReferrals: \"الإحالات الناجحة\",\n        pointsEarned: \"النقاط المكتسبة من الإحالات\"\n      },\n      about: {\n        title: \"من نحن\",\n        subtitle: \"قصتنا ورؤيتنا\",\n        mission: \"مهمتنا\",\n        missionText: \"نسعى لتقديم أفضل خدمة غسيل سيارات متنقلة في الكويت، مع الحفاظ على البيئة واستخدام منتجات صديقة للبيئة.\",\n        coverage: \"تغطية الخدمة\",\n        coverageText: \"نغطي حالياً مناطق مختارة في الكويت تشمل السالمية، الروضة، السرة، كيفان، الخالدية، والمزيد. خدمات إضافية قريباً!\",\n        quality: \"جودة مضمونة\",\n        qualityText: \"فريق مدرب احترافياً، معدات حديثة، ومنتجات عالية الجودة لضمان نظافة سيارتك.\"\n      },\n      account: {\n        title: \"حسابي\",\n        profile: \"الملف الشخصي\",\n        orders: \"طلباتي\",\n        loyalty: \"نقاط الولاء\",\n        referrals: \"الإحالات\",\n        editProfile: \"تعديل الملف\",\n        name: \"الاسم\",\n        email: \"البريد الإلكتروني\",\n        phone: \"رقم الهاتف\",\n        carInfo: \"معلومات السيارة\",\n        save: \"حفظ التغييرات\",\n        orderStatus: {\n          pending: \"في الانتظار\",\n          assigned: \"تم التعيين\",\n          in_progress: \"قيد التنفيذ\",\n          completed: \"مكتمل\",\n          cancelled: \"ملغي\"\n        }\n      },\n      contact: {\n        title: \"تواصل معنا\",\n        subtitle: \"نسعد بتواصلك معنا\",\n        whatsapp: \"تواصل عبر واتساب\",\n        name: \"الاسم\",\n        phone: \"رقم الهاتف\",\n        message: \"رسالتك\",\n        send: \"إرسال\",\n        success: \"تم إرسال رسالتك بنجاح!\"\n      },\n      auth: {\n        login: \"تسجيل الدخول\",\n        register: \"إنشاء حساب جديد\",\n        email: \"البريد الإلكتروني\",\n        password: \"كلمة المرور\",\n        confirmPassword: \"تأكيد كلمة المرور\",\n        name: \"الاسم الكامل\",\n        phone: \"رقم الهاتف\",\n        loginWithGoogle: \"تسجيل الدخول بجوجل\",\n        loginWithPhone: \"تسجيل الدخول برقم الهاتف\",\n        noAccount: \"ليس لديك حساب؟\",\n        hasAccount: \"لديك حساب بالفعل؟\",\n        forgotPassword: \"نسيت كلمة المرور؟\",\n        referralCode: \"رمز الإحالة (اختياري)\"\n      },\n      admin: {\n        dashboard: \"لوحة التحكم\",\n        packages: \"الباقات والأسعار\",\n        orders: \"الطلبات\",\n        customers: \"العملاء\",\n        loyalty: \"إعدادات الولاء\",\n        content: \"إدارة المحتوى\",\n        analytics: \"التقارير والإحصائيات\",\n        auditLogs: \"سجل العمليات\",\n        admins: \"إدارة المشرفين\",\n        totalIncome: \"إجمالي الدخل\",\n        totalOrders: \"إجمالي الطلبات\",\n        activeCustomers: \"العملاء النشطين\",\n        pointsIssued: \"النقاط الصادرة\",\n        pointsRedeemed: \"النقاط المستخدمة\",\n        successfulReferrals: \"الإحالات الناجحة\"\n      },\n      footer: {\n        description: \"خدمة غسيل السيارات المتنقلة الأولى في الكويت\",\n        quickLinks: \"روابط سريعة\",\n        contactInfo: \"معلومات التواصل\",\n        followUs: \"تابعنا\",\n        rights: \"جميع الحقوق محفوظة\"\n      },\n      common: {\n        loading: \"جاري التحميل...\",\n        error: \"حدث خطأ\",\n        retry: \"إعادة المحاولة\",\n        cancel: \"إلغاء\",\n        save: \"حفظ\",\n        edit: \"تعديل\",\n        delete: \"حذف\",\n        view: \"عرض\",\n        search: \"بحث\",\n        filter: \"تصفية\",\n        export: \"تصدير\",\n        noData: \"لا توجد بيانات\",\n        confirmDelete: \"هل أنت متأكد من الحذف؟\"\n      }\n    }\n  },\n  en: {\n    translation: {\n      brand: \"Ghasla Style\",\n      nav: {\n        home: \"Home\",\n        about: \"About Us\",\n        services: \"Services\",\n        offers: \"Offers\",\n        booking: \"Book Now\",\n        loyalty: \"Loyalty Program\",\n        friendsClub: \"Friends Club\",\n        blog: \"Blog\",\n        gallery: \"Gallery\",\n        reviews: \"Reviews\",\n        contact: \"Contact\",\n        login: \"Login\",\n        register: \"Register\",\n        account: \"My Account\",\n        logout: \"Logout\",\n        admin: \"Admin Panel\"\n      },\n      hero: {\n        title: \"Mobile Car Wash Service\",\n        subtitle: \"We come to you anywhere in Kuwait\",\n        description: \"Get your car clean and shiny without leaving your home or office. Professional service, competitive prices, and exclusive rewards program.\",\n        bookNow: \"Book Now\",\n        learnMore: \"Learn More\"\n      },\n      services: {\n        title: \"Our Services\",\n        subtitle: \"Choose the right package for your car\",\n        exterior: \"Exterior Wash\",\n        interior: \"Interior Clean\",\n        full: \"Full Wash\",\n        vip: \"VIP / Detailing\",\n        monthly: \"Monthly Subscription\",\n        sedan: \"Sedan\",\n        suv: \"SUV\",\n        duration: \"Estimated Duration\",\n        minutes: \"minutes\",\n        select: \"Select Package\",\n        kd: \"KD\"\n      },\n      booking: {\n        title: \"Book Your Appointment\",\n        step1: \"Car Type\",\n        step2: \"Select Service\",\n        step3: \"Location & Time\",\n        step4: \"Payment\",\n        carType: \"Car Type\",\n        carDetails: \"Car Details (optional)\",\n        address: \"Address\",\n        area: \"Area\",\n        date: \"Date\",\n        time: \"Time\",\n        paymentMethod: \"Payment Method\",\n        cash: \"Cash on Service\",\n        online: \"Online Payment\",\n        redeemPoints: \"Redeem Loyalty Points\",\n        availablePoints: \"Available Points\",\n        pointsToRedeem: \"Points to Redeem\",\n        discount: \"Discount\",\n        total: \"Total\",\n        confirm: \"Confirm Booking\",\n        back: \"Back\",\n        next: \"Next\",\n        success: \"Booking Successful!\",\n        orderNumber: \"Order Number\"\n      },\n      loyalty: {\n        title: \"Loyalty Program\",\n        subtitle: \"Earn points with every service\",\n        howItWorks: \"How It Works\",\n        earnTitle: \"Earn Points\",\n        earnDesc: \"Get 35 points for every KD spent\",\n        redeemTitle: \"Redeem Points\",\n        redeemDesc: \"Every 100 points equals 0.4 KD discount\",\n        welcomeTitle: \"Welcome Bonus\",\n        welcomeDesc: \"Get 200 points on your first paid order\",\n        currentBalance: \"Current Balance\",\n        points: \"points\",\n        history: \"Points History\",\n        earned: \"Earned\",\n        redeemed: \"Redeemed\",\n        bonus: \"Bonus\"\n      },\n      friendsClub: {\n        title: \"Friends Club\",\n        subtitle: \"Invite friends and earn more\",\n        howItWorks: \"How It Works\",\n        step1Title: \"Share Your Link\",\n        step1Desc: \"Send your referral link to friends\",\n        step2Title: \"Friend Signs Up\",\n        step2Desc: \"When your friend registers and completes first order\",\n        step3Title: \"Both Win\",\n        step3Desc: \"You get 400 points and your friend gets 200 points\",\n        yourCode: \"Your Referral Code\",\n        yourLink: \"Your Referral Link\",\n        copyLink: \"Copy Link\",\n        copied: \"Copied!\",\n        stats: \"Your Statistics\",\n        totalReferrals: \"Total Referrals\",\n        successfulReferrals: \"Successful Referrals\",\n        pointsEarned: \"Points from Referrals\"\n      },\n      about: {\n        title: \"About Us\",\n        subtitle: \"Our Story and Vision\",\n        mission: \"Our Mission\",\n        missionText: \"We strive to provide the best mobile car wash service in Kuwait, while protecting the environment using eco-friendly products.\",\n        coverage: \"Service Coverage\",\n        coverageText: \"We currently cover select areas in Kuwait including Salmiya, Rawda, Surra, Kaifan, Khaldiya, and more. Additional areas coming soon!\",\n        quality: \"Quality Guaranteed\",\n        qualityText: \"Professionally trained team, modern equipment, and high-quality products to ensure your car's cleanliness.\"\n      },\n      account: {\n        title: \"My Account\",\n        profile: \"Profile\",\n        orders: \"My Orders\",\n        loyalty: \"Loyalty Points\",\n        referrals: \"Referrals\",\n        editProfile: \"Edit Profile\",\n        name: \"Name\",\n        email: \"Email\",\n        phone: \"Phone Number\",\n        carInfo: \"Car Information\",\n        save: \"Save Changes\",\n        orderStatus: {\n          pending: \"Pending\",\n          assigned: \"Assigned\",\n          in_progress: \"In Progress\",\n          completed: \"Completed\",\n          cancelled: \"Cancelled\"\n        }\n      },\n      contact: {\n        title: \"Contact Us\",\n        subtitle: \"We'd love to hear from you\",\n        whatsapp: \"Chat on WhatsApp\",\n        name: \"Name\",\n        phone: \"Phone Number\",\n        message: \"Your Message\",\n        send: \"Send\",\n        success: \"Message sent successfully!\"\n      },\n      auth: {\n        login: \"Login\",\n        register: \"Create Account\",\n        email: \"Email\",\n        password: \"Password\",\n        confirmPassword: \"Confirm Password\",\n        name: \"Full Name\",\n        phone: \"Phone Number\",\n        loginWithGoogle: \"Login with Google\",\n        loginWithPhone: \"Login with Phone\",\n        noAccount: \"Don't have an account?\",\n        hasAccount: \"Already have an account?\",\n        forgotPassword: \"Forgot Password?\",\n        referralCode: \"Referral Code (optional)\"\n      },\n      admin: {\n        dashboard: \"Dashboard\",\n        packages: \"Packages & Prices\",\n        orders: \"Orders\",\n        customers: \"Customers\",\n        loyalty: \"Loyalty Settings\",\n        content: \"Content Management\",\n        analytics: \"Analytics & Reports\",\n        auditLogs: \"Audit Logs\",\n        admins: \"Manage Admins\",\n        totalIncome: \"Total Income\",\n        totalOrders: \"Total Orders\",\n        activeCustomers: \"Active Customers\",\n        pointsIssued: \"Points Issued\",\n        pointsRedeemed: \"Points Redeemed\",\n        successfulReferrals: \"Successful Referrals\"\n      },\n      footer: {\n        description: \"The premier mobile car wash service in Kuwait\",\n        quickLinks: \"Quick Links\",\n        contactInfo: \"Contact Info\",\n        followUs: \"Follow Us\",\n        rights: \"All Rights Reserved\"\n      },\n      common: {\n        loading: \"Loading...\",\n        error: \"An error occurred\",\n        retry: \"Retry\",\n        cancel: \"Cancel\",\n        save: \"Save\",\n        edit: \"Edit\",\n        delete: \"Delete\",\n        view: \"View\",\n        search: \"Search\",\n        filter: \"Filter\",\n        export: \"Export\",\n        noData: \"No data available\",\n        confirmDelete: \"Are you sure you want to delete?\"\n      }\n    }\n  },\n  fr: {\n    translation: {\n      brand: \"Ghasla Style\",\n      nav: {\n        home: \"Accueil\",\n        about: \"À propos\",\n        services: \"Services\",\n        offers: \"Offres\",\n        booking: \"Réserver\",\n        loyalty: \"Programme Fidélité\",\n        friendsClub: \"Club des Amis\",\n        blog: \"Blog\",\n        gallery: \"Galerie\",\n        reviews: \"Avis\",\n        contact: \"Contact\",\n        login: \"Connexion\",\n        register: \"S'inscrire\",\n        account: \"Mon Compte\",\n        logout: \"Déconnexion\",\n        admin: \"Administration\"\n      },\n      hero: {\n        title: \"Service de Lavage Auto Mobile\",\n        subtitle: \"Nous venons à vous partout au Koweït\",\n        description: \"Faites nettoyer et briller votre voiture sans quitter votre domicile ou bureau. Service professionnel, prix compétitifs et programme de récompenses exclusif.\",\n        bookNow: \"Réserver\",\n        learnMore: \"En Savoir Plus\"\n      },\n      services: {\n        title: \"Nos Services\",\n        subtitle: \"Choisissez le forfait adapté à votre voiture\",\n        exterior: \"Lavage Extérieur\",\n        interior: \"Nettoyage Intérieur\",\n        full: \"Lavage Complet\",\n        vip: \"VIP / Détaillage\",\n        monthly: \"Abonnement Mensuel\",\n        sedan: \"Berline\",\n        suv: \"SUV\",\n        duration: \"Durée Estimée\",\n        minutes: \"minutes\",\n        select: \"Choisir ce Forfait\",\n        kd: \"KD\"\n      },\n      booking: {\n        title: \"Réservez Votre Rendez-vous\",\n        step1: \"Type de Voiture\",\n        step2: \"Choisir Service\",\n        step3: \"Lieu & Heure\",\n        step4: \"Paiement\",\n        carType: \"Type de Voiture\",\n        carDetails: \"Détails de la Voiture (optionnel)\",\n        address: \"Adresse\",\n        area: \"Zone\",\n        date: \"Date\",\n        time: \"Heure\",\n        paymentMethod: \"Mode de Paiement\",\n        cash: \"Espèces sur Place\",\n        online: \"Paiement en Ligne\",\n        redeemPoints: \"Utiliser Points de Fidélité\",\n        availablePoints: \"Points Disponibles\",\n        pointsToRedeem: \"Points à Utiliser\",\n        discount: \"Réduction\",\n        total: \"Total\",\n        confirm: \"Confirmer la Réservation\",\n        back: \"Retour\",\n        next: \"Suivant\",\n        success: \"Réservation Réussie!\",\n        orderNumber: \"Numéro de Commande\"\n      },\n      loyalty: {\n        title: \"Programme de Fidélité\",\n        subtitle: \"Gagnez des points à chaque service\",\n        howItWorks: \"Comment Ça Marche\",\n        earnTitle: \"Gagnez des Points\",\n        earnDesc: \"Obtenez 35 points pour chaque KD dépensé\",\n        redeemTitle: \"Échangez vos Points\",\n        redeemDesc: \"100 points = 0.4 KD de réduction\",\n        welcomeTitle: \"Bonus de Bienvenue\",\n        welcomeDesc: \"Recevez 200 points sur votre première commande\",\n        currentBalance: \"Solde Actuel\",\n        points: \"points\",\n        history: \"Historique des Points\",\n        earned: \"Gagnés\",\n        redeemed: \"Utilisés\",\n        bonus: \"Bonus\"\n      },\n      friendsClub: {\n        title: \"Club des Amis\",\n        subtitle: \"Invitez des amis et gagnez plus\",\n        howItWorks: \"Comment Ça Marche\",\n        step1Title: \"Partagez Votre Lien\",\n        step1Desc: \"Envoyez votre lien de parrainage à vos amis\",\n        step2Title: \"L'ami S'inscrit\",\n        step2Desc: \"Quand votre ami s'inscrit et complète sa première commande\",\n        step3Title: \"Vous Gagnez Tous Les Deux\",\n        step3Desc: \"Vous recevez 400 points et votre ami 200 points\",\n        yourCode: \"Votre Code de Parrainage\",\n        yourLink: \"Votre Lien de Parrainage\",\n        copyLink: \"Copier le Lien\",\n        copied: \"Copié!\",\n        stats: \"Vos Statistiques\",\n        totalReferrals: \"Parrainages Totaux\",\n        successfulReferrals: \"Parrainages Réussis\",\n        pointsEarned: \"Points des Parrainages\"\n      },\n      about: {\n        title: \"À Propos\",\n        subtitle: \"Notre Histoire et Vision\",\n        mission: \"Notre Mission\",\n        missionText: \"Nous nous efforçons de fournir le meilleur service de lavage auto mobile au Koweït, tout en protégeant l'environnement avec des produits écologiques.\",\n        coverage: \"Zone de Service\",\n        coverageText: \"Nous couvrons actuellement des zones sélectionnées au Koweït incluant Salmiya, Rawda, Surra, Kaifan, Khaldiya et plus. Zones supplémentaires bientôt!\",\n        quality: \"Qualité Garantie\",\n        qualityText: \"Équipe formée professionnellement, équipement moderne et produits de haute qualité pour assurer la propreté de votre voiture.\"\n      },\n      account: {\n        title: \"Mon Compte\",\n        profile: \"Profil\",\n        orders: \"Mes Commandes\",\n        loyalty: \"Points de Fidélité\",\n        referrals: \"Parrainages\",\n        editProfile: \"Modifier le Profil\",\n        name: \"Nom\",\n        email: \"Email\",\n        phone: \"Téléphone\",\n        carInfo: \"Info Voiture\",\n        save: \"Enregistrer\",\n        orderStatus: {\n          pending: \"En Attente\",\n          assigned: \"Assigné\",\n          in_progress: \"En Cours\",\n          completed: \"Terminé\",\n          cancelled: \"Annulé\"\n        }\n      },\n      contact: {\n        title: \"Contactez-nous\",\n        subtitle: \"Nous serions ravis de vous entendre\",\n        whatsapp: \"Chat WhatsApp\",\n        name: \"Nom\",\n        phone: \"Téléphone\",\n        message: \"Votre Message\",\n        send: \"Envoyer\",\n        success: \"Message envoyé avec succès!\"\n      },\n      auth: {\n        login: \"Connexion\",\n        register: \"Créer un Compte\",\n        email: \"Email\",\n        password: \"Mot de passe\",\n        confirmPassword: \"Confirmer le Mot de passe\",\n        name: \"Nom Complet\",\n        phone: \"Téléphone\",\n        loginWithGoogle: \"Connexion avec Google\",\n        loginWithPhone: \"Connexion par Téléphone\",\n        noAccount: \"Pas de compte?\",\n        hasAccount: \"Déjà un compte?\",\n        forgotPassword: \"Mot de passe oublié?\",\n        referralCode: \"Code de Parrainage (optionnel)\"\n      },\n      admin: {\n        dashboard: \"Tableau de Bord\",\n        packages: \"Forfaits & Prix\",\n        orders: \"Commandes\",\n        customers: \"Clients\",\n        loyalty: \"Paramètres Fidélité\",\n        content: \"Gestion du Contenu\",\n        analytics: \"Analyses & Rapports\",\n        auditLogs: \"Journal d'Audit\",\n        admins: \"Gérer les Admins\",\n        totalIncome: \"Revenu Total\",\n        totalOrders: \"Commandes Totales\",\n        activeCustomers: \"Clients Actifs\",\n        pointsIssued: \"Points Émis\",\n        pointsRedeemed: \"Points Utilisés\",\n        successfulReferrals: \"Parrainages Réussis\"\n      },\n      footer: {\n        description: \"Le premier service de lavage auto mobile au Koweït\",\n        quickLinks: \"Liens Rapides\",\n        contactInfo: \"Coordonnées\",\n        followUs: \"Suivez-nous\",\n        rights: \"Tous Droits Réservés\"\n      },\n      common: {\n        loading: \"Chargement...\",\n        error: \"Une erreur s'est produite\",\n        retry: \"Réessayer\",\n        cancel: \"Annuler\",\n        save: \"Enregistrer\",\n        edit: \"Modifier\",\n        delete: \"Supprimer\",\n        view: \"Voir\",\n        search: \"Rechercher\",\n        filter: \"Filtrer\",\n        export: \"Exporter\",\n        noData: \"Aucune donnée disponible\",\n        confirmDelete: \"Êtes-vous sûr de vouloir supprimer?\"\n      }\n    }\n  }\n};\n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    resources,\n    fallbackLng: 'ar',\n    supportedLngs: ['ar', 'en', 'fr'],\n    interpolation: {\n      escapeValue: false\n    },\n    detection: {\n      order: ['localStorage', 'navigator'],\n      caches: ['localStorage']\n    }\n  });\n\nexport default i18n;\n","path":null,"size_bytes":23278,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/pages/Contact.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Phone, Mail, MapPin, Send, MessageCircle } from \"lucide-react\";\nimport { SiWhatsapp } from \"react-icons/si\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function Contact() {\n  const { t, i18n } = useTranslation();\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    phone: \"\",\n    message: \"\",\n  });\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    try {\n      const response = await fetch(\"/api/contact\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(formData),\n      });\n\n      if (response.ok) {\n        toast({\n          title: t(\"contact.success\"),\n          description: getLocalizedText(\n            \"سنتواصل معك قريباً\",\n            \"We'll get back to you soon\",\n            \"Nous vous répondrons bientôt\"\n          ),\n        });\n        setFormData({ name: \"\", phone: \"\", message: \"\" });\n      } else {\n        throw new Error(\"Failed to send\");\n      }\n    } catch (error) {\n      toast({\n        title: t(\"common.error\"),\n        description: getLocalizedText(\n          \"حاول مرة أخرى\",\n          \"Please try again\",\n          \"Veuillez réessayer\"\n        ),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const contactInfo = [\n    {\n      icon: Phone,\n      labelAr: \"الهاتف\",\n      labelEn: \"Phone\",\n      labelFr: \"Téléphone\",\n      value: \"+965 9796 0808\",\n      href: \"tel:+96597960808\",\n    },\n    {\n      icon: MessageCircle,\n      labelAr: \"واتساب\",\n      labelEn: \"WhatsApp\",\n      labelFr: \"WhatsApp\",\n      value: \"+965 9796 0808\",\n      href: \"https://wa.me/96597960808\",\n    },\n    {\n      icon: Mail,\n      labelAr: \"البريد الإلكتروني\",\n      labelEn: \"Email\",\n      labelFr: \"Email\",\n      value: \"info@ghaslastyle.com\",\n      href: \"mailto:info@ghaslastyle.com\",\n    },\n    {\n      icon: MapPin,\n      labelAr: \"الموقع\",\n      labelEn: \"Location\",\n      labelFr: \"Emplacement\",\n      value: getLocalizedText(\"الكويت - 19 منطقة متاحة\", \"Kuwait - 19 Areas Available\", \"Koweït - 19 zones disponibles\"),\n      href: null,\n    },\n  ];\n\n  return (\n    <div className=\"py-12\">\n      <div className=\"container mx-auto px-4\">\n        {/* Header */}\n        <div className=\"text-center mb-12\">\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">{t(\"contact.title\")}</h1>\n          <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n            {t(\"contact.subtitle\")}\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-5xl mx-auto\">\n          {/* Contact Info */}\n          <div className=\"space-y-6\">\n            <Card className=\"overflow-hidden\">\n              <div className=\"bg-gradient-to-br from-[#25D366] to-[#128C7E] p-6 text-white\">\n                <SiWhatsapp className=\"h-10 w-10 mb-4\" />\n                <h3 className=\"text-xl font-bold mb-2\">{t(\"contact.whatsapp\")}</h3>\n                <p className=\"opacity-90\">\n                  {getLocalizedText(\n                    \"تواصل معنا مباشرة عبر واتساب\",\n                    \"Contact us directly via WhatsApp\",\n                    \"Contactez-nous directement via WhatsApp\"\n                  )}\n                </p>\n              </div>\n              <CardContent className=\"p-6\">\n                <a\n                  href=\"https://wa.me/96597960808\"\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"block\"\n                >\n                  <Button className=\"w-full bg-[#25D366] hover:bg-[#128C7E]\" size=\"lg\" data-testid=\"whatsapp-contact\">\n                    <SiWhatsapp className=\"h-5 w-5 me-2\" />\n                    {t(\"contact.whatsapp\")}\n                  </Button>\n                </a>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>\n                  {getLocalizedText(\"معلومات التواصل\", \"Contact Information\", \"Coordonnées\")}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {contactInfo.map((item, index) => (\n                  <div key={index} className=\"flex items-center gap-4\" data-testid={`contact-info-${index}`}>\n                    <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0\">\n                      <item.icon className=\"h-5 w-5 text-primary\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {getLocalizedText(item.labelAr, item.labelEn, item.labelFr)}\n                      </p>\n                      {item.href ? (\n                        <a\n                          href={item.href}\n                          target={item.href.startsWith(\"http\") ? \"_blank\" : undefined}\n                          rel={item.href.startsWith(\"http\") ? \"noopener noreferrer\" : undefined}\n                          className=\"font-medium hover:text-primary transition-colors\"\n                          dir=\"ltr\"\n                        >\n                          {item.value}\n                        </a>\n                      ) : (\n                        <p className=\"font-medium\">{item.value}</p>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Contact Form */}\n          <Card>\n            <CardHeader>\n              <CardTitle>\n                {getLocalizedText(\"أرسل رسالة\", \"Send a Message\", \"Envoyer un Message\")}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"name\">{t(\"contact.name\")}</Label>\n                  <Input\n                    id=\"name\"\n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    required\n                    data-testid=\"input-contact-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"phone\">{t(\"contact.phone\")}</Label>\n                  <Input\n                    id=\"phone\"\n                    type=\"tel\"\n                    value={formData.phone}\n                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                    required\n                    dir=\"ltr\"\n                    data-testid=\"input-contact-phone\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"message\">{t(\"contact.message\")}</Label>\n                  <Textarea\n                    id=\"message\"\n                    rows={5}\n                    value={formData.message}\n                    onChange={(e) => setFormData({ ...formData, message: e.target.value })}\n                    required\n                    data-testid=\"input-contact-message\"\n                  />\n                </div>\n                <Button type=\"submit\" className=\"w-full\" disabled={isSubmitting} data-testid=\"button-send-message\">\n                  {isSubmitting ? (\n                    t(\"common.loading\")\n                  ) : (\n                    <>\n                      <Send className=\"h-4 w-4 me-2\" />\n                      {t(\"contact.send\")}\n                    </>\n                  )}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8482,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/pages/FriendsClub.tsx":{"content":"import { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { Users, Share2, UserPlus, Gift, Copy, Check } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useAuth } from \"@/context/AuthContext\";\n\nexport default function FriendsClub() {\n  const { t, i18n } = useTranslation();\n  const { user } = useAuth();\n  const [copied, setCopied] = useState(false);\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const referralCode = user?.referralCode || \"GHASLA2024\";\n  const referralLink = `${window.location.origin}/register?ref=${referralCode}`;\n\n  const copyToClipboard = () => {\n    navigator.clipboard.writeText(referralLink);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  const steps = [\n    {\n      icon: Share2,\n      number: 1,\n      titleAr: \"شارك رابطك\",\n      titleEn: \"Share Your Link\",\n      titleFr: \"Partagez Votre Lien\",\n      descAr: \"أرسل رابط الإحالة الخاص بك لأصدقائك وعائلتك\",\n      descEn: \"Send your referral link to friends and family\",\n      descFr: \"Envoyez votre lien de parrainage à vos amis et famille\",\n    },\n    {\n      icon: UserPlus,\n      number: 2,\n      titleAr: \"صديقك يسجل\",\n      titleEn: \"Friend Signs Up\",\n      titleFr: \"L'ami S'inscrit\",\n      descAr: \"عندما يسجل صديقك باستخدام رابطك\",\n      descEn: \"When your friend registers using your link\",\n      descFr: \"Quand votre ami s'inscrit via votre lien\",\n    },\n    {\n      icon: Gift,\n      number: 3,\n      titleAr: \"كلاكما يربح\",\n      titleEn: \"Both Win\",\n      titleFr: \"Vous Gagnez Tous Les Deux\",\n      descAr: \"عند أول طلب مدفوع، تحصل على 400 نقطة وصديقك على 200 نقطة\",\n      descEn: \"On first paid order, you get 400 points and your friend gets 200 points\",\n      descFr: \"À la première commande payée, vous recevez 400 points et votre ami 200 points\",\n    },\n  ];\n\n  const benefits = [\n    {\n      valueAr: \"400\",\n      valueEn: \"400\",\n      valueFr: \"400\",\n      labelAr: \"نقطة للمُحيل\",\n      labelEn: \"Points for Referrer\",\n      labelFr: \"Points pour le Parrain\",\n    },\n    {\n      valueAr: \"200\",\n      valueEn: \"200\",\n      valueFr: \"200\",\n      labelAr: \"نقطة للصديق\",\n      labelEn: \"Points for Friend\",\n      labelFr: \"Points pour l'Ami\",\n    },\n    {\n      valueAr: \"∞\",\n      valueEn: \"∞\",\n      valueFr: \"∞\",\n      labelAr: \"بدون حدود\",\n      labelEn: \"Unlimited\",\n      labelFr: \"Illimité\",\n    },\n  ];\n\n  return (\n    <div className=\"py-12\">\n      <div className=\"container mx-auto px-4\">\n        {/* Hero */}\n        <div className=\"text-center mb-16\">\n          <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-chart-1/10 mb-6\">\n            <Users className=\"h-10 w-10 text-chart-1\" />\n          </div>\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">{t(\"friendsClub.title\")}</h1>\n          <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n            {t(\"friendsClub.subtitle\")}\n          </p>\n        </div>\n\n        {/* Benefits Summary */}\n        <div className=\"grid grid-cols-3 gap-4 max-w-2xl mx-auto mb-16\">\n          {benefits.map((benefit, index) => (\n            <Card key={index} className=\"text-center\" data-testid={`benefit-${index}`}>\n              <CardContent className=\"pt-6\">\n                <p className=\"text-4xl font-bold text-chart-1 mb-2\">\n                  {getLocalizedText(benefit.valueAr, benefit.valueEn, benefit.valueFr)}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  {getLocalizedText(benefit.labelAr, benefit.labelEn, benefit.labelFr)}\n                </p>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {/* How It Works */}\n        <div className=\"mb-16\">\n          <h2 className=\"text-3xl font-bold text-center mb-8\">{t(\"friendsClub.howItWorks\")}</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto\">\n            {steps.map((step, index) => (\n              <Card key={index} className=\"text-center\" data-testid={`step-card-${index}`}>\n                <CardHeader>\n                  <div className=\"mx-auto w-16 h-16 rounded-full bg-chart-1/10 flex items-center justify-center mb-4\">\n                    <step.icon className=\"h-8 w-8 text-chart-1\" />\n                  </div>\n                  <div className=\"mx-auto w-8 h-8 rounded-full bg-chart-1 flex items-center justify-center text-white font-bold text-sm -mt-12 mb-4 relative z-10\">\n                    {step.number}\n                  </div>\n                  <CardTitle className=\"text-lg\">\n                    {getLocalizedText(step.titleAr, step.titleEn, step.titleFr)}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground text-sm\">\n                    {getLocalizedText(step.descAr, step.descEn, step.descFr)}\n                  </p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n\n        {/* Referral Link Section */}\n        {user ? (\n          <div className=\"max-w-2xl mx-auto mb-16\">\n            <Card className=\"overflow-hidden\">\n              <div className=\"bg-gradient-to-br from-chart-1 to-chart-1/80 p-6 text-white\">\n                <h3 className=\"text-xl font-bold mb-2\">{t(\"friendsClub.yourLink\")}</h3>\n                <p className=\"opacity-90 text-sm\">\n                  {getLocalizedText(\n                    \"شارك هذا الرابط مع أصدقائك\",\n                    \"Share this link with your friends\",\n                    \"Partagez ce lien avec vos amis\"\n                  )}\n                </p>\n              </div>\n              <CardContent className=\"p-6 space-y-4\">\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">{t(\"friendsClub.yourCode\")}</label>\n                  <div className=\"p-3 bg-muted rounded-lg font-mono text-lg text-center\">\n                    {referralCode}\n                  </div>\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">{t(\"friendsClub.yourLink\")}</label>\n                  <div className=\"flex gap-2\">\n                    <input\n                      type=\"text\"\n                      readOnly\n                      value={referralLink}\n                      className=\"flex-1 p-3 bg-muted rounded-lg text-sm font-mono\"\n                      dir=\"ltr\"\n                    />\n                    <Button onClick={copyToClipboard} data-testid=\"copy-referral-link\">\n                      {copied ? <Check className=\"h-4 w-4\" /> : <Copy className=\"h-4 w-4\" />}\n                      <span className=\"ms-2\">{copied ? t(\"friendsClub.copied\") : t(\"friendsClub.copyLink\")}</span>\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        ) : (\n          <div className=\"text-center mb-16\">\n            <Card className=\"max-w-md mx-auto\">\n              <CardContent className=\"pt-6\">\n                <Users className=\"h-12 w-12 text-chart-1 mx-auto mb-4\" />\n                <h3 className=\"text-xl font-semibold mb-2\">\n                  {getLocalizedText(\n                    \"سجل للحصول على رابط الإحالة\",\n                    \"Register to Get Your Referral Link\",\n                    \"Inscrivez-vous pour Obtenir Votre Lien\"\n                  )}\n                </h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  {getLocalizedText(\n                    \"أنشئ حساباً لبدء دعوة أصدقائك وكسب النقاط\",\n                    \"Create an account to start inviting friends and earning points\",\n                    \"Créez un compte pour commencer à inviter des amis et gagner des points\"\n                  )}\n                </p>\n                <Link href=\"/register\">\n                  <Button className=\"w-full\" data-testid=\"friends-club-register\">\n                    {t(\"auth.register\")}\n                  </Button>\n                </Link>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* FAQ */}\n        <div className=\"max-w-3xl mx-auto\">\n          <h2 className=\"text-2xl font-bold text-center mb-8\">\n            {getLocalizedText(\"أسئلة شائعة\", \"Frequently Asked Questions\", \"Questions Fréquentes\")}\n          </h2>\n          <div className=\"space-y-4\">\n            <Card>\n              <CardContent className=\"pt-6\">\n                <h4 className=\"font-semibold mb-2\">\n                  {getLocalizedText(\n                    \"متى أحصل على النقاط؟\",\n                    \"When do I get the points?\",\n                    \"Quand est-ce que je reçois les points?\"\n                  )}\n                </h4>\n                <p className=\"text-muted-foreground text-sm\">\n                  {getLocalizedText(\n                    \"تحصل على النقاط فور إتمام صديقك لأول طلب مدفوع\",\n                    \"You receive points as soon as your friend completes their first paid order\",\n                    \"Vous recevez les points dès que votre ami termine sa première commande payée\"\n                  )}\n                </p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardContent className=\"pt-6\">\n                <h4 className=\"font-semibold mb-2\">\n                  {getLocalizedText(\n                    \"هل هناك حد لعدد الإحالات؟\",\n                    \"Is there a limit on referrals?\",\n                    \"Y a-t-il une limite aux parrainages?\"\n                  )}\n                </h4>\n                <p className=\"text-muted-foreground text-sm\">\n                  {getLocalizedText(\n                    \"لا، يمكنك دعوة عدد غير محدود من الأصدقاء وكسب نقاط على كل إحالة ناجحة\",\n                    \"No, you can invite unlimited friends and earn points on every successful referral\",\n                    \"Non, vous pouvez inviter un nombre illimité d'amis et gagner des points sur chaque parrainage réussi\"\n                  )}\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10753,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/pages/TrackOrder.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { \n  Car, MapPin, Clock, Calendar, Package, Check, ChevronRight, \n  Filter, ArrowLeft, Truck, CircleDot, CheckCircle, XCircle, \n  RefreshCw, FileText, CreditCard, Star, Sparkles\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { usePostgresOrders, type OrderFilter } from \"@/hooks/use-postgres-orders\";\nimport type { Order } from \"@shared/schema\";\n\nconst ORDER_STATUS_CONFIG: Record<string, { labelAr: string; labelEn: string; labelFr: string; step: number }> = {\n  pending: { labelAr: \"معلق\", labelEn: \"Pending\", labelFr: \"En attente\", step: 1 },\n  confirmed: { labelAr: \"مؤكد\", labelEn: \"Confirmed\", labelFr: \"Confirmé\", step: 2 },\n  assigned: { labelAr: \"مخصص\", labelEn: \"Assigned\", labelFr: \"Assigné\", step: 2 },\n  on_the_way: { labelAr: \"في الطريق\", labelEn: \"On the way\", labelFr: \"En route\", step: 3 },\n  in_progress: { labelAr: \"قيد التنفيذ\", labelEn: \"In progress\", labelFr: \"En cours\", step: 4 },\n  completed: { labelAr: \"مكتمل\", labelEn: \"Completed\", labelFr: \"Terminé\", step: 5 },\n  cancelled: { labelAr: \"ملغي\", labelEn: \"Cancelled\", labelFr: \"Annulé\", step: 0 }\n};\n\nconst fadeInUp = {\n  hidden: { opacity: 0, y: 20 },\n  visible: { opacity: 1, y: 0, transition: { duration: 0.4 } }\n};\n\nconst staggerContainer = {\n  hidden: { opacity: 0 },\n  visible: { opacity: 1, transition: { staggerChildren: 0.1 } }\n};\n\nexport default function TrackOrder() {\n  const { t, i18n } = useTranslation();\n  const { user } = useAuth();\n  const [, navigate] = useLocation();\n  const [selectedOrder, setSelectedOrder] = useState<Order | null>(null);\n\n  const { \n    filteredOrders, \n    lastCompletedOrder, \n    isLoading, \n    error,\n    filter, \n    setFilter, \n    refetch \n  } = usePostgresOrders();\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  useEffect(() => {\n    if (!user) {\n      navigate(\"/login\");\n    }\n  }, [user, navigate]);\n\n  const getStatusLabel = (status: string) => {\n    const config = ORDER_STATUS_CONFIG[status as keyof typeof ORDER_STATUS_CONFIG];\n    if (!config) return status;\n    return getLocalizedText(config.labelAr, config.labelEn, config.labelFr);\n  };\n\n  const getStatusVariant = (status: string): \"default\" | \"secondary\" | \"destructive\" => {\n    if (status === \"completed\") return \"default\";\n    if (status === \"cancelled\") return \"destructive\";\n    return \"secondary\";\n  };\n\n  const getStatusStep = (status: string) => {\n    const config = ORDER_STATUS_CONFIG[status as keyof typeof ORDER_STATUS_CONFIG];\n    return config?.step || 0;\n  };\n\n  const formatDate = (dateValue: any) => {\n    if (!dateValue) return \"\";\n    const date = new Date(dateValue);\n    return date.toLocaleDateString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\", {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n    });\n  };\n\n  const formatTime = (dateValue: any) => {\n    if (!dateValue) return \"\";\n    const date = new Date(dateValue);\n    return date.toLocaleTimeString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  };\n\n  const isLastCompleted = (order: Order) => {\n    return lastCompletedOrder?.id === order.id;\n  };\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <div className=\"bg-gradient-to-r from-primary/10 to-chart-1/10 border-b\">\n        <div className=\"container mx-auto px-4 py-8\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\" data-testid=\"button-back-home\">\n              <ArrowLeft className=\"h-4 w-4 me-2\" />\n              {getLocalizedText(\"العودة للرئيسية\", \"Back to Home\", \"Retour à l'accueil\")}\n            </Button>\n          </Link>\n          <h1 className=\"text-3xl md:text-4xl font-bold mb-2\">\n            Track Your Orders\n          </h1>\n          <p className=\"text-muted-foreground\">\n            {getLocalizedText(\n              \"تابع حالة طلبات غسلتك الحالية والسابقة في مكان واحد\",\n              \"Track the status of your current and previous wash orders in one place\",\n              \"Suivez l'état de vos commandes de lavage actuelles et passées en un seul endroit\"\n            )}\n          </p>\n          <div className=\"flex items-center gap-2 mt-2\">\n            <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n            <span className=\"text-xs text-muted-foreground\">\n              {getLocalizedText(\"تحديث لحظي\", \"Real-time updates\", \"Mises à jour en temps réel\")}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Orders List */}\n          <div className=\"lg:col-span-1 space-y-4\">\n            {/* Filter and Refresh */}\n            <div className=\"flex items-center gap-2\">\n              <Filter className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n              <Select value={filter} onValueChange={(v) => setFilter(v as OrderFilter)}>\n                <SelectTrigger className=\"flex-1\" data-testid=\"select-status-filter\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{getLocalizedText(\"جميع الطلبات\", \"All Orders\", \"Toutes les commandes\")}</SelectItem>\n                  <SelectItem value=\"active\">{getLocalizedText(\"طلبات نشطة\", \"Active\", \"Actives\")}</SelectItem>\n                  <SelectItem value=\"completed\">{getLocalizedText(\"مكتملة\", \"Completed\", \"Terminées\")}</SelectItem>\n                  <SelectItem value=\"cancelled\">{getLocalizedText(\"ملغية\", \"Cancelled\", \"Annulées\")}</SelectItem>\n                </SelectContent>\n              </Select>\n              <Button \n                variant=\"outline\" \n                size=\"icon\" \n                onClick={refetch}\n                title={getLocalizedText(\"تحديث\", \"Refresh\", \"Actualiser\")}\n                data-testid=\"button-refresh-orders\"\n              >\n                <RefreshCw className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            {/* Error State */}\n            {error && (\n              <Card className=\"border-destructive/50 bg-destructive/10\">\n                <CardContent className=\"p-4 text-center\">\n                  <XCircle className=\"h-8 w-8 text-destructive mx-auto mb-2\" />\n                  <p className=\"text-sm text-destructive\">{error}</p>\n                  <Button variant=\"outline\" size=\"sm\" className=\"mt-2\" onClick={refetch}>\n                    {getLocalizedText(\"إعادة المحاولة\", \"Retry\", \"Réessayer\")}\n                  </Button>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Loading State */}\n            {isLoading ? (\n              <div className=\"space-y-3\">\n                {[1, 2, 3].map(i => (\n                  <Card key={i} className=\"animate-pulse\">\n                    <CardContent className=\"p-4\">\n                      <div className=\"h-4 bg-muted rounded w-1/2 mb-2\" />\n                      <div className=\"h-3 bg-muted rounded w-3/4\" />\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : filteredOrders.length === 0 ? (\n              <Card>\n                <CardContent className=\"p-8 text-center\">\n                  <Package className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <p className=\"text-muted-foreground\">\n                    {getLocalizedText(\"لا توجد طلبات\", \"No orders found\", \"Aucune commande trouvée\")}\n                  </p>\n                  <Link href=\"/booking\">\n                    <Button className=\"mt-4\" data-testid=\"button-book-now\">\n                      {getLocalizedText(\"احجز الآن\", \"Book Now\", \"Réserver\")}\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            ) : (\n              <motion.div\n                initial=\"hidden\"\n                animate=\"visible\"\n                variants={staggerContainer}\n                className=\"space-y-3\"\n              >\n                {filteredOrders.map((order) => (\n                  <motion.div key={order.id} variants={fadeInUp}>\n                    <Card \n                      className={`cursor-pointer transition-all hover:shadow-md ${\n                        selectedOrder?.id === order.id ? \"ring-2 ring-primary\" : \"\"\n                      } ${isLastCompleted(order) ? \"border-green-500/50\" : \"\"}`}\n                      onClick={() => setSelectedOrder(order)}\n                      data-testid={`order-card-${order.id}`}\n                    >\n                      <CardContent className=\"p-4\">\n                        {/* Last Completed Badge */}\n                        {isLastCompleted(order) && (\n                          <div className=\"flex items-center gap-1 mb-2\">\n                            <Sparkles className=\"h-3 w-3 text-green-600\" />\n                            <span className=\"text-xs font-medium text-green-600\">\n                              {getLocalizedText(\"آخر طلب منتهي\", \"Last Completed\", \"Dernière terminée\")}\n                            </span>\n                          </div>\n                        )}\n                        \n                        <div className=\"flex items-start justify-between gap-2 mb-2\">\n                          <div>\n                            <p className=\"font-medium text-sm\">\n                              {order.area || getLocalizedText(\"خدمة غسيل\", \"Car Wash Service\", \"Service de lavage\")}\n                            </p>\n                            <p className=\"text-xs text-muted-foreground flex items-center gap-2 flex-wrap\">\n                              <span className=\"font-mono\">#{order.id.slice(0, 8)}</span>\n                              {order.carType && (\n                                <span className=\"flex items-center gap-1\">\n                                  <Car className=\"h-3 w-3\" />\n                                  {order.carType === \"suv\" ? \"SUV\" : getLocalizedText(\"سيدان\", \"Sedan\", \"Berline\")}\n                                </span>\n                              )}\n                            </p>\n                          </div>\n                          <Badge variant={getStatusVariant(order.status)} className=\"shrink-0\">\n                            {getStatusLabel(order.status)}\n                          </Badge>\n                        </div>\n                        \n                        {/* Vehicle Info */}\n                        {order.carDetails && (\n                          <div className=\"flex items-center gap-2 text-xs text-muted-foreground mb-2\">\n                            <Car className=\"h-3 w-3\" />\n                            <span>{order.carDetails}</span>\n                          </div>\n                        )}\n                        \n                        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                          <span className=\"flex items-center gap-1\">\n                            <Calendar className=\"h-3 w-3\" />\n                            {formatDate(order.createdAt)}\n                          </span>\n                          <span className=\"flex items-center gap-1\">\n                            <Clock className=\"h-3 w-3\" />\n                            {formatTime(order.createdAt)}\n                          </span>\n                        </div>\n                        <div className=\"flex items-center justify-between mt-2\">\n                          <span className=\"text-sm font-semibold text-primary\">\n                            {order.priceKD} {getLocalizedText(\"د.ك\", \"KD\", \"KD\")}\n                          </span>\n                          <ChevronRight className=\"h-4 w-4 text-muted-foreground\" />\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </motion.div>\n                ))}\n              </motion.div>\n            )}\n          </div>\n\n          {/* Order Details Panel */}\n          <div className=\"lg:col-span-2\">\n            <AnimatePresence mode=\"wait\">\n              {selectedOrder ? (\n                <motion.div\n                  key={selectedOrder.id}\n                  initial={{ opacity: 0, x: 20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  exit={{ opacity: 0, x: -20 }}\n                  transition={{ duration: 0.3 }}\n                >\n                  <Card>\n                    <CardHeader className=\"pb-4\">\n                      <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                        <div>\n                          {isLastCompleted(selectedOrder) && (\n                            <Badge className=\"bg-green-600 mb-2\">\n                              <Sparkles className=\"h-3 w-3 me-1\" />\n                              {getLocalizedText(\"آخر طلب منتهي\", \"Last Completed Order\", \"Dernière commande terminée\")}\n                            </Badge>\n                          )}\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <Package className=\"h-5 w-5 text-primary\" />\n                            {selectedOrder.area || getLocalizedText(\"خدمة غسيل\", \"Car Wash Service\", \"Service de lavage\")}\n                          </CardTitle>\n                          <p className=\"text-sm text-muted-foreground mt-1 font-mono\">\n                            {getLocalizedText(\"كود الطلب:\", \"Order Code:\", \"Code de commande:\")} #{selectedOrder.id.slice(0, 8)}\n                          </p>\n                        </div>\n                        <Badge variant={getStatusVariant(selectedOrder.status)} className=\"text-sm\">\n                          {getStatusLabel(selectedOrder.status)}\n                        </Badge>\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-6\">\n                      {/* Timeline */}\n                      {selectedOrder.status !== \"cancelled\" && (\n                        <div className=\"bg-muted/50 rounded-lg p-4\">\n                          <h3 className=\"font-medium mb-4\">\n                            {getLocalizedText(\"حالة الطلب\", \"Order Progress\", \"Progression de la commande\")}\n                          </h3>\n                          <div className=\"space-y-4\">\n                            {[\n                              { key: \"pending\", icon: CircleDot, label: { ar: \"تم استلام الطلب\", en: \"Order Received\", fr: \"Commande reçue\" } },\n                              { key: \"assigned\", icon: Truck, label: { ar: \"تم تخصيص السائق\", en: \"Driver Assigned\", fr: \"Chauffeur assigné\" } },\n                              { key: \"on_the_way\", icon: MapPin, label: { ar: \"في الطريق\", en: \"On The Way\", fr: \"En Route\" } },\n                              { key: \"in_progress\", icon: Car, label: { ar: \"قيد التنفيذ\", en: \"In Progress\", fr: \"En cours\" } },\n                              { key: \"completed\", icon: CheckCircle, label: { ar: \"مكتمل\", en: \"Completed\", fr: \"Terminé\" } },\n                            ].map((step, index) => {\n                              const statusOrder = [\"pending\", \"assigned\", \"on_the_way\", \"in_progress\", \"completed\"];\n                              const currentIdx = statusOrder.indexOf(selectedOrder.status);\n                              const stepIdx = statusOrder.indexOf(step.key);\n                              const isCompleted = stepIdx < currentIdx;\n                              const isCurrent = stepIdx === currentIdx;\n                              const StepIcon = step.icon;\n\n                              return (\n                                <div key={step.key} className=\"flex items-start gap-3\">\n                                  <div className=\"relative\">\n                                    <div\n                                      className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                                        isCompleted\n                                          ? \"bg-primary text-white\"\n                                          : isCurrent\n                                          ? \"bg-primary/20 text-primary border-2 border-primary\"\n                                          : \"bg-muted border-2 border-muted-foreground/20 text-muted-foreground\"\n                                      }`}\n                                    >\n                                      {isCompleted ? (\n                                        <Check className=\"h-4 w-4\" />\n                                      ) : (\n                                        <StepIcon className={`h-4 w-4 ${isCurrent && step.key === \"on_the_way\" ? \"animate-pulse\" : \"\"}`} />\n                                      )}\n                                    </div>\n                                    {index < 4 && (\n                                      <div\n                                        className={`absolute top-8 start-1/2 -translate-x-1/2 w-0.5 h-6 ${\n                                          isCompleted ? \"bg-primary\" : \"bg-muted-foreground/20\"\n                                        }`}\n                                      />\n                                    )}\n                                  </div>\n                                  <div className=\"pt-1\">\n                                    <p className={`font-medium ${isCurrent ? \"text-primary\" : \"\"}`}>\n                                      {getLocalizedText(step.label.ar, step.label.en, step.label.fr)}\n                                    </p>\n                                    {isCurrent && (\n                                      <p className=\"text-xs text-muted-foreground\">\n                                        {getLocalizedText(\"الحالة الحالية\", \"Current status\", \"Statut actuel\")}\n                                      </p>\n                                    )}\n                                    {selectedOrder.assignedDriver && step.key === \"assigned\" && (\n                                      <p className=\"text-xs text-muted-foreground\">\n                                        {selectedOrder.assignedDriver}\n                                      </p>\n                                    )}\n                                    {isCurrent && step.key === \"on_the_way\" && (\n                                      <p className=\"text-xs text-primary\">\n                                        {getLocalizedText(\"السائق في الطريق إليك\", \"Driver is on the way to you\", \"Le chauffeur est en route\")}\n                                      </p>\n                                    )}\n                                  </div>\n                                </div>\n                              );\n                            })}\n                          </div>\n                        </div>\n                      )}\n\n                      {/* Cancelled Status */}\n                      {selectedOrder.status === \"cancelled\" && (\n                        <div className=\"bg-destructive/10 border border-destructive/20 rounded-lg p-4 flex items-center gap-3\">\n                          <XCircle className=\"h-6 w-6 text-destructive\" />\n                          <div>\n                            <p className=\"font-medium text-destructive\">\n                              {getLocalizedText(\"تم إلغاء الطلب\", \"Order Cancelled\", \"Commande annulée\")}\n                            </p>\n                            {selectedOrder.cancelReason && (\n                              <p className=\"text-sm text-muted-foreground\">{selectedOrder.cancelReason}</p>\n                            )}\n                          </div>\n                        </div>\n                      )}\n\n                      {/* Order Details Grid */}\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                        {/* Vehicle */}\n                        <div className=\"bg-muted/30 rounded-lg p-3\">\n                          <div className=\"flex items-center gap-2 text-muted-foreground mb-1\">\n                            <Car className=\"h-4 w-4\" />\n                            <span className=\"text-xs\">{getLocalizedText(\"السيارة\", \"Vehicle\", \"Véhicule\")}</span>\n                          </div>\n                          <p className=\"font-medium text-sm\">\n                            {selectedOrder.carType === \"suv\" ? \"SUV\" : getLocalizedText(\"سيدان\", \"Sedan\", \"Berline\")}\n                          </p>\n                          {selectedOrder.carDetails && (\n                            <p className=\"text-xs text-muted-foreground\">{selectedOrder.carDetails}</p>\n                          )}\n                        </div>\n                        \n                        {/* Area */}\n                        <div className=\"bg-muted/30 rounded-lg p-3\">\n                          <div className=\"flex items-center gap-2 text-muted-foreground mb-1\">\n                            <MapPin className=\"h-4 w-4\" />\n                            <span className=\"text-xs\">{getLocalizedText(\"المنطقة\", \"Area\", \"Zone\")}</span>\n                          </div>\n                          <p className=\"font-medium text-sm\">{selectedOrder.area}</p>\n                        </div>\n                        \n                        {/* Date */}\n                        <div className=\"bg-muted/30 rounded-lg p-3\">\n                          <div className=\"flex items-center gap-2 text-muted-foreground mb-1\">\n                            <Calendar className=\"h-4 w-4\" />\n                            <span className=\"text-xs\">{getLocalizedText(\"التاريخ\", \"Date\", \"Date\")}</span>\n                          </div>\n                          <p className=\"font-medium text-sm\">{formatDate(selectedOrder.createdAt)}</p>\n                        </div>\n                        \n                        {/* Payment */}\n                        <div className=\"bg-muted/30 rounded-lg p-3\">\n                          <div className=\"flex items-center gap-2 text-muted-foreground mb-1\">\n                            <CreditCard className=\"h-4 w-4\" />\n                            <span className=\"text-xs\">{getLocalizedText(\"الدفع\", \"Payment\", \"Paiement\")}</span>\n                          </div>\n                          <p className=\"font-medium text-sm capitalize\">{selectedOrder.paymentMethod.replace(\"_\", \" \")}</p>\n                        </div>\n                      </div>\n\n                      {/* Address */}\n                      {selectedOrder.address && (\n                        <div className=\"bg-muted/30 rounded-lg p-3\">\n                          <p className=\"text-xs text-muted-foreground mb-1\">\n                            {getLocalizedText(\"العنوان\", \"Address\", \"Adresse\")}\n                          </p>\n                          <p className=\"text-sm\">{selectedOrder.address}</p>\n                        </div>\n                      )}\n\n                      {/* Price & Points */}\n                      <div className=\"flex flex-wrap items-center justify-between gap-4 pt-4 border-t\">\n                        <div>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {getLocalizedText(\"المبلغ الإجمالي\", \"Total Amount\", \"Montant total\")}\n                          </p>\n                          <p className=\"text-2xl font-bold text-primary\">\n                            {selectedOrder.priceKD} {getLocalizedText(\"د.ك\", \"KD\", \"KD\")}\n                          </p>\n                        </div>\n                        <div className=\"flex flex-wrap gap-2\">\n                          {(selectedOrder.loyaltyPointsEarned ?? 0) > 0 && (\n                            <Badge variant=\"secondary\" className=\"text-sm\">\n                              <Star className=\"h-3 w-3 me-1\" />\n                              +{selectedOrder.loyaltyPointsEarned} {getLocalizedText(\"نقطة مكتسبة\", \"points earned\", \"points gagnés\")}\n                            </Badge>\n                          )}\n                          {(selectedOrder.loyaltyPointsRedeemed ?? 0) > 0 && (\n                            <Badge variant=\"outline\" className=\"text-sm\">\n                              {selectedOrder.loyaltyPointsRedeemed} {getLocalizedText(\"نقطة مستخدمة\", \"points used\", \"points utilisés\")}\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n\n                      {/* Order Timestamps */}\n                      <div className=\"flex items-center justify-center gap-4 text-xs text-muted-foreground\">\n                        <span>\n                          {getLocalizedText(\"تاريخ الطلب:\", \"Created:\", \"Créé:\")} {formatDate(selectedOrder.createdAt)}\n                        </span>\n                        <span>\n                          {getLocalizedText(\"آخر تحديث:\", \"Updated:\", \"Mis à jour:\")} {formatDate(selectedOrder.updatedAt)}\n                        </span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </motion.div>\n              ) : (\n                <motion.div\n                  initial={{ opacity: 0 }}\n                  animate={{ opacity: 1 }}\n                  className=\"h-full flex items-center justify-center\"\n                >\n                  <Card className=\"w-full\">\n                    <CardContent className=\"p-12 text-center\">\n                      <Package className=\"h-16 w-16 text-muted-foreground/50 mx-auto mb-4\" />\n                      <p className=\"text-muted-foreground text-lg\">\n                        {getLocalizedText(\n                          \"اختر طلباً لعرض التفاصيل\",\n                          \"Select an order to view details\",\n                          \"Sélectionnez une commande pour voir les détails\"\n                        )}\n                      </p>\n                    </CardContent>\n                  </Card>\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":27070,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/pages/Loyalty.tsx":{"content":"import { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { Gift, Star, Coins, Award, ArrowRight, Calculator } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nexport default function Loyalty() {\n  const { t, i18n } = useTranslation();\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const steps = [\n    {\n      icon: Star,\n      number: 1,\n      titleAr: \"احجز خدمتك\",\n      titleEn: \"Book Your Service\",\n      titleFr: \"Réservez Votre Service\",\n      descAr: \"اختر الباقة المناسبة واحجز موعدك\",\n      descEn: \"Choose the right package and book your appointment\",\n      descFr: \"Choisissez le forfait adapté et réservez votre rendez-vous\",\n    },\n    {\n      icon: Coins,\n      number: 2,\n      titleAr: \"اكسب النقاط\",\n      titleEn: \"Earn Points\",\n      titleFr: \"Gagnez des Points\",\n      descAr: \"احصل على 35 نقطة لكل دينار تنفقه\",\n      descEn: \"Get 35 points for every KD you spend\",\n      descFr: \"Obtenez 35 points pour chaque KD dépensé\",\n    },\n    {\n      icon: Gift,\n      number: 3,\n      titleAr: \"استبدل واستمتع\",\n      titleEn: \"Redeem & Enjoy\",\n      titleFr: \"Échangez & Profitez\",\n      descAr: \"استخدم نقاطك للحصول على خصومات\",\n      descEn: \"Use your points to get discounts\",\n      descFr: \"Utilisez vos points pour obtenir des réductions\",\n    },\n  ];\n\n  const benefits = [\n    {\n      icon: Award,\n      titleAr: \"مكافأة ترحيب\",\n      titleEn: \"Welcome Bonus\",\n      titleFr: \"Bonus de Bienvenue\",\n      valueAr: \"200 نقطة\",\n      valueEn: \"200 Points\",\n      valueFr: \"200 Points\",\n      descAr: \"عند أول طلب مدفوع\",\n      descEn: \"On your first paid order\",\n      descFr: \"Sur votre première commande payée\",\n    },\n    {\n      icon: Coins,\n      titleAr: \"نقاط لكل دينار\",\n      titleEn: \"Points per KD\",\n      titleFr: \"Points par KD\",\n      valueAr: \"35 نقطة\",\n      valueEn: \"35 Points\",\n      valueFr: \"35 Points\",\n      descAr: \"على كل دينار تنفقه\",\n      descEn: \"For every KD spent\",\n      descFr: \"Pour chaque KD dépensé\",\n    },\n    {\n      icon: Calculator,\n      titleAr: \"قيمة النقاط\",\n      titleEn: \"Points Value\",\n      titleFr: \"Valeur des Points\",\n      valueAr: \"100 = 0.4 د.ك\",\n      valueEn: \"100 = 0.4 KD\",\n      valueFr: \"100 = 0.4 KD\",\n      descAr: \"كل 100 نقطة تساوي 0.4 د.ك\",\n      descEn: \"Every 100 points = 0.4 KD\",\n      descFr: \"Chaque 100 points = 0.4 KD\",\n    },\n  ];\n\n  const examples = [\n    {\n      titleAr: \"مثال: غسيل كامل (7 د.ك)\",\n      titleEn: \"Example: Full Wash (7 KD)\",\n      titleFr: \"Exemple: Lavage Complet (7 KD)\",\n      pointsAr: \"تكسب 245 نقطة\",\n      pointsEn: \"You earn 245 points\",\n      pointsFr: \"Vous gagnez 245 points\",\n      calcAr: \"7 × 35 = 245 نقطة\",\n      calcEn: \"7 × 35 = 245 points\",\n      calcFr: \"7 × 35 = 245 points\",\n    },\n    {\n      titleAr: \"مثال: استخدام النقاط\",\n      titleEn: \"Example: Using Points\",\n      titleFr: \"Exemple: Utilisation des Points\",\n      pointsAr: \"500 نقطة = 2 د.ك خصم\",\n      pointsEn: \"500 points = 2 KD discount\",\n      pointsFr: \"500 points = 2 KD de réduction\",\n      calcAr: \"500 ÷ 100 × 0.4 = 2 د.ك\",\n      calcEn: \"500 ÷ 100 × 0.4 = 2 KD\",\n      calcFr: \"500 ÷ 100 × 0.4 = 2 KD\",\n    },\n  ];\n\n  return (\n    <div className=\"py-12\">\n      <div className=\"container mx-auto px-4\">\n        {/* Hero */}\n        <div className=\"text-center mb-16\">\n          <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-primary/10 mb-6\">\n            <Gift className=\"h-10 w-10 text-primary\" />\n          </div>\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">{t(\"loyalty.title\")}</h1>\n          <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n            {t(\"loyalty.subtitle\")}\n          </p>\n        </div>\n\n        {/* How It Works */}\n        <div className=\"mb-16\">\n          <h2 className=\"text-3xl font-bold text-center mb-8\">{t(\"loyalty.howItWorks\")}</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto\">\n            {steps.map((step, index) => (\n              <div key={index} className=\"relative text-center\" data-testid={`loyalty-step-${index}`}>\n                <div className=\"mx-auto w-16 h-16 rounded-full bg-gradient-to-br from-primary to-chart-1 flex items-center justify-center text-white text-2xl font-bold mb-4\">\n                  {step.number}\n                </div>\n                <h3 className=\"text-xl font-semibold mb-2\">\n                  {getLocalizedText(step.titleAr, step.titleEn, step.titleFr)}\n                </h3>\n                <p className=\"text-muted-foreground\">\n                  {getLocalizedText(step.descAr, step.descEn, step.descFr)}\n                </p>\n                {index < steps.length - 1 && (\n                  <ArrowRight className=\"hidden md:block absolute top-8 -end-4 h-6 w-6 text-muted-foreground rtl:rotate-180\" />\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Benefits */}\n        <div className=\"mb-16\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            {benefits.map((benefit, index) => (\n              <Card key={index} className=\"text-center\" data-testid={`benefit-card-${index}`}>\n                <CardHeader>\n                  <div className=\"mx-auto w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center mb-4\">\n                    <benefit.icon className=\"h-7 w-7 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">\n                    {getLocalizedText(benefit.titleAr, benefit.titleEn, benefit.titleFr)}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-3xl font-bold text-primary mb-2\">\n                    {getLocalizedText(benefit.valueAr, benefit.valueEn, benefit.valueFr)}\n                  </p>\n                  <p className=\"text-muted-foreground text-sm\">\n                    {getLocalizedText(benefit.descAr, benefit.descEn, benefit.descFr)}\n                  </p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n\n        {/* Examples */}\n        <div className=\"mb-16\">\n          <h2 className=\"text-3xl font-bold text-center mb-8\">\n            {getLocalizedText(\"أمثلة عملية\", \"Practical Examples\", \"Exemples Pratiques\")}\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-3xl mx-auto\">\n            {examples.map((example, index) => (\n              <Card key={index} className=\"bg-muted/30\" data-testid={`example-card-${index}`}>\n                <CardContent className=\"pt-6\">\n                  <h3 className=\"font-semibold mb-4\">\n                    {getLocalizedText(example.titleAr, example.titleEn, example.titleFr)}\n                  </h3>\n                  <div className=\"space-y-2\">\n                    <p className=\"text-primary font-medium\">\n                      {getLocalizedText(example.pointsAr, example.pointsEn, example.pointsFr)}\n                    </p>\n                    <p className=\"text-muted-foreground text-sm font-mono\">\n                      {getLocalizedText(example.calcAr, example.calcEn, example.calcFr)}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n\n        {/* CTA */}\n        <div className=\"text-center bg-gradient-to-br from-primary to-chart-1 rounded-2xl p-8 text-white\">\n          <h2 className=\"text-2xl md:text-3xl font-bold mb-4\">\n            {getLocalizedText(\n              \"ابدأ بجمع النقاط اليوم!\",\n              \"Start Earning Points Today!\",\n              \"Commencez à Gagner des Points Aujourd'hui!\"\n            )}\n          </h2>\n          <p className=\"text-lg opacity-90 mb-6\">\n            {getLocalizedText(\n              \"سجل الآن واحصل على مكافأة الترحيب\",\n              \"Register now and get your welcome bonus\",\n              \"Inscrivez-vous maintenant et obtenez votre bonus de bienvenue\"\n            )}\n          </p>\n          <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\n            <Link href=\"/register\">\n              <Button size=\"lg\" variant=\"secondary\" data-testid=\"loyalty-register\">\n                {t(\"auth.register\")}\n              </Button>\n            </Link>\n            <Link href=\"/booking\">\n              <Button size=\"lg\" variant=\"outline\" className=\"border-white text-white hover:bg-white/10\" data-testid=\"loyalty-book\">\n                {t(\"nav.booking\")}\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9146,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"replit.md":{"content":"# Ghasla Style - Mobile Car Wash Service Platform\n\n## Overview\n\nGhasla Style (غسلة ستايل) is a production-ready fullstack web application for a Kuwaiti mobile car wash service. The platform features online booking, a loyalty points system, a referral \"Friends Club\" program, and comprehensive admin dashboard capabilities. The application supports three languages (Arabic RTL default, English, French) with light/dark theme modes.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript, using Vite as the build tool\n- **Routing**: Wouter for lightweight client-side routing\n- **State Management**: TanStack React Query for server state, React Context for auth and theme\n- **UI Components**: shadcn/ui component library built on Radix UI primitives\n- **Styling**: Tailwind CSS with custom design tokens for brand colors (dark orange and blue)\n- **Animations**: Framer Motion for page transitions and micro-interactions\n- **Internationalization**: react-i18next with JSON translation files for AR/EN/FR support\n- **Forms**: React Hook Form with Zod validation via @hookform/resolvers\n\n### Backend Architecture\n- **Runtime**: Node.js with Express.js\n- **API Design**: RESTful endpoints under `/api/*` prefix\n- **Database ORM**: Drizzle ORM with PostgreSQL\n- **Schema Validation**: Zod schemas generated from Drizzle tables via drizzle-zod\n- **Session Management**: express-session with connect-pg-simple for PostgreSQL session storage\n\n### Data Storage\n- **Primary Database**: PostgreSQL accessed via Drizzle ORM\n- **Schema Location**: `shared/schema.ts` contains all table definitions\n- **Key Entities**: Users, ServicePackages, Orders, Payments, LoyaltyConfig, LoyaltyTransactions, Referrals, BlogPosts, Testimonials, GalleryItems, ContactMessages, AuditLogs\n\n### Authentication\n- **Provider**: Firebase Authentication (configured in `client/src/lib/firebase.ts`)\n- **Methods**: Email/password, Google OAuth, phone authentication for customers\n- **Admin Security**: 2FA support for admin accounts\n- **Role-Based Access**: customer, admin, super_admin roles via Firebase Custom Claims\n- **Firebase Admin SDK**: Server-side token verification and custom claims management\n  - `server/firebase-admin.ts`: Admin SDK initialization and middleware\n  - `requireSuperAdmin`, `requireAdmin`: Middleware for protected routes\n- **Internal Admin Routes** (require SUPER_ADMIN_SECRET):\n  - `POST /internal/make-super-admin`: Set superAdmin claim (one-time setup)\n  - `POST /internal/set-admin`: Grant/revoke admin role\n\n### Payment Integration\n- **Gateway**: Tap Payments (supports KNET for Kuwait)\n- **Payment Table**: `payments` table stores all payment records with gateway references\n- **Flow**:\n  1. Customer selects \"online\" payment during booking\n  2. Order created → Payment record created → Redirect to checkout page\n  3. In production: Redirect to Tap/KNET gateway → Webhook confirms payment\n  4. Development: Simulation endpoints for testing (disabled in production)\n- **API Endpoints**:\n  - `POST /api/payments/create`: Create payment for an order\n  - `POST /api/payments/webhook`: Receive payment status from gateway\n  - `GET /api/payments/:id`: Get payment details\n  - `GET /api/payments/order/:orderId`: Get payment by order ID\n  - `GET /api/payments/customer/:customerId`: Customer payment history\n- **Security**:\n  - Simulation endpoints blocked in production (NODE_ENV=production)\n  - Webhook should validate gateway signatures in production\n  - Payment status transitions enforced server-side\n\n### Real-Time Features\n- **Firestore Orders**: Real-time order tracking with onSnapshot\n- **Dual Storage**: PostgreSQL for backend persistence, Firestore for real-time client updates\n- **Loyalty Points**: Automatic calculation and application on order completion\n\n### Project Structure\n```\nclient/               # React frontend application\n  src/\n    components/       # Reusable UI components\n      layout/         # Header, Footer, Layout wrapper\n      ui/             # shadcn/ui component library\n    context/          # React contexts (Auth, Theme)\n    hooks/            # Custom React hooks\n    lib/              # Utilities, Firebase config, i18n, query client\n      firebase.ts            # Firebase app initialization\n      firebase-functions.ts  # Cloud Functions client helpers\n      firestore-orders.ts    # Firestore order management\n    types/            # TypeScript type definitions\n      firestore-order.ts     # Firestore order types\n    pages/            # Route page components\n      admin/          # Admin dashboard pages\nserver/               # Express backend\n  db.ts              # Database connection\n  index.ts           # Express app entry point\n  routes.ts          # API route definitions\n  storage.ts         # Data access layer\n  static.ts          # Static file serving for production\n  vite.ts            # Vite dev server integration\nshared/               # Shared code between client and server\n  schema.ts          # Drizzle database schema and Zod types\nfunctions/            # Firebase Cloud Functions\n  src/\n    index.ts         # Cloud Functions (initSuperAdmin, setUserRole, getUserRole)\n  README.md          # Setup and deployment instructions\n```\n\n### Build and Development\n- **Development**: `npm run dev` runs tsx for hot-reloading server with Vite middleware\n- **Production Build**: `npm run build` compiles client with Vite and bundles server with esbuild\n- **Database Migrations**: `npm run db:push` uses drizzle-kit to sync schema with database\n\n## External Dependencies\n\n### Firebase Services\n- **Firebase Authentication**: User authentication and identity management\n- **Firebase Admin SDK**: Server-side authentication and custom claims\n- **Firebase Configuration**: Requires environment variables:\n  - `VITE_FIREBASE_API_KEY`\n  - `VITE_FIREBASE_PROJECT_ID`\n  - `VITE_FIREBASE_APP_ID`\n  - `FIREBASE_SERVICE_ACCOUNT` (optional): JSON string of service account for production\n  - `SUPER_ADMIN_SECRET`: Secret for one-time super admin setup via /internal/* routes\n\n### Database\n- **PostgreSQL**: Primary data store\n- **Connection**: Requires `DATABASE_URL` environment variable\n- **Session Store**: Uses connect-pg-simple for persistent sessions\n\n### Third-Party Integrations\n- **WhatsApp Business**: Direct booking via WhatsApp links (phone: +96597960808)\n- **Google Maps**: Embedded maps for location-based services\n- **Google Fonts**: Tajawal (Arabic) and Inter (English/French) typefaces\n\n### Key NPM Dependencies\n- UI: @radix-ui/* components, class-variance-authority, tailwind-merge\n- Data: @tanstack/react-query, drizzle-orm, drizzle-zod\n- Forms: react-hook-form, zod\n- i18n: i18next, react-i18next, i18next-browser-languagedetector\n- Animation: framer-motion\n- Icons: lucide-react, react-icons\n- Security: express-rate-limit, helmet\n\n## Security Configuration\n\n### Rate Limiting (server/security.ts + server/routes.ts)\nRate limiting is implemented using `express-rate-limit` to protect against abuse. Rate limiters are defined in `server/security.ts` and applied to routes in `server/routes.ts`:\n\n| Route Pattern | Limit | Window | Purpose |\n|---------------|-------|--------|---------|\n| `/api/*` (general) | 100 requests | 1 minute | General API protection |\n| `/api/auth/*` | 10 requests | 1 minute | Authentication endpoints |\n| `/api/users/*` | 10 requests | 1 minute | User account operations |\n| `/api/orders/*` | 20 requests | 1 minute | Order creation/management |\n| `/api/contact/*` | 5 requests | 1 minute | Contact form submissions |\n| `/internal/*` | 5 requests | 1 hour | Admin setup routes (very strict) |\n\n**To modify limits**: Edit the `rateLimit()` configurations in `server/security.ts`. Adjust `windowMs` (milliseconds) and `max` (request count) values.\n\n### CORS Configuration (server/index.ts)\nCORS is configured dynamically based on environment:\n\n**Development Mode**:\n- Allows all origins for local testing\n\n**Production Mode**:\n- Only allows origins specified in `ALLOWED_ORIGINS` environment variable\n- Set `ALLOWED_ORIGINS` as comma-separated list of allowed domains:\n  ```\n  ALLOWED_ORIGINS=https://ghaslastyle.com,https://admin.ghaslastyle.com,https://delegate.ghaslastyle.com\n  ```\n\n**Allowed Methods**: GET, POST, PUT, PATCH, DELETE, OPTIONS\n**Allowed Headers**: Content-Type, Authorization, X-Requested-With\n**Credentials**: Enabled\n**Preflight Cache**: 24 hours (86400 seconds)\n\n### HTTPS Enforcement\n- **Automatic Redirect**: In production, all HTTP requests are automatically redirected to HTTPS (301 redirect)\n- **Detection**: Uses `x-forwarded-proto` header (standard for reverse proxies like Replit/Cloudflare)\n- **Replit**: HTTPS is enforced automatically by Replit's infrastructure\n\n### Security Headers (Helmet)\nThe `helmet` middleware adds these security headers:\n- X-DNS-Prefetch-Control\n- X-Frame-Options (clickjacking protection)\n- X-Content-Type-Options (MIME sniffing protection)\n- Referrer-Policy\n- X-XSS-Protection\n\n**Note**: Content-Security-Policy is disabled for development compatibility with Vite HMR.\n\n### Authentication & Authorization Middleware\nLocated in `server/firebase-admin.ts`:\n\n| Middleware | Access Level | Protected Routes |\n|------------|--------------|------------------|\n| `requireAuth` | Any authenticated user | Customer-specific data |\n| `requireDelegate` | Delegate, Admin, Super Admin | `/api/delegate/*` |\n| `requireAdmin` | Admin, Super Admin | `/api/admin/*` (most routes) |\n| `requireSuperAdmin` | Super Admin only | `/api/admin/admins/*`, admin management |\n\n### Environment Variables (Secrets)\nAll sensitive data stored as encrypted secrets (never in code):\n- `SUPER_ADMIN_SECRET`: One-time admin setup\n- `SESSION_SECRET`: Session encryption\n- `FIREBASE_SERVICE_ACCOUNT`: Firebase Admin SDK credentials\n- `DATABASE_URL`: PostgreSQL connection string\n- `VITE_FIREBASE_*`: Firebase client configuration\n\n### Audit Logging\nAll admin actions are logged to `auditLogs` table with:\n- Action type\n- Performing user ID\n- Target collection/ID\n- Old/new values\n- Timestamp\n\n## Firebase Production Deployment\n\n### Deploying Security Rules\nBefore going to production, deploy Firebase security rules:\n\n```bash\n# Install Firebase CLI (if not already installed)\nnpm install -g firebase-tools\n\n# Login to Firebase\nfirebase login\n\n# Deploy Firestore rules\nfirebase deploy --only firestore:rules\n\n# Deploy Storage rules\nfirebase deploy --only storage:rules\n\n# Deploy Firestore indexes\nfirebase deploy --only firestore:indexes\n\n# Or deploy everything at once\nfirebase deploy --only firestore,storage\n```\n\n### Security Rules Files\n- `firestore.rules` - Firestore database access rules\n- `storage.rules` - Firebase Storage access rules\n- `firestore.indexes.json` - Composite indexes for queries\n- `firebase.json` - Firebase project configuration\n\n### Pre-Production Checklist\n1. All secrets configured in Replit Secrets panel (not in code)\n2. Firebase security rules deployed (not in test mode)\n3. Set `ALLOWED_ORIGINS` for production domains\n4. Test all user roles: Super Admin, Admin, Delegate, Customer\n5. Verify rate limiting is working correctly\n6. Check HTTPS redirect in production","path":null,"size_bytes":11239,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/pages/Register.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation, useSearch } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { Mail, Lock, User, Phone, Gift, Loader2, CheckCircle, AlertCircle } from \"lucide-react\";\nimport { SiGoogle } from \"react-icons/si\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/context/AuthContext\";\n\nexport default function Register() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const search = useSearch();\n  const { toast } = useToast();\n  const { registerWithEmail, loginWithGoogle } = useAuth();\n  const [isLoading, setIsLoading] = useState(false);\n  const [errors, setErrors] = useState<{[key: string]: string}>({});\n  \n  const referralCodeFromUrl = new URLSearchParams(search).get(\"ref\") || \"\";\n  \n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    phone: \"+965 \",\n    password: \"\",\n    confirmPassword: \"\",\n    referralCode: referralCodeFromUrl,\n  });\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const validateEmail = (email: string) => {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  };\n\n  const validatePassword = (password: string) => {\n    const hasMinLength = password.length >= 8;\n    const hasNumberOrSymbol = /[0-9!@#$%^&*(),.?\":{}|<>]/.test(password);\n    return hasMinLength && hasNumberOrSymbol;\n  };\n\n  const validatePhone = (phone: string) => {\n    const phoneClean = phone.replace(/\\s/g, \"\");\n    const kuwaitPhoneRegex = /^\\+965[569]\\d{7}$/;\n    return !phone || phone === \"+965 \" || kuwaitPhoneRegex.test(phoneClean);\n  };\n\n  const validateForm = () => {\n    const newErrors: {[key: string]: string} = {};\n\n    if (!formData.name.trim()) {\n      newErrors.name = getLocalizedText(\"الاسم مطلوب\", \"Name is required\", \"Le nom est requis\");\n    }\n\n    if (!formData.email.trim()) {\n      newErrors.email = getLocalizedText(\"البريد الإلكتروني مطلوب\", \"Email is required\", \"L'email est requis\");\n    } else if (!validateEmail(formData.email)) {\n      newErrors.email = getLocalizedText(\"البريد الإلكتروني غير صحيح\", \"Invalid email format\", \"Format d'email invalide\");\n    }\n\n    if (!formData.password) {\n      newErrors.password = getLocalizedText(\"كلمة المرور مطلوبة\", \"Password is required\", \"Le mot de passe est requis\");\n    } else if (!validatePassword(formData.password)) {\n      newErrors.password = getLocalizedText(\n        \"كلمة المرور يجب أن تكون 8 أحرف على الأقل وتحتوي على رقم أو رمز\",\n        \"Password must be at least 8 characters with a number or symbol\",\n        \"Le mot de passe doit contenir au moins 8 caractères avec un chiffre ou symbole\"\n      );\n    }\n\n    if (formData.password !== formData.confirmPassword) {\n      newErrors.confirmPassword = getLocalizedText(\n        \"كلمتا المرور غير متطابقتين\",\n        \"Passwords do not match\",\n        \"Les mots de passe ne correspondent pas\"\n      );\n    }\n\n    if (formData.phone && formData.phone !== \"+965 \" && !validatePhone(formData.phone)) {\n      newErrors.phone = getLocalizedText(\n        \"رقم الهاتف غير صحيح (مثال: +965 9XXX XXXX)\",\n        \"Invalid phone number (example: +965 9XXX XXXX)\",\n        \"Numéro de téléphone invalide (exemple: +965 9XXX XXXX)\"\n      );\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const getFirebaseErrorMessage = (errorCode: string) => {\n    switch (errorCode) {\n      case \"auth/email-already-in-use\":\n        return getLocalizedText(\n          \"هذا البريد الإلكتروني مستخدم بالفعل\",\n          \"This email is already in use\",\n          \"Cet email est déjà utilisé\"\n        );\n      case \"auth/invalid-email\":\n        return getLocalizedText(\n          \"البريد الإلكتروني غير صحيح\",\n          \"Invalid email address\",\n          \"Adresse email invalide\"\n        );\n      case \"auth/weak-password\":\n        return getLocalizedText(\n          \"كلمة المرور ضعيفة جداً\",\n          \"Password is too weak\",\n          \"Le mot de passe est trop faible\"\n        );\n      case \"auth/operation-not-allowed\":\n        return getLocalizedText(\n          \"تسجيل الحساب غير متاح حالياً\",\n          \"Account registration is not available\",\n          \"L'inscription n'est pas disponible\"\n        );\n      case \"auth/network-request-failed\":\n        return getLocalizedText(\n          \"خطأ في الاتصال بالشبكة\",\n          \"Network connection error\",\n          \"Erreur de connexion réseau\"\n        );\n      default:\n        return getLocalizedText(\n          \"حدث خطأ أثناء إنشاء الحساب\",\n          \"An error occurred during registration\",\n          \"Une erreur s'est produite lors de l'inscription\"\n        );\n    }\n  };\n\n  const handleRegister = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!validateForm()) {\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const phone = formData.phone === \"+965 \" ? undefined : formData.phone.replace(/\\s/g, \"\");\n      await registerWithEmail(\n        formData.email,\n        formData.password,\n        formData.name,\n        phone,\n        formData.referralCode || undefined\n      );\n      toast({\n        title: getLocalizedText(\"تم إنشاء الحساب بنجاح\", \"Account Created Successfully\", \"Compte Créé avec Succès\"),\n        description: getLocalizedText(\n          \"مرحباً بك في غسلة ستايل!\",\n          \"Welcome to Ghasla Style!\",\n          \"Bienvenue chez Ghasla Style!\"\n        ),\n      });\n      setLocation(\"/account\");\n    } catch (error: any) {\n      const errorCode = error.code || \"\";\n      toast({\n        title: getLocalizedText(\"خطأ\", \"Error\", \"Erreur\"),\n        description: getFirebaseErrorMessage(errorCode),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleGoogleLogin = async () => {\n    setIsLoading(true);\n    try {\n      await loginWithGoogle();\n      toast({\n        title: getLocalizedText(\"تم تسجيل الدخول بنجاح\", \"Login Successful\", \"Connexion Réussie\"),\n        description: getLocalizedText(\n          \"مرحباً بك في غسلة ستايل!\",\n          \"Welcome to Ghasla Style!\",\n          \"Bienvenue chez Ghasla Style!\"\n        ),\n      });\n      setLocation(\"/account\");\n    } catch (error: any) {\n      const errorCode = error.code || \"\";\n      let message = getLocalizedText(\n        \"فشل تسجيل الدخول بواسطة Google\",\n        \"Google login failed\",\n        \"Échec de la connexion Google\"\n      );\n      if (errorCode === \"auth/popup-closed-by-user\") {\n        message = getLocalizedText(\n          \"تم إلغاء تسجيل الدخول\",\n          \"Login was cancelled\",\n          \"Connexion annulée\"\n        );\n      }\n      toast({\n        title: getLocalizedText(\"خطأ\", \"Error\", \"Erreur\"),\n        description: message,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData({ ...formData, [field]: value });\n    if (errors[field]) {\n      setErrors({ ...errors, [field]: \"\" });\n    }\n  };\n\n  return (\n    <div className=\"py-12\">\n      <div className=\"container mx-auto px-4 max-w-md\">\n        <Card>\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"text-2xl\">\n              {getLocalizedText(\"إنشاء حساب جديد\", \"Create New Account\", \"Créer un Nouveau Compte\")}\n            </CardTitle>\n            <CardDescription>\n              {getLocalizedText(\n                \"أنشئ حسابك للاستمتاع بجميع المزايا\",\n                \"Create your account to enjoy all benefits\",\n                \"Créez votre compte pour profiter de tous les avantages\"\n              )}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Button\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={handleGoogleLogin}\n              disabled={isLoading}\n              data-testid=\"register-with-google\"\n            >\n              <SiGoogle className=\"h-4 w-4 me-2\" />\n              {getLocalizedText(\"التسجيل بواسطة Google\", \"Sign up with Google\", \"S'inscrire avec Google\")}\n            </Button>\n\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  {getLocalizedText(\"أو بالبريد الإلكتروني\", \"or with email\", \"ou par email\")}\n                </span>\n              </div>\n            </div>\n\n            <form onSubmit={handleRegister} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"name\">\n                  {getLocalizedText(\"الاسم الكامل\", \"Full Name\", \"Nom Complet\")} *\n                </Label>\n                <div className=\"relative\">\n                  <User className=\"absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"name\"\n                    value={formData.name}\n                    onChange={(e) => handleInputChange(\"name\", e.target.value)}\n                    className={`ps-10 ${errors.name ? \"border-destructive\" : \"\"}`}\n                    placeholder={getLocalizedText(\"أدخل اسمك الكامل\", \"Enter your full name\", \"Entrez votre nom complet\")}\n                    data-testid=\"input-register-name\"\n                  />\n                </div>\n                {errors.name && (\n                  <p className=\"text-sm text-destructive flex items-center gap-1\">\n                    <AlertCircle className=\"h-3 w-3\" /> {errors.name}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">\n                  {getLocalizedText(\"البريد الإلكتروني\", \"Email Address\", \"Adresse Email\")} *\n                </Label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => handleInputChange(\"email\", e.target.value)}\n                    className={`ps-10 ${errors.email ? \"border-destructive\" : \"\"}`}\n                    placeholder=\"email@example.com\"\n                    dir=\"ltr\"\n                    data-testid=\"input-register-email\"\n                  />\n                </div>\n                {errors.email && (\n                  <p className=\"text-sm text-destructive flex items-center gap-1\">\n                    <AlertCircle className=\"h-3 w-3\" /> {errors.email}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\">\n                  {getLocalizedText(\"رقم الهاتف\", \"Phone Number\", \"Numéro de Téléphone\")}\n                  <span className=\"text-muted-foreground text-xs ms-1\">\n                    ({getLocalizedText(\"اختياري\", \"optional\", \"optionnel\")})\n                  </span>\n                </Label>\n                <div className=\"relative\">\n                  <Phone className=\"absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"phone\"\n                    type=\"tel\"\n                    value={formData.phone}\n                    onChange={(e) => handleInputChange(\"phone\", e.target.value)}\n                    className={`ps-10 ${errors.phone ? \"border-destructive\" : \"\"}`}\n                    placeholder=\"+965 9XXX XXXX\"\n                    dir=\"ltr\"\n                    data-testid=\"input-register-phone\"\n                  />\n                </div>\n                {errors.phone && (\n                  <p className=\"text-sm text-destructive flex items-center gap-1\">\n                    <AlertCircle className=\"h-3 w-3\" /> {errors.phone}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">\n                  {getLocalizedText(\"كلمة المرور\", \"Password\", \"Mot de Passe\")} *\n                </Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"password\"\n                    type=\"password\"\n                    value={formData.password}\n                    onChange={(e) => handleInputChange(\"password\", e.target.value)}\n                    className={`ps-10 ${errors.password ? \"border-destructive\" : \"\"}`}\n                    placeholder={getLocalizedText(\"8 أحرف على الأقل مع رقم أو رمز\", \"8+ chars with number or symbol\", \"8+ caractères avec chiffre ou symbole\")}\n                    data-testid=\"input-register-password\"\n                  />\n                </div>\n                {errors.password && (\n                  <p className=\"text-sm text-destructive flex items-center gap-1\">\n                    <AlertCircle className=\"h-3 w-3\" /> {errors.password}\n                  </p>\n                )}\n                {formData.password && validatePassword(formData.password) && (\n                  <p className=\"text-sm text-green-600 flex items-center gap-1\">\n                    <CheckCircle className=\"h-3 w-3\" /> {getLocalizedText(\"كلمة مرور قوية\", \"Strong password\", \"Mot de passe fort\")}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirmPassword\">\n                  {getLocalizedText(\"تأكيد كلمة المرور\", \"Confirm Password\", \"Confirmer le Mot de Passe\")} *\n                </Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"confirmPassword\"\n                    type=\"password\"\n                    value={formData.confirmPassword}\n                    onChange={(e) => handleInputChange(\"confirmPassword\", e.target.value)}\n                    className={`ps-10 ${errors.confirmPassword ? \"border-destructive\" : \"\"}`}\n                    placeholder={getLocalizedText(\"أعد إدخال كلمة المرور\", \"Re-enter password\", \"Ressaisir le mot de passe\")}\n                    data-testid=\"input-register-confirm-password\"\n                  />\n                </div>\n                {errors.confirmPassword && (\n                  <p className=\"text-sm text-destructive flex items-center gap-1\">\n                    <AlertCircle className=\"h-3 w-3\" /> {errors.confirmPassword}\n                  </p>\n                )}\n                {formData.confirmPassword && formData.password === formData.confirmPassword && formData.password && (\n                  <p className=\"text-sm text-green-600 flex items-center gap-1\">\n                    <CheckCircle className=\"h-3 w-3\" /> {getLocalizedText(\"كلمتا المرور متطابقتان\", \"Passwords match\", \"Mots de passe identiques\")}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"referralCode\">\n                  {getLocalizedText(\"كود الإحالة\", \"Referral Code\", \"Code de Parrainage\")}\n                  <span className=\"text-muted-foreground text-xs ms-1\">\n                    ({getLocalizedText(\"اختياري\", \"optional\", \"optionnel\")})\n                  </span>\n                </Label>\n                <div className=\"relative\">\n                  <Gift className=\"absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"referralCode\"\n                    value={formData.referralCode}\n                    onChange={(e) => handleInputChange(\"referralCode\", e.target.value.toUpperCase())}\n                    className=\"ps-10\"\n                    placeholder={getLocalizedText(\"أدخل الكود إن وجد\", \"Enter code if you have one\", \"Entrez le code si vous en avez un\")}\n                    data-testid=\"input-register-referral\"\n                  />\n                </div>\n              </div>\n\n              <Button type=\"submit\" className=\"w-full\" disabled={isLoading} data-testid=\"button-register\">\n                {isLoading ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 me-2 animate-spin\" />\n                    {getLocalizedText(\"جاري إنشاء الحساب...\", \"Creating account...\", \"Création du compte...\")}\n                  </>\n                ) : (\n                  getLocalizedText(\"إنشاء الحساب\", \"Create Account\", \"Créer le Compte\")\n                )}\n              </Button>\n            </form>\n          </CardContent>\n          <CardFooter className=\"text-center text-sm\">\n            <p className=\"text-muted-foreground w-full\">\n              {getLocalizedText(\"لديك حساب بالفعل؟\", \"Already have an account?\", \"Vous avez déjà un compte?\")}{\" \"}\n              <Link href=\"/login\" className=\"text-primary hover:underline\">\n                {getLocalizedText(\"تسجيل الدخول\", \"Login\", \"Connexion\")}\n              </Link>\n            </p>\n          </CardFooter>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":18403,"size_tokens":null},"client/src/lib/firebase-functions.ts":{"content":"/**\n * Firebase Cloud Functions Client\n * \n * Helper functions to call Firebase Cloud Functions for role management.\n * \n * USAGE:\n * \n * 1. Initialize Super Admin (one-time only):\n *    await initializeSuperAdmin(\"MY_INIT_SUPER_SECRET_123\");\n * \n * 2. Set user role (requires Super Admin):\n *    await setUserRoleFunction(\"user@example.com\", \"admin\");\n * \n * 3. Get user role:\n *    const role = await getUserRoleFunction(\"user@example.com\");\n */\n\nimport { getFunctions, httpsCallable, connectFunctionsEmulator } from \"firebase/functions\";\nimport { app } from \"./firebase\";\n\nconst functions = getFunctions(app);\n\nif (import.meta.env.DEV && import.meta.env.VITE_USE_FUNCTIONS_EMULATOR === \"true\") {\n  connectFunctionsEmulator(functions, \"localhost\", 5001);\n}\n\nexport interface InitSuperAdminResponse {\n  message: string;\n  email: string;\n  uid: string;\n}\n\nexport interface SetUserRoleResponse {\n  message: string;\n  targetUid: string;\n  role: string;\n}\n\nexport interface GetUserRoleResponse {\n  email: string;\n  uid: string;\n  role: string;\n  displayName?: string;\n}\n\n/**\n * Initialize the first Super Admin account\n * This function can only be called ONCE\n * \n * @param initSecret - The initialization secret (set via firebase functions:config:set admin.secret=\"...\")\n * @returns Success response with Super Admin details\n * @throws Error if already initialized or invalid secret\n */\nexport async function initializeSuperAdmin(initSecret: string): Promise<InitSuperAdminResponse> {\n  const initSuperAdmin = httpsCallable<{ initSecret: string }, InitSuperAdminResponse>(\n    functions,\n    \"initSuperAdmin\"\n  );\n  \n  const result = await initSuperAdmin({ initSecret });\n  return result.data;\n}\n\n/**\n * Set a user's role (Super Admin only)\n * \n * @param targetEmail - Email of the user to update\n * @param role - New role (\"admin\" | \"customer\")\n * @returns Success response\n * @throws Error if not Super Admin or invalid parameters\n */\nexport async function setUserRoleFunction(\n  targetEmail: string, \n  role: \"admin\" | \"customer\"\n): Promise<SetUserRoleResponse> {\n  const setUserRole = httpsCallable<{ targetEmail: string; role: string }, SetUserRoleResponse>(\n    functions,\n    \"setUserRole\"\n  );\n  \n  const result = await setUserRole({ targetEmail, role });\n  return result.data;\n}\n\n/**\n * Get a user's role\n * Super Admin/Admin can check any user\n * Regular users can only check themselves\n * \n * @param email - Email of the user (optional, defaults to current user)\n * @returns User role information\n */\nexport async function getUserRoleFunction(email?: string): Promise<GetUserRoleResponse> {\n  const getUserRole = httpsCallable<{ email?: string }, GetUserRoleResponse>(\n    functions,\n    \"getUserRole\"\n  );\n  \n  const result = await getUserRole({ email });\n  return result.data;\n}\n\n/**\n * Helper to check if current user is Super Admin\n * Use this before showing role management UI\n */\nexport async function checkIsSuperAdmin(): Promise<boolean> {\n  try {\n    const result = await getUserRoleFunction();\n    return result.role === \"super_admin\";\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Helper to check if current user is Admin or Super Admin\n * Use this for admin dashboard access\n */\nexport async function checkIsAdmin(): Promise<boolean> {\n  try {\n    const result = await getUserRoleFunction();\n    return result.role === \"admin\" || result.role === \"super_admin\";\n  } catch {\n    return false;\n  }\n}\n","path":null,"size_bytes":3416,"size_tokens":null},"client/src/context/AuthContext.tsx":{"content":"import { createContext, useContext, useEffect, useState, type ReactNode } from \"react\";\nimport { auth, onAuthChange, signInWithGoogle, signInWithEmail, signUpWithEmail, logOut, getAuthClaims, type FirebaseUser } from \"@/lib/firebase\";\nimport type { User } from \"@shared/schema\";\n\ninterface FirebaseClaims {\n  superAdmin: boolean;\n  admin: boolean;\n}\n\ninterface AuthContextType {\n  firebaseUser: FirebaseUser | null;\n  user: User | null;\n  loading: boolean;\n  loginWithGoogle: () => Promise<void>;\n  loginWithEmail: (email: string, password: string) => Promise<void>;\n  registerWithEmail: (email: string, password: string, name: string, phone?: string, referralCode?: string) => Promise<void>;\n  logout: () => Promise<void>;\n  isAdmin: boolean;\n  isSuperAdmin: boolean;\n  firebaseClaims: FirebaseClaims;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [firebaseUser, setFirebaseUser] = useState<FirebaseUser | null>(null);\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [firebaseClaims, setFirebaseClaims] = useState<FirebaseClaims>({ superAdmin: false, admin: false });\n\n  useEffect(() => {\n    const unsubscribe = onAuthChange(async (fbUser) => {\n      setFirebaseUser(fbUser);\n      if (fbUser) {\n        try {\n          const claims = await getAuthClaims(fbUser);\n          setFirebaseClaims(claims);\n          \n          const response = await fetch(`/api/users/${fbUser.uid}`);\n          if (response.ok) {\n            const userData = await response.json();\n            setUser(userData);\n          } else if (response.status === 404) {\n            setUser(null);\n          }\n        } catch (error) {\n          console.error(\"Error fetching user:\", error);\n          setUser(null);\n          setFirebaseClaims({ superAdmin: false, admin: false });\n        }\n      } else {\n        setUser(null);\n        setFirebaseClaims({ superAdmin: false, admin: false });\n      }\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const loginWithGoogle = async () => {\n    try {\n      const result = await signInWithGoogle();\n      const response = await fetch(\"/api/auth/google\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          uid: result.user.uid,\n          email: result.user.email,\n          name: result.user.displayName,\n          phone: result.user.phoneNumber,\n        }),\n      });\n      if (response.ok) {\n        const userData = await response.json();\n        setUser(userData);\n      }\n    } catch (error) {\n      console.error(\"Google login error:\", error);\n      throw error;\n    }\n  };\n\n  const loginWithEmail = async (email: string, password: string) => {\n    try {\n      const result = await signInWithEmail(email, password);\n      // Fetch user data from our backend\n      if (result.user) {\n        const response = await fetch(`/api/users/${result.user.uid}`);\n        if (response.ok) {\n          const userData = await response.json();\n          setUser(userData);\n        }\n      }\n    } catch (error: any) {\n      console.error(\"Email login error:\", error);\n      if (error.code === \"auth/invalid-credential\" || error.code === \"auth/wrong-password\" || error.code === \"auth/user-not-found\") {\n        throw new Error(\"البريد الإلكتروني أو كلمة المرور غير صحيحة\");\n      }\n      throw error;\n    }\n  };\n\n  const registerWithEmail = async (\n    email: string, \n    password: string, \n    name: string, \n    phone?: string, \n    referralCode?: string\n  ) => {\n    try {\n      const result = await signUpWithEmail(email, password);\n      const response = await fetch(\"/api/auth/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          uid: result.user.uid,\n          email,\n          name,\n          phone,\n          referralCode,\n        }),\n      });\n      if (response.ok) {\n        const userData = await response.json();\n        setUser(userData);\n      }\n    } catch (error: any) {\n      console.error(\"Registration error:\", error);\n      if (error.code === \"auth/email-already-in-use\") {\n        throw new Error(\"البريد الإلكتروني مسجل مسبقاً. يرجى استخدام تسجيل الدخول بدلاً من إنشاء حساب جديد.\");\n      }\n      if (error.code === \"auth/weak-password\") {\n        throw new Error(\"كلمة المرور ضعيفة. يجب أن تكون 6 أحرف على الأقل.\");\n      }\n      if (error.code === \"auth/invalid-email\") {\n        throw new Error(\"البريد الإلكتروني غير صالح.\");\n      }\n      throw error;\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await logOut();\n      setUser(null);\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      throw error;\n    }\n  };\n\n  const isAdmin = user?.role === \"admin\" || user?.role === \"super_admin\" || firebaseClaims.admin;\n  const isSuperAdmin = user?.role === \"super_admin\" || firebaseClaims.superAdmin;\n\n  return (\n    <AuthContext.Provider\n      value={{\n        firebaseUser,\n        user,\n        loading,\n        loginWithGoogle,\n        loginWithEmail,\n        registerWithEmail,\n        logout,\n        isAdmin,\n        isSuperAdmin,\n        firebaseClaims,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":5711,"size_tokens":null},"client/src/lib/firestore-orders.ts":{"content":"import { \n  collection, \n  doc, \n  addDoc, \n  updateDoc, \n  serverTimestamp,\n  increment,\n  runTransaction,\n  getDoc\n} from \"firebase/firestore\";\nimport { db } from \"./firebase\";\nimport type { \n  CreateFirestoreOrder, \n  FirestoreOrder\n} from \"@/types/firestore-order\";\nimport { generateOrderCode } from \"@/types/firestore-order\";\n\n/**\n * Firestore Order Service for Ghasla Style\n * \n * Handles order creation, updates, and loyalty points calculation.\n */\n\n/**\n * Create a new order in Firestore\n */\nexport async function createFirestoreOrder(orderData: CreateFirestoreOrder): Promise<string> {\n  const ordersRef = collection(db, \"orders\");\n  \n  const newOrder: Omit<FirestoreOrder, \"id\"> = {\n    ...orderData,\n    orderCode: generateOrderCode(),\n    status: \"pending\",\n    createdAt: serverTimestamp() as any,\n    updatedAt: serverTimestamp() as any,\n    isPaid: false,\n    loyaltyPointsEarned: 0,\n    isPointsApplied: false,\n    driverId: null,\n    cancelReason: null\n  };\n  \n  const docRef = await addDoc(ordersRef, newOrder);\n  return docRef.id;\n}\n\n/**\n * Update order status\n * If status changes to \"completed\", automatically calculate and apply loyalty points\n */\nexport async function updateOrderStatus(\n  orderId: string, \n  newStatus: FirestoreOrder[\"status\"],\n  driverId?: string,\n  cancelReason?: string\n): Promise<void> {\n  const orderRef = doc(db, \"orders\", orderId);\n  \n  const updateData: Partial<FirestoreOrder> = {\n    status: newStatus,\n    updatedAt: serverTimestamp() as any\n  };\n  \n  if (driverId !== undefined) {\n    updateData.driverId = driverId;\n  }\n  \n  if (newStatus === \"cancelled\" && cancelReason) {\n    updateData.cancelReason = cancelReason;\n  }\n  \n  await updateDoc(orderRef, updateData);\n  \n  // If completed, trigger loyalty points calculation\n  if (newStatus === \"completed\") {\n    await applyLoyaltyPoints(orderId);\n  }\n}\n\n/**\n * Apply loyalty points to customer when order is completed\n * \n * This function uses a transaction to ensure:\n * 1. Points are only added once (checks isPointsApplied flag)\n * 2. Customer's total points are updated atomically\n * 3. Order document is updated with earned points\n * \n * Default calculation: 35 points per 1 KWD\n */\nexport async function applyLoyaltyPoints(\n  orderId: string,\n  pointsPerKD: number = 35\n): Promise<number> {\n  const orderRef = doc(db, \"orders\", orderId);\n  \n  return runTransaction(db, async (transaction) => {\n    const orderDoc = await transaction.get(orderRef);\n    \n    if (!orderDoc.exists()) {\n      throw new Error(\"Order not found\");\n    }\n    \n    const orderData = orderDoc.data();\n    \n    // Prevent double points application\n    if (orderData.isPointsApplied) {\n      console.log(\"Points already applied for order:\", orderId);\n      return orderData.loyaltyPointsEarned || 0;\n    }\n    \n    // Calculate points from total price\n    const totalPrice = orderData.totalPrice || 0;\n    const pointsEarned = Math.floor(totalPrice * pointsPerKD);\n    \n    // Update order with earned points\n    transaction.update(orderRef, {\n      loyaltyPointsEarned: pointsEarned,\n      isPointsApplied: true,\n      updatedAt: serverTimestamp()\n    });\n    \n    // Update customer's loyalty balance\n    if (orderData.customerId) {\n      const userRef = doc(db, \"users\", orderData.customerId);\n      const userDoc = await transaction.get(userRef);\n      \n      if (userDoc.exists()) {\n        transaction.update(userRef, {\n          loyaltyPoints: increment(pointsEarned),\n          totalLoyaltyPointsEarned: increment(pointsEarned),\n          lastOrderDate: serverTimestamp()\n        });\n      }\n    }\n    \n    console.log(`Applied ${pointsEarned} points for order ${orderId}`);\n    return pointsEarned;\n  });\n}\n\n/**\n * Cancel an order\n */\nexport async function cancelOrder(orderId: string, reason: string): Promise<void> {\n  await updateOrderStatus(orderId, \"cancelled\", undefined, reason);\n}\n\n/**\n * Assign driver to order\n */\nexport async function assignDriver(\n  orderId: string, \n  driverId: string, \n  driverName?: string\n): Promise<void> {\n  const orderRef = doc(db, \"orders\", orderId);\n  \n  await updateDoc(orderRef, {\n    status: \"assigned\",\n    driverId,\n    driverName: driverName || null,\n    updatedAt: serverTimestamp()\n  });\n}\n\n/**\n * Start order execution\n */\nexport async function startOrder(orderId: string): Promise<void> {\n  await updateOrderStatus(orderId, \"in_progress\");\n}\n\n/**\n * Complete order\n * Note: updateOrderStatus already handles loyalty points calculation\n * when status changes to \"completed\", so we don't call applyLoyaltyPoints again\n */\nexport async function completeOrder(orderId: string): Promise<void> {\n  await updateOrderStatus(orderId, \"completed\");\n}\n\n/**\n * Get order details by ID\n */\nexport async function getOrderById(orderId: string): Promise<FirestoreOrder | null> {\n  const orderRef = doc(db, \"orders\", orderId);\n  const orderDoc = await getDoc(orderRef);\n  \n  if (!orderDoc.exists()) {\n    return null;\n  }\n  \n  return {\n    ...orderDoc.data(),\n    id: orderDoc.id\n  } as unknown as FirestoreOrder;\n}\n\n/**\n * Generate unique order code\n * Format: GS-XXXX (X = alphanumeric, no ambiguous characters)\n */\nexport function generateOrderCodeUtil(): string {\n  const chars = \"0123456789ABCDEFGHJKLMNPQRSTUVWXYZ\";\n  let code = \"GS-\";\n  for (let i = 0; i < 4; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return code;\n}\n","path":null,"size_bytes":5387,"size_tokens":null},"shared/schema.ts":{"content":"import { pgTable, text, integer, boolean, real, timestamp, pgEnum } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums\nexport const userRoleEnum = pgEnum(\"user_role\", [\"customer\", \"delegate\", \"admin\", \"super_admin\"]);\nexport const userStatusEnum = pgEnum(\"user_status\", [\"active\", \"blocked\"]);\nexport const orderStatusEnum = pgEnum(\"order_status\", [\"pending\", \"assigned\", \"on_the_way\", \"in_progress\", \"completed\", \"cancelled\"]);\nexport const carTypeEnum = pgEnum(\"car_type\", [\"sedan\", \"suv\", \"other\"]);\nexport const paymentMethodEnum = pgEnum(\"payment_method\", [\"cash\", \"online\"]);\nexport const serviceCategoryEnum = pgEnum(\"service_category\", [\"exterior\", \"interior\", \"full\", \"vip\", \"monthly\"]);\nexport const loyaltyTransactionTypeEnum = pgEnum(\"loyalty_transaction_type\", [\"earn\", \"redeem\", \"referral_bonus\", \"welcome_bonus\", \"admin_adjustment\"]);\nexport const referralStatusEnum = pgEnum(\"referral_status\", [\"pending\", \"completed\", \"invalid\"]);\nexport const offerTargetAudienceEnum = pgEnum(\"offer_target_audience\", [\"all\", \"new_customers\", \"existing_customers\"]);\nexport const offerLoyaltyScopeEnum = pgEnum(\"offer_loyalty_scope\", [\"inside_loyalty\", \"outside_loyalty\"]);\nexport const paymentStatusEnum = pgEnum(\"payment_status\", [\"pending\", \"initiated\", \"captured\", \"failed\", \"refunded\", \"cancelled\"]);\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: text(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  name: text(\"name\").notNull(),\n  phone: text(\"phone\"),\n  role: userRoleEnum(\"role\").notNull().default(\"customer\"),\n  status: userStatusEnum(\"status\").notNull().default(\"active\"),\n  loyaltyPoints: integer(\"loyalty_points\").notNull().default(0),\n  referralCode: text(\"referral_code\").notNull().unique(),\n  referredBy: text(\"referred_by\"),\n  carMake: text(\"car_make\"),\n  carModel: text(\"car_model\"),\n  carColor: text(\"car_color\"),\n  carPlateNumber: text(\"car_plate_number\"),\n  twoFactorEnabled: boolean(\"two_factor_enabled\").notNull().default(false),\n  twoFactorSecret: text(\"two_factor_secret\"),\n  // Delegate-specific fields\n  autoAcceptOrders: boolean(\"auto_accept_orders\").notNull().default(false),\n  coverageAreas: text(\"coverage_areas\").array(),\n  maxActiveOrders: integer(\"max_active_orders\").notNull().default(3),\n  isAvailable: boolean(\"is_available\").notNull().default(true),\n  currentLatitude: real(\"current_latitude\"),\n  currentLongitude: real(\"current_longitude\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, loyaltyPoints: true, referralCode: true });\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// Service Packages table\nexport const servicePackages = pgTable(\"service_packages\", {\n  id: text(\"id\").primaryKey(),\n  nameAr: text(\"name_ar\").notNull(),\n  nameEn: text(\"name_en\").notNull(),\n  nameFr: text(\"name_fr\").notNull(),\n  descriptionAr: text(\"description_ar\").notNull(),\n  descriptionEn: text(\"description_en\").notNull(),\n  descriptionFr: text(\"description_fr\").notNull(),\n  priceSedanKD: real(\"price_sedan_kd\").notNull(),\n  priceSuvKD: real(\"price_suv_kd\").notNull(),\n  estimatedMinutes: integer(\"estimated_minutes\").notNull(),\n  category: serviceCategoryEnum(\"category\").notNull(),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertServicePackageSchema = createInsertSchema(servicePackages).omit({ id: true, createdAt: true });\nexport type InsertServicePackage = z.infer<typeof insertServicePackageSchema>;\nexport type ServicePackage = typeof servicePackages.$inferSelect;\n\n// Orders table\nexport const orders = pgTable(\"orders\", {\n  id: text(\"id\").primaryKey(),\n  customerId: text(\"customer_id\").notNull().references(() => users.id),\n  status: orderStatusEnum(\"status\").notNull().default(\"pending\"),\n  carType: carTypeEnum(\"car_type\").notNull(),\n  carDetails: text(\"car_details\"),\n  servicePackageId: text(\"service_package_id\").notNull().references(() => servicePackages.id),\n  priceKD: real(\"price_kd\").notNull(),\n  finalPriceKD: real(\"final_price_kd\"),\n  paymentMethod: paymentMethodEnum(\"payment_method\").notNull(),\n  isPaid: boolean(\"is_paid\").notNull().default(false),\n  address: text(\"address\").notNull(),\n  area: text(\"area\").notNull(),\n  latitude: real(\"latitude\"),\n  longitude: real(\"longitude\"),\n  preferredDate: text(\"preferred_date\").notNull(),\n  preferredTime: text(\"preferred_time\").notNull(),\n  loyaltyPointsEarned: integer(\"loyalty_points_earned\").notNull().default(0),\n  loyaltyPointsRedeemed: integer(\"loyalty_points_redeemed\").notNull().default(0),\n  discountApplied: real(\"discount_applied\").notNull().default(0),\n  referralId: text(\"referral_id\"),\n  cancelReason: text(\"cancel_reason\"),\n  assignedDriver: text(\"assigned_driver\"),\n  assignedAt: timestamp(\"assigned_at\"),\n  startedAt: timestamp(\"started_at\"),\n  onTheWayAt: timestamp(\"on_the_way_at\"),\n  completedAt: timestamp(\"completed_at\"),\n  delegateNotes: text(\"delegate_notes\"),\n  customerNotes: text(\"customer_notes\"),\n  beforePhotoUrl: text(\"before_photo_url\"),\n  afterPhotoUrl: text(\"after_photo_url\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertOrderSchema = createInsertSchema(orders).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true, \n  loyaltyPointsEarned: true, \n  completedAt: true,\n  assignedAt: true,\n  startedAt: true,\n  onTheWayAt: true,\n});\nexport type InsertOrder = z.infer<typeof insertOrderSchema>;\nexport type Order = typeof orders.$inferSelect;\n\n// Loyalty Config table\nexport const loyaltyConfig = pgTable(\"loyalty_config\", {\n  id: text(\"id\").primaryKey(),\n  pointsPerKD: integer(\"points_per_kd\").notNull().default(35),\n  conversionRate: real(\"conversion_rate\").notNull().default(0.004),\n  maxRedeemPercentage: real(\"max_redeem_percentage\").notNull().default(0.15),\n  welcomeBonusPoints: integer(\"welcome_bonus_points\").notNull().default(200),\n  referrerBonusPoints: integer(\"referrer_bonus_points\").notNull().default(400),\n  referredWelcomePoints: integer(\"referred_welcome_points\").notNull().default(200),\n  firstOrderDiscount: real(\"first_order_discount\").notNull().default(0.15),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertLoyaltyConfigSchema = createInsertSchema(loyaltyConfig).omit({ id: true, updatedAt: true });\nexport type InsertLoyaltyConfig = z.infer<typeof insertLoyaltyConfigSchema>;\nexport type LoyaltyConfig = typeof loyaltyConfig.$inferSelect;\n\n// Loyalty Transactions table\nexport const loyaltyTransactions = pgTable(\"loyalty_transactions\", {\n  id: text(\"id\").primaryKey(),\n  customerId: text(\"customer_id\").notNull().references(() => users.id),\n  orderId: text(\"order_id\"),\n  pointsChange: integer(\"points_change\").notNull(),\n  type: loyaltyTransactionTypeEnum(\"type\").notNull(),\n  note: text(\"note\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  createdBy: text(\"created_by\").notNull(),\n});\n\nexport const insertLoyaltyTransactionSchema = createInsertSchema(loyaltyTransactions).omit({ id: true, createdAt: true });\nexport type InsertLoyaltyTransaction = z.infer<typeof insertLoyaltyTransactionSchema>;\nexport type LoyaltyTransaction = typeof loyaltyTransactions.$inferSelect;\n\n// Referrals table\nexport const referrals = pgTable(\"referrals\", {\n  id: text(\"id\").primaryKey(),\n  referrerId: text(\"referrer_id\").notNull().references(() => users.id),\n  referredCustomerId: text(\"referred_customer_id\").notNull().references(() => users.id),\n  firstOrderId: text(\"first_order_id\"),\n  status: referralStatusEnum(\"status\").notNull().default(\"pending\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const insertReferralSchema = createInsertSchema(referrals).omit({ id: true, createdAt: true, completedAt: true });\nexport type InsertReferral = z.infer<typeof insertReferralSchema>;\nexport type Referral = typeof referrals.$inferSelect;\n\n// Blog Posts table\nexport const blogPosts = pgTable(\"blog_posts\", {\n  id: text(\"id\").primaryKey(),\n  titleAr: text(\"title_ar\").notNull(),\n  titleEn: text(\"title_en\").notNull(),\n  titleFr: text(\"title_fr\").notNull(),\n  contentAr: text(\"content_ar\").notNull(),\n  contentEn: text(\"content_en\").notNull(),\n  contentFr: text(\"content_fr\").notNull(),\n  imageUrl: text(\"image_url\"),\n  isPublished: boolean(\"is_published\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertBlogPostSchema = createInsertSchema(blogPosts).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertBlogPost = z.infer<typeof insertBlogPostSchema>;\nexport type BlogPost = typeof blogPosts.$inferSelect;\n\n// Testimonials table\nexport const testimonials = pgTable(\"testimonials\", {\n  id: text(\"id\").primaryKey(),\n  customerName: text(\"customer_name\").notNull(),\n  contentAr: text(\"content_ar\").notNull(),\n  contentEn: text(\"content_en\").notNull(),\n  contentFr: text(\"content_fr\").notNull(),\n  rating: integer(\"rating\").notNull(),\n  imageUrl: text(\"image_url\"),\n  isApproved: boolean(\"is_approved\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertTestimonialSchema = createInsertSchema(testimonials).omit({ id: true, createdAt: true });\nexport type InsertTestimonial = z.infer<typeof insertTestimonialSchema>;\nexport type Testimonial = typeof testimonials.$inferSelect;\n\n// Gallery Items table\nexport const galleryItems = pgTable(\"gallery_items\", {\n  id: text(\"id\").primaryKey(),\n  beforeImageUrl: text(\"before_image_url\").notNull(),\n  afterImageUrl: text(\"after_image_url\").notNull(),\n  captionAr: text(\"caption_ar\").notNull(),\n  captionEn: text(\"caption_en\").notNull(),\n  captionFr: text(\"caption_fr\").notNull(),\n  isPublished: boolean(\"is_published\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertGalleryItemSchema = createInsertSchema(galleryItems).omit({ id: true, createdAt: true });\nexport type InsertGalleryItem = z.infer<typeof insertGalleryItemSchema>;\nexport type GalleryItem = typeof galleryItems.$inferSelect;\n\n// Offers/Promotions table\nexport const offers = pgTable(\"offers\", {\n  id: text(\"id\").primaryKey(),\n  titleAr: text(\"title_ar\").notNull(),\n  titleEn: text(\"title_en\").notNull(),\n  titleFr: text(\"title_fr\").notNull(),\n  descriptionAr: text(\"description_ar\").notNull(),\n  descriptionEn: text(\"description_en\").notNull(),\n  descriptionFr: text(\"description_fr\").notNull(),\n  discountPercentage: real(\"discount_percentage\"),\n  discountAmountKD: real(\"discount_amount_kd\"),\n  imageUrl: text(\"image_url\"),\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\").notNull(),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  targetAudience: offerTargetAudienceEnum(\"target_audience\").notNull().default(\"all\"),\n  loyaltyScope: offerLoyaltyScopeEnum(\"loyalty_scope\").notNull().default(\"outside_loyalty\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertOfferSchema = createInsertSchema(offers).omit({ id: true, createdAt: true });\nexport type InsertOffer = z.infer<typeof insertOfferSchema>;\nexport type Offer = typeof offers.$inferSelect;\n\n// Contact Messages table\nexport const contactMessages = pgTable(\"contact_messages\", {\n  id: text(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  phone: text(\"phone\").notNull(),\n  email: text(\"email\"),\n  message: text(\"message\").notNull(),\n  isRead: boolean(\"is_read\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertContactMessageSchema = createInsertSchema(contactMessages).omit({ id: true, createdAt: true, isRead: true });\nexport type InsertContactMessage = z.infer<typeof insertContactMessageSchema>;\nexport type ContactMessage = typeof contactMessages.$inferSelect;\n\n// Audit Logs table\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: text(\"id\").primaryKey(),\n  actionType: text(\"action_type\").notNull(),\n  performedBy: text(\"performed_by\").notNull(),\n  performedAt: timestamp(\"performed_at\").notNull().defaultNow(),\n  targetCollection: text(\"target_collection\").notNull(),\n  targetId: text(\"target_id\").notNull(),\n  oldValue: text(\"old_value\"),\n  newValue: text(\"new_value\"),\n  note: text(\"note\"),\n});\n\nexport const insertAuditLogSchema = createInsertSchema(auditLogs).omit({ id: true, performedAt: true });\nexport type InsertAuditLog = z.infer<typeof insertAuditLogSchema>;\nexport type AuditLog = typeof auditLogs.$inferSelect;\n\n// Order Ratings table\nexport const orderRatings = pgTable(\"order_ratings\", {\n  id: text(\"id\").primaryKey(),\n  orderId: text(\"order_id\").notNull().references(() => orders.id),\n  customerId: text(\"customer_id\").notNull().references(() => users.id),\n  delegateId: text(\"delegate_id\").notNull().references(() => users.id),\n  rating: integer(\"rating\").notNull(),\n  comment: text(\"comment\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertOrderRatingSchema = createInsertSchema(orderRatings).omit({ id: true, createdAt: true });\nexport type InsertOrderRating = z.infer<typeof insertOrderRatingSchema>;\nexport type OrderRating = typeof orderRatings.$inferSelect;\n\n// Payments table - for KNET/Tap Payments integration\nexport const payments = pgTable(\"payments\", {\n  id: text(\"id\").primaryKey(),\n  orderId: text(\"order_id\").notNull().references(() => orders.id),\n  customerId: text(\"customer_id\").notNull().references(() => users.id),\n  amountKD: real(\"amount_kd\").notNull(),\n  currency: text(\"currency\").notNull().default(\"KWD\"),\n  status: paymentStatusEnum(\"status\").notNull().default(\"pending\"),\n  paymentGateway: text(\"payment_gateway\").notNull().default(\"tap\"), // tap, knet, myfatoorah\n  gatewayTransactionId: text(\"gateway_transaction_id\"),\n  gatewayChargeId: text(\"gateway_charge_id\"),\n  gatewayTrackingId: text(\"gateway_tracking_id\"),\n  gatewayResponse: text(\"gateway_response\"), // JSON string of full response\n  paymentUrl: text(\"payment_url\"),\n  callbackUrl: text(\"callback_url\"),\n  customerEmail: text(\"customer_email\"),\n  customerPhone: text(\"customer_phone\"),\n  cardBrand: text(\"card_brand\"), // KNET, VISA, etc.\n  cardLastFour: text(\"card_last_four\"),\n  errorMessage: text(\"error_message\"),\n  paidAt: timestamp(\"paid_at\"),\n  refundedAt: timestamp(\"refunded_at\"),\n  refundAmount: real(\"refund_amount\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertPaymentSchema = createInsertSchema(payments).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true,\n  paidAt: true,\n  refundedAt: true,\n});\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\nexport type Payment = typeof payments.$inferSelect;\n\n// Kuwait Areas for service validation - with availability status\n// Areas currently available for service\nexport const availableAreasNow = [\n  { nameAr: \"السلام\", nameEn: \"Al-Salam\", nameFr: \"Al-Salam\" },\n  { nameAr: \"السالمية\", nameEn: \"Salmiya\", nameFr: \"Salmiya\" },\n  { nameAr: \"الدسمة\", nameEn: \"Dasma\", nameFr: \"Dasma\" },\n  { nameAr: \"الدعية\", nameEn: \"Daiya\", nameFr: \"Daiya\" },\n  { nameAr: \"الشامية\", nameEn: \"Shamiya\", nameFr: \"Shamiya\" },\n  { nameAr: \"الروضة\", nameEn: \"Rawda\", nameFr: \"Rawda\" },\n  { nameAr: \"العديلية\", nameEn: \"Adiliya\", nameFr: \"Adiliya\" },\n  { nameAr: \"كيفان\", nameEn: \"Kaifan\", nameFr: \"Kaifan\" },\n  { nameAr: \"الخالدية\", nameEn: \"Khaldiya\", nameFr: \"Khaldiya\" },\n  { nameAr: \"القادسية\", nameEn: \"Qadsiya\", nameFr: \"Qadsiya\" },\n  { nameAr: \"الفيحاء\", nameEn: \"Faiha\", nameFr: \"Faiha\" },\n  { nameAr: \"المنصورية\", nameEn: \"Mansouriya\", nameFr: \"Mansouriya\" },\n  { nameAr: \"النزهة\", nameEn: \"Nuzha\", nameFr: \"Nuzha\" },\n  { nameAr: \"اليرموك\", nameEn: \"Yarmouk\", nameFr: \"Yarmouk\" },\n  { nameAr: \"السرة\", nameEn: \"Surra\", nameFr: \"Surra\" },\n  { nameAr: \"قرطبة\", nameEn: \"Qortuba\", nameFr: \"Qortuba\" },\n  { nameAr: \"الشعب البحري\", nameEn: \"Shaab Al-Bahri\", nameFr: \"Shaab Al-Bahri\" },\n  { nameAr: \"ضاحية عبد الله السالم\", nameEn: \"Abdullah Al-Salem\", nameFr: \"Abdullah Al-Salem\" },\n  { nameAr: \"الشويخ السكنية\", nameEn: \"Shuwaikh Residential\", nameFr: \"Shuwaikh Résidentiel\" },\n] as const;\n\n// Areas coming soon\nexport const areasComingSoon = [\n  { nameAr: \"حولي\", nameEn: \"Hawalli\", nameFr: \"Hawalli\" },\n  { nameAr: \"الفروانية\", nameEn: \"Farwaniya\", nameFr: \"Farwaniya\" },\n  { nameAr: \"الأحمدي\", nameEn: \"Ahmadi\", nameFr: \"Ahmadi\" },\n  { nameAr: \"الجهراء\", nameEn: \"Jahra\", nameFr: \"Jahra\" },\n  { nameAr: \"مبارك الكبير\", nameEn: \"Mubarak Al-Kabeer\", nameFr: \"Mubarak Al-Kabeer\" },\n  { nameAr: \"العاصمة\", nameEn: \"Capital\", nameFr: \"Capitale\" },\n  { nameAr: \"صباح السالم\", nameEn: \"Sabah Al-Salem\", nameFr: \"Sabah Al-Salem\" },\n  { nameAr: \"المنقف\", nameEn: \"Mangaf\", nameFr: \"Mangaf\" },\n  { nameAr: \"الفحيحيل\", nameEn: \"Fahaheel\", nameFr: \"Fahaheel\" },\n  { nameAr: \"المهبولة\", nameEn: \"Mahboula\", nameFr: \"Mahboula\" },\n  { nameAr: \"الجابرية\", nameEn: \"Jabriya\", nameFr: \"Jabriya\" },\n  { nameAr: \"مشرف\", nameEn: \"Mishref\", nameFr: \"Mishref\" },\n  { nameAr: \"سلوى\", nameEn: \"Salwa\", nameFr: \"Salwa\" },\n  { nameAr: \"الرميثية\", nameEn: \"Rumaithiya\", nameFr: \"Rumaithiya\" },\n  { nameAr: \"بيان\", nameEn: \"Bayan\", nameFr: \"Bayan\" },\n  { nameAr: \"الفنطاس\", nameEn: \"Fintas\", nameFr: \"Fintas\" },\n  { nameAr: \"أبو حليفة\", nameEn: \"Abu Halifa\", nameFr: \"Abu Halifa\" },\n  { nameAr: \"العقيلة\", nameEn: \"Egaila\", nameFr: \"Egaila\" },\n  { nameAr: \"الصبحية\", nameEn: \"Subahiya\", nameFr: \"Subahiya\" },\n  { nameAr: \"جليب الشيوخ\", nameEn: \"Jleeb Al-Shuyoukh\", nameFr: \"Jleeb Al-Shuyoukh\" },\n  { nameAr: \"خيطان\", nameEn: \"Khaitan\", nameFr: \"Khaitan\" },\n  { nameAr: \"الأندلس\", nameEn: \"Andalus\", nameFr: \"Andalus\" },\n  { nameAr: \"الرقعي\", nameEn: \"Riggae\", nameFr: \"Riggae\" },\n] as const;\n\n// Combined areas for API/validation - use English names as identifiers\nexport const kuwaitAreas = [\n  ...availableAreasNow.map(a => a.nameEn),\n  ...areasComingSoon.map(a => a.nameEn)\n] as const;\n\nexport type KuwaitArea = typeof kuwaitAreas[number];\n\n// Service area with availability info\nexport interface ServiceArea {\n  nameAr: string;\n  nameEn: string;\n  nameFr: string;\n  isAvailable: boolean;\n}\n\n// Get all areas with availability status\nexport function getServiceAreas(): ServiceArea[] {\n  return [\n    ...availableAreasNow.map(a => ({ ...a, isAvailable: true })),\n    ...areasComingSoon.map(a => ({ ...a, isAvailable: false })),\n  ];\n}\n","path":null,"size_bytes":19049,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/Logo.tsx":{"content":"import { useTranslation } from \"react-i18next\";\n\ninterface LogoProps {\n  showText?: boolean;\n  size?: \"sm\" | \"md\" | \"lg\";\n  className?: string;\n}\n\nexport function Logo({ showText = true, size = \"md\", className = \"\" }: LogoProps) {\n  const { i18n } = useTranslation();\n  const isArabic = i18n.language === \"ar\";\n\n  const sizes = {\n    sm: { icon: 32, text: \"text-lg\" },\n    md: { icon: 40, text: \"text-xl\" },\n    lg: { icon: 56, text: \"text-2xl\" },\n  };\n\n  const { icon: iconSize, text: textSize } = sizes[size];\n\n  return (\n    <div className={`flex items-center gap-2 ${className}`} data-testid=\"logo\">\n      <svg\n        width={iconSize}\n        height={iconSize}\n        viewBox=\"0 0 48 48\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        className=\"shrink-0\"\n      >\n        <defs>\n          <linearGradient id=\"logoGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n            <stop offset=\"0%\" stopColor=\"hsl(25, 95%, 53%)\" />\n            <stop offset=\"100%\" stopColor=\"hsl(25, 95%, 45%)\" />\n          </linearGradient>\n          <linearGradient id=\"waterGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n            <stop offset=\"0%\" stopColor=\"hsl(215, 89%, 45%)\" />\n            <stop offset=\"100%\" stopColor=\"hsl(215, 89%, 35%)\" />\n          </linearGradient>\n          <linearGradient id=\"sparkleGradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n            <stop offset=\"0%\" stopColor=\"hsl(215, 89%, 65%)\" />\n            <stop offset=\"100%\" stopColor=\"hsl(215, 89%, 55%)\" />\n          </linearGradient>\n        </defs>\n        \n        <rect width=\"48\" height=\"48\" rx=\"10\" fill=\"url(#logoGradient)\" />\n        \n        <path\n          d=\"M24 10C24 10 16 18 16 25C16 29.4 19.6 33 24 33C28.4 33 32 29.4 32 25C32 18 24 10 24 10Z\"\n          fill=\"url(#waterGradient)\"\n        />\n        \n        <ellipse cx=\"21\" cy=\"23\" rx=\"2.5\" ry=\"4\" fill=\"url(#sparkleGradient)\" opacity=\"0.7\" />\n        \n        <path\n          d=\"M12 36C14 34 18 33 24 33C30 33 34 34 36 36\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          opacity=\"0.6\"\n        />\n        \n        <circle cx=\"35\" cy=\"15\" r=\"2\" fill=\"white\" opacity=\"0.8\" />\n        <circle cx=\"38\" cy=\"12\" r=\"1\" fill=\"white\" opacity=\"0.6\" />\n      </svg>\n      \n      {showText && (\n        <div className=\"flex flex-col leading-tight\">\n          <span className={`font-bold text-foreground ${textSize}`}>\n            {isArabic ? \"غسلة ستايل\" : \"Ghasla Style\"}\n          </span>\n          {size === \"lg\" && (\n            <span className=\"text-xs text-muted-foreground\">\n              {isArabic ? \"غسيل سيارات متنقل\" : \"Mobile Car Wash\"}\n            </span>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport function LogoIcon({ size = 40, className = \"\" }: { size?: number; className?: string }) {\n  return (\n    <svg\n      width={size}\n      height={size}\n      viewBox=\"0 0 48 48\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className={className}\n    >\n      <defs>\n        <linearGradient id=\"logoGradientIcon\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n          <stop offset=\"0%\" stopColor=\"hsl(25, 95%, 53%)\" />\n          <stop offset=\"100%\" stopColor=\"hsl(25, 95%, 45%)\" />\n        </linearGradient>\n        <linearGradient id=\"waterGradientIcon\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n          <stop offset=\"0%\" stopColor=\"hsl(215, 89%, 45%)\" />\n          <stop offset=\"100%\" stopColor=\"hsl(215, 89%, 35%)\" />\n        </linearGradient>\n        <linearGradient id=\"sparkleGradientIcon\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n          <stop offset=\"0%\" stopColor=\"hsl(215, 89%, 65%)\" />\n          <stop offset=\"100%\" stopColor=\"hsl(215, 89%, 55%)\" />\n        </linearGradient>\n      </defs>\n      \n      <rect width=\"48\" height=\"48\" rx=\"10\" fill=\"url(#logoGradientIcon)\" />\n      \n      <path\n        d=\"M24 10C24 10 16 18 16 25C16 29.4 19.6 33 24 33C28.4 33 32 29.4 32 25C32 18 24 10 24 10Z\"\n        fill=\"url(#waterGradientIcon)\"\n      />\n      \n      <ellipse cx=\"21\" cy=\"23\" rx=\"2.5\" ry=\"4\" fill=\"url(#sparkleGradientIcon)\" opacity=\"0.7\" />\n      \n      <path\n        d=\"M12 36C14 34 18 33 24 33C30 33 34 34 36 36\"\n        stroke=\"white\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        opacity=\"0.6\"\n      />\n      \n      <circle cx=\"35\" cy=\"15\" r=\"2\" fill=\"white\" opacity=\"0.8\" />\n      <circle cx=\"38\" cy=\"12\" r=\"1\" fill=\"white\" opacity=\"0.6\" />\n    </svg>\n  );\n}\n","path":null,"size_bytes":4444,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/pages/Account.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { User, ShoppingBag, Gift, Users, Settings, LogOut } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport type { Order, LoyaltyTransaction, Referral } from \"@shared/schema\";\n\nexport default function Account() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const { user, logout, loading } = useAuth();\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const { data: orders, isLoading: ordersLoading } = useQuery<Order[]>({\n    queryKey: [\"/api/orders/customer\", user?.id],\n    queryFn: async () => {\n      if (!user?.id) return [];\n      const res = await fetch(`/api/orders/customer/${user.id}`);\n      if (!res.ok) throw new Error(\"Failed to fetch orders\");\n      return res.json();\n    },\n    enabled: !!user,\n  });\n\n  const { data: loyaltyTransactions } = useQuery<LoyaltyTransaction[]>({\n    queryKey: [\"/api/users\", user?.id, \"loyalty\"],\n    queryFn: async () => {\n      if (!user?.id) return [];\n      const res = await fetch(`/api/users/${user.id}/loyalty`);\n      if (!res.ok) throw new Error(\"Failed to fetch loyalty transactions\");\n      return res.json();\n    },\n    enabled: !!user,\n  });\n\n  const { data: referrals } = useQuery<Referral[]>({\n    queryKey: [\"/api/users\", user?.id, \"referrals\"],\n    queryFn: async () => {\n      if (!user?.id) return [];\n      const res = await fetch(`/api/users/${user.id}/referrals`);\n      if (!res.ok) throw new Error(\"Failed to fetch referrals\");\n      return res.json();\n    },\n    enabled: !!user,\n  });\n\n  if (loading) {\n    return (\n      <div className=\"py-12\">\n        <div className=\"container mx-auto px-4 max-w-4xl\">\n          <Skeleton className=\"h-10 w-48 mb-8\" />\n          <div className=\"space-y-4\">\n            <Skeleton className=\"h-32 w-full\" />\n            <Skeleton className=\"h-32 w-full\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    setLocation(\"/login\");\n    return null;\n  }\n\n  const handleLogout = async () => {\n    await logout();\n    setLocation(\"/\");\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, \"default\" | \"secondary\" | \"destructive\" | \"outline\"> = {\n      pending: \"secondary\",\n      assigned: \"outline\",\n      in_progress: \"default\",\n      completed: \"default\",\n      cancelled: \"destructive\",\n    };\n    const colors: Record<string, string> = {\n      pending: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\",\n      assigned: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n      in_progress: \"bg-primary/10 text-primary\",\n      completed: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n      cancelled: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n    };\n    return (\n      <span className={`px-2 py-1 rounded-full text-xs font-medium ${colors[status] || colors.pending}`}>\n        {t(`account.orderStatus.${status}`)}\n      </span>\n    );\n  };\n\n  const getTransactionBadge = (type: string) => {\n    const colors: Record<string, string> = {\n      earn: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n      redeem: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n      referral_bonus: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n      welcome_bonus: \"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400\",\n      admin_adjustment: \"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400\",\n    };\n    const labels: Record<string, string> = {\n      earn: t(\"loyalty.earned\"),\n      redeem: t(\"loyalty.redeemed\"),\n      referral_bonus: t(\"loyalty.bonus\"),\n      welcome_bonus: t(\"loyalty.bonus\"),\n      admin_adjustment: getLocalizedText(\"تعديل\", \"Adjustment\", \"Ajustement\"),\n    };\n    return (\n      <span className={`px-2 py-1 rounded-full text-xs font-medium ${colors[type] || colors.earn}`}>\n        {labels[type]}\n      </span>\n    );\n  };\n\n  return (\n    <div className=\"py-12\">\n      <div className=\"container mx-auto px-4 max-w-4xl\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <h1 className=\"text-3xl font-bold\">{t(\"account.title\")}</h1>\n          <Button variant=\"outline\" onClick={handleLogout} data-testid=\"logout-button\">\n            <LogOut className=\"h-4 w-4 me-2\" />\n            {t(\"nav.logout\")}\n          </Button>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8\">\n          <Card>\n            <CardContent className=\"pt-6 text-center\">\n              <Gift className=\"h-8 w-8 mx-auto mb-2 text-primary\" />\n              <p className=\"text-2xl font-bold text-primary\">{user.loyaltyPoints || 0}</p>\n              <p className=\"text-sm text-muted-foreground\">{t(\"loyalty.points\")}</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-6 text-center\">\n              <ShoppingBag className=\"h-8 w-8 mx-auto mb-2 text-chart-1\" />\n              <p className=\"text-2xl font-bold\">{orders?.length || 0}</p>\n              <p className=\"text-sm text-muted-foreground\">{t(\"account.orders\")}</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-6 text-center\">\n              <Users className=\"h-8 w-8 mx-auto mb-2 text-chart-3\" />\n              <p className=\"text-2xl font-bold\">{referrals?.filter(r => r.status === \"completed\").length || 0}</p>\n              <p className=\"text-sm text-muted-foreground\">{t(\"friendsClub.successfulReferrals\")}</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-6 text-center\">\n              <User className=\"h-8 w-8 mx-auto mb-2 text-chart-4\" />\n              <p className=\"text-sm font-medium truncate\">{user.name}</p>\n              <p className=\"text-xs text-muted-foreground truncate\">{user.email}</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs defaultValue=\"orders\" className=\"space-y-6\">\n          <TabsList className=\"grid grid-cols-4 w-full\">\n            <TabsTrigger value=\"orders\" data-testid=\"tab-orders\">\n              <ShoppingBag className=\"h-4 w-4 me-2 hidden sm:inline\" />\n              {t(\"account.orders\")}\n            </TabsTrigger>\n            <TabsTrigger value=\"loyalty\" data-testid=\"tab-loyalty\">\n              <Gift className=\"h-4 w-4 me-2 hidden sm:inline\" />\n              {t(\"account.loyalty\")}\n            </TabsTrigger>\n            <TabsTrigger value=\"referrals\" data-testid=\"tab-referrals\">\n              <Users className=\"h-4 w-4 me-2 hidden sm:inline\" />\n              {t(\"account.referrals\")}\n            </TabsTrigger>\n            <TabsTrigger value=\"profile\" data-testid=\"tab-profile\">\n              <Settings className=\"h-4 w-4 me-2 hidden sm:inline\" />\n              {t(\"account.profile\")}\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Orders Tab */}\n          <TabsContent value=\"orders\">\n            <Card>\n              <CardHeader>\n                <CardTitle>{t(\"account.orders\")}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {ordersLoading ? (\n                  <div className=\"space-y-4\">\n                    {[1, 2, 3].map((i) => <Skeleton key={i} className=\"h-20 w-full\" />)}\n                  </div>\n                ) : orders?.length ? (\n                  <div className=\"space-y-4\">\n                    {orders.map((order) => (\n                      <div key={order.id} className=\"p-4 rounded-lg border flex flex-col md:flex-row md:items-center justify-between gap-4\" data-testid={`order-${order.id}`}>\n                        <div>\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            {getStatusBadge(order.status)}\n                            <span className=\"text-sm text-muted-foreground\">#{order.id.slice(0, 8)}</span>\n                          </div>\n                          <p className=\"font-medium\">{order.area}</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {new Date(order.createdAt).toLocaleDateString(i18n.language)}\n                          </p>\n                        </div>\n                        <div className=\"text-end\">\n                          <p className=\"text-lg font-bold text-primary\">{order.priceKD} {t(\"services.kd\")}</p>\n                          {order.loyaltyPointsEarned > 0 && (\n                            <p className=\"text-sm text-green-600\">+{order.loyaltyPointsEarned} {t(\"loyalty.points\")}</p>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <p className=\"text-center text-muted-foreground py-8\">{t(\"common.noData\")}</p>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Loyalty Tab */}\n          <TabsContent value=\"loyalty\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center justify-between flex-wrap gap-2\">\n                  <span>{t(\"loyalty.history\")}</span>\n                  <Badge variant=\"secondary\" className=\"text-lg px-4 py-1\">\n                    {user.loyaltyPoints || 0} {t(\"loyalty.points\")}\n                  </Badge>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loyaltyTransactions?.length ? (\n                  <div className=\"space-y-3\">\n                    {loyaltyTransactions.map((tx) => (\n                      <div key={tx.id} className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50\" data-testid={`transaction-${tx.id}`}>\n                        <div className=\"flex items-center gap-3\">\n                          {getTransactionBadge(tx.type)}\n                          <span className=\"text-sm text-muted-foreground\">\n                            {new Date(tx.createdAt).toLocaleDateString(i18n.language)}\n                          </span>\n                        </div>\n                        <span className={`font-bold ${tx.pointsChange > 0 ? \"text-green-600\" : \"text-red-600\"}`}>\n                          {tx.pointsChange > 0 ? \"+\" : \"\"}{tx.pointsChange}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <p className=\"text-center text-muted-foreground py-8\">{t(\"common.noData\")}</p>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Referrals Tab */}\n          <TabsContent value=\"referrals\">\n            <Card>\n              <CardHeader>\n                <CardTitle>{t(\"friendsClub.title\")}</CardTitle>\n                <CardDescription>{t(\"friendsClub.subtitle\")}</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"p-4 rounded-lg bg-primary/5 border border-primary/20\">\n                  <Label className=\"text-sm font-medium\">{t(\"friendsClub.yourCode\")}</Label>\n                  <p className=\"text-2xl font-mono font-bold text-primary mt-1\">{user.referralCode}</p>\n                </div>\n\n                <div>\n                  <h4 className=\"font-medium mb-3\">{t(\"friendsClub.stats\")}</h4>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"p-4 rounded-lg bg-muted text-center\">\n                      <p className=\"text-2xl font-bold\">{referrals?.length || 0}</p>\n                      <p className=\"text-sm text-muted-foreground\">{t(\"friendsClub.totalReferrals\")}</p>\n                    </div>\n                    <div className=\"p-4 rounded-lg bg-muted text-center\">\n                      <p className=\"text-2xl font-bold\">{referrals?.filter(r => r.status === \"completed\").length || 0}</p>\n                      <p className=\"text-sm text-muted-foreground\">{t(\"friendsClub.successfulReferrals\")}</p>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Profile Tab */}\n          <TabsContent value=\"profile\">\n            <Card>\n              <CardHeader>\n                <CardTitle>{t(\"account.editProfile\")}</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label>{t(\"account.name\")}</Label>\n                    <Input defaultValue={user.name} data-testid=\"input-profile-name\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>{t(\"account.email\")}</Label>\n                    <Input defaultValue={user.email} disabled dir=\"ltr\" />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>{t(\"account.phone\")}</Label>\n                    <Input defaultValue={user.phone || \"\"} dir=\"ltr\" data-testid=\"input-profile-phone\" />\n                  </div>\n                </div>\n                <Button data-testid=\"button-save-profile\">{t(\"account.save\")}</Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14048,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport path from \"path\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\nimport { initializeFirebaseAdmin } from \"./firebase-admin\";\nimport helmet from \"helmet\";\n\ninitializeFirebaseAdmin();\n\nconst app = express();\nconst httpServer = createServer(app);\n\nconst isProduction = process.env.NODE_ENV === \"production\";\n\n// Trust proxy for proper IP detection behind reverse proxies (Replit, Cloudflare)\n// MUST be set BEFORE any rate limiting middleware\napp.set(\"trust proxy\", 1);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\n// ===========================================\n// SECURITY MIDDLEWARE (Order matters!)\n// ===========================================\n\n// 1. Helmet - Security Headers (CSP disabled for development compatibility)\napp.use(helmet({\n  contentSecurityPolicy: false,\n  crossOriginEmbedderPolicy: false,\n}));\n\n// 2. HTTPS Redirect - ONLY in Production\nif (isProduction) {\n  app.use((req, res, next) => {\n    if (req.protocol !== \"https\" && req.headers[\"x-forwarded-proto\"] !== \"https\") {\n      return res.redirect(301, `https://${req.headers.host}${req.url}`);\n    }\n    next();\n  });\n}\n\n// 3. CORS Configuration - Handle OPTIONS first\nconst allowedOrigins = process.env.ALLOWED_ORIGINS \n  ? process.env.ALLOWED_ORIGINS.split(\",\").map(o => o.trim().replace(/\\/$/, \"\"))\n  : [];\n\napp.use((req, res, next) => {\n  const origin = req.headers.origin?.replace(/\\/$/, \"\");\n  \n  // Handle OPTIONS preflight requests first (before any other checks)\n  if (req.method === \"OPTIONS\") {\n    if (isProduction && allowedOrigins.length > 0) {\n      if (origin && allowedOrigins.includes(origin)) {\n        res.setHeader(\"Access-Control-Allow-Origin\", origin);\n        res.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\n      } else {\n        return res.status(403).json({ error: \"Origin not allowed\" });\n      }\n    } else {\n      res.setHeader(\"Access-Control-Allow-Origin\", origin || \"*\");\n      if (origin) {\n        res.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\n      }\n    }\n    res.setHeader(\"Access-Control-Allow-Methods\", \"GET, POST, PUT, PATCH, DELETE, OPTIONS\");\n    res.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization, X-Requested-With\");\n    res.setHeader(\"Access-Control-Max-Age\", \"86400\");\n    return res.status(204).end();\n  }\n  \n  // Regular requests\n  if (isProduction && allowedOrigins.length > 0) {\n    if (origin && allowedOrigins.includes(origin)) {\n      res.setHeader(\"Access-Control-Allow-Origin\", origin);\n      res.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n    // In production, if origin not in list, don't set CORS headers (browser will block)\n  } else {\n    // Development: allow all origins\n    if (origin) {\n      res.setHeader(\"Access-Control-Allow-Origin\", origin);\n      res.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n  }\n  \n  res.setHeader(\"Access-Control-Allow-Methods\", \"GET, POST, PUT, PATCH, DELETE, OPTIONS\");\n  res.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization, X-Requested-With\");\n  next();\n});\n\n// ===========================================\n// BODY PARSING (Must come before rate limiters)\n// ===========================================\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\n// Serve uploaded files statically\napp.use(\"/uploads\", express.static(path.join(process.cwd(), \"uploads\")));\n\n// Rate limiters are now in server/security.ts and applied in server/routes.ts\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n      \n      // Log curl example for super admin setup\n      const domain = process.env.REPLIT_DEV_DOMAIN || process.env.REPLIT_DOMAINS?.split(\",\")[0] || `localhost:${port}`;\n      const protocol = domain.includes(\"localhost\") ? \"http\" : \"https\";\n      console.log(\"\\n========================================\");\n      console.log(\"SUPER ADMIN SETUP - One-time curl example:\");\n      console.log(\"========================================\");\n      console.log(`curl -X POST ${protocol}://${domain}/internal/make-super-admin \\\\`);\n      console.log(`  -H \"Content-Type: application/json\" \\\\`);\n      console.log(`  -d '{\"email\": \"fawzybadr22@gmail.com\", \"secret\": \"YOUR_SUPER_ADMIN_SECRET\"}'`);\n      console.log(\"\\nReplace YOUR_SUPER_ADMIN_SECRET with the value of SUPER_ADMIN_SECRET env var\");\n      console.log(\"========================================\\n\");\n    },\n  );\n})();\n","path":null,"size_bytes":6637,"size_tokens":null},"client/src/lib/firebase.ts":{"content":"import { initializeApp, getApps, getApp } from \"firebase/app\";\nimport { \n  getAuth, \n  GoogleAuthProvider, \n  signInWithPopup, \n  signInWithEmailAndPassword, \n  createUserWithEmailAndPassword, \n  signOut, \n  onAuthStateChanged,\n  getIdTokenResult,\n  RecaptchaVerifier,\n  signInWithPhoneNumber,\n  PhoneAuthProvider,\n  linkWithCredential,\n  type User as FirebaseUser,\n  type ConfirmationResult,\n  type IdTokenResult\n} from \"firebase/auth\";\nimport { getFirestore } from \"firebase/firestore\";\n\nconst firebaseConfig = {\n  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,\n  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\n  appId: import.meta.env.VITE_FIREBASE_APP_ID,\n  measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID,\n};\n\n// Initialize Firebase only if not already initialized (prevents duplicate-app error during hot reload)\nexport const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();\nexport const auth = getAuth(app);\nexport const db = getFirestore(app);\n\nconst googleProvider = new GoogleAuthProvider();\n\nexport const signInWithGoogle = () => signInWithPopup(auth, googleProvider);\n\nexport const signInWithEmail = (email: string, password: string) => \n  signInWithEmailAndPassword(auth, email, password);\n\nexport const signUpWithEmail = (email: string, password: string) => \n  createUserWithEmailAndPassword(auth, email, password);\n\nexport const logOut = () => signOut(auth);\n\nexport const onAuthChange = (callback: (user: FirebaseUser | null) => void) => \n  onAuthStateChanged(auth, callback);\n\nexport const getTokenResult = async (user: FirebaseUser): Promise<IdTokenResult> => \n  getIdTokenResult(user, true);\n\nexport const getAuthClaims = async (user: FirebaseUser): Promise<{ \n  superAdmin: boolean; \n  admin: boolean;\n}> => {\n  try {\n    const tokenResult = await getIdTokenResult(user, true);\n    return {\n      superAdmin: tokenResult.claims.superAdmin === true,\n      admin: tokenResult.claims.admin === true || tokenResult.claims.superAdmin === true,\n    };\n  } catch (error) {\n    console.error(\"Error getting auth claims:\", error);\n    return { superAdmin: false, admin: false };\n  }\n};\n\nexport const setupRecaptcha = (buttonId: string) => {\n  const recaptchaVerifier = new RecaptchaVerifier(auth, buttonId, {\n    size: 'invisible',\n    callback: () => {},\n  });\n  return recaptchaVerifier;\n};\n\nexport const sendPhoneOTP = async (phoneNumber: string, recaptchaVerifier: RecaptchaVerifier): Promise<ConfirmationResult> => {\n  return signInWithPhoneNumber(auth, phoneNumber, recaptchaVerifier);\n};\n\nexport const linkPhoneToAccount = async (verificationId: string, otp: string) => {\n  const credential = PhoneAuthProvider.credential(verificationId, otp);\n  if (auth.currentUser) {\n    return linkWithCredential(auth.currentUser, credential);\n  }\n  throw new Error(\"No user logged in\");\n};\n\nexport type { FirebaseUser, ConfirmationResult };\n","path":null,"size_bytes":3081,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/pages/admin/Dashboard.tsx":{"content":"import { useState, useRef, useEffect, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { \n  LayoutDashboard, Package, ShoppingBag, Users, Gift, FileText, \n  BarChart3, Shield, Settings, ChevronRight, TrendingUp, Pencil, Trash2,\n  Plus, Ban, CheckCircle, Download, Eye, X, Save, Camera, ImageIcon,\n  Upload, Loader2, Calendar, MapPin, ChevronLeft\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport type { ServicePackage, Order, User, LoyaltyConfig, AuditLog, Offer } from \"@shared/schema\";\nimport { Tag } from \"lucide-react\";\nimport type * as L from \"leaflet\";\n\nexport default function AdminDashboard() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const [, params] = useRoute(\"/admin/:section\");\n  const { user, firebaseUser, isAdmin, isSuperAdmin, loading } = useAuth();\n  const { toast } = useToast();\n  \n  const section = params?.section || \"dashboard\";\n\n  // Date filter state - default to today\n  const [selectedDate, setSelectedDate] = useState<string>(() => {\n    const today = new Date();\n    return today.toISOString().split(\"T\")[0];\n  });\n  // Filter mode: daily, weekly, monthly, all\n  const [filterMode, setFilterMode] = useState<\"daily\" | \"weekly\" | \"monthly\" | \"all\">(\"daily\");\n  \n  // Analytics filter state (separate from orders filter)\n  const [analyticsDate, setAnalyticsDate] = useState<string>(() => {\n    const today = new Date();\n    return today.toISOString().split(\"T\")[0];\n  });\n  const [analyticsFilterMode, setAnalyticsFilterMode] = useState<\"daily\" | \"weekly\" | \"monthly\" | \"all\">(\"monthly\");\n\n  // Package editing state\n  const [editingPackage, setEditingPackage] = useState<ServicePackage | null>(null);\n  const [isAddingPackage, setIsAddingPackage] = useState(false);\n  const [packageForm, setPackageForm] = useState({\n    nameAr: \"\",\n    nameEn: \"\",\n    nameFr: \"\",\n    descriptionAr: \"\",\n    descriptionEn: \"\",\n    descriptionFr: \"\",\n    priceSedanKD: 0,\n    priceSuvKD: 0,\n    estimatedMinutes: 30,\n    category: \"exterior\" as string,\n    isActive: true,\n  });\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  // Queries\n  const { data: analytics } = useQuery<{\n    totalIncome: number;\n    totalOrders: number;\n    completedOrders: number;\n    cancelledOrders: number;\n    newCustomers: number;\n    pointsIssued: number;\n    pointsRedeemed: number;\n    referralCount: number;\n  }>({\n    queryKey: [\"/api/admin/analytics\"],\n    enabled: isAdmin && section === \"dashboard\",\n  });\n\n  const { data: packages, isLoading: packagesLoading } = useQuery<ServicePackage[]>({\n    queryKey: [\"/api/admin/packages\"],\n    enabled: isAdmin && (section === \"packages\" || section === \"dashboard\"),\n  });\n\n  const { data: allOrders, isLoading: ordersLoading } = useQuery<Order[]>({\n    queryKey: [\"/api/admin/orders\"],\n    enabled: isAdmin && (section === \"orders\" || section === \"dashboard\" || section === \"analytics\"),\n  });\n\n  // Filter orders based on filter mode (client-side filtering for fast UX)\n  const filteredOrders = useMemo(() => {\n    if (!allOrders) return [];\n    if (filterMode === \"all\") return allOrders;\n    \n    const selectedDateObj = new Date(selectedDate);\n    \n    if (filterMode === \"daily\") {\n      return allOrders.filter(order => order.preferredDate === selectedDate);\n    }\n    \n    if (filterMode === \"weekly\") {\n      // Get start of week (Sunday)\n      const startOfWeek = new Date(selectedDateObj);\n      startOfWeek.setDate(selectedDateObj.getDate() - selectedDateObj.getDay());\n      startOfWeek.setHours(0, 0, 0, 0);\n      // Get end of week (Saturday)\n      const endOfWeek = new Date(startOfWeek);\n      endOfWeek.setDate(startOfWeek.getDate() + 6);\n      endOfWeek.setHours(23, 59, 59, 999);\n      \n      return allOrders.filter(order => {\n        const orderDate = new Date(order.preferredDate);\n        return orderDate >= startOfWeek && orderDate <= endOfWeek;\n      });\n    }\n    \n    if (filterMode === \"monthly\") {\n      const year = selectedDateObj.getFullYear();\n      const month = selectedDateObj.getMonth();\n      return allOrders.filter(order => {\n        const orderDate = new Date(order.preferredDate);\n        return orderDate.getFullYear() === year && orderDate.getMonth() === month;\n      });\n    }\n    \n    return allOrders;\n  }, [allOrders, filterMode, selectedDate]);\n  \n  // Dashboard shows all recent orders, Orders page shows filtered by date\n  const orders = section === \"orders\" ? filteredOrders : allOrders?.slice(0, 10);\n\n  // Analytics filtered orders (separate from orders page filter)\n  const analyticsFilteredOrders = useMemo(() => {\n    if (!allOrders) return [];\n    if (analyticsFilterMode === \"all\") return allOrders;\n    \n    const selectedDateObj = new Date(analyticsDate);\n    \n    if (analyticsFilterMode === \"daily\") {\n      return allOrders.filter(order => order.preferredDate === analyticsDate);\n    }\n    \n    if (analyticsFilterMode === \"weekly\") {\n      const startOfWeek = new Date(selectedDateObj);\n      startOfWeek.setDate(selectedDateObj.getDate() - selectedDateObj.getDay());\n      startOfWeek.setHours(0, 0, 0, 0);\n      const endOfWeek = new Date(startOfWeek);\n      endOfWeek.setDate(startOfWeek.getDate() + 6);\n      endOfWeek.setHours(23, 59, 59, 999);\n      \n      return allOrders.filter(order => {\n        const orderDate = new Date(order.preferredDate);\n        return orderDate >= startOfWeek && orderDate <= endOfWeek;\n      });\n    }\n    \n    if (analyticsFilterMode === \"monthly\") {\n      const year = selectedDateObj.getFullYear();\n      const month = selectedDateObj.getMonth();\n      return allOrders.filter(order => {\n        const orderDate = new Date(order.preferredDate);\n        return orderDate.getFullYear() === year && orderDate.getMonth() === month;\n      });\n    }\n    \n    return allOrders;\n  }, [allOrders, analyticsFilterMode, analyticsDate]);\n\n  // Calculate analytics from filtered orders\n  const filteredAnalytics = useMemo(() => {\n    const completedOrders = analyticsFilteredOrders.filter(o => o.status === \"completed\");\n    const cancelledOrders = analyticsFilteredOrders.filter(o => o.status === \"cancelled\");\n    const totalIncome = completedOrders.reduce((sum, o) => sum + (o.priceKD || 0), 0);\n    const pendingOrders = analyticsFilteredOrders.filter(o => o.status === \"pending\");\n    const inProgressOrders = analyticsFilteredOrders.filter(o => [\"assigned\", \"on_the_way\", \"in_progress\"].includes(o.status));\n    \n    return {\n      totalOrders: analyticsFilteredOrders.length,\n      totalIncome,\n      completedOrders: completedOrders.length,\n      cancelledOrders: cancelledOrders.length,\n      pendingOrders: pendingOrders.length,\n      inProgressOrders: inProgressOrders.length,\n      averageOrderValue: completedOrders.length > 0 ? totalIncome / completedOrders.length : 0,\n    };\n  }, [analyticsFilteredOrders]);\n\n  const { data: customers, isLoading: customersLoading } = useQuery<User[]>({\n    queryKey: [\"/api/admin/users\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/users?role=customer\");\n      if (!res.ok) throw new Error(\"Failed to fetch customers\");\n      return res.json();\n    },\n    enabled: isAdmin && section === \"customers\",\n  });\n\n  const { data: loyaltyConfig } = useQuery<LoyaltyConfig>({\n    queryKey: [\"/api/loyalty/config\"],\n    enabled: isAdmin && section === \"loyalty\",\n  });\n\n  const { data: auditLogs, isLoading: auditLogsLoading } = useQuery<AuditLog[]>({\n    queryKey: [\"/api/admin/audit-logs\"],\n    enabled: isSuperAdmin && section === \"audit\",\n  });\n\n  const { data: allOffers, isLoading: offersLoading } = useQuery<Offer[]>({\n    queryKey: [\"/api/admin/offers\"],\n    enabled: isAdmin && section === \"offers\",\n  });\n\n  // Mutations\n  const updateOrderMutation = useMutation({\n    mutationFn: async ({ id, status, cancelReason }: { id: string; status: string; cancelReason?: string }) => {\n      const res = await fetch(`/api/orders/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status, cancelReason, performedBy: user?.id }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update order\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/orders\"] });\n      toast({ title: getLocalizedText(\"تم التحديث\", \"Updated\", \"Mis à jour\") });\n    },\n  });\n\n  const updateUserStatusMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: string; status: string }) => {\n      const res = await fetch(`/api/admin/users/${id}/status`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status, performedBy: user?.id }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update user\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({ title: getLocalizedText(\"تم التحديث\", \"Updated\", \"Mis à jour\") });\n    },\n  });\n\n  const adjustPointsMutation = useMutation({\n    mutationFn: async ({ id, pointsChange, note }: { id: string; pointsChange: number; note: string }) => {\n      const res = await fetch(`/api/admin/users/${id}/points`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ pointsChange, note, performedBy: user?.id }),\n      });\n      if (!res.ok) throw new Error(\"Failed to adjust points\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({ title: getLocalizedText(\"تم تعديل النقاط\", \"Points Adjusted\", \"Points Ajustés\") });\n    },\n  });\n\n  const updateLoyaltyConfigMutation = useMutation({\n    mutationFn: async (data: Partial<LoyaltyConfig>) => {\n      const res = await fetch(\"/api/admin/loyalty/config\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ ...data, performedBy: user?.id }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update config\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/loyalty/config\"] });\n      toast({ title: getLocalizedText(\"تم حفظ الإعدادات\", \"Settings Saved\", \"Paramètres Enregistrés\") });\n    },\n  });\n\n  const createPackageMutation = useMutation({\n    mutationFn: async (data: typeof packageForm) => {\n      const res = await fetch(\"/api/admin/packages\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ ...data, performedBy: user?.id }),\n      });\n      if (!res.ok) throw new Error(\"Failed to create package\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/packages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/packages\"] });\n      setIsAddingPackage(false);\n      resetPackageForm();\n      toast({ title: getLocalizedText(\"تمت الإضافة بنجاح\", \"Package Added\", \"Forfait Ajouté\") });\n    },\n    onError: () => {\n      toast({ title: getLocalizedText(\"فشل في الإضافة\", \"Failed to add\", \"Échec de l'ajout\"), variant: \"destructive\" });\n    },\n  });\n\n  const updatePackageMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: typeof packageForm }) => {\n      const res = await fetch(`/api/admin/packages/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ ...data, performedBy: user?.id }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update package\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/packages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/packages\"] });\n      setEditingPackage(null);\n      resetPackageForm();\n      toast({ title: getLocalizedText(\"تم التحديث بنجاح\", \"Package Updated\", \"Forfait Mis à Jour\") });\n    },\n    onError: () => {\n      toast({ title: getLocalizedText(\"فشل في التحديث\", \"Failed to update\", \"Échec de la mise à jour\"), variant: \"destructive\" });\n    },\n  });\n\n  const deletePackageMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/admin/packages/${id}?performedBy=${user?.id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok) throw new Error(\"Failed to delete package\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/packages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/packages\"] });\n      toast({ title: getLocalizedText(\"تم الحذف\", \"Package Deleted\", \"Forfait Supprimé\") });\n    },\n    onError: () => {\n      toast({ title: getLocalizedText(\"فشل في الحذف\", \"Failed to delete\", \"Échec de la suppression\"), variant: \"destructive\" });\n    },\n  });\n\n  const resetPackageForm = () => {\n    setPackageForm({\n      nameAr: \"\",\n      nameEn: \"\",\n      nameFr: \"\",\n      descriptionAr: \"\",\n      descriptionEn: \"\",\n      descriptionFr: \"\",\n      priceSedanKD: 0,\n      priceSuvKD: 0,\n      estimatedMinutes: 30,\n      category: \"exterior\",\n      isActive: true,\n    });\n  };\n\n  const openEditPackage = (pkg: ServicePackage) => {\n    setPackageForm({\n      nameAr: pkg.nameAr,\n      nameEn: pkg.nameEn,\n      nameFr: pkg.nameFr,\n      descriptionAr: pkg.descriptionAr || \"\",\n      descriptionEn: pkg.descriptionEn || \"\",\n      descriptionFr: pkg.descriptionFr || \"\",\n      priceSedanKD: pkg.priceSedanKD,\n      priceSuvKD: pkg.priceSuvKD,\n      estimatedMinutes: pkg.estimatedMinutes,\n      category: pkg.category,\n      isActive: pkg.isActive,\n    });\n    setEditingPackage(pkg);\n  };\n\n  const openAddPackage = () => {\n    resetPackageForm();\n    setIsAddingPackage(true);\n  };\n\n  const handlePackageSubmit = () => {\n    if (editingPackage) {\n      updatePackageMutation.mutate({ id: editingPackage.id, data: packageForm });\n    } else {\n      createPackageMutation.mutate(packageForm);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\" />\n      </div>\n    );\n  }\n\n  if (!user || !isAdmin) {\n    return (\n      <div className=\"py-12\">\n        <div className=\"container mx-auto px-4 text-center\">\n          <Shield className=\"h-16 w-16 mx-auto mb-4 text-destructive\" />\n          <h1 className=\"text-2xl font-bold mb-2\">\n            {getLocalizedText(\"غير مصرح\", \"Unauthorized\", \"Non autorisé\")}\n          </h1>\n          <p className=\"text-muted-foreground mb-4\">\n            {getLocalizedText(\n              \"ليس لديك صلاحية للوصول إلى هذه الصفحة\",\n              \"You don't have permission to access this page\",\n              \"Vous n'avez pas l'autorisation d'accéder à cette page\"\n            )}\n          </p>\n          <Button onClick={() => setLocation(\"/\")} data-testid=\"go-home\">\n            {t(\"nav.home\")}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const menuItems = [\n    { id: \"dashboard\", icon: LayoutDashboard, label: t(\"admin.dashboard\") },\n    { id: \"packages\", icon: Package, label: t(\"admin.packages\") },\n    { id: \"orders\", icon: ShoppingBag, label: t(\"admin.orders\") },\n    { id: \"customers\", icon: Users, label: t(\"admin.customers\") },\n    { id: \"loyalty\", icon: Gift, label: t(\"admin.loyalty\") },\n    { id: \"offers\", icon: Tag, label: getLocalizedText(\"العروض\", \"Offers\", \"Offres\") },\n    { id: \"content\", icon: FileText, label: t(\"admin.content\") },\n    { id: \"analytics\", icon: BarChart3, label: t(\"admin.analytics\") },\n    ...(isSuperAdmin ? [\n      { id: \"admins\", icon: Shield, label: t(\"admin.admins\") },\n      { id: \"audit\", icon: Settings, label: t(\"admin.auditLogs\") },\n    ] : []),\n  ];\n\n  const stats = [\n    { label: t(\"admin.totalIncome\"), value: `${analytics?.totalIncome?.toFixed(3) || \"0\"} KD`, icon: TrendingUp },\n    { label: t(\"admin.totalOrders\"), value: analytics?.totalOrders?.toString() || \"0\", icon: ShoppingBag },\n    { label: t(\"admin.activeCustomers\"), value: analytics?.newCustomers?.toString() || \"0\", icon: Users },\n    { label: t(\"admin.pointsIssued\"), value: analytics?.pointsIssued?.toString() || \"0\", icon: Gift },\n  ];\n\n  const getStatusBadge = (status: string) => {\n    const colors: Record<string, string> = {\n      pending: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400\",\n      assigned: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n      in_progress: \"bg-primary/10 text-primary\",\n      completed: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n      cancelled: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n    };\n    return <span className={`px-2 py-1 rounded-full text-xs font-medium ${colors[status] || colors.pending}`}>{status}</span>;\n  };\n\n  return (\n    <div className=\"py-6\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"flex flex-col lg:flex-row gap-6\">\n          {/* Sidebar */}\n          <div className=\"lg:w-64 flex-shrink-0\">\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-lg flex items-center gap-2\">\n                  <Shield className=\"h-5 w-5 text-primary\" />\n                  {t(\"admin.dashboard\")}\n                </CardTitle>\n                <CardDescription>{user.email}</CardDescription>\n              </CardHeader>\n              <CardContent className=\"p-2\">\n                <nav className=\"space-y-1\">\n                  {menuItems.map((item) => (\n                    <Button\n                      key={item.id}\n                      variant={section === item.id ? \"secondary\" : \"ghost\"}\n                      className=\"w-full justify-start\"\n                      onClick={() => setLocation(item.id === \"dashboard\" ? \"/admin\" : `/admin/${item.id}`)}\n                      data-testid={`admin-nav-${item.id}`}\n                    >\n                      <item.icon className=\"h-4 w-4 me-2\" />\n                      {item.label}\n                    </Button>\n                  ))}\n                </nav>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Main Content */}\n          <div className=\"flex-1 min-w-0\">\n            {section === \"dashboard\" && (\n              <div className=\"space-y-6\">\n                <h1 className=\"text-2xl font-bold\">{t(\"admin.dashboard\")}</h1>\n                \n                {/* Stats Grid */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                  {stats.map((stat, index) => (\n                    <Card key={index} data-testid={`stat-card-${index}`}>\n                      <CardContent className=\"pt-6\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <stat.icon className=\"h-5 w-5 text-primary\" />\n                        </div>\n                        <p className=\"text-2xl font-bold\">{stat.value}</p>\n                        <p className=\"text-sm text-muted-foreground\">{stat.label}</p>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n\n                {/* Recent Orders Preview */}\n                <Card>\n                  <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n                    <CardTitle>{getLocalizedText(\"أحدث الطلبات\", \"Recent Orders\", \"Commandes Récentes\")}</CardTitle>\n                    <Button variant=\"ghost\" size=\"sm\" onClick={() => setLocation(\"/admin/orders\")}>\n                      {getLocalizedText(\"عرض الكل\", \"View All\", \"Voir Tout\")}\n                      <ChevronRight className=\"h-4 w-4 ms-1 rtl:rotate-180\" />\n                    </Button>\n                  </CardHeader>\n                  <CardContent>\n                    {ordersLoading ? (\n                      <div className=\"space-y-2\">\n                        {[1, 2, 3].map(i => <Skeleton key={i} className=\"h-12 w-full\" />)}\n                      </div>\n                    ) : orders?.length ? (\n                      <div className=\"space-y-2\">\n                        {orders.slice(0, 5).map((order) => (\n                          <div key={order.id} className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50\">\n                            <div className=\"flex items-center gap-3\">\n                              {getStatusBadge(order.status)}\n                              <span className=\"text-sm font-medium\">{order.area}</span>\n                            </div>\n                            <span className=\"font-bold text-primary\">{order.priceKD} KD</span>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <p className=\"text-muted-foreground text-center py-8\">{t(\"common.noData\")}</p>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n\n            {section === \"packages\" && (\n              <div className=\"space-y-6\">\n                <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                  <h1 className=\"text-2xl font-bold\">{t(\"admin.packages\")}</h1>\n                  <Button onClick={openAddPackage} data-testid=\"add-package\">\n                    <Plus className=\"h-4 w-4 me-2\" />\n                    {getLocalizedText(\"إضافة باقة\", \"Add Package\", \"Ajouter un Forfait\")}\n                  </Button>\n                </div>\n                <Card>\n                  <CardContent className=\"pt-6\">\n                    {packagesLoading ? (\n                      <div className=\"space-y-2\">\n                        {[1, 2, 3].map(i => <Skeleton key={i} className=\"h-16 w-full\" />)}\n                      </div>\n                    ) : packages?.length ? (\n                      <div className=\"space-y-3\">\n                        {packages.map((pkg) => (\n                          <div key={pkg.id} className=\"flex items-center justify-between p-4 rounded-lg border\" data-testid={`package-row-${pkg.id}`}>\n                            <div>\n                              <p className=\"font-medium\">{getLocalizedText(pkg.nameAr, pkg.nameEn, pkg.nameFr)}</p>\n                              <p className=\"text-sm text-muted-foreground\">\n                                Sedan: {pkg.priceSedanKD} KD | SUV: {pkg.priceSuvKD} KD\n                              </p>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Badge variant={pkg.isActive ? \"default\" : \"secondary\"}>\n                                {pkg.isActive ? getLocalizedText(\"نشط\", \"Active\", \"Actif\") : getLocalizedText(\"غير نشط\", \"Inactive\", \"Inactif\")}\n                              </Badge>\n                              <Button size=\"icon\" variant=\"ghost\" onClick={() => openEditPackage(pkg)} data-testid={`edit-package-${pkg.id}`}>\n                                <Pencil className=\"h-4 w-4\" />\n                              </Button>\n                              <Button size=\"icon\" variant=\"ghost\" onClick={() => deletePackageMutation.mutate(pkg.id)} data-testid={`delete-package-${pkg.id}`}>\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <p className=\"text-muted-foreground text-center py-8\">{t(\"common.noData\")}</p>\n                    )}\n                  </CardContent>\n                </Card>\n\n                {/* Package Edit/Add Dialog */}\n                <Dialog open={!!editingPackage || isAddingPackage} onOpenChange={(open) => {\n                  if (!open) {\n                    setEditingPackage(null);\n                    setIsAddingPackage(false);\n                    resetPackageForm();\n                  }\n                }}>\n                  <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n                    <DialogHeader>\n                      <DialogTitle>\n                        {editingPackage \n                          ? getLocalizedText(\"تعديل الباقة\", \"Edit Package\", \"Modifier le Forfait\")\n                          : getLocalizedText(\"إضافة باقة جديدة\", \"Add New Package\", \"Ajouter un Nouveau Forfait\")\n                        }\n                      </DialogTitle>\n                    </DialogHeader>\n                    <div className=\"space-y-4 py-4\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"الاسم (عربي)\", \"Name (Arabic)\", \"Nom (Arabe)\")}</Label>\n                          <Input\n                            value={packageForm.nameAr}\n                            onChange={(e) => setPackageForm({ ...packageForm, nameAr: e.target.value })}\n                            placeholder=\"غسيل خارجي\"\n                            dir=\"rtl\"\n                            data-testid=\"input-package-name-ar\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"الاسم (إنجليزي)\", \"Name (English)\", \"Nom (Anglais)\")}</Label>\n                          <Input\n                            value={packageForm.nameEn}\n                            onChange={(e) => setPackageForm({ ...packageForm, nameEn: e.target.value })}\n                            placeholder=\"Exterior Wash\"\n                            data-testid=\"input-package-name-en\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"الاسم (فرنسي)\", \"Name (French)\", \"Nom (Français)\")}</Label>\n                          <Input\n                            value={packageForm.nameFr}\n                            onChange={(e) => setPackageForm({ ...packageForm, nameFr: e.target.value })}\n                            placeholder=\"Lavage Extérieur\"\n                            data-testid=\"input-package-name-fr\"\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"الوصف (عربي)\", \"Description (Arabic)\", \"Description (Arabe)\")}</Label>\n                          <Input\n                            value={packageForm.descriptionAr}\n                            onChange={(e) => setPackageForm({ ...packageForm, descriptionAr: e.target.value })}\n                            dir=\"rtl\"\n                            data-testid=\"input-package-desc-ar\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"الوصف (إنجليزي)\", \"Description (English)\", \"Description (Anglais)\")}</Label>\n                          <Input\n                            value={packageForm.descriptionEn}\n                            onChange={(e) => setPackageForm({ ...packageForm, descriptionEn: e.target.value })}\n                            data-testid=\"input-package-desc-en\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"الوصف (فرنسي)\", \"Description (French)\", \"Description (Français)\")}</Label>\n                          <Input\n                            value={packageForm.descriptionFr}\n                            onChange={(e) => setPackageForm({ ...packageForm, descriptionFr: e.target.value })}\n                            data-testid=\"input-package-desc-fr\"\n                          />\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"سعر سيدان (د.ك)\", \"Sedan Price (KD)\", \"Prix Berline (KD)\")}</Label>\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            step=\"0.5\"\n                            value={packageForm.priceSedanKD}\n                            onChange={(e) => setPackageForm({ ...packageForm, priceSedanKD: parseFloat(e.target.value) || 0 })}\n                            data-testid=\"input-package-price-sedan\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"سعر SUV (د.ك)\", \"SUV Price (KD)\", \"Prix SUV (KD)\")}</Label>\n                          <Input\n                            type=\"number\"\n                            min=\"0\"\n                            step=\"0.5\"\n                            value={packageForm.priceSuvKD}\n                            onChange={(e) => setPackageForm({ ...packageForm, priceSuvKD: parseFloat(e.target.value) || 0 })}\n                            data-testid=\"input-package-price-suv\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"المدة (دقائق)\", \"Duration (min)\", \"Durée (min)\")}</Label>\n                          <Input\n                            type=\"number\"\n                            min=\"1\"\n                            value={packageForm.estimatedMinutes}\n                            onChange={(e) => setPackageForm({ ...packageForm, estimatedMinutes: parseInt(e.target.value) || 30 })}\n                            data-testid=\"input-package-duration\"\n                          />\n                        </div>\n                        <div className=\"space-y-2\">\n                          <Label>{getLocalizedText(\"الفئة\", \"Category\", \"Catégorie\")}</Label>\n                          <Select value={packageForm.category} onValueChange={(val) => setPackageForm({ ...packageForm, category: val })}>\n                            <SelectTrigger data-testid=\"select-package-category\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"exterior\">{getLocalizedText(\"خارجي\", \"Exterior\", \"Extérieur\")}</SelectItem>\n                              <SelectItem value=\"interior\">{getLocalizedText(\"داخلي\", \"Interior\", \"Intérieur\")}</SelectItem>\n                              <SelectItem value=\"full\">{getLocalizedText(\"كامل\", \"Full\", \"Complet\")}</SelectItem>\n                              <SelectItem value=\"vip\">{getLocalizedText(\"VIP\", \"VIP\", \"VIP\")}</SelectItem>\n                              <SelectItem value=\"monthly\">{getLocalizedText(\"شهري\", \"Monthly\", \"Mensuel\")}</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </div>\n                      </div>\n\n                      <div className=\"flex items-center gap-2\">\n                        <Label>{getLocalizedText(\"نشط\", \"Active\", \"Actif\")}</Label>\n                        <input\n                          type=\"checkbox\"\n                          checked={packageForm.isActive}\n                          onChange={(e) => setPackageForm({ ...packageForm, isActive: e.target.checked })}\n                          className=\"h-4 w-4\"\n                          data-testid=\"checkbox-package-active\"\n                        />\n                      </div>\n\n                      <div className=\"flex gap-2 pt-4\">\n                        <Button \n                          onClick={handlePackageSubmit} \n                          disabled={createPackageMutation.isPending || updatePackageMutation.isPending}\n                          data-testid=\"button-save-package\"\n                        >\n                          <Save className=\"h-4 w-4 me-2\" />\n                          {(createPackageMutation.isPending || updatePackageMutation.isPending)\n                            ? getLocalizedText(\"جاري الحفظ...\", \"Saving...\", \"Enregistrement...\")\n                            : getLocalizedText(\"حفظ\", \"Save\", \"Enregistrer\")\n                          }\n                        </Button>\n                        <Button \n                          variant=\"outline\" \n                          onClick={() => {\n                            setEditingPackage(null);\n                            setIsAddingPackage(false);\n                            resetPackageForm();\n                          }}\n                          data-testid=\"button-cancel-package\"\n                        >\n                          <X className=\"h-4 w-4 me-2\" />\n                          {getLocalizedText(\"إلغاء\", \"Cancel\", \"Annuler\")}\n                        </Button>\n                      </div>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              </div>\n            )}\n\n            {section === \"orders\" && (\n              <div className=\"space-y-6\">\n                {/* Header with Date Filter */}\n                <div className=\"flex flex-col gap-4\">\n                  <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\n                    <h1 className=\"text-2xl font-bold\">{t(\"admin.orders\")}</h1>\n                    <Button variant=\"outline\" onClick={() => window.open(\"/api/admin/export/orders\", \"_blank\")}>\n                      <Download className=\"h-4 w-4 me-2\" />\n                      {getLocalizedText(\"تصدير CSV\", \"Export CSV\", \"Exporter CSV\")}\n                    </Button>\n                  </div>\n                  \n                  {/* Filter Mode Tabs */}\n                  <div className=\"flex flex-wrap items-center gap-2\">\n                    <div className=\"flex bg-muted/50 rounded-lg p-1 gap-1\">\n                      <Button \n                        variant={filterMode === \"daily\" ? \"default\" : \"ghost\"} \n                        size=\"sm\"\n                        onClick={() => setFilterMode(\"daily\")}\n                        data-testid=\"button-filter-daily\"\n                      >\n                        {getLocalizedText(\"يومي\", \"Daily\", \"Quotidien\")}\n                      </Button>\n                      <Button \n                        variant={filterMode === \"weekly\" ? \"default\" : \"ghost\"} \n                        size=\"sm\"\n                        onClick={() => setFilterMode(\"weekly\")}\n                        data-testid=\"button-filter-weekly\"\n                      >\n                        {getLocalizedText(\"أسبوعي\", \"Weekly\", \"Hebdomadaire\")}\n                      </Button>\n                      <Button \n                        variant={filterMode === \"monthly\" ? \"default\" : \"ghost\"} \n                        size=\"sm\"\n                        onClick={() => setFilterMode(\"monthly\")}\n                        data-testid=\"button-filter-monthly\"\n                      >\n                        {getLocalizedText(\"شهري\", \"Monthly\", \"Mensuel\")}\n                      </Button>\n                      <Button \n                        variant={filterMode === \"all\" ? \"default\" : \"ghost\"} \n                        size=\"sm\"\n                        onClick={() => setFilterMode(\"all\")}\n                        data-testid=\"button-filter-all\"\n                      >\n                        {getLocalizedText(\"الكل\", \"All\", \"Tout\")}\n                      </Button>\n                    </div>\n                    \n                    {/* Date Navigator - hidden when \"all\" is selected */}\n                    {filterMode !== \"all\" && (\n                      <div className=\"flex items-center gap-2 bg-muted/50 rounded-lg p-1\">\n                        <Button \n                          variant=\"ghost\" \n                          size=\"icon\"\n                          onClick={() => {\n                            const d = new Date(selectedDate);\n                            if (filterMode === \"daily\") d.setDate(d.getDate() - 1);\n                            else if (filterMode === \"weekly\") d.setDate(d.getDate() - 7);\n                            else if (filterMode === \"monthly\") d.setMonth(d.getMonth() - 1);\n                            setSelectedDate(d.toISOString().split(\"T\")[0]);\n                          }}\n                          data-testid=\"button-prev-period\"\n                        >\n                          {i18n.language === \"ar\" ? <ChevronRight className=\"h-4 w-4\" /> : <ChevronLeft className=\"h-4 w-4\" />}\n                        </Button>\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {filterMode === \"monthly\" ? (\n                            <Input\n                              type=\"month\"\n                              value={selectedDate.slice(0, 7)}\n                              onChange={(e) => setSelectedDate(e.target.value + \"-01\")}\n                              className=\"w-auto min-w-[140px]\"\n                              data-testid=\"input-month-filter\"\n                            />\n                          ) : (\n                            <Input\n                              type=\"date\"\n                              value={selectedDate}\n                              onChange={(e) => setSelectedDate(e.target.value)}\n                              className=\"w-auto min-w-[140px]\"\n                              data-testid=\"input-date-filter\"\n                            />\n                          )}\n                        </div>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"icon\"\n                          onClick={() => {\n                            const d = new Date(selectedDate);\n                            if (filterMode === \"daily\") d.setDate(d.getDate() + 1);\n                            else if (filterMode === \"weekly\") d.setDate(d.getDate() + 7);\n                            else if (filterMode === \"monthly\") d.setMonth(d.getMonth() + 1);\n                            setSelectedDate(d.toISOString().split(\"T\")[0]);\n                          }}\n                          data-testid=\"button-next-period\"\n                        >\n                          {i18n.language === \"ar\" ? <ChevronLeft className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\n                        </Button>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => setSelectedDate(new Date().toISOString().split(\"T\")[0])}\n                          data-testid=\"button-today\"\n                        >\n                          {getLocalizedText(\"اليوم\", \"Today\", \"Aujourd'hui\")}\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Summary Stats for Selected Date */}\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <Card>\n                    <CardContent className=\"pt-4 pb-4\">\n                      <div className=\"text-2xl font-bold\">{filteredOrders.length}</div>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"إجمالي الطلبات\", \"Total Orders\", \"Total Commandes\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"pt-4 pb-4\">\n                      <div className=\"text-2xl font-bold text-yellow-600\">{filteredOrders.filter(o => o.status === \"pending\").length}</div>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"قيد الانتظار\", \"Pending\", \"En Attente\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"pt-4 pb-4\">\n                      <div className=\"text-2xl font-bold text-blue-600\">{filteredOrders.filter(o => [\"assigned\", \"on_the_way\", \"in_progress\"].includes(o.status)).length}</div>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"قيد التنفيذ\", \"In Progress\", \"En Cours\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"pt-4 pb-4\">\n                      <div className=\"text-2xl font-bold text-green-600\">{filteredOrders.filter(o => o.status === \"completed\").length}</div>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"مكتمل\", \"Completed\", \"Terminé\")}</p>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Map showing order locations */}\n                {filteredOrders.some(o => o.latitude && o.longitude) && (\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-lg flex items-center gap-2\">\n                        <MapPin className=\"h-5 w-5 text-primary\" />\n                        {getLocalizedText(\"خريطة الطلبات\", \"Orders Map\", \"Carte des Commandes\")}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <AdminOrdersMap orders={filteredOrders} getLocalizedText={getLocalizedText} getStatusBadge={getStatusBadge} />\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Orders List */}\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-lg\">\n                      {filterMode === \"all\" ? (\n                        getLocalizedText(\"جميع الطلبات\", \"All Orders\", \"Toutes les Commandes\")\n                      ) : filterMode === \"monthly\" ? (\n                        getLocalizedText(\n                          `طلبات ${new Date(selectedDate).toLocaleDateString(\"ar-KW\", { month: \"long\", year: \"numeric\" })}`,\n                          `Orders for ${new Date(selectedDate).toLocaleDateString(\"en-US\", { month: \"long\", year: \"numeric\" })}`,\n                          `Commandes de ${new Date(selectedDate).toLocaleDateString(\"fr-FR\", { month: \"long\", year: \"numeric\" })}`\n                        )\n                      ) : filterMode === \"weekly\" ? (\n                        (() => {\n                          const d = new Date(selectedDate);\n                          const startOfWeek = new Date(d);\n                          startOfWeek.setDate(d.getDate() - d.getDay());\n                          const endOfWeek = new Date(startOfWeek);\n                          endOfWeek.setDate(startOfWeek.getDate() + 6);\n                          return getLocalizedText(\n                            `طلبات الأسبوع (${startOfWeek.toLocaleDateString(\"ar-KW\", { day: \"numeric\", month: \"short\" })} - ${endOfWeek.toLocaleDateString(\"ar-KW\", { day: \"numeric\", month: \"short\" })})`,\n                            `Orders for Week (${startOfWeek.toLocaleDateString(\"en-US\", { month: \"short\", day: \"numeric\" })} - ${endOfWeek.toLocaleDateString(\"en-US\", { month: \"short\", day: \"numeric\" })})`,\n                            `Commandes de la Semaine (${startOfWeek.toLocaleDateString(\"fr-FR\", { day: \"numeric\", month: \"short\" })} - ${endOfWeek.toLocaleDateString(\"fr-FR\", { day: \"numeric\", month: \"short\" })})`\n                          );\n                        })()\n                      ) : (\n                        getLocalizedText(\n                          `طلبات ${new Date(selectedDate).toLocaleDateString(\"ar-KW\", { weekday: \"long\", day: \"numeric\", month: \"long\" })}`,\n                          `Orders for ${new Date(selectedDate).toLocaleDateString(\"en-US\", { weekday: \"long\", month: \"short\", day: \"numeric\" })}`,\n                          `Commandes du ${new Date(selectedDate).toLocaleDateString(\"fr-FR\", { weekday: \"long\", day: \"numeric\", month: \"long\" })}`\n                        )\n                      )}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {ordersLoading ? (\n                      <div className=\"space-y-2\">\n                        {[1, 2, 3, 4, 5].map(i => <Skeleton key={i} className=\"h-16 w-full\" />)}\n                      </div>\n                    ) : filteredOrders.length ? (\n                      <div className=\"space-y-3\">\n                        {filteredOrders.map((order) => (\n                          <div key={order.id} className=\"flex flex-col md:flex-row md:items-center justify-between p-4 rounded-lg border gap-4\" data-testid={`order-row-${order.id}`}>\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                                {getStatusBadge(order.status)}\n                                <span className=\"text-sm text-muted-foreground\">#{order.id.slice(0, 8)}</span>\n                                {order.status !== \"pending\" && (\n                                  <Badge variant=\"outline\" className=\"text-xs\">\n                                    <Users className=\"h-3 w-3 ltr:mr-1 rtl:ml-1\" />\n                                    {getLocalizedText(\"تم التعيين\", \"Assigned\", \"Assigné\")}\n                                  </Badge>\n                                )}\n                                {(order.beforePhotoUrl || order.afterPhotoUrl) && (\n                                  <Badge variant=\"secondary\" className=\"text-xs\">\n                                    <Camera className=\"h-3 w-3 ltr:mr-1 rtl:ml-1\" />\n                                    {getLocalizedText(\"صور\", \"Photos\", \"Photos\")}\n                                  </Badge>\n                                )}\n                              </div>\n                              <p className=\"font-medium\">{order.area} - {order.address}</p>\n                              <p className=\"text-sm text-muted-foreground\">\n                                {order.preferredTime} | {order.carType}\n                              </p>\n                              {(order.beforePhotoUrl || order.afterPhotoUrl) && (\n                                <div className=\"flex gap-4 mt-2\">\n                                  {order.beforePhotoUrl && (\n                                    <a href={order.beforePhotoUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-xs text-primary hover:underline flex items-center gap-1\">\n                                      <ImageIcon className=\"h-3 w-3\" />\n                                      {getLocalizedText(\"قبل\", \"Before\", \"Avant\")}\n                                    </a>\n                                  )}\n                                  {order.afterPhotoUrl && (\n                                    <a href={order.afterPhotoUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-xs text-primary hover:underline flex items-center gap-1\">\n                                      <ImageIcon className=\"h-3 w-3\" />\n                                      {getLocalizedText(\"بعد\", \"After\", \"Après\")}\n                                    </a>\n                                  )}\n                                </div>\n                              )}\n                            </div>\n                            <div className=\"flex items-center gap-3 flex-wrap\">\n                              {order.latitude && order.longitude && (\n                                <Button\n                                  size=\"icon\"\n                                  variant=\"ghost\"\n                                  onClick={() => window.open(`https://www.google.com/maps/dir/?api=1&destination=${order.latitude},${order.longitude}`, \"_blank\")}\n                                  data-testid={`button-map-${order.id}`}\n                                >\n                                  <MapPin className=\"h-4 w-4\" />\n                                </Button>\n                              )}\n                              <span className=\"font-bold text-primary\">{order.priceKD} KD</span>\n                              <Select\n                                value={order.status}\n                                onValueChange={(status) => updateOrderMutation.mutate({ id: order.id, status })}\n                              >\n                                <SelectTrigger className=\"w-36\">\n                                  <SelectValue />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  <SelectItem value=\"pending\">{getLocalizedText(\"معلق\", \"Pending\", \"En Attente\")}</SelectItem>\n                                  <SelectItem value=\"assigned\">{getLocalizedText(\"تم التعيين\", \"Assigned\", \"Assigné\")}</SelectItem>\n                                  <SelectItem value=\"on_the_way\">{getLocalizedText(\"في الطريق\", \"On The Way\", \"En Route\")}</SelectItem>\n                                  <SelectItem value=\"in_progress\">{getLocalizedText(\"قيد التنفيذ\", \"In Progress\", \"En Cours\")}</SelectItem>\n                                  <SelectItem value=\"completed\">{getLocalizedText(\"مكتمل\", \"Completed\", \"Terminé\")}</SelectItem>\n                                  <SelectItem value=\"cancelled\">{getLocalizedText(\"ملغي\", \"Cancelled\", \"Annulé\")}</SelectItem>\n                                </SelectContent>\n                              </Select>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <Calendar className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                        <p className=\"text-muted-foreground\">\n                          {getLocalizedText(\n                            \"لا توجد طلبات في هذا اليوم\",\n                            \"No orders for this date\",\n                            \"Aucune commande pour cette date\"\n                          )}\n                        </p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n\n            {section === \"customers\" && (\n              <div className=\"space-y-6\">\n                <h1 className=\"text-2xl font-bold\">{t(\"admin.customers\")}</h1>\n                <Card>\n                  <CardContent className=\"pt-6\">\n                    {customersLoading ? (\n                      <div className=\"space-y-2\">\n                        {[1, 2, 3, 4, 5].map(i => <Skeleton key={i} className=\"h-16 w-full\" />)}\n                      </div>\n                    ) : customers?.length ? (\n                      <div className=\"space-y-3\">\n                        {customers.map((customer) => (\n                          <div key={customer.id} className=\"flex flex-col md:flex-row md:items-center justify-between p-4 rounded-lg border gap-4\" data-testid={`customer-row-${customer.id}`}>\n                            <div className=\"flex-1\">\n                              <p className=\"font-medium\">{customer.name}</p>\n                              <p className=\"text-sm text-muted-foreground\">{customer.email}</p>\n                            </div>\n                            <div className=\"flex items-center gap-3\">\n                              <Badge variant=\"outline\">{customer.loyaltyPoints} pts</Badge>\n                              <Badge variant={customer.status === \"active\" ? \"default\" : \"destructive\"}>\n                                {customer.status}\n                              </Badge>\n                              <Button\n                                size=\"sm\"\n                                variant={customer.status === \"active\" ? \"destructive\" : \"default\"}\n                                onClick={() => updateUserStatusMutation.mutate({\n                                  id: customer.id,\n                                  status: customer.status === \"active\" ? \"blocked\" : \"active\"\n                                })}\n                              >\n                                {customer.status === \"active\" ? <Ban className=\"h-4 w-4\" /> : <CheckCircle className=\"h-4 w-4\" />}\n                              </Button>\n                              <PointsAdjustDialog\n                                customerId={customer.id}\n                                customerName={customer.name}\n                                currentPoints={customer.loyaltyPoints}\n                                onAdjust={(pointsChange, note) => adjustPointsMutation.mutate({ id: customer.id, pointsChange, note })}\n                              />\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <p className=\"text-muted-foreground text-center py-8\">{t(\"common.noData\")}</p>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n\n            {section === \"loyalty\" && (\n              <div className=\"space-y-6\">\n                <h1 className=\"text-2xl font-bold\">{t(\"admin.loyalty\")}</h1>\n                {loyaltyConfig && (\n                  <LoyaltyConfigEditor\n                    config={loyaltyConfig}\n                    onSave={(data) => updateLoyaltyConfigMutation.mutate(data)}\n                    isPending={updateLoyaltyConfigMutation.isPending}\n                    getLocalizedText={getLocalizedText}\n                  />\n                )}\n              </div>\n            )}\n\n            {section === \"content\" && (\n              <div className=\"space-y-6\">\n                <h1 className=\"text-2xl font-bold\">{t(\"admin.content\")}</h1>\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <Card className=\"hover-elevate cursor-pointer\" onClick={() => setLocation(\"/admin/blog\")} data-testid=\"card-blog\">\n                    <CardContent className=\"pt-6 text-center\">\n                      <FileText className=\"h-12 w-12 mx-auto mb-4 text-primary\" />\n                      <p className=\"font-medium\">{getLocalizedText(\"المدونة\", \"Blog Posts\", \"Articles de Blog\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card className=\"hover-elevate cursor-pointer\" onClick={() => setLocation(\"/admin/testimonials\")} data-testid=\"card-testimonials\">\n                    <CardContent className=\"pt-6 text-center\">\n                      <Users className=\"h-12 w-12 mx-auto mb-4 text-chart-1\" />\n                      <p className=\"font-medium\">{getLocalizedText(\"الشهادات\", \"Testimonials\", \"Témoignages\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card className=\"hover-elevate cursor-pointer\" onClick={() => setLocation(\"/admin/gallery\")} data-testid=\"card-gallery\">\n                    <CardContent className=\"pt-6 text-center\">\n                      <Eye className=\"h-12 w-12 mx-auto mb-4 text-chart-3\" />\n                      <p className=\"font-medium\">{getLocalizedText(\"المعرض\", \"Gallery\", \"Galerie\")}</p>\n                    </CardContent>\n                  </Card>\n                </div>\n              </div>\n            )}\n\n            {section === \"blog\" && (\n              <ContentBlogManager getLocalizedText={getLocalizedText} firebaseUser={firebaseUser} />\n            )}\n\n            {section === \"testimonials\" && (\n              <ContentTestimonialsManager getLocalizedText={getLocalizedText} firebaseUser={firebaseUser} />\n            )}\n\n            {section === \"gallery\" && (\n              <ContentGalleryManager getLocalizedText={getLocalizedText} firebaseUser={firebaseUser} />\n            )}\n\n            {section === \"offers\" && (\n              <OffersManager \n                offers={allOffers || []} \n                isLoading={offersLoading}\n                getLocalizedText={getLocalizedText} \n                firebaseUser={firebaseUser} \n              />\n            )}\n\n            {section === \"analytics\" && (\n              <div className=\"space-y-6\">\n                {/* Header with Filter Controls */}\n                <div className=\"flex flex-col gap-4\">\n                  <h1 className=\"text-2xl font-bold\">{t(\"admin.analytics\")}</h1>\n                  \n                  {/* Filter Mode Tabs */}\n                  <div className=\"flex flex-wrap items-center gap-2\">\n                    <div className=\"flex bg-muted/50 rounded-lg p-1 gap-1\">\n                      <Button \n                        variant={analyticsFilterMode === \"daily\" ? \"default\" : \"ghost\"} \n                        size=\"sm\"\n                        onClick={() => setAnalyticsFilterMode(\"daily\")}\n                        data-testid=\"button-analytics-filter-daily\"\n                      >\n                        {getLocalizedText(\"يومي\", \"Daily\", \"Quotidien\")}\n                      </Button>\n                      <Button \n                        variant={analyticsFilterMode === \"weekly\" ? \"default\" : \"ghost\"} \n                        size=\"sm\"\n                        onClick={() => setAnalyticsFilterMode(\"weekly\")}\n                        data-testid=\"button-analytics-filter-weekly\"\n                      >\n                        {getLocalizedText(\"أسبوعي\", \"Weekly\", \"Hebdomadaire\")}\n                      </Button>\n                      <Button \n                        variant={analyticsFilterMode === \"monthly\" ? \"default\" : \"ghost\"} \n                        size=\"sm\"\n                        onClick={() => setAnalyticsFilterMode(\"monthly\")}\n                        data-testid=\"button-analytics-filter-monthly\"\n                      >\n                        {getLocalizedText(\"شهري\", \"Monthly\", \"Mensuel\")}\n                      </Button>\n                      <Button \n                        variant={analyticsFilterMode === \"all\" ? \"default\" : \"ghost\"} \n                        size=\"sm\"\n                        onClick={() => setAnalyticsFilterMode(\"all\")}\n                        data-testid=\"button-analytics-filter-all\"\n                      >\n                        {getLocalizedText(\"الكل\", \"All\", \"Tout\")}\n                      </Button>\n                    </div>\n                    \n                    {/* Date Navigator - hidden when \"all\" is selected */}\n                    {analyticsFilterMode !== \"all\" && (\n                      <div className=\"flex items-center gap-2 bg-muted/50 rounded-lg p-1\">\n                        <Button \n                          variant=\"ghost\" \n                          size=\"icon\"\n                          onClick={() => {\n                            const d = new Date(analyticsDate);\n                            if (analyticsFilterMode === \"daily\") d.setDate(d.getDate() - 1);\n                            else if (analyticsFilterMode === \"weekly\") d.setDate(d.getDate() - 7);\n                            else if (analyticsFilterMode === \"monthly\") d.setMonth(d.getMonth() - 1);\n                            setAnalyticsDate(d.toISOString().split(\"T\")[0]);\n                          }}\n                          data-testid=\"button-analytics-prev-period\"\n                        >\n                          {i18n.language === \"ar\" ? <ChevronRight className=\"h-4 w-4\" /> : <ChevronLeft className=\"h-4 w-4\" />}\n                        </Button>\n                        <div className=\"flex items-center gap-2\">\n                          <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                          {analyticsFilterMode === \"monthly\" ? (\n                            <Input\n                              type=\"month\"\n                              value={analyticsDate.slice(0, 7)}\n                              onChange={(e) => setAnalyticsDate(e.target.value + \"-01\")}\n                              className=\"w-auto min-w-[140px]\"\n                              data-testid=\"input-analytics-month-filter\"\n                            />\n                          ) : (\n                            <Input\n                              type=\"date\"\n                              value={analyticsDate}\n                              onChange={(e) => setAnalyticsDate(e.target.value)}\n                              className=\"w-auto min-w-[140px]\"\n                              data-testid=\"input-analytics-date-filter\"\n                            />\n                          )}\n                        </div>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"icon\"\n                          onClick={() => {\n                            const d = new Date(analyticsDate);\n                            if (analyticsFilterMode === \"daily\") d.setDate(d.getDate() + 1);\n                            else if (analyticsFilterMode === \"weekly\") d.setDate(d.getDate() + 7);\n                            else if (analyticsFilterMode === \"monthly\") d.setMonth(d.getMonth() + 1);\n                            setAnalyticsDate(d.toISOString().split(\"T\")[0]);\n                          }}\n                          data-testid=\"button-analytics-next-period\"\n                        >\n                          {i18n.language === \"ar\" ? <ChevronLeft className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\n                        </Button>\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={() => setAnalyticsDate(new Date().toISOString().split(\"T\")[0])}\n                          data-testid=\"button-analytics-today\"\n                        >\n                          {getLocalizedText(\"اليوم\", \"Today\", \"Aujourd'hui\")}\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Period Label */}\n                <div className=\"text-lg font-medium text-muted-foreground\">\n                  {analyticsFilterMode === \"all\" ? (\n                    getLocalizedText(\"جميع الفترات\", \"All Time\", \"Toutes les Périodes\")\n                  ) : analyticsFilterMode === \"monthly\" ? (\n                    new Date(analyticsDate).toLocaleDateString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\", { month: \"long\", year: \"numeric\" })\n                  ) : analyticsFilterMode === \"weekly\" ? (\n                    (() => {\n                      const d = new Date(analyticsDate);\n                      const startOfWeek = new Date(d);\n                      startOfWeek.setDate(d.getDate() - d.getDay());\n                      const endOfWeek = new Date(startOfWeek);\n                      endOfWeek.setDate(startOfWeek.getDate() + 6);\n                      return `${startOfWeek.toLocaleDateString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\", { month: \"short\", day: \"numeric\" })} - ${endOfWeek.toLocaleDateString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\", { month: \"short\", day: \"numeric\" })}`;\n                    })()\n                  ) : (\n                    new Date(analyticsDate).toLocaleDateString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\", { weekday: \"long\", day: \"numeric\", month: \"long\", year: \"numeric\" })\n                  )}\n                </div>\n\n                {/* Main Stats Cards */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                  <Card>\n                    <CardContent className=\"pt-6 text-center\">\n                      <p className=\"text-3xl font-bold text-primary\">{filteredAnalytics.totalIncome.toFixed(3)}</p>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"إجمالي الدخل (د.ك)\", \"Total Income (KD)\", \"Revenu Total (KD)\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"pt-6 text-center\">\n                      <p className=\"text-3xl font-bold\">{filteredAnalytics.totalOrders}</p>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"إجمالي الطلبات\", \"Total Orders\", \"Total Commandes\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"pt-6 text-center\">\n                      <p className=\"text-3xl font-bold text-green-600\">{filteredAnalytics.completedOrders}</p>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"طلبات مكتملة\", \"Completed Orders\", \"Commandes Terminées\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"pt-6 text-center\">\n                      <p className=\"text-3xl font-bold text-red-600\">{filteredAnalytics.cancelledOrders}</p>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"طلبات ملغية\", \"Cancelled Orders\", \"Commandes Annulées\")}</p>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Additional Stats */}\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <Card>\n                    <CardContent className=\"pt-6 text-center\">\n                      <p className=\"text-3xl font-bold text-yellow-600\">{filteredAnalytics.pendingOrders}</p>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"طلبات قيد الانتظار\", \"Pending Orders\", \"Commandes en Attente\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"pt-6 text-center\">\n                      <p className=\"text-3xl font-bold text-blue-600\">{filteredAnalytics.inProgressOrders}</p>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"طلبات قيد التنفيذ\", \"In Progress\", \"En Cours\")}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"pt-6 text-center\">\n                      <p className=\"text-3xl font-bold text-purple-600\">{filteredAnalytics.averageOrderValue.toFixed(3)}</p>\n                      <p className=\"text-sm text-muted-foreground\">{getLocalizedText(\"متوسط قيمة الطلب (د.ك)\", \"Avg Order Value (KD)\", \"Valeur Moy. Commande (KD)\")}</p>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Completion Rate */}\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"text-lg\">{getLocalizedText(\"معدل الإنجاز\", \"Completion Rate\", \"Taux d'Achèvement\")}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex items-center gap-4\">\n                      <div className=\"flex-1 bg-muted rounded-full h-4 overflow-hidden\">\n                        <div \n                          className=\"bg-green-500 h-full transition-all duration-500\"\n                          style={{ \n                            width: `${filteredAnalytics.totalOrders > 0 ? (filteredAnalytics.completedOrders / filteredAnalytics.totalOrders) * 100 : 0}%` \n                          }}\n                        />\n                      </div>\n                      <span className=\"text-lg font-bold\">\n                        {filteredAnalytics.totalOrders > 0 \n                          ? Math.round((filteredAnalytics.completedOrders / filteredAnalytics.totalOrders) * 100) \n                          : 0}%\n                      </span>\n                    </div>\n                    <div className=\"flex justify-between mt-2 text-sm text-muted-foreground\">\n                      <span>{getLocalizedText(\"مكتمل\", \"Completed\", \"Terminé\")}: {filteredAnalytics.completedOrders}</span>\n                      <span>{getLocalizedText(\"إجمالي\", \"Total\", \"Total\")}: {filteredAnalytics.totalOrders}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n\n            {section === \"admins\" && isSuperAdmin && (\n              <AdminManagement \n                userId={user?.id || \"\"} \n                firebaseUser={firebaseUser}\n                getLocalizedText={getLocalizedText} \n              />\n            )}\n\n            {section === \"audit\" && isSuperAdmin && (\n              <div className=\"space-y-6\">\n                <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n                  <h1 className=\"text-2xl font-bold\">{t(\"admin.auditLogs\")}</h1>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={async () => {\n                        if (confirm(getLocalizedText(\n                          \"هل تريد حذف السجلات الأقدم من 30 يوم؟\",\n                          \"Delete logs older than 30 days?\",\n                          \"Supprimer les logs de plus de 30 jours?\"\n                        ))) {\n                          try {\n                            const res = await fetch(\"/api/admin/audit-logs?olderThanDays=30\", {\n                              method: \"DELETE\",\n                              headers: { \"Authorization\": `Bearer ${await firebaseUser?.getIdToken()}` },\n                            });\n                            const data = await res.json();\n                            if (res.ok) {\n                              toast({ title: getLocalizedText(`تم حذف ${data.deletedCount} سجل`, `Deleted ${data.deletedCount} logs`, `${data.deletedCount} logs supprimés`) });\n                              queryClient.invalidateQueries({ queryKey: [\"/api/admin/audit-logs\"] });\n                            }\n                          } catch (e) {\n                            toast({ title: getLocalizedText(\"خطأ\", \"Error\", \"Erreur\"), variant: \"destructive\" });\n                          }\n                        }\n                      }}\n                      data-testid=\"clear-old-logs-btn\"\n                    >\n                      <Trash2 className=\"h-4 w-4 me-2\" />\n                      {getLocalizedText(\"حذف +30 يوم\", \"Clear 30+ days\", \"Suppr. +30 jours\")}\n                    </Button>\n                    <Button\n                      variant=\"destructive\"\n                      onClick={async () => {\n                        if (confirm(getLocalizedText(\n                          \"هل أنت متأكد؟ سيتم حذف جميع سجلات العمليات!\",\n                          \"Are you sure? This will delete ALL audit logs!\",\n                          \"Êtes-vous sûr? Cela supprimera TOUS les logs!\"\n                        ))) {\n                          try {\n                            const res = await fetch(\"/api/admin/audit-logs?clearAll=true\", {\n                              method: \"DELETE\",\n                              headers: { \"Authorization\": `Bearer ${await firebaseUser?.getIdToken()}` },\n                            });\n                            const data = await res.json();\n                            if (res.ok) {\n                              toast({ title: getLocalizedText(`تم حذف ${data.deletedCount} سجل`, `Deleted ${data.deletedCount} logs`, `${data.deletedCount} logs supprimés`) });\n                              queryClient.invalidateQueries({ queryKey: [\"/api/admin/audit-logs\"] });\n                            }\n                          } catch (e) {\n                            toast({ title: getLocalizedText(\"خطأ\", \"Error\", \"Erreur\"), variant: \"destructive\" });\n                          }\n                        }\n                      }}\n                      data-testid=\"clear-all-logs-btn\"\n                    >\n                      <Trash2 className=\"h-4 w-4 me-2\" />\n                      {getLocalizedText(\"حذف الكل\", \"Clear All\", \"Supprimer tout\")}\n                    </Button>\n                  </div>\n                </div>\n                <Card>\n                  <CardContent className=\"pt-6\">\n                    {auditLogsLoading ? (\n                      <div className=\"space-y-2\">\n                        {[1, 2, 3, 4, 5].map(i => <Skeleton key={i} className=\"h-12 w-full\" />)}\n                      </div>\n                    ) : auditLogs?.length ? (\n                      <div className=\"space-y-2\">\n                        {auditLogs.map((log) => (\n                          <div key={log.id} className=\"p-3 rounded-lg border text-sm\" data-testid={`audit-log-${log.id}`}>\n                            <div className=\"flex items-center justify-between mb-1\">\n                              <Badge variant=\"outline\">{log.actionType}</Badge>\n                              <span className=\"text-muted-foreground\">\n                                {new Date(log.performedAt).toLocaleString(i18n.language)}\n                              </span>\n                            </div>\n                            <p className=\"text-muted-foreground\">\n                              {log.targetCollection} / {log.targetId.slice(0, 8)}\n                            </p>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <p className=\"text-muted-foreground text-center py-8\">{t(\"common.noData\")}</p>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Points Adjustment Dialog\nfunction PointsAdjustDialog({ \n  customerId, \n  customerName, \n  currentPoints, \n  onAdjust \n}: { \n  customerId: string; \n  customerName: string; \n  currentPoints: number; \n  onAdjust: (points: number, note: string) => void;\n}) {\n  const [points, setPoints] = useState(0);\n  const [note, setNote] = useState(\"\");\n  const [open, setOpen] = useState(false);\n\n  const handleSubmit = () => {\n    if (points !== 0) {\n      onAdjust(points, note);\n      setOpen(false);\n      setPoints(0);\n      setNote(\"\");\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button size=\"sm\" variant=\"outline\">\n          <Gift className=\"h-4 w-4\" />\n        </Button>\n      </DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Adjust Points: {customerName}</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-4\">\n          <p className=\"text-sm text-muted-foreground\">Current Points: {currentPoints}</p>\n          <div className=\"space-y-2\">\n            <Label>Points Change (+ or -)</Label>\n            <Input\n              type=\"number\"\n              value={points}\n              onChange={(e) => setPoints(parseInt(e.target.value) || 0)}\n              placeholder=\"e.g., 100 or -50\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>Note</Label>\n            <Input\n              value={note}\n              onChange={(e) => setNote(e.target.value)}\n              placeholder=\"Reason for adjustment\"\n            />\n          </div>\n          <Button onClick={handleSubmit} className=\"w-full\">\n            <Save className=\"h-4 w-4 me-2\" />\n            Save Adjustment\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Loyalty Config Editor\nfunction LoyaltyConfigEditor({\n  config,\n  onSave,\n  isPending,\n  getLocalizedText,\n}: {\n  config: LoyaltyConfig;\n  onSave: (data: Partial<LoyaltyConfig>) => void;\n  isPending: boolean;\n  getLocalizedText: (ar: string, en: string, fr: string) => string;\n}) {\n  const [formData, setFormData] = useState({\n    pointsPerKD: config.pointsPerKD,\n    conversionRate: config.conversionRate,\n    maxRedeemPercentage: config.maxRedeemPercentage * 100,\n    welcomeBonusPoints: config.welcomeBonusPoints,\n    referrerBonusPoints: config.referrerBonusPoints,\n    referredWelcomePoints: config.referredWelcomePoints,\n    firstOrderDiscount: config.firstOrderDiscount * 100,\n  });\n\n  const handleSave = () => {\n    onSave({\n      pointsPerKD: formData.pointsPerKD,\n      conversionRate: formData.conversionRate,\n      maxRedeemPercentage: formData.maxRedeemPercentage / 100,\n      welcomeBonusPoints: formData.welcomeBonusPoints,\n      referrerBonusPoints: formData.referrerBonusPoints,\n      referredWelcomePoints: formData.referredWelcomePoints,\n      firstOrderDiscount: formData.firstOrderDiscount / 100,\n    });\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>{getLocalizedText(\"إعدادات برنامج الولاء\", \"Loyalty Program Settings\", \"Paramètres du Programme de Fidélité\")}</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div className=\"space-y-2\">\n            <Label>{getLocalizedText(\"نقاط لكل دينار\", \"Points per KD\", \"Points par KD\")}</Label>\n            <Input\n              type=\"number\"\n              value={formData.pointsPerKD}\n              onChange={(e) => setFormData({ ...formData, pointsPerKD: parseInt(e.target.value) || 0 })}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>{getLocalizedText(\"معدل التحويل (دينار/نقطة)\", \"Conversion Rate (KD/point)\", \"Taux de Conversion (KD/point)\")}</Label>\n            <Input\n              type=\"number\"\n              step=\"0.001\"\n              value={formData.conversionRate}\n              onChange={(e) => setFormData({ ...formData, conversionRate: parseFloat(e.target.value) || 0 })}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>{getLocalizedText(\"الحد الأقصى للاستخدام (%)\", \"Max Redeem (%)\", \"Max Utilisation (%)\")}</Label>\n            <Input\n              type=\"number\"\n              value={formData.maxRedeemPercentage}\n              onChange={(e) => setFormData({ ...formData, maxRedeemPercentage: parseInt(e.target.value) || 0 })}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>{getLocalizedText(\"نقاط الترحيب\", \"Welcome Bonus\", \"Bonus de Bienvenue\")}</Label>\n            <Input\n              type=\"number\"\n              value={formData.welcomeBonusPoints}\n              onChange={(e) => setFormData({ ...formData, welcomeBonusPoints: parseInt(e.target.value) || 0 })}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>{getLocalizedText(\"مكافأة المُحيل\", \"Referrer Bonus\", \"Bonus Parrain\")}</Label>\n            <Input\n              type=\"number\"\n              value={formData.referrerBonusPoints}\n              onChange={(e) => setFormData({ ...formData, referrerBonusPoints: parseInt(e.target.value) || 0 })}\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label>{getLocalizedText(\"مكافأة المُحال\", \"Referred Bonus\", \"Bonus Filleul\")}</Label>\n            <Input\n              type=\"number\"\n              value={formData.referredWelcomePoints}\n              onChange={(e) => setFormData({ ...formData, referredWelcomePoints: parseInt(e.target.value) || 0 })}\n            />\n          </div>\n        </div>\n        <Button onClick={handleSave} disabled={isPending}>\n          <Save className=\"h-4 w-4 me-2\" />\n          {isPending ? getLocalizedText(\"جاري الحفظ...\", \"Saving...\", \"Enregistrement...\") : getLocalizedText(\"حفظ الإعدادات\", \"Save Settings\", \"Enregistrer\")}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n\n// Admin Management Component (Super Admin only)\nfunction AdminManagement({\n  userId,\n  firebaseUser,\n  getLocalizedText,\n}: {\n  userId: string;\n  firebaseUser: any;\n  getLocalizedText: (ar: string, en: string, fr: string) => string;\n}) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [showAddForm, setShowAddForm] = useState(false);\n  const [editingAdmin, setEditingAdmin] = useState<User | null>(null);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    phone: \"\",\n    role: \"delegate\",\n    password: \"\",\n  });\n\n  const getAuthHeaders = async (): Promise<Record<string, string>> => {\n    if (!firebaseUser) {\n      throw new Error(\"Not authenticated\");\n    }\n    const token = await firebaseUser.getIdToken();\n    return { Authorization: `Bearer ${token}` };\n  };\n\n  const { data: admins, isLoading, error: adminsError } = useQuery<User[]>({\n    queryKey: [\"/api/admin/admins\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/admin/admins\", { headers });\n      if (!res.ok) {\n        if (res.status === 401 || res.status === 403) {\n          throw new Error(\"Authentication required. Please sign in again.\");\n        }\n        throw new Error(\"Failed to fetch admins\");\n      }\n      return res.json();\n    },\n    enabled: !!firebaseUser,\n  });\n\n  const createAdminMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/admin/admins\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\", ...headers },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) {\n        const err = await res.json();\n        throw new Error(err.error || \"Failed to create admin\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/admins\"] });\n      toast({ title: getLocalizedText(\"تم إنشاء المشرف\", \"Admin created\", \"Administrateur créé\") });\n      setShowAddForm(false);\n      resetForm();\n    },\n    onError: (error: Error) => {\n      toast({ title: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateAdminMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<User> }) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/admin/admins/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\", ...headers },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) {\n        const err = await res.json();\n        throw new Error(err.error || \"Failed to update admin\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/admins\"] });\n      toast({ title: getLocalizedText(\"تم تحديث المشرف\", \"Admin updated\", \"Administrateur mis à jour\") });\n      setEditingAdmin(null);\n    },\n    onError: (error: Error) => {\n      toast({ title: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteAdminMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/admin/admins/${id}`, {\n        method: \"DELETE\",\n        headers,\n      });\n      if (!res.ok) {\n        const err = await res.json();\n        throw new Error(err.error || \"Failed to deactivate admin\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/admins\"] });\n      toast({ title: getLocalizedText(\"تم إلغاء تفعيل المشرف\", \"Admin deactivated\", \"Administrateur désactivé\") });\n    },\n    onError: (error: Error) => {\n      toast({ title: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({ name: \"\", email: \"\", phone: \"\", role: \"admin\", password: \"\" });\n  };\n\n  const handleSubmit = () => {\n    if (!formData.name || !formData.email) {\n      toast({ title: getLocalizedText(\"الاسم والإيميل مطلوبان\", \"Name and email are required\", \"Nom et email requis\"), variant: \"destructive\" });\n      return;\n    }\n    createAdminMutation.mutate(formData);\n  };\n\n  const handleUpdate = () => {\n    if (!editingAdmin) return;\n    updateAdminMutation.mutate({\n      id: editingAdmin.id,\n      data: {\n        name: formData.name,\n        phone: formData.phone,\n        role: formData.role as \"admin\" | \"super_admin\" | \"customer\",\n        status: editingAdmin.status,\n      },\n    });\n  };\n\n  const getRoleBadge = (role: string) => {\n    const colors: Record<string, string> = {\n      super_admin: \"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400\",\n      admin: \"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400\",\n      delegate: \"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\",\n      customer: \"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400\",\n    };\n    const labels: Record<string, string> = {\n      super_admin: getLocalizedText(\"سوبر أدمن\", \"Super Admin\", \"Super Admin\"),\n      admin: getLocalizedText(\"مشرف\", \"Admin\", \"Admin\"),\n      delegate: getLocalizedText(\"مندوب\", \"Delegate\", \"Délégué\"),\n      customer: getLocalizedText(\"عميل\", \"Customer\", \"Client\"),\n    };\n    return <span className={`px-2 py-1 rounded-full text-xs font-medium ${colors[role] || colors.customer}`}>{labels[role] || role}</span>;\n  };\n\n  if (!firebaseUser) {\n    return (\n      <div className=\"space-y-6\">\n        <h1 className=\"text-2xl font-bold\">{t(\"admin.admins\")}</h1>\n        <Card>\n          <CardContent className=\"p-8 text-center\">\n            <p className=\"text-muted-foreground\">\n              {getLocalizedText(\"جارٍ التحميل...\", \"Loading...\", \"Chargement...\")}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (adminsError) {\n    return (\n      <div className=\"space-y-6\">\n        <h1 className=\"text-2xl font-bold\">{t(\"admin.admins\")}</h1>\n        <Card>\n          <CardContent className=\"p-8 text-center\">\n            <p className=\"text-destructive\">\n              {getLocalizedText(\"فشل تحميل المشرفين\", \"Failed to load admins\", \"Échec du chargement\")}\n            </p>\n            <p className=\"text-muted-foreground text-sm mt-2\">\n              {(adminsError as Error).message}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <h1 className=\"text-2xl font-bold\">{t(\"admin.admins\")}</h1>\n        <Button onClick={() => { setShowAddForm(true); setEditingAdmin(null); resetForm(); }} data-testid=\"add-admin-btn\">\n          <Plus className=\"h-4 w-4 me-2\" />\n          {getLocalizedText(\"إضافة مشرف\", \"Add Admin\", \"Ajouter Admin\")}\n        </Button>\n      </div>\n\n      {(showAddForm || editingAdmin) && (\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2\">\n            <CardTitle>\n              {editingAdmin \n                ? getLocalizedText(\"تعديل المشرف\", \"Edit Admin\", \"Modifier Admin\")\n                : getLocalizedText(\"إضافة مشرف جديد\", \"Add New Admin\", \"Ajouter Nouvel Admin\")\n              }\n            </CardTitle>\n            <Button size=\"icon\" variant=\"ghost\" onClick={() => { setShowAddForm(false); setEditingAdmin(null); resetForm(); }}>\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"الاسم الكامل\", \"Full Name\", \"Nom Complet\")} *</Label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder={getLocalizedText(\"أدخل الاسم\", \"Enter name\", \"Entrez le nom\")}\n                  data-testid=\"input-admin-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"البريد الإلكتروني\", \"Email\", \"Email\")} *</Label>\n                <Input\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  placeholder=\"admin@example.com\"\n                  disabled={!!editingAdmin}\n                  data-testid=\"input-admin-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"رقم الهاتف\", \"Phone\", \"Téléphone\")}</Label>\n                <Input\n                  value={formData.phone}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  placeholder=\"+965 XXXX XXXX\"\n                  data-testid=\"input-admin-phone\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"الدور\", \"Role\", \"Rôle\")}</Label>\n                <Select\n                  value={formData.role}\n                  onValueChange={(value) => setFormData({ ...formData, role: value })}\n                >\n                  <SelectTrigger data-testid=\"select-admin-role\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"delegate\">{getLocalizedText(\"مندوب\", \"Delegate\", \"Délégué\")}</SelectItem>\n                    <SelectItem value=\"admin\">{getLocalizedText(\"مشرف\", \"Admin\", \"Admin\")}</SelectItem>\n                    <SelectItem value=\"super_admin\">{getLocalizedText(\"سوبر أدمن\", \"Super Admin\", \"Super Admin\")}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              {!editingAdmin && (\n                <div className=\"space-y-2 md:col-span-2\">\n                  <Label>{getLocalizedText(\"كلمة المرور الابتدائية\", \"Initial Password\", \"Mot de passe initial\")}</Label>\n                  <Input\n                    type=\"password\"\n                    value={formData.password}\n                    onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                    placeholder={getLocalizedText(\"اتركه فارغاً لتوليد كلمة مرور تلقائية\", \"Leave empty for auto-generated password\", \"Laisser vide pour mot de passe auto-généré\")}\n                    data-testid=\"input-admin-password\"\n                  />\n                </div>\n              )}\n            </div>\n            <div className=\"flex gap-2\">\n              <Button \n                onClick={editingAdmin ? handleUpdate : handleSubmit} \n                disabled={createAdminMutation.isPending || updateAdminMutation.isPending}\n                data-testid=\"btn-save-admin\"\n              >\n                <Save className=\"h-4 w-4 me-2\" />\n                {(createAdminMutation.isPending || updateAdminMutation.isPending) \n                  ? getLocalizedText(\"جاري الحفظ...\", \"Saving...\", \"Enregistrement...\")\n                  : getLocalizedText(\"حفظ\", \"Save\", \"Enregistrer\")\n                }\n              </Button>\n              <Button variant=\"outline\" onClick={() => { setShowAddForm(false); setEditingAdmin(null); resetForm(); }}>\n                {getLocalizedText(\"إلغاء\", \"Cancel\", \"Annuler\")}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>{getLocalizedText(\"قائمة المشرفين\", \"Admins List\", \"Liste des Administrateurs\")}</CardTitle>\n          <CardDescription>\n            {getLocalizedText(\n              \"إدارة جميع حسابات المشرفين في النظام\",\n              \"Manage all admin accounts in the system\",\n              \"Gérer tous les comptes administrateurs\"\n            )}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-2\">\n              {[1, 2, 3].map(i => <Skeleton key={i} className=\"h-16 w-full\" />)}\n            </div>\n          ) : admins?.length ? (\n            <div className=\"space-y-3\">\n              {admins.map((admin) => (\n                <div \n                  key={admin.id} \n                  className=\"flex flex-col md:flex-row md:items-center justify-between p-4 rounded-lg border gap-4\"\n                  data-testid={`admin-row-${admin.id}`}\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n                      <span className=\"font-medium\">{admin.name}</span>\n                      {getRoleBadge(admin.role)}\n                      <Badge variant={admin.status === \"active\" ? \"default\" : \"destructive\"} className=\"text-xs\">\n                        {admin.status === \"active\" \n                          ? getLocalizedText(\"نشط\", \"Active\", \"Actif\")\n                          : getLocalizedText(\"محظور\", \"Blocked\", \"Bloqué\")\n                        }\n                      </Badge>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">{admin.email}</p>\n                    {admin.phone && <p className=\"text-sm text-muted-foreground\">{admin.phone}</p>}\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {getLocalizedText(\"تاريخ الإنشاء:\", \"Created:\", \"Créé le:\")} {new Date(admin.createdAt).toLocaleDateString()}\n                    </p>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {admin.id !== userId && (\n                      <>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => {\n                            setEditingAdmin(admin);\n                            setFormData({\n                              name: admin.name,\n                              email: admin.email,\n                              phone: admin.phone || \"\",\n                              role: admin.role,\n                              password: \"\",\n                            });\n                            setShowAddForm(false);\n                          }}\n                          data-testid={`edit-admin-${admin.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant={admin.status === \"active\" ? \"destructive\" : \"default\"}\n                          onClick={() => {\n                            if (admin.status === \"active\") {\n                              if (confirm(getLocalizedText(\n                                \"هل أنت متأكد من إلغاء تفعيل هذا المشرف؟\",\n                                \"Are you sure you want to deactivate this admin?\",\n                                \"Êtes-vous sûr de vouloir désactiver cet administrateur?\"\n                              ))) {\n                                deleteAdminMutation.mutate(admin.id);\n                              }\n                            } else {\n                              updateAdminMutation.mutate({\n                                id: admin.id,\n                                data: { status: \"active\" },\n                              });\n                            }\n                          }}\n                          data-testid={`toggle-admin-${admin.id}`}\n                        >\n                          {admin.status === \"active\" ? <Ban className=\"h-4 w-4\" /> : <CheckCircle className=\"h-4 w-4\" />}\n                        </Button>\n                      </>\n                    )}\n                    {admin.id === userId && (\n                      <Badge variant=\"outline\">{getLocalizedText(\"أنت\", \"You\", \"Vous\")}</Badge>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <p className=\"text-muted-foreground text-center py-8\">{t(\"common.noData\")}</p>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nfunction ContentBlogManager({ getLocalizedText, firebaseUser }: { getLocalizedText: (ar: string, en: string, fr: string) => string; firebaseUser: any }) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [showForm, setShowForm] = useState(false);\n  const [editing, setEditing] = useState<any>(null);\n  const [form, setForm] = useState({\n    titleAr: \"\", titleEn: \"\", titleFr: \"\",\n    contentAr: \"\", contentEn: \"\", contentFr: \"\",\n    imageUrl: \"\", isPublished: true\n  });\n\n  const getAuthHeaders = async () => {\n    if (!firebaseUser) throw new Error(\"Not authenticated\");\n    const token = await firebaseUser.getIdToken();\n    return { Authorization: `Bearer ${token}` };\n  };\n\n  const { data: posts, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/admin/blog\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/admin/blog\", { headers });\n      if (!res.ok) throw new Error(\"Failed to fetch\");\n      return res.json();\n    }\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof form) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/admin/blog\", {\n        method: \"POST\", headers: { \"Content-Type\": \"application/json\", ...headers }, body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to create\");\n      return res.json();\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/blog\"] }); toast({ title: getLocalizedText(\"تم الإنشاء\", \"Created\", \"Créé\") }); resetForm(); }\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<typeof form> }) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/admin/blog/${id}`, {\n        method: \"PATCH\", headers: { \"Content-Type\": \"application/json\", ...headers }, body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to update\");\n      return res.json();\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/blog\"] }); toast({ title: getLocalizedText(\"تم التحديث\", \"Updated\", \"Mis à jour\") }); resetForm(); }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/admin/blog/${id}`, { method: \"DELETE\", headers });\n      if (!res.ok) throw new Error(\"Failed to delete\");\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/blog\"] }); toast({ title: getLocalizedText(\"تم الحذف\", \"Deleted\", \"Supprimé\") }); }\n  });\n\n  const resetForm = () => {\n    setForm({ titleAr: \"\", titleEn: \"\", titleFr: \"\", contentAr: \"\", contentEn: \"\", contentFr: \"\", imageUrl: \"\", isPublished: true });\n    setEditing(null);\n    setShowForm(false);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{getLocalizedText(\"إدارة المدونة\", \"Blog Management\", \"Gestion du Blog\")}</h1>\n        <Button onClick={() => { resetForm(); setShowForm(true); }} data-testid=\"button-add-blog\">\n          <Plus className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n          {getLocalizedText(\"إضافة مقال\", \"Add Article\", \"Ajouter un article\")}\n        </Button>\n      </div>\n\n      {(showForm || editing) && (\n        <Card>\n          <CardHeader>\n            <CardTitle>{editing ? getLocalizedText(\"تعديل المقال\", \"Edit Article\", \"Modifier l'article\") : getLocalizedText(\"إضافة مقال جديد\", \"Add New Article\", \"Ajouter un nouvel article\")}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"العنوان (عربي)\", \"Title (Arabic)\", \"Titre (Arabe)\")}</Label>\n                <Input value={form.titleAr} onChange={(e) => setForm({ ...form, titleAr: e.target.value })} data-testid=\"input-blog-title-ar\" />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"العنوان (إنجليزي)\", \"Title (English)\", \"Titre (Anglais)\")}</Label>\n                <Input value={form.titleEn} onChange={(e) => setForm({ ...form, titleEn: e.target.value })} data-testid=\"input-blog-title-en\" />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"العنوان (فرنسي)\", \"Title (French)\", \"Titre (Français)\")}</Label>\n                <Input value={form.titleFr} onChange={(e) => setForm({ ...form, titleFr: e.target.value })} data-testid=\"input-blog-title-fr\" />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{getLocalizedText(\"المحتوى (عربي)\", \"Content (Arabic)\", \"Contenu (Arabe)\")}</Label>\n              <textarea className=\"w-full min-h-[100px] p-2 border rounded-md bg-background\" value={form.contentAr} onChange={(e) => setForm({ ...form, contentAr: e.target.value })} data-testid=\"input-blog-content-ar\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{getLocalizedText(\"المحتوى (إنجليزي)\", \"Content (English)\", \"Contenu (Anglais)\")}</Label>\n              <textarea className=\"w-full min-h-[100px] p-2 border rounded-md bg-background\" value={form.contentEn} onChange={(e) => setForm({ ...form, contentEn: e.target.value })} data-testid=\"input-blog-content-en\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{getLocalizedText(\"المحتوى (فرنسي)\", \"Content (French)\", \"Contenu (Français)\")}</Label>\n              <textarea className=\"w-full min-h-[100px] p-2 border rounded-md bg-background\" value={form.contentFr} onChange={(e) => setForm({ ...form, contentFr: e.target.value })} data-testid=\"input-blog-content-fr\" />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{getLocalizedText(\"رابط الصورة\", \"Image URL\", \"URL de l'image\")}</Label>\n              <Input value={form.imageUrl} onChange={(e) => setForm({ ...form, imageUrl: e.target.value })} data-testid=\"input-blog-image\" />\n            </div>\n            <div className=\"flex items-center gap-4 flex-wrap\">\n              <Button onClick={() => editing ? updateMutation.mutate({ id: editing.id, data: form }) : createMutation.mutate(form)} disabled={createMutation.isPending || updateMutation.isPending} data-testid=\"button-save-blog\">\n                <Save className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                {getLocalizedText(\"حفظ\", \"Save\", \"Enregistrer\")}\n              </Button>\n              <Button variant=\"outline\" onClick={resetForm} data-testid=\"button-cancel-blog\">\n                <X className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                {getLocalizedText(\"إلغاء\", \"Cancel\", \"Annuler\")}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {isLoading ? (\n        <div className=\"space-y-4\">{[1,2,3].map(i => <Skeleton key={i} className=\"h-24\" />)}</div>\n      ) : posts && posts.length > 0 ? (\n        <div className=\"space-y-4\">\n          {posts.map((post: any) => (\n            <Card key={post.id}>\n              <CardContent className=\"pt-4\">\n                <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                  <div className=\"flex-1 min-w-0\">\n                    <h3 className=\"font-medium\">{getLocalizedText(post.titleAr, post.titleEn, post.titleFr)}</h3>\n                    <p className=\"text-sm text-muted-foreground line-clamp-2\">{getLocalizedText(post.contentAr, post.contentEn, post.contentFr)}</p>\n                    <Badge variant={post.isPublished ? \"default\" : \"secondary\"} className=\"mt-2\">\n                      {post.isPublished ? getLocalizedText(\"منشور\", \"Published\", \"Publié\") : getLocalizedText(\"مسودة\", \"Draft\", \"Brouillon\")}\n                    </Badge>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button size=\"icon\" variant=\"outline\" onClick={() => { setEditing(post); setForm({ titleAr: post.titleAr, titleEn: post.titleEn, titleFr: post.titleFr, contentAr: post.contentAr, contentEn: post.contentEn, contentFr: post.contentFr, imageUrl: post.imageUrl || \"\", isPublished: post.isPublished }); }} data-testid={`edit-blog-${post.id}`}>\n                      <Pencil className=\"h-4 w-4\" />\n                    </Button>\n                    <Button size=\"icon\" variant=\"destructive\" onClick={() => { if (confirm(getLocalizedText(\"هل أنت متأكد؟\", \"Are you sure?\", \"Êtes-vous sûr?\"))) deleteMutation.mutate(post.id); }} data-testid={`delete-blog-${post.id}`}>\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <p className=\"text-muted-foreground text-center py-8\">{t(\"common.noData\")}</p>\n      )}\n    </div>\n  );\n}\n\nfunction ContentTestimonialsManager({ getLocalizedText, firebaseUser }: { getLocalizedText: (ar: string, en: string, fr: string) => string; firebaseUser: any }) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [showForm, setShowForm] = useState(false);\n  const [editing, setEditing] = useState<any>(null);\n  const [form, setForm] = useState({ customerName: \"\", contentAr: \"\", contentEn: \"\", contentFr: \"\", rating: 5, imageUrl: \"\", isApproved: true });\n\n  const getAuthHeaders = async () => {\n    if (!firebaseUser) throw new Error(\"Not authenticated\");\n    const token = await firebaseUser.getIdToken();\n    return { Authorization: `Bearer ${token}` };\n  };\n\n  const { data: items, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/admin/testimonials\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/admin/testimonials\", { headers });\n      if (!res.ok) throw new Error(\"Failed to fetch\");\n      return res.json();\n    }\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof form) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/admin/testimonials\", {\n        method: \"POST\", headers: { \"Content-Type\": \"application/json\", ...headers }, body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to create\");\n      return res.json();\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/testimonials\"] }); toast({ title: getLocalizedText(\"تم الإنشاء\", \"Created\", \"Créé\") }); resetForm(); }\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<typeof form> }) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/admin/testimonials/${id}`, {\n        method: \"PATCH\", headers: { \"Content-Type\": \"application/json\", ...headers }, body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to update\");\n      return res.json();\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/testimonials\"] }); toast({ title: getLocalizedText(\"تم التحديث\", \"Updated\", \"Mis à jour\") }); resetForm(); }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/admin/testimonials/${id}`, { method: \"DELETE\", headers });\n      if (!res.ok) throw new Error(\"Failed to delete\");\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/testimonials\"] }); toast({ title: getLocalizedText(\"تم الحذف\", \"Deleted\", \"Supprimé\") }); }\n  });\n\n  const resetForm = () => { setForm({ customerName: \"\", contentAr: \"\", contentEn: \"\", contentFr: \"\", rating: 5, imageUrl: \"\", isApproved: true }); setEditing(null); setShowForm(false); };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{getLocalizedText(\"إدارة الشهادات\", \"Testimonials Management\", \"Gestion des Témoignages\")}</h1>\n        <Button onClick={() => { resetForm(); setShowForm(true); }} data-testid=\"button-add-testimonial\">\n          <Plus className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n          {getLocalizedText(\"إضافة شهادة\", \"Add Testimonial\", \"Ajouter un témoignage\")}\n        </Button>\n      </div>\n\n      {(showForm || editing) && (\n        <Card>\n          <CardHeader>\n            <CardTitle>{editing ? getLocalizedText(\"تعديل الشهادة\", \"Edit Testimonial\", \"Modifier le témoignage\") : getLocalizedText(\"إضافة شهادة جديدة\", \"Add New Testimonial\", \"Ajouter un nouveau témoignage\")}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"اسم العميل\", \"Customer Name\", \"Nom du client\")}</Label>\n                <Input value={form.customerName} onChange={(e) => setForm({ ...form, customerName: e.target.value })} data-testid=\"input-testimonial-name\" />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"التقييم\", \"Rating\", \"Note\")}</Label>\n                <Select value={String(form.rating)} onValueChange={(v) => setForm({ ...form, rating: Number(v) })}>\n                  <SelectTrigger><SelectValue /></SelectTrigger>\n                  <SelectContent>\n                    {[5,4,3,2,1].map(n => <SelectItem key={n} value={String(n)}>{n} / 5</SelectItem>)}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{getLocalizedText(\"المحتوى (عربي)\", \"Content (Arabic)\", \"Contenu (Arabe)\")}</Label>\n              <textarea className=\"w-full min-h-[80px] p-2 border rounded-md bg-background\" value={form.contentAr} onChange={(e) => setForm({ ...form, contentAr: e.target.value })} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{getLocalizedText(\"المحتوى (إنجليزي)\", \"Content (English)\", \"Contenu (Anglais)\")}</Label>\n              <textarea className=\"w-full min-h-[80px] p-2 border rounded-md bg-background\" value={form.contentEn} onChange={(e) => setForm({ ...form, contentEn: e.target.value })} />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>{getLocalizedText(\"المحتوى (فرنسي)\", \"Content (French)\", \"Contenu (Français)\")}</Label>\n              <textarea className=\"w-full min-h-[80px] p-2 border rounded-md bg-background\" value={form.contentFr} onChange={(e) => setForm({ ...form, contentFr: e.target.value })} />\n            </div>\n            <div className=\"flex items-center gap-4 flex-wrap\">\n              <Button onClick={() => editing ? updateMutation.mutate({ id: editing.id, data: form }) : createMutation.mutate(form)} disabled={createMutation.isPending || updateMutation.isPending} data-testid=\"button-save-testimonial\">\n                <Save className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                {getLocalizedText(\"حفظ\", \"Save\", \"Enregistrer\")}\n              </Button>\n              <Button variant=\"outline\" onClick={resetForm} data-testid=\"button-cancel-testimonial\">\n                <X className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                {getLocalizedText(\"إلغاء\", \"Cancel\", \"Annuler\")}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {isLoading ? (\n        <div className=\"space-y-4\">{[1,2,3].map(i => <Skeleton key={i} className=\"h-24\" />)}</div>\n      ) : items && items.length > 0 ? (\n        <div className=\"space-y-4\">\n          {items.map((item: any) => (\n            <Card key={item.id}>\n              <CardContent className=\"pt-4\">\n                <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                  <div className=\"flex-1 min-w-0\">\n                    <h3 className=\"font-medium\">{item.customerName}</h3>\n                    <p className=\"text-sm text-muted-foreground\">{getLocalizedText(item.contentAr, item.contentEn, item.contentFr)}</p>\n                    <div className=\"flex items-center gap-2 mt-2\">\n                      <Badge variant={item.isApproved ? \"default\" : \"secondary\"}>{item.isApproved ? getLocalizedText(\"معتمد\", \"Approved\", \"Approuvé\") : getLocalizedText(\"قيد المراجعة\", \"Pending\", \"En attente\")}</Badge>\n                      <Badge variant=\"outline\">{item.rating}/5</Badge>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button size=\"icon\" variant=\"outline\" onClick={() => { setEditing(item); setForm({ customerName: item.customerName, contentAr: item.contentAr, contentEn: item.contentEn, contentFr: item.contentFr, rating: item.rating, imageUrl: item.imageUrl || \"\", isApproved: item.isApproved }); }}>\n                      <Pencil className=\"h-4 w-4\" />\n                    </Button>\n                    <Button size=\"icon\" variant=\"destructive\" onClick={() => { if (confirm(getLocalizedText(\"هل أنت متأكد؟\", \"Are you sure?\", \"Êtes-vous sûr?\"))) deleteMutation.mutate(item.id); }}>\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <p className=\"text-muted-foreground text-center py-8\">{t(\"common.noData\")}</p>\n      )}\n    </div>\n  );\n}\n\nfunction ContentGalleryManager({ getLocalizedText, firebaseUser }: { getLocalizedText: (ar: string, en: string, fr: string) => string; firebaseUser: any }) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [showForm, setShowForm] = useState(false);\n  const [editing, setEditing] = useState<any>(null);\n  const [form, setForm] = useState({ beforeImageUrl: \"\", afterImageUrl: \"\", captionAr: \"\", captionEn: \"\", captionFr: \"\", isPublished: true });\n\n  const getAuthHeaders = async () => {\n    if (!firebaseUser) throw new Error(\"Not authenticated\");\n    const token = await firebaseUser.getIdToken();\n    return { Authorization: `Bearer ${token}` };\n  };\n\n  const { data: items, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/admin/gallery\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/admin/gallery\", { headers });\n      if (!res.ok) throw new Error(\"Failed to fetch\");\n      return res.json();\n    }\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof form) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/admin/gallery\", {\n        method: \"POST\", headers: { \"Content-Type\": \"application/json\", ...headers }, body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to create\");\n      return res.json();\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/gallery\"] }); toast({ title: getLocalizedText(\"تم الإنشاء\", \"Created\", \"Créé\") }); resetForm(); }\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<typeof form> }) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/admin/gallery/${id}`, {\n        method: \"PATCH\", headers: { \"Content-Type\": \"application/json\", ...headers }, body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to update\");\n      return res.json();\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/gallery\"] }); toast({ title: getLocalizedText(\"تم التحديث\", \"Updated\", \"Mis à jour\") }); resetForm(); }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/admin/gallery/${id}`, { method: \"DELETE\", headers });\n      if (!res.ok) throw new Error(\"Failed to delete\");\n    },\n    onSuccess: () => { queryClient.invalidateQueries({ queryKey: [\"/api/admin/gallery\"] }); toast({ title: getLocalizedText(\"تم الحذف\", \"Deleted\", \"Supprimé\") }); }\n  });\n\n  const resetForm = () => { setForm({ beforeImageUrl: \"\", afterImageUrl: \"\", captionAr: \"\", captionEn: \"\", captionFr: \"\", isPublished: true }); setEditing(null); setShowForm(false); };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{getLocalizedText(\"إدارة المعرض\", \"Gallery Management\", \"Gestion de la Galerie\")}</h1>\n        <Button onClick={() => { resetForm(); setShowForm(true); }} data-testid=\"button-add-gallery\">\n          <Plus className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n          {getLocalizedText(\"إضافة صورة\", \"Add Image\", \"Ajouter une image\")}\n        </Button>\n      </div>\n\n      {(showForm || editing) && (\n        <Card>\n          <CardHeader>\n            <CardTitle>{editing ? getLocalizedText(\"تعديل الصورة\", \"Edit Image\", \"Modifier l'image\") : getLocalizedText(\"إضافة صورة جديدة\", \"Add New Image\", \"Ajouter une nouvelle image\")}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"صورة قبل\", \"Before Image URL\", \"URL image avant\")}</Label>\n                <Input value={form.beforeImageUrl} onChange={(e) => setForm({ ...form, beforeImageUrl: e.target.value })} data-testid=\"input-gallery-before\" />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"صورة بعد\", \"After Image URL\", \"URL image après\")}</Label>\n                <Input value={form.afterImageUrl} onChange={(e) => setForm({ ...form, afterImageUrl: e.target.value })} data-testid=\"input-gallery-after\" />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"الوصف (عربي)\", \"Caption (Arabic)\", \"Légende (Arabe)\")}</Label>\n                <Input value={form.captionAr} onChange={(e) => setForm({ ...form, captionAr: e.target.value })} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"الوصف (إنجليزي)\", \"Caption (English)\", \"Légende (Anglais)\")}</Label>\n                <Input value={form.captionEn} onChange={(e) => setForm({ ...form, captionEn: e.target.value })} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"الوصف (فرنسي)\", \"Caption (French)\", \"Légende (Français)\")}</Label>\n                <Input value={form.captionFr} onChange={(e) => setForm({ ...form, captionFr: e.target.value })} />\n              </div>\n            </div>\n            <div className=\"flex items-center gap-4 flex-wrap\">\n              <Button onClick={() => editing ? updateMutation.mutate({ id: editing.id, data: form }) : createMutation.mutate(form)} disabled={createMutation.isPending || updateMutation.isPending} data-testid=\"button-save-gallery\">\n                <Save className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                {getLocalizedText(\"حفظ\", \"Save\", \"Enregistrer\")}\n              </Button>\n              <Button variant=\"outline\" onClick={resetForm} data-testid=\"button-cancel-gallery\">\n                <X className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                {getLocalizedText(\"إلغاء\", \"Cancel\", \"Annuler\")}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">{[1,2,3].map(i => <Skeleton key={i} className=\"h-48\" />)}</div>\n      ) : items && items.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {items.map((item: any) => (\n            <Card key={item.id} className=\"overflow-hidden\">\n              <CardContent className=\"p-0\">\n                <div className=\"grid grid-cols-2 gap-1\">\n                  {item.beforeImageUrl && <img src={item.beforeImageUrl} alt=\"Before\" className=\"w-full h-32 object-cover\" />}\n                  {item.afterImageUrl && <img src={item.afterImageUrl} alt=\"After\" className=\"w-full h-32 object-cover\" />}\n                </div>\n                <div className=\"p-4\">\n                  <p className=\"text-sm\">{getLocalizedText(item.captionAr, item.captionEn, item.captionFr)}</p>\n                  <div className=\"flex items-center justify-between gap-2 mt-2\">\n                    <Badge variant={item.isPublished ? \"default\" : \"secondary\"}>{item.isPublished ? getLocalizedText(\"منشور\", \"Published\", \"Publié\") : getLocalizedText(\"مسودة\", \"Draft\", \"Brouillon\")}</Badge>\n                    <div className=\"flex gap-1\">\n                      <Button size=\"icon\" variant=\"outline\" onClick={() => { setEditing(item); setForm({ beforeImageUrl: item.beforeImageUrl, afterImageUrl: item.afterImageUrl, captionAr: item.captionAr, captionEn: item.captionEn, captionFr: item.captionFr, isPublished: item.isPublished }); }}>\n                        <Pencil className=\"h-4 w-4\" />\n                      </Button>\n                      <Button size=\"icon\" variant=\"destructive\" onClick={() => { if (confirm(getLocalizedText(\"هل أنت متأكد؟\", \"Are you sure?\", \"Êtes-vous sûr?\"))) deleteMutation.mutate(item.id); }}>\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <p className=\"text-muted-foreground text-center py-8\">{t(\"common.noData\")}</p>\n      )}\n    </div>\n  );\n}\n\n// Offers Manager Component\nfunction OffersManager({ \n  offers, \n  isLoading, \n  getLocalizedText, \n  firebaseUser \n}: { \n  offers: Offer[];\n  isLoading: boolean;\n  getLocalizedText: (ar: string, en: string, fr: string) => string; \n  firebaseUser: any;\n}) {\n  const { t, i18n } = useTranslation();\n  const { toast } = useToast();\n  const [editing, setEditing] = useState<Offer | null>(null);\n  const [showForm, setShowForm] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [form, setForm] = useState({\n    titleAr: \"\",\n    titleEn: \"\",\n    titleFr: \"\",\n    descriptionAr: \"\",\n    descriptionEn: \"\",\n    descriptionFr: \"\",\n    discountPercentage: \"\",\n    discountAmountKD: \"\",\n    imageUrl: \"\",\n    startDate: \"\",\n    endDate: \"\",\n    isActive: true,\n    targetAudience: \"all\" as \"all\" | \"new_customers\" | \"existing_customers\",\n    loyaltyScope: \"outside_loyalty\" as \"inside_loyalty\" | \"outside_loyalty\",\n  });\n\n  const resetForm = () => {\n    setForm({\n      titleAr: \"\",\n      titleEn: \"\",\n      titleFr: \"\",\n      descriptionAr: \"\",\n      descriptionEn: \"\",\n      descriptionFr: \"\",\n      discountPercentage: \"\",\n      discountAmountKD: \"\",\n      imageUrl: \"\",\n      startDate: \"\",\n      endDate: \"\",\n      isActive: true,\n      targetAudience: \"all\",\n      loyaltyScope: \"outside_loyalty\",\n    });\n    setEditing(null);\n    setShowForm(false);\n  };\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/webp\", \"image/gif\"];\n    if (!allowedTypes.includes(file.type)) {\n      toast({ \n        title: getLocalizedText(\"نوع الملف غير مدعوم\", \"File type not supported\", \"Type de fichier non pris en charge\"), \n        variant: \"destructive\" \n      });\n      return;\n    }\n\n    if (file.size > 5 * 1024 * 1024) {\n      toast({ \n        title: getLocalizedText(\"الملف كبير جداً (الحد الأقصى 5MB)\", \"File too large (max 5MB)\", \"Fichier trop volumineux (max 5MB)\"), \n        variant: \"destructive\" \n      });\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const formData = new FormData();\n      formData.append(\"image\", file);\n      \n      const res = await fetch(\"/api/admin/offers/upload-image\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!res.ok) throw new Error(\"Upload failed\");\n      \n      const data = await res.json();\n      setForm({ ...form, imageUrl: data.imageUrl });\n      toast({ title: getLocalizedText(\"تم رفع الصورة\", \"Image uploaded\", \"Image téléchargée\") });\n    } catch (error) {\n      toast({ \n        title: getLocalizedText(\"فشل رفع الصورة\", \"Upload failed\", \"Échec du téléchargement\"), \n        variant: \"destructive\" \n      });\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n    }\n  };\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof form) => {\n      const res = await fetch(\"/api/admin/offers\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          ...data,\n          discountPercentage: data.discountPercentage ? parseFloat(data.discountPercentage) : null,\n          discountAmountKD: data.discountAmountKD ? parseFloat(data.discountAmountKD) : null,\n        }),\n      });\n      if (!res.ok) throw new Error(\"Failed to create offer\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/offers\"] });\n      toast({ title: getLocalizedText(\"تم إنشاء العرض\", \"Offer created\", \"Offre créée\") });\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: getLocalizedText(\"خطأ في الإنشاء\", \"Creation failed\", \"Échec de la création\"), variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: typeof form }) => {\n      const res = await fetch(`/api/admin/offers/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          ...data,\n          discountPercentage: data.discountPercentage ? parseFloat(data.discountPercentage) : null,\n          discountAmountKD: data.discountAmountKD ? parseFloat(data.discountAmountKD) : null,\n        }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update offer\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/offers\"] });\n      toast({ title: getLocalizedText(\"تم التحديث\", \"Updated\", \"Mis à jour\") });\n      resetForm();\n    },\n    onError: () => {\n      toast({ title: getLocalizedText(\"خطأ في التحديث\", \"Update failed\", \"Échec de la mise à jour\"), variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/admin/offers/${id}`, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Failed to delete offer\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/offers\"] });\n      toast({ title: getLocalizedText(\"تم الحذف\", \"Deleted\", \"Supprimé\") });\n    },\n    onError: () => {\n      toast({ title: getLocalizedText(\"خطأ في الحذف\", \"Delete failed\", \"Échec de la suppression\"), variant: \"destructive\" });\n    },\n  });\n\n  const toggleActiveMutation = useMutation({\n    mutationFn: async ({ id, isActive }: { id: string; isActive: boolean }) => {\n      const res = await fetch(`/api/admin/offers/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ isActive }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update offer\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/offers\"] });\n      toast({ title: getLocalizedText(\"تم التحديث\", \"Updated\", \"Mis à jour\") });\n    },\n  });\n\n  const formatDate = (date: string | Date) => {\n    const d = new Date(date);\n    return d.toISOString().split(\"T\")[0];\n  };\n\n  const isOfferActive = (offer: Offer) => {\n    if (!offer.isActive) return false;\n    const now = new Date();\n    return new Date(offer.startDate) <= now && new Date(offer.endDate) >= now;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <h1 className=\"text-2xl font-bold\">{getLocalizedText(\"العروض\", \"Offers\", \"Offres\")}</h1>\n        <Button onClick={() => { resetForm(); setShowForm(true); }} data-testid=\"button-add-offer\">\n          <Plus className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n          {getLocalizedText(\"إضافة عرض\", \"Add Offer\", \"Ajouter une offre\")}\n        </Button>\n      </div>\n\n      {showForm && (\n        <Card>\n          <CardHeader>\n            <CardTitle>{editing ? getLocalizedText(\"تعديل العرض\", \"Edit Offer\", \"Modifier l'offre\") : getLocalizedText(\"إضافة عرض جديد\", \"Add New Offer\", \"Ajouter une nouvelle offre\")}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div>\n                <Label>{getLocalizedText(\"العنوان (عربي)\", \"Title (Arabic)\", \"Titre (Arabe)\")}</Label>\n                <Input value={form.titleAr} onChange={(e) => setForm({ ...form, titleAr: e.target.value })} data-testid=\"input-offer-title-ar\" />\n              </div>\n              <div>\n                <Label>{getLocalizedText(\"العنوان (إنجليزي)\", \"Title (English)\", \"Titre (Anglais)\")}</Label>\n                <Input value={form.titleEn} onChange={(e) => setForm({ ...form, titleEn: e.target.value })} data-testid=\"input-offer-title-en\" />\n              </div>\n              <div>\n                <Label>{getLocalizedText(\"العنوان (فرنسي)\", \"Title (French)\", \"Titre (Français)\")}</Label>\n                <Input value={form.titleFr} onChange={(e) => setForm({ ...form, titleFr: e.target.value })} data-testid=\"input-offer-title-fr\" />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div>\n                <Label>{getLocalizedText(\"الوصف (عربي)\", \"Description (Arabic)\", \"Description (Arabe)\")}</Label>\n                <Input value={form.descriptionAr} onChange={(e) => setForm({ ...form, descriptionAr: e.target.value })} data-testid=\"input-offer-desc-ar\" />\n              </div>\n              <div>\n                <Label>{getLocalizedText(\"الوصف (إنجليزي)\", \"Description (English)\", \"Description (Anglais)\")}</Label>\n                <Input value={form.descriptionEn} onChange={(e) => setForm({ ...form, descriptionEn: e.target.value })} data-testid=\"input-offer-desc-en\" />\n              </div>\n              <div>\n                <Label>{getLocalizedText(\"الوصف (فرنسي)\", \"Description (French)\", \"Description (Français)\")}</Label>\n                <Input value={form.descriptionFr} onChange={(e) => setForm({ ...form, descriptionFr: e.target.value })} data-testid=\"input-offer-desc-fr\" />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div>\n                <Label>{getLocalizedText(\"نسبة الخصم (%)\", \"Discount Percentage (%)\", \"Pourcentage de réduction (%)\")}</Label>\n                <Input type=\"number\" value={form.discountPercentage} onChange={(e) => setForm({ ...form, discountPercentage: e.target.value })} placeholder=\"0-100\" data-testid=\"input-offer-discount-percent\" />\n              </div>\n              <div>\n                <Label>{getLocalizedText(\"مبلغ الخصم (د.ك)\", \"Discount Amount (KD)\", \"Montant de réduction (KD)\")}</Label>\n                <Input type=\"number\" value={form.discountAmountKD} onChange={(e) => setForm({ ...form, discountAmountKD: e.target.value })} placeholder=\"0.000\" step=\"0.001\" data-testid=\"input-offer-discount-amount\" />\n              </div>\n              <div>\n                <Label>{getLocalizedText(\"الصورة\", \"Image\", \"Image\")}</Label>\n                <div className=\"flex gap-2\">\n                  <Input \n                    value={form.imageUrl} \n                    onChange={(e) => setForm({ ...form, imageUrl: e.target.value })} \n                    placeholder={getLocalizedText(\"رابط أو رفع صورة\", \"URL or upload image\", \"URL ou télécharger\")} \n                    data-testid=\"input-offer-image\" \n                    className=\"flex-1\"\n                  />\n                  <input\n                    type=\"file\"\n                    ref={fileInputRef}\n                    onChange={handleImageUpload}\n                    accept=\"image/jpeg,image/png,image/webp,image/gif\"\n                    className=\"hidden\"\n                    data-testid=\"input-offer-image-file\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"icon\"\n                    onClick={() => fileInputRef.current?.click()}\n                    disabled={uploading}\n                    data-testid=\"button-upload-offer-image\"\n                  >\n                    {uploading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <Upload className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n                {form.imageUrl && (\n                  <div className=\"mt-2 relative w-20 h-20\">\n                    <img src={form.imageUrl} alt=\"Preview\" className=\"w-full h-full object-cover rounded-md\" />\n                  </div>\n                )}\n              </div>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div>\n                <Label>{getLocalizedText(\"تاريخ البدء\", \"Start Date\", \"Date de début\")}</Label>\n                <Input type=\"date\" value={form.startDate} onChange={(e) => setForm({ ...form, startDate: e.target.value })} data-testid=\"input-offer-start-date\" />\n              </div>\n              <div>\n                <Label>{getLocalizedText(\"تاريخ الانتهاء\", \"End Date\", \"Date de fin\")}</Label>\n                <Input type=\"date\" value={form.endDate} onChange={(e) => setForm({ ...form, endDate: e.target.value })} data-testid=\"input-offer-end-date\" />\n              </div>\n              <div className=\"flex items-end\">\n                <Label className=\"flex items-center gap-2 cursor-pointer\">\n                  <input \n                    type=\"checkbox\" \n                    checked={form.isActive} \n                    onChange={(e) => setForm({ ...form, isActive: e.target.checked })} \n                    className=\"w-4 h-4\"\n                    data-testid=\"input-offer-active\"\n                  />\n                  {getLocalizedText(\"نشط\", \"Active\", \"Actif\")}\n                </Label>\n              </div>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <Label>{getLocalizedText(\"الجمهور المستهدف\", \"Target Audience\", \"Public cible\")}</Label>\n                <Select value={form.targetAudience} onValueChange={(v: \"all\" | \"new_customers\" | \"existing_customers\") => setForm({ ...form, targetAudience: v })}>\n                  <SelectTrigger data-testid=\"select-offer-audience\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{getLocalizedText(\"الجميع\", \"All Customers\", \"Tous les clients\")}</SelectItem>\n                    <SelectItem value=\"new_customers\">{getLocalizedText(\"العملاء الجدد\", \"New Customers\", \"Nouveaux clients\")}</SelectItem>\n                    <SelectItem value=\"existing_customers\">{getLocalizedText(\"العملاء الحاليين\", \"Existing Customers\", \"Clients existants\")}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label>{getLocalizedText(\"نظام الولاء\", \"Loyalty System\", \"Système de fidélité\")}</Label>\n                <Select value={form.loyaltyScope} onValueChange={(v: \"inside_loyalty\" | \"outside_loyalty\") => setForm({ ...form, loyaltyScope: v })}>\n                  <SelectTrigger data-testid=\"select-offer-loyalty\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"outside_loyalty\">{getLocalizedText(\"خارج نظام الولاء\", \"Outside Loyalty\", \"Hors fidélité\")}</SelectItem>\n                    <SelectItem value=\"inside_loyalty\">{getLocalizedText(\"داخل نظام الولاء\", \"Inside Loyalty\", \"Dans fidélité\")}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-4 flex-wrap\">\n              <Button \n                onClick={() => {\n                  if (form.startDate && form.endDate && new Date(form.endDate) < new Date(form.startDate)) {\n                    toast({ \n                      title: getLocalizedText(\"خطأ في التاريخ\", \"Date Error\", \"Erreur de date\"),\n                      description: getLocalizedText(\"تاريخ الانتهاء يجب أن يكون بعد تاريخ البدء\", \"End date must be after start date\", \"La date de fin doit être après la date de début\"),\n                      variant: \"destructive\" \n                    });\n                    return;\n                  }\n                  editing ? updateMutation.mutate({ id: editing.id, data: form }) : createMutation.mutate(form);\n                }} \n                disabled={createMutation.isPending || updateMutation.isPending || !form.titleAr || !form.startDate || !form.endDate} \n                data-testid=\"button-save-offer\"\n              >\n                <Save className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                {getLocalizedText(\"حفظ\", \"Save\", \"Enregistrer\")}\n              </Button>\n              <Button variant=\"outline\" onClick={resetForm} data-testid=\"button-cancel-offer\">\n                <X className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                {getLocalizedText(\"إلغاء\", \"Cancel\", \"Annuler\")}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {isLoading ? (\n        <div className=\"space-y-4\">{[1, 2, 3].map(i => <Skeleton key={i} className=\"h-24\" />)}</div>\n      ) : offers && offers.length > 0 ? (\n        <div className=\"space-y-4\">\n          {offers.map((offer) => (\n            <Card key={offer.id} className={`${!offer.isActive ? \"opacity-60\" : \"\"}`} data-testid={`offer-card-${offer.id}`}>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-start justify-between gap-4 flex-wrap\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n                      <h3 className=\"text-lg font-semibold\">{getLocalizedText(offer.titleAr, offer.titleEn, offer.titleFr)}</h3>\n                      {isOfferActive(offer) ? (\n                        <Badge className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400\">\n                          {getLocalizedText(\"نشط الآن\", \"Active Now\", \"Actif maintenant\")}\n                        </Badge>\n                      ) : offer.isActive ? (\n                        <Badge variant=\"secondary\">{getLocalizedText(\"مفعّل\", \"Enabled\", \"Activé\")}</Badge>\n                      ) : (\n                        <Badge variant=\"outline\">{getLocalizedText(\"متوقف\", \"Disabled\", \"Désactivé\")}</Badge>\n                      )}\n                    </div>\n                    <p className=\"text-muted-foreground text-sm mb-2\">{getLocalizedText(offer.descriptionAr, offer.descriptionEn, offer.descriptionFr)}</p>\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground flex-wrap\">\n                      {offer.discountPercentage && (\n                        <span className=\"text-primary font-medium\">{offer.discountPercentage}% {getLocalizedText(\"خصم\", \"off\", \"de réduction\")}</span>\n                      )}\n                      {offer.discountAmountKD && (\n                        <span className=\"text-primary font-medium\">{offer.discountAmountKD} KD {getLocalizedText(\"خصم\", \"off\", \"de réduction\")}</span>\n                      )}\n                      <span>\n                        {formatDate(offer.startDate)} - {formatDate(offer.endDate)}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center gap-2 mt-2 flex-wrap\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {offer.targetAudience === \"all\" ? getLocalizedText(\"الجميع\", \"All\", \"Tous\") : \n                         offer.targetAudience === \"new_customers\" ? getLocalizedText(\"عملاء جدد\", \"New\", \"Nouveaux\") : \n                         getLocalizedText(\"عملاء حاليين\", \"Existing\", \"Existants\")}\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {offer.loyaltyScope === \"inside_loyalty\" ? getLocalizedText(\"داخل الولاء\", \"In Loyalty\", \"Fidélité\") : getLocalizedText(\"خارج الولاء\", \"No Loyalty\", \"Sans fidélité\")}\n                      </Badge>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button \n                      size=\"sm\" \n                      variant={offer.isActive ? \"secondary\" : \"default\"}\n                      onClick={() => toggleActiveMutation.mutate({ id: offer.id, isActive: !offer.isActive })}\n                      data-testid={`button-toggle-offer-${offer.id}`}\n                    >\n                      {offer.isActive ? (\n                        <>\n                          <Ban className=\"h-4 w-4 ltr:mr-1 rtl:ml-1\" />\n                          {getLocalizedText(\"إيقاف\", \"Disable\", \"Désactiver\")}\n                        </>\n                      ) : (\n                        <>\n                          <CheckCircle className=\"h-4 w-4 ltr:mr-1 rtl:ml-1\" />\n                          {getLocalizedText(\"تفعيل\", \"Enable\", \"Activer\")}\n                        </>\n                      )}\n                    </Button>\n                    <Button \n                      size=\"icon\" \n                      variant=\"outline\" \n                      onClick={() => { \n                        setEditing(offer); \n                        setForm({\n                          titleAr: offer.titleAr,\n                          titleEn: offer.titleEn,\n                          titleFr: offer.titleFr,\n                          descriptionAr: offer.descriptionAr,\n                          descriptionEn: offer.descriptionEn,\n                          descriptionFr: offer.descriptionFr,\n                          discountPercentage: offer.discountPercentage?.toString() || \"\",\n                          discountAmountKD: offer.discountAmountKD?.toString() || \"\",\n                          imageUrl: offer.imageUrl || \"\",\n                          startDate: formatDate(offer.startDate),\n                          endDate: formatDate(offer.endDate),\n                          isActive: offer.isActive,\n                          targetAudience: offer.targetAudience || \"all\",\n                          loyaltyScope: offer.loyaltyScope || \"outside_loyalty\",\n                        });\n                        setShowForm(true);\n                      }}\n                      data-testid={`button-edit-offer-${offer.id}`}\n                    >\n                      <Pencil className=\"h-4 w-4\" />\n                    </Button>\n                    <Button \n                      size=\"icon\" \n                      variant=\"destructive\" \n                      onClick={() => { \n                        if (confirm(getLocalizedText(\"هل أنت متأكد من حذف هذا العرض؟\", \"Are you sure you want to delete this offer?\", \"Êtes-vous sûr de vouloir supprimer cette offre?\"))) {\n                          deleteMutation.mutate(offer.id);\n                        }\n                      }}\n                      data-testid={`button-delete-offer-${offer.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"pt-6 text-center py-12\">\n            <Tag className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <p className=\"text-muted-foreground\">{getLocalizedText(\"لا توجد عروض\", \"No offers yet\", \"Pas d'offres pour le moment\")}</p>\n            <Button className=\"mt-4\" onClick={() => setShowForm(true)} data-testid=\"button-add-first-offer\">\n              <Plus className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n              {getLocalizedText(\"إضافة أول عرض\", \"Add First Offer\", \"Ajouter la première offre\")}\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n\n// Admin Orders Map Component\nfunction AdminOrdersMap({ \n  orders, \n  getLocalizedText, \n  getStatusBadge \n}: { \n  orders: Order[]; \n  getLocalizedText: (ar: string, en: string, fr: string) => string;\n  getStatusBadge: (status: string) => JSX.Element;\n}) {\n  const mapRef = useRef<HTMLDivElement>(null);\n  const leafletMapRef = useRef<L.Map | null>(null);\n  const markersRef = useRef<L.Marker[]>([]);\n\n  useEffect(() => {\n    if (!mapRef.current) return;\n\n    // Load Leaflet CSS\n    if (!document.querySelector('link[href*=\"leaflet\"]')) {\n      const link = document.createElement(\"link\");\n      link.rel = \"stylesheet\";\n      link.href = \"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\";\n      document.head.appendChild(link);\n    }\n\n    // Wait for CSS to load before initializing map\n    const initMap = async () => {\n      const L = await import(\"leaflet\");\n      \n      if (leafletMapRef.current) {\n        // Clear existing markers\n        markersRef.current.forEach(m => m.remove());\n        markersRef.current = [];\n      } else {\n        // Initialize map centered on Kuwait\n        leafletMapRef.current = L.map(mapRef.current!, {\n          center: [29.3759, 47.9774],\n          zoom: 11,\n        });\n\n        L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n          attribution: '&copy; OpenStreetMap contributors',\n        }).addTo(leafletMapRef.current);\n      }\n\n      // Add markers for orders with locations\n      const ordersWithLocation = orders.filter(o => o.latitude && o.longitude);\n      \n      if (ordersWithLocation.length > 0) {\n        const bounds: [number, number][] = [];\n        \n        ordersWithLocation.forEach(order => {\n          if (!order.latitude || !order.longitude) return;\n          \n          const statusColors: Record<string, string> = {\n            pending: \"#eab308\",\n            assigned: \"#3b82f6\",\n            on_the_way: \"#8b5cf6\",\n            in_progress: \"#f97316\",\n            completed: \"#22c55e\",\n            cancelled: \"#ef4444\",\n          };\n          \n          const color = statusColors[order.status] || \"#6b7280\";\n          \n          // Create custom icon\n          const icon = L.divIcon({\n            className: \"custom-marker\",\n            html: `<div style=\"background-color: ${color}; width: 30px; height: 30px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);\"></div>`,\n            iconSize: [30, 30],\n            iconAnchor: [15, 30],\n            popupAnchor: [0, -30],\n          });\n\n          const marker = L.marker([order.latitude, order.longitude], { icon })\n            .addTo(leafletMapRef.current!)\n            .bindPopup(`\n              <div style=\"min-width: 180px; direction: rtl; text-align: right;\">\n                <strong>#${order.id.slice(0, 8)}</strong><br/>\n                <span style=\"color: ${color}; font-weight: bold;\">${order.status}</span><br/>\n                <span>${order.area}</span><br/>\n                <span>${order.preferredTime}</span><br/>\n                <strong>${order.priceKD} KD</strong>\n              </div>\n            `);\n          \n          markersRef.current.push(marker);\n          bounds.push([order.latitude, order.longitude]);\n        });\n\n        // Fit map to show all markers\n        if (bounds.length > 0) {\n          leafletMapRef.current.fitBounds(bounds as L.LatLngBoundsExpression, { padding: [50, 50] });\n        }\n      }\n    };\n\n    initMap();\n\n    return () => {\n      // Cleanup markers but keep map instance\n      markersRef.current.forEach(m => m.remove());\n      markersRef.current = [];\n    };\n  }, [orders]);\n\n  // Cleanup map on unmount\n  useEffect(() => {\n    return () => {\n      if (leafletMapRef.current) {\n        leafletMapRef.current.remove();\n        leafletMapRef.current = null;\n      }\n    };\n  }, []);\n\n  return (\n    <div \n      ref={mapRef} \n      className=\"h-[400px] w-full rounded-lg border\"\n      data-testid=\"admin-orders-map\"\n    />\n  );\n}\n","path":null,"size_bytes":152442,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\nimport { auth } from \"./firebase\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport async function getAuthHeaders(): Promise<Record<string, string>> {\n  const user = auth.currentUser;\n  if (!user) {\n    throw new Error(\"Not authenticated\");\n  }\n  const token = await user.getIdToken();\n  return {\n    Authorization: `Bearer ${token}`,\n  };\n}\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1684,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"functions/README.md":{"content":"# Ghasla Style - Firebase Cloud Functions\n\n## Overview\n\nThis directory contains Firebase Cloud Functions for managing user roles and authentication in the Ghasla Style mobile car wash application.\n\n## Functions\n\n### 1. `initSuperAdmin` (One-time Setup)\n\nInitializes the first Super Admin account. This function can only be called **ONCE**.\n\n**Parameters:**\n- `initSecret`: The initialization secret (must match the configured admin.secret)\n\n**Security:**\n- Uses a secret key known only to the project owner\n- Cannot be called again after successful initialization\n- No password involved - relies on pre-registered email\n\n### 2. `setUserRole` (Super Admin Only)\n\nAssigns roles to users. Only Super Admin can call this function.\n\n**Parameters:**\n- `targetEmail`: Email of the user to update\n- `role`: New role (\"admin\" | \"customer\")\n\n**Notes:**\n- Cannot assign \"super_admin\" role (use initSuperAdmin instead)\n- Cannot modify the Super Admin's role\n\n### 3. `getUserRole`\n\nRetrieves a user's current role.\n\n**Parameters:**\n- `email`: (Optional) Email of user to check. Defaults to caller.\n\n**Access:**\n- Super Admin/Admin can check any user\n- Regular users can only check themselves\n\n## Setup Instructions\n\n### 1. Configure Firebase CLI\n\n```bash\n# Install Firebase CLI if not already installed\nnpm install -g firebase-tools\n\n# Login to Firebase\nfirebase login\n\n# Initialize Firebase in your project (if not done)\nfirebase init functions\n```\n\n### 2. Set the Admin Secret\n\n```bash\n# Set the initialization secret (choose a strong, unique value)\nfirebase functions:config:set admin.secret=\"MY_INIT_SUPER_SECRET_123\"\n```\n\n### 3. Deploy Functions\n\n```bash\ncd functions\nnpm install\nnpm run build\nfirebase deploy --only functions\n```\n\n### 4. Initialize Super Admin\n\nFrom your client app or Firebase console, call the `initSuperAdmin` function with the secret you configured:\n\n```typescript\nimport { initializeSuperAdmin } from \"@/lib/firebase-functions\";\n\n// Call this ONCE to set up the first Super Admin\nconst result = await initializeSuperAdmin(\"MY_INIT_SUPER_SECRET_123\");\nconsole.log(result.message); // \"Initial super admin created.\"\n```\n\n**Important:** The user with email `fawzybadr22@gmail.com` must already exist in Firebase Auth before calling this function.\n\n## Role Hierarchy\n\n1. **super_admin** - Full system access, can manage all roles\n2. **admin** - Dashboard access, can manage customers and orders\n3. **customer** - Regular user access, can place orders and track them\n\n## Security Notes\n\n- The `admin.secret` is only used for initial setup and should be kept secure\n- After initialization, role management is done through `setUserRole` which requires Super Admin authentication\n- Custom claims are stored in Firebase Auth tokens and are verified on every request\n- Token refresh is required after role changes for the new role to take effect\n\n## Local Development\n\nTo use the Firebase Emulator Suite:\n\n```bash\n# Start emulators\nfirebase emulators:start\n\n# In your client app, set the environment variable\nVITE_USE_FUNCTIONS_EMULATOR=true\n```\n\n## File Structure\n\n```\nfunctions/\n├── src/\n│   └── index.ts      # Cloud Functions implementation\n├── lib/              # Compiled JavaScript (generated)\n├── package.json      # Dependencies\n├── tsconfig.json     # TypeScript config\n└── README.md         # This file\n```\n","path":null,"size_bytes":3361,"size_tokens":null},"client/src/context/ThemeContext.tsx":{"content":"import { createContext, useContext, useEffect, useState, type ReactNode } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ninterface ThemeContextType {\n  theme: Theme;\n  toggleTheme: () => void;\n  setTheme: (theme: Theme) => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setThemeState] = useState<Theme>(() => {\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(\"theme\") as Theme;\n      if (stored) return stored;\n      return window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n    }\n    return \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    if (theme === \"dark\") {\n      root.classList.add(\"dark\");\n    } else {\n      root.classList.remove(\"dark\");\n    }\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setThemeState((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  const setTheme = (newTheme: Theme) => {\n    setThemeState(newTheme);\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme, setTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1448,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pkg from \"pg\";\nconst { Pool } = pkg;\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL environment variable is required\");\n}\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":364,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/layout/Header.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { Menu, X, Moon, Sun, User, LogOut, Settings } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Logo } from \"@/components/Logo\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { useTheme } from \"@/context/ThemeContext\";\n\nexport function Header() {\n  const { t, i18n } = useTranslation();\n  const [location] = useLocation();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const { user, logout, isAdmin } = useAuth();\n  const { theme, toggleTheme } = useTheme();\n\n  const isRTL = i18n.language === \"ar\";\n\n  const navLinks = [\n    { href: \"/\", label: t(\"nav.home\") },\n    { href: \"/about\", label: t(\"nav.about\") },\n    { href: \"/services\", label: t(\"nav.services\") },\n    { href: \"/offers\", label: t(\"nav.offers\") },\n    { href: \"/loyalty\", label: t(\"nav.loyalty\") },\n    { href: \"/friends-club\", label: t(\"nav.friendsClub\") },\n    { href: \"/blog\", label: t(\"nav.blog\") },\n    { href: \"/contact\", label: t(\"nav.contact\") },\n  ];\n\n  const changeLanguage = (lang: string) => {\n    i18n.changeLanguage(lang);\n    document.documentElement.dir = lang === \"ar\" ? \"rtl\" : \"ltr\";\n    document.documentElement.lang = lang;\n  };\n\n  const handleLogout = async () => {\n    await logout();\n  };\n\n  return (\n    <header className=\"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"flex h-16 items-center justify-between gap-4\">\n          <Link href=\"/\" className=\"flex items-center\" data-testid=\"logo-link\">\n            <Logo size=\"md\" />\n          </Link>\n\n          <nav className=\"hidden lg:flex items-center gap-1\">\n            {navLinks.map((link) => (\n              <Link key={link.href} href={link.href}>\n                <Button\n                  variant={location === link.href ? \"secondary\" : \"ghost\"}\n                  size=\"sm\"\n                  data-testid={`nav-link-${link.href.replace(\"/\", \"\") || \"home\"}`}\n                >\n                  {link.label}\n                </Button>\n              </Link>\n            ))}\n          </nav>\n\n          <div className=\"flex items-center gap-2\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\" data-testid=\"language-switcher\">\n                  {i18n.language.toUpperCase()}\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align={isRTL ? \"start\" : \"end\"}>\n                <DropdownMenuItem onClick={() => changeLanguage(\"ar\")} data-testid=\"lang-ar\">\n                  العربية\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => changeLanguage(\"en\")} data-testid=\"lang-en\">\n                  English\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => changeLanguage(\"fr\")} data-testid=\"lang-fr\">\n                  Français\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={toggleTheme}\n              data-testid=\"theme-toggle\"\n            >\n              {theme === \"dark\" ? <Sun className=\"h-5 w-5\" /> : <Moon className=\"h-5 w-5\" />}\n            </Button>\n\n            {user ? (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" size=\"icon\" data-testid=\"user-menu\">\n                    <User className=\"h-5 w-5\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align={isRTL ? \"start\" : \"end\"}>\n                  <DropdownMenuItem asChild>\n                    <Link href=\"/account\" className=\"flex items-center gap-2 w-full\">\n                      <User className=\"h-4 w-4\" />\n                      {t(\"nav.account\")}\n                    </Link>\n                  </DropdownMenuItem>\n                  {isAdmin && (\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/admin\" className=\"flex items-center gap-2 w-full\">\n                        <Settings className=\"h-4 w-4\" />\n                        {t(\"nav.admin\")}\n                      </Link>\n                    </DropdownMenuItem>\n                  )}\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem onClick={handleLogout} className=\"flex items-center gap-2\">\n                    <LogOut className=\"h-4 w-4\" />\n                    {t(\"nav.logout\")}\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            ) : (\n              <div className=\"hidden sm:flex items-center gap-2\">\n                <Link href=\"/login\">\n                  <Button variant=\"ghost\" size=\"sm\" data-testid=\"login-button\">\n                    {t(\"nav.login\")}\n                  </Button>\n                </Link>\n                <Link href=\"/booking\">\n                  <Button size=\"sm\" data-testid=\"book-now-button\">\n                    {t(\"nav.booking\")}\n                  </Button>\n                </Link>\n              </div>\n            )}\n\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"lg:hidden\"\n              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n              data-testid=\"mobile-menu-toggle\"\n            >\n              {mobileMenuOpen ? <X className=\"h-5 w-5\" /> : <Menu className=\"h-5 w-5\" />}\n            </Button>\n          </div>\n        </div>\n\n        {mobileMenuOpen && (\n          <div className=\"lg:hidden py-4 border-t\">\n            <nav className=\"flex flex-col gap-2\">\n              {navLinks.map((link) => (\n                <Link key={link.href} href={link.href}>\n                  <Button\n                    variant={location === link.href ? \"secondary\" : \"ghost\"}\n                    className=\"w-full justify-start\"\n                    onClick={() => setMobileMenuOpen(false)}\n                  >\n                    {link.label}\n                  </Button>\n                </Link>\n              ))}\n              {!user && (\n                <>\n                  <Link href=\"/login\">\n                    <Button variant=\"ghost\" className=\"w-full justify-start\" onClick={() => setMobileMenuOpen(false)}>\n                      {t(\"nav.login\")}\n                    </Button>\n                  </Link>\n                  <Link href=\"/booking\">\n                    <Button className=\"w-full\" onClick={() => setMobileMenuOpen(false)}>\n                      {t(\"nav.booking\")}\n                    </Button>\n                  </Link>\n                </>\n              )}\n            </nav>\n          </div>\n        )}\n      </div>\n    </header>\n  );\n}\n","path":null,"size_bytes":7084,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"design_guidelines.md":{"content":"# Ghasla Style Design Guidelines\n\n## Design Approach\n\n**Reference-Based Approach**: Drawing inspiration from Airbnb (booking flow, trust elements), Uber (service tracking, location-based), and regional e-commerce platforms (cultural appropriateness, RTL excellence). This is a service marketplace requiring strong visual trust signals and streamlined booking experience.\n\n## Core Design Principles\n\n1. **Cultural Authenticity**: Design that resonates with Kuwaiti market while maintaining international standards\n2. **Trust & Professionalism**: Clean, polished aesthetic that conveys premium mobile service quality\n3. **Booking Efficiency**: Clear visual hierarchy guiding users from discovery to booking completion\n4. **Bilingual Excellence**: Seamless RTL/LTR experience without visual compromise\n\n## Typography\n\n**Arabic Text**: \n- Primary: Tajawal (Google Fonts) - modern, highly legible Arabic typeface\n- Weights: Regular (400), Medium (500), Bold (700)\n\n**English/French Text**:\n- Primary: Inter (Google Fonts) - clean, professional sans-serif\n- Weights: Regular (400), Medium (500), Semibold (600), Bold (700)\n\n**Hierarchy**:\n- Hero Headlines: 3xl to 5xl (Arabic slightly larger for visual balance)\n- Section Headers: 2xl to 3xl\n- Body Text: base to lg\n- Small Print/Labels: sm to base\n\n## Layout System\n\n**Spacing Units**: Tailwind scale - 4, 6, 8, 12, 16, 20, 24 (py-4, px-6, gap-8, etc.)\n- Section Padding: py-16 md:py-24 lg:py-32\n- Component Spacing: gap-6 to gap-12\n- Container Max-Width: max-w-7xl for content, max-w-4xl for forms\n\n**Grid Strategy**:\n- Hero: Single column, centered content with background image\n- Services/Packages: 1 col mobile → 2 cols tablet → 3 cols desktop\n- Testimonials: 1 col mobile → 2 cols tablet → 3 cols desktop  \n- Admin Dashboard: Sidebar + main content layout\n\n## Color Application\n\n**Brand Colors** (specific values to be defined in theme):\n- Primary Orange: Use for CTAs, active states, key highlights\n- Primary Blue: Use for links, secondary actions, trust elements\n- Dark Orange variant: Dark mode primary\n- Light Blue variant: Backgrounds, subtle highlights\n\n**Neutrals**:\n- Light Mode: White backgrounds, gray-50/100 for sections, gray-700/900 for text\n- Dark Mode: Gray-900 backgrounds, gray-800 for cards, gray-100/white for text\n\n**Application Strategy**:\n- CTAs: Orange gradient with blue accent on hover\n- Navigation: Blue for active items, gray for inactive\n- Status Indicators: Green (completed), yellow (pending), red (cancelled), blue (in-progress)\n- Cards: White (light) / Gray-800 (dark) with subtle borders\n\n## Component Library\n\n### Navigation\n- Sticky header with logo (left for LTR, right for RTL), centered nav links, language switcher + theme toggle + account menu (opposite side)\n- Mobile: Hamburger menu with slide-out drawer\n- Admin: Collapsible sidebar with icon + label navigation\n\n### Hero Section\n- Full-width background image showing car wash service in action\n- Overlay gradient (dark at bottom for text contrast)\n- Centered content: H1 headline, subtitle, dual CTAs (Book Now - orange, Learn More - blue outline)\n- Height: 70vh to 80vh on desktop, 60vh on mobile\n\n### Service Cards\n- Clean card design with icon/image at top\n- Service name, brief description (2-3 lines)\n- Pricing table: Sedan / SUV columns\n- \"Select\" button at bottom\n- Hover: Subtle lift shadow, orange border accent\n\n### Booking Flow\n- Multi-step progress indicator at top (numbered circles with connecting lines)\n- Each step: Prominent heading, clear instructions, visual inputs\n- Step navigation: Back (gray), Continue (orange) buttons\n- Summary sidebar showing selections (desktop only)\n\n### Customer Dashboard\n- Tab navigation for sections (Orders, Loyalty, Referrals, Profile)\n- Order cards: Status badge, service details, action buttons\n- Loyalty: Large point balance display, transaction history table\n- Referrals: Copy-to-clipboard referral code box, stats grid\n\n### Admin Dashboard\n- Data tables: Striped rows, sortable headers, action dropdown per row\n- Form layouts: Label above input, full-width on mobile, 2-column on desktop\n- Analytics: Card-based metrics with icons, chart visualizations\n- Filters: Collapsible sidebar on desktop, modal on mobile\n\n### Forms\n- Floating labels for text inputs\n- Clear error states (red border, message below)\n- Success states (green checkmark icon)\n- Dropdown/Select: Custom styled with chevron icon\n- Date/Time pickers: Native styled inputs with calendar icon\n\n### Buttons\n- Primary (Orange): py-3 px-6, rounded-lg, bold text, shadow\n- Secondary (Blue outline): Same size, border-2, transparent bg\n- Small (Utility): py-2 px-4, rounded-md\n- Icon buttons: Rounded-full, p-3\n- All buttons: Smooth hover/active states (brightness/scale)\n\n### Modals & Overlays\n- Centered modal with backdrop blur\n- Header with title + close button\n- Content area with scrollable body\n- Footer with action buttons (right-aligned)\n\n## RTL/LTR Handling\n\n- Mirror all layouts automatically via `dir=\"rtl/ltr\"` on root\n- Icons: Use directional-aware icons (arrow-left becomes arrow-right in RTL)\n- Padding/Margins: Use logical properties (start/end vs left/right)\n- Text alignment: Natural alignment (right for Arabic, left for English)\n- Forms: Labels and inputs maintain proper flow direction\n\n## Images\n\n**Hero Image**: High-quality photo of mobile car wash team servicing a luxury vehicle in Kuwait setting (recognizable architecture/landscape). Image should convey professionalism, modern equipment, and premium service quality.\n\n**Services Section**: Icon-based rather than photos to maintain clean aesthetic and fast loading.\n\n**Before/After Gallery**: Grid layout with side-by-side comparison sliders showing transformation. Real customer vehicles with visible results.\n\n**Testimonials**: Optional customer photos (circular avatars) if available, otherwise use elegant quote icon.\n\n**About Us**: Team photo showing uniformed staff with equipment/branded vehicle.\n\n**Blog**: Featured image for each post (16:9 ratio), thumbnail grid for listings.\n\n## Animations\n\n**Minimal, Purposeful Motion**:\n- Page transitions: Subtle fade-in (200ms)\n- Card hovers: Slight lift + shadow (150ms ease-out)\n- Button interactions: Scale 0.98 on press\n- Mobile menu: Slide-in from side (250ms)\n- Success states: Checkmark draw animation (300ms)\n- NO scroll-triggered animations, parallax, or auto-playing elements\n\n## WhatsApp Integration\n\n- Floating action button: Fixed bottom-right (bottom-left for RTL)\n- Green circular button with WhatsApp icon\n- Shadow + pulse animation to draw attention\n- Click opens wa.me link in new tab\n- z-index above all content except modals\n\n## Accessibility\n\n- ARIA labels on all interactive elements\n- Focus visible states with orange outline\n- Sufficient color contrast (WCAG AA minimum)\n- Keyboard navigation throughout\n- Screen reader friendly (proper heading hierarchy, alt texts)","path":null,"size_bytes":6888,"size_tokens":null},"client/src/hooks/use-firestore-orders.ts":{"content":"import { useState, useEffect, useCallback } from \"react\";\nimport { \n  collection, \n  query, \n  where, \n  orderBy, \n  onSnapshot, \n  doc,\n  limit,\n  Timestamp,\n  type QueryDocumentSnapshot,\n  type QuerySnapshot,\n  type DocumentData\n} from \"firebase/firestore\";\nimport { db } from \"@/lib/firebase\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport type { \n  FirestoreOrder, \n  FirestoreOrderWithId, \n  FirestoreOrderStatus \n} from \"@/types/firestore-order\";\n\n/**\n * Custom hook for real-time Firestore order tracking\n * \n * Features:\n * - Real-time updates via onSnapshot\n * - Filter by status\n * - Automatic last completed order detection\n * - Loading and error states\n */\n\n// Filter options for orders\nexport type OrderFilter = \"all\" | \"active\" | \"completed\" | \"cancelled\";\n\ninterface UseFirestoreOrdersReturn {\n  orders: FirestoreOrderWithId[];\n  filteredOrders: FirestoreOrderWithId[];\n  lastCompletedOrder: FirestoreOrderWithId | null;\n  isLoading: boolean;\n  error: string | null;\n  filter: OrderFilter;\n  setFilter: (filter: OrderFilter) => void;\n  refetch: () => void;\n}\n\nexport function useFirestoreOrders(): UseFirestoreOrdersReturn {\n  const { user } = useAuth();\n  const [orders, setOrders] = useState<FirestoreOrderWithId[]>([]);\n  const [lastCompletedOrder, setLastCompletedOrder] = useState<FirestoreOrderWithId | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [filter, setFilter] = useState<OrderFilter>(\"all\");\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n\n  // Manual refetch function\n  const refetch = useCallback(() => {\n    setRefreshTrigger(prev => prev + 1);\n  }, []);\n\n  // Convert Firestore document to typed order\n  const convertToOrder = (docSnapshot: QueryDocumentSnapshot<DocumentData>): FirestoreOrderWithId => {\n    const data = docSnapshot.data();\n    return {\n      id: docSnapshot.id,\n      orderCode: data.orderCode || `GS-${docSnapshot.id.slice(0, 4).toUpperCase()}`,\n      customerId: data.customerId,\n      status: data.status || \"pending\",\n      createdAt: data.createdAt || Timestamp.now(),\n      updatedAt: data.updatedAt || Timestamp.now(),\n      serviceType: data.serviceType || \"\",\n      servicePackageId: data.servicePackageId || \"\",\n      vehicleInfo: data.vehicleInfo || { make: \"\", model: \"\", plateLast: \"\", color: \"\" },\n      address: data.address || { area: \"\" },\n      totalPrice: data.totalPrice || 0,\n      originalPrice: data.originalPrice || data.totalPrice || 0,\n      discountApplied: data.discountApplied || 0,\n      paymentMethod: data.paymentMethod || \"cash\",\n      isPaid: data.isPaid || false,\n      loyaltyPointsEarned: data.loyaltyPointsEarned || 0,\n      loyaltyPointsRedeemed: data.loyaltyPointsRedeemed || 0,\n      isPointsApplied: data.isPointsApplied || false,\n      driverId: data.driverId || null,\n      driverName: data.driverName,\n      cancelReason: data.cancelReason || null,\n      source: data.source || \"web_app\",\n      referralCode: data.referralCode\n    };\n  };\n\n  // Main orders subscription - real-time updates\n  useEffect(() => {\n    if (!user?.id) {\n      setOrders([]);\n      setIsLoading(false);\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    // Query all orders for this customer, ordered by creation date descending\n    const ordersRef = collection(db, \"orders\");\n    const ordersQuery = query(\n      ordersRef,\n      where(\"customerId\", \"==\", user.id),\n      orderBy(\"createdAt\", \"desc\")\n    );\n\n    // Real-time subscription with onSnapshot\n    const unsubscribe = onSnapshot(\n      ordersQuery,\n      (snapshot: QuerySnapshot<DocumentData>) => {\n        const ordersData = snapshot.docs.map(convertToOrder);\n        setOrders(ordersData);\n        setIsLoading(false);\n      },\n      (err) => {\n        console.error(\"Firestore orders error:\", err);\n        setError(err.message);\n        setIsLoading(false);\n      }\n    );\n\n    // Cleanup subscription on unmount or user change\n    return () => unsubscribe();\n  }, [user?.id, refreshTrigger]);\n\n  // Last completed order subscription\n  useEffect(() => {\n    if (!user?.id) {\n      setLastCompletedOrder(null);\n      return;\n    }\n\n    const ordersRef = collection(db, \"orders\");\n    const lastCompletedQuery = query(\n      ordersRef,\n      where(\"customerId\", \"==\", user.id),\n      where(\"status\", \"==\", \"completed\"),\n      orderBy(\"updatedAt\", \"desc\"),\n      limit(1)\n    );\n\n    const unsubscribe = onSnapshot(\n      lastCompletedQuery,\n      (snapshot) => {\n        if (!snapshot.empty) {\n          setLastCompletedOrder(convertToOrder(snapshot.docs[0]));\n        } else {\n          setLastCompletedOrder(null);\n        }\n      },\n      (err) => {\n        console.error(\"Last completed order error:\", err);\n      }\n    );\n\n    return () => unsubscribe();\n  }, [user?.id, refreshTrigger]);\n\n  // Filter orders based on selected filter\n  const filteredOrders = orders.filter(order => {\n    switch (filter) {\n      case \"active\":\n        return [\"pending\", \"assigned\", \"in_progress\"].includes(order.status);\n      case \"completed\":\n        return order.status === \"completed\";\n      case \"cancelled\":\n        return order.status === \"cancelled\";\n      default:\n        return true;\n    }\n  });\n\n  return {\n    orders,\n    filteredOrders,\n    lastCompletedOrder,\n    isLoading,\n    error,\n    filter,\n    setFilter,\n    refetch\n  };\n}\n\n/**\n * Hook for tracking a single order in real-time\n * Used in order detail page\n */\nexport function useFirestoreOrderDetail(orderId: string | null) {\n  const [order, setOrder] = useState<FirestoreOrderWithId | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!orderId) {\n      setOrder(null);\n      setIsLoading(false);\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    const orderRef = doc(db, \"orders\", orderId);\n\n    const unsubscribe = onSnapshot(\n      orderRef,\n      (snapshot) => {\n        if (snapshot.exists()) {\n          const data = snapshot.data();\n          setOrder({\n            id: snapshot.id,\n            orderCode: data.orderCode || `GS-${snapshot.id.slice(0, 4).toUpperCase()}`,\n            customerId: data.customerId,\n            status: data.status || \"pending\",\n            createdAt: data.createdAt || Timestamp.now(),\n            updatedAt: data.updatedAt || Timestamp.now(),\n            serviceType: data.serviceType || \"\",\n            servicePackageId: data.servicePackageId || \"\",\n            vehicleInfo: data.vehicleInfo || { make: \"\", model: \"\", plateLast: \"\", color: \"\" },\n            address: data.address || { area: \"\" },\n            totalPrice: data.totalPrice || 0,\n            originalPrice: data.originalPrice || data.totalPrice || 0,\n            discountApplied: data.discountApplied || 0,\n            paymentMethod: data.paymentMethod || \"cash\",\n            isPaid: data.isPaid || false,\n            loyaltyPointsEarned: data.loyaltyPointsEarned || 0,\n            loyaltyPointsRedeemed: data.loyaltyPointsRedeemed || 0,\n            isPointsApplied: data.isPointsApplied || false,\n            driverId: data.driverId || null,\n            driverName: data.driverName,\n            cancelReason: data.cancelReason || null,\n            source: data.source || \"web_app\",\n            referralCode: data.referralCode\n          });\n        } else {\n          setOrder(null);\n        }\n        setIsLoading(false);\n      },\n      (err) => {\n        console.error(\"Order detail error:\", err);\n        setError(err.message);\n        setIsLoading(false);\n      }\n    );\n\n    return () => unsubscribe();\n  }, [orderId]);\n\n  return { order, isLoading, error };\n}\n\n/**\n * Calculate loyalty points from order total\n * Default: 35 points per 1 KWD (as per loyalty config)\n */\nexport function calculateLoyaltyPoints(totalPrice: number, pointsPerKD: number = 35): number {\n  return Math.floor(totalPrice * pointsPerKD);\n}\n","path":null,"size_bytes":7974,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"functions/src/index.ts":{"content":"/**\n * Ghasla Style - Firebase Cloud Functions\n * \n * This file contains Cloud Functions for:\n * - initSuperAdmin: One-time initialization of the first Super Admin\n * - setUserRole: Role management by Super Admin\n * \n * SETUP INSTRUCTIONS:\n * Before deploying, set the admin secret from Firebase CLI:\n * \n *   firebase functions:config:set admin.secret=\"MY_INIT_SUPER_SECRET_123\"\n * \n * Then deploy the functions:\n * \n *   cd functions\n *   npm install\n *   npm run build\n *   firebase deploy --only functions\n * \n * To call initSuperAdmin from client (one-time only):\n * \n *   const initSuperAdmin = httpsCallable(functions, 'initSuperAdmin');\n *   await initSuperAdmin({ initSecret: 'MY_INIT_SUPER_SECRET_123' });\n */\n\nimport * as functions from \"firebase-functions\";\nimport * as admin from \"firebase-admin\";\n\nadmin.initializeApp();\n\nconst INITIAL_SUPER_ADMIN_EMAIL = \"fawzybadr22@gmail.com\";\n\n/**\n * Get the admin secret from Firebase Functions config\n * Set via: firebase functions:config:set admin.secret=\"YOUR_SECRET\"\n */\nfunction getAdminSecret(): string {\n  const config = functions.config();\n  if (!config.admin?.secret) {\n    throw new functions.https.HttpsError(\n      \"failed-precondition\",\n      \"Admin secret not configured. Run: firebase functions:config:set admin.secret=\\\"YOUR_SECRET\\\"\"\n    );\n  }\n  return config.admin.secret;\n}\n\n/**\n * initSuperAdmin - One-time HTTPS Callable Function\n * \n * Initializes the first Super Admin account using email only (no password).\n * This function can only be called ONCE - subsequent calls will fail.\n * \n * @param data.initSecret - The initialization secret (must match admin.secret config)\n * @returns Success message or throws error\n * \n * Security:\n * - Uses a secret key known only to the project owner\n * - Can only be executed once (checks if super_admin already exists)\n * - No password involved - relies on email + secret verification\n */\nexport const initSuperAdmin = functions.https.onCall(\n  async (data: { initSecret?: string }) => {\n    const SUPER_SECRET = getAdminSecret();\n\n    if (!data.initSecret) {\n      throw new functions.https.HttpsError(\n        \"invalid-argument\",\n        \"initSecret is required\"\n      );\n    }\n\n    if (data.initSecret !== SUPER_SECRET) {\n      throw new functions.https.HttpsError(\n        \"permission-denied\",\n        \"Invalid initialization secret\"\n      );\n    }\n\n    try {\n      const user = await admin.auth().getUserByEmail(INITIAL_SUPER_ADMIN_EMAIL);\n      \n      if (user.customClaims?.role === \"super_admin\") {\n        throw new functions.https.HttpsError(\n          \"already-exists\",\n          \"Super Admin has already been initialized. This function can only be called once.\"\n        );\n      }\n\n      await admin.auth().setCustomUserClaims(user.uid, { \n        role: \"super_admin\",\n        initializedAt: new Date().toISOString()\n      });\n\n      console.log(`Super Admin initialized successfully for: ${INITIAL_SUPER_ADMIN_EMAIL}`);\n\n      return { \n        message: \"Initial super admin created.\",\n        email: INITIAL_SUPER_ADMIN_EMAIL,\n        uid: user.uid\n      };\n\n    } catch (error: unknown) {\n      if (error instanceof functions.https.HttpsError) {\n        throw error;\n      }\n      \n      const firebaseError = error as { code?: string; message?: string };\n      \n      if (firebaseError.code === \"auth/user-not-found\") {\n        throw new functions.https.HttpsError(\n          \"not-found\",\n          `User with email ${INITIAL_SUPER_ADMIN_EMAIL} does not exist. Please create the account first.`\n        );\n      }\n\n      console.error(\"Error initializing super admin:\", error);\n      throw new functions.https.HttpsError(\n        \"internal\",\n        \"Failed to initialize super admin\"\n      );\n    }\n  }\n);\n\n/**\n * setUserRole - HTTPS Callable Function for Role Management\n * \n * Allows Super Admin to assign roles to other users.\n * Only users with role === \"super_admin\" can call this function.\n * \n * @param data.targetEmail - Email of the user to update\n * @param data.role - New role to assign (\"admin\" | \"customer\")\n * @returns Success message or throws error\n * \n * Valid roles:\n * - \"super_admin\" - Cannot be assigned via this function (only via initSuperAdmin)\n * - \"admin\" - Full admin access to dashboard\n * - \"customer\" - Regular customer access\n */\nexport const setUserRole = functions.https.onCall(\n  async (\n    data: { targetEmail?: string; role?: string },\n    context: functions.https.CallableContext\n  ) => {\n    if (!context.auth) {\n      throw new functions.https.HttpsError(\n        \"unauthenticated\",\n        \"You must be logged in to manage user roles\"\n      );\n    }\n\n    const callerRole = context.auth.token.role as string | undefined;\n    if (callerRole !== \"super_admin\") {\n      throw new functions.https.HttpsError(\n        \"permission-denied\",\n        \"Only Super Admin can manage user roles\"\n      );\n    }\n\n    if (!data.targetEmail) {\n      throw new functions.https.HttpsError(\n        \"invalid-argument\",\n        \"targetEmail is required\"\n      );\n    }\n\n    if (!data.role) {\n      throw new functions.https.HttpsError(\n        \"invalid-argument\",\n        \"role is required\"\n      );\n    }\n\n    const validRoles = [\"admin\", \"customer\"];\n    if (!validRoles.includes(data.role)) {\n      throw new functions.https.HttpsError(\n        \"invalid-argument\",\n        `Invalid role. Valid roles are: ${validRoles.join(\", \")}. Use initSuperAdmin to create super_admin.`\n      );\n    }\n\n    try {\n      const targetUser = await admin.auth().getUserByEmail(data.targetEmail);\n\n      if (targetUser.customClaims?.role === \"super_admin\") {\n        throw new functions.https.HttpsError(\n          \"permission-denied\",\n          \"Cannot modify Super Admin role\"\n        );\n      }\n\n      const existingClaims = targetUser.customClaims || {};\n      await admin.auth().setCustomUserClaims(targetUser.uid, { \n        ...existingClaims,\n        role: data.role,\n        updatedAt: new Date().toISOString(),\n        updatedBy: context.auth.uid\n      });\n\n      console.log(`Role ${data.role} assigned to ${data.targetEmail} by ${context.auth.token.email}`);\n\n      return { \n        message: `Role \"${data.role}\" assigned successfully to ${data.targetEmail}`,\n        targetUid: targetUser.uid,\n        role: data.role\n      };\n\n    } catch (error: unknown) {\n      if (error instanceof functions.https.HttpsError) {\n        throw error;\n      }\n      \n      const firebaseError = error as { code?: string };\n      \n      if (firebaseError.code === \"auth/user-not-found\") {\n        throw new functions.https.HttpsError(\n          \"not-found\",\n          `User with email ${data.targetEmail} does not exist`\n        );\n      }\n\n      console.error(\"Error setting user role:\", error);\n      throw new functions.https.HttpsError(\n        \"internal\",\n        \"Failed to set user role\"\n      );\n    }\n  }\n);\n\n/**\n * getUserRole - HTTPS Callable Function to get a user's role\n * \n * Allows checking a user's current role.\n * Super Admin can check any user's role.\n * Regular users can only check their own role.\n * \n * @param data.email - Email of the user to check (optional, defaults to caller)\n * @returns User's role information\n */\nexport const getUserRole = functions.https.onCall(\n  async (\n    data: { email?: string },\n    context: functions.https.CallableContext\n  ) => {\n    if (!context.auth) {\n      throw new functions.https.HttpsError(\n        \"unauthenticated\",\n        \"You must be logged in\"\n      );\n    }\n\n    const callerRole = context.auth.token.role as string | undefined;\n    const callerEmail = context.auth.token.email;\n    const targetEmail = data.email || callerEmail;\n\n    if (targetEmail !== callerEmail && callerRole !== \"super_admin\" && callerRole !== \"admin\") {\n      throw new functions.https.HttpsError(\n        \"permission-denied\",\n        \"You can only check your own role\"\n      );\n    }\n\n    try {\n      const user = await admin.auth().getUserByEmail(targetEmail!);\n      \n      return {\n        email: targetEmail,\n        uid: user.uid,\n        role: user.customClaims?.role || \"customer\",\n        displayName: user.displayName\n      };\n\n    } catch (error: unknown) {\n      const firebaseError = error as { code?: string };\n      \n      if (firebaseError.code === \"auth/user-not-found\") {\n        throw new functions.https.HttpsError(\n          \"not-found\",\n          `User not found`\n        );\n      }\n\n      throw new functions.https.HttpsError(\n        \"internal\",\n        \"Failed to get user role\"\n      );\n    }\n  }\n);\n","path":null,"size_bytes":8509,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/pages/Booking.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, useSearch } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Car, Sparkles, MapPin, CreditCard, Check, ChevronRight, ChevronLeft, Loader2, Navigation, Calendar, Clock, Map } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, SelectGroup, SelectLabel } from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { MapPicker } from \"@/components/ui/map-picker\";\nimport type { ServicePackage, ServiceArea } from \"@shared/schema\";\n\nconst defaultPackages: ServicePackage[] = [\n  { id: \"1\", nameAr: \"غسيل خارجي\", nameEn: \"Exterior Wash\", nameFr: \"Lavage Extérieur\", descriptionAr: \"\", descriptionEn: \"\", descriptionFr: \"\", priceSedanKD: 3.5, priceSuvKD: 4.5, estimatedMinutes: 30, category: \"exterior\", isActive: true, createdAt: new Date() },\n  { id: \"2\", nameAr: \"تنظيف داخلي\", nameEn: \"Interior Clean\", nameFr: \"Nettoyage Intérieur\", descriptionAr: \"\", descriptionEn: \"\", descriptionFr: \"\", priceSedanKD: 5, priceSuvKD: 7, estimatedMinutes: 45, category: \"interior\", isActive: true, createdAt: new Date() },\n  { id: \"3\", nameAr: \"غسيل كامل\", nameEn: \"Full Wash\", nameFr: \"Lavage Complet\", descriptionAr: \"\", descriptionEn: \"\", descriptionFr: \"\", priceSedanKD: 7, priceSuvKD: 10, estimatedMinutes: 60, category: \"full\", isActive: true, createdAt: new Date() },\n  { id: \"4\", nameAr: \"VIP / تفصيلي\", nameEn: \"VIP / Detailing\", nameFr: \"VIP / Détaillage\", descriptionAr: \"\", descriptionEn: \"\", descriptionFr: \"\", priceSedanKD: 15, priceSuvKD: 20, estimatedMinutes: 120, category: \"vip\", isActive: true, createdAt: new Date() },\n];\n\n\nexport default function Booking() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const search = useSearch();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  \n  const preselectedPackage = new URLSearchParams(search).get(\"package\");\n  \n  const [step, setStep] = useState(1);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isLocating, setIsLocating] = useState(false);\n  const [locationDetected, setLocationDetected] = useState(false);\n  const [showMapPicker, setShowMapPicker] = useState(false);\n  const [fieldErrors, setFieldErrors] = useState<{\n    area?: string;\n    address?: string;\n    date?: string;\n    time?: string;\n  }>({});\n  const [formData, setFormData] = useState({\n    carType: \"sedan\" as \"sedan\" | \"suv\" | \"other\",\n    carDetails: \"\",\n    packageId: preselectedPackage || \"\",\n    address: \"\",\n    area: \"\",\n    date: \"\",\n    time: \"\",\n    paymentMethod: \"cash\" as \"cash\" | \"online\",\n    pointsToRedeem: 0,\n  });\n\n  const { data: packages } = useQuery<ServicePackage[]>({\n    queryKey: [\"/api/packages\"],\n  });\n\n  const { data: areasData, isLoading: areasLoading } = useQuery<ServiceArea[]>({\n    queryKey: [\"/api/areas\"],\n  });\n  \n  // Default fallback areas in case API fails\n  const defaultAvailableAreas: ServiceArea[] = [\n    { nameAr: \"السالمية\", nameEn: \"Salmiya\", nameFr: \"Salmiya\", isAvailable: true },\n    { nameAr: \"الروضة\", nameEn: \"Rawda\", nameFr: \"Rawda\", isAvailable: true },\n    { nameAr: \"السرة\", nameEn: \"Surra\", nameFr: \"Surra\", isAvailable: true },\n  ];\n  const defaultComingSoonAreas: ServiceArea[] = [\n    { nameAr: \"حولي\", nameEn: \"Hawalli\", nameFr: \"Hawalli\", isAvailable: false },\n    { nameAr: \"الفروانية\", nameEn: \"Farwaniya\", nameFr: \"Farwaniya\", isAvailable: false },\n  ];\n  \n  // Separate available and coming soon areas\n  const availableAreas = areasData?.filter(a => a.isAvailable) || defaultAvailableAreas;\n  const comingSoonAreas = areasData?.filter(a => !a.isAvailable) || defaultComingSoonAreas;\n\n  const { data: loyaltyConfigData } = useQuery<{\n    conversionRate: number;\n    maxRedeemPercentage: number;\n    pointsPerKD: number;\n  }>({\n    queryKey: [\"/api/loyalty/config\"],\n  });\n\n  const displayPackages = packages?.length ? packages : defaultPackages;\n  \n  // Check if selected area is available now\n  const selectedAreaData = areasData?.find(a => a.nameEn === formData.area);\n  const isAreaAvailable = selectedAreaData?.isAvailable ?? true;\n  const selectedPackage = displayPackages.find(p => p.id === formData.packageId);\n  const basePrice = selectedPackage ? (formData.carType === \"suv\" ? selectedPackage.priceSuvKD : selectedPackage.priceSedanKD) : 0;\n  \n  const loyaltyConfig = loyaltyConfigData || { conversionRate: 0.004, maxRedeemPercentage: 0.15 };\n  const maxRedeemPoints = user?.loyaltyPoints || 0;\n  const maxRedeemValue = basePrice * loyaltyConfig.maxRedeemPercentage;\n  const maxAllowedPoints = Math.min(maxRedeemPoints, maxRedeemValue / loyaltyConfig.conversionRate);\n  const discount = formData.pointsToRedeem * loyaltyConfig.conversionRate;\n  const finalPrice = Math.max(0, basePrice - discount);\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  // Helper function to get address from coordinates using backend proxy\n  const reverseGeocode = async (lat: number, lon: number): Promise<string | null> => {\n    try {\n      const response = await fetch(\n        `/api/geocode/reverse?lat=${lat}&lon=${lon}&lang=${i18n.language}`\n      );\n      const data = await response.json();\n      if (data.display_name) {\n        return data.display_name.split(\",\").slice(0, 3).join(\",\");\n      }\n      return null;\n    } catch {\n      return null;\n    }\n  };\n\n  // Try IP-based location as fallback\n  const getIPLocation = async (): Promise<{ lat: number; lon: number; city: string } | null> => {\n    try {\n      const response = await fetch(\"/api/geocode/ip-location\");\n      const data = await response.json();\n      if (data.success) {\n        return { lat: data.lat, lon: data.lon, city: data.city };\n      }\n      return null;\n    } catch {\n      return null;\n    }\n  };\n\n  const handleGetLocation = async () => {\n    setIsLocating(true);\n    \n    // Try browser geolocation with high accuracy\n    if (navigator.geolocation) {\n      try {\n        const position = await new Promise<GeolocationPosition>((resolve, reject) => {\n          navigator.geolocation.getCurrentPosition(resolve, reject, {\n            enableHighAccuracy: true,\n            timeout: 10000,\n            maximumAge: 0,\n          });\n        });\n\n        const { latitude, longitude } = position.coords;\n        const address = await reverseGeocode(latitude, longitude);\n        \n        if (address) {\n          setFormData(prev => ({ ...prev, address }));\n        } else {\n          setFormData(prev => ({ ...prev, address: `${latitude.toFixed(6)}, ${longitude.toFixed(6)}` }));\n        }\n        setLocationDetected(true);\n        if (fieldErrors.address) setFieldErrors(prev => ({ ...prev, address: undefined }));\n        toast({\n          title: getLocalizedText(\"تم تحديد الموقع\", \"Location Detected\", \"Emplacement Détecté\"),\n          description: getLocalizedText(\n            \"تم تحديد موقعك الدقيق بنجاح\",\n            \"Your precise location was detected successfully\",\n            \"Votre emplacement précis a été détecté avec succès\"\n          ),\n        });\n        setIsLocating(false);\n        return;\n      } catch (geoError: any) {\n        console.log(\"Browser geolocation failed:\", geoError.code, geoError.message);\n        // If permission denied or failed, open map picker for manual selection\n        setIsLocating(false);\n        setShowMapPicker(true);\n        toast({\n          title: getLocalizedText(\"تنبيه\", \"Notice\", \"Avis\"),\n          description: getLocalizedText(\n            \"لم نتمكن من تحديد موقعك تلقائياً. حدد موقعك على الخريطة\",\n            \"Could not detect location automatically. Please select on the map\",\n            \"Impossible de détecter l'emplacement. Veuillez sélectionner sur la carte\"\n          ),\n        });\n        return;\n      }\n    }\n    \n    // No geolocation support - open map picker\n    setIsLocating(false);\n    setShowMapPicker(true);\n    toast({\n      title: getLocalizedText(\"تنبيه\", \"Notice\", \"Avis\"),\n      description: getLocalizedText(\n        \"المتصفح لا يدعم تحديد الموقع. حدد موقعك على الخريطة\",\n        \"Browser doesn't support geolocation. Please select on the map\",\n        \"Le navigateur ne prend pas en charge la géolocalisation. Sélectionnez sur la carte\"\n      ),\n    });\n  };\n\n  const getMinTime = () => {\n    const now = new Date();\n    if (formData.date === now.toISOString().split(\"T\")[0]) {\n      const hours = now.getHours().toString().padStart(2, \"0\");\n      const minutes = now.getMinutes().toString().padStart(2, \"0\");\n      return `${hours}:${minutes}`;\n    }\n    return \"06:00\";\n  };\n\n  const steps = [\n    { number: 1, label: t(\"booking.step1\"), icon: Car },\n    { number: 2, label: t(\"booking.step2\"), icon: Sparkles },\n    { number: 3, label: t(\"booking.step3\"), icon: MapPin },\n    { number: 4, label: t(\"booking.step4\"), icon: CreditCard },\n  ];\n\n  const handleSubmit = async () => {\n    if (!user) {\n      toast({\n        title: t(\"common.error\"),\n        description: getLocalizedText(\"يرجى تسجيل الدخول أولاً\", \"Please login first\", \"Veuillez d'abord vous connecter\"),\n        variant: \"destructive\",\n      });\n      setLocation(\"/login\");\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      const response = await fetch(\"/api/orders\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          customerId: user.id,\n          carType: formData.carType,\n          carDetails: formData.carDetails || null,\n          servicePackageId: formData.packageId,\n          address: formData.address,\n          area: formData.area,\n          preferredDate: formData.date,\n          preferredTime: formData.time,\n          paymentMethod: formData.paymentMethod,\n          priceKD: finalPrice,\n          loyaltyPointsRedeemed: formData.pointsToRedeem,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (response.ok) {\n        // If online payment, create payment and redirect to checkout\n        if (formData.paymentMethod === \"online\") {\n          try {\n            const paymentResponse = await fetch(\"/api/payments/create\", {\n              method: \"POST\",\n              headers: { \"Content-Type\": \"application/json\" },\n              body: JSON.stringify({\n                orderId: data.id,\n                customerId: user.id,\n                amountKD: finalPrice,\n                customerEmail: user.email,\n                customerPhone: user.phone,\n              }),\n            });\n            \n            const paymentData = await paymentResponse.json();\n            \n            if (paymentResponse.ok && paymentData.paymentId) {\n              setFormData({\n                carType: \"sedan\",\n                carDetails: \"\",\n                packageId: \"\",\n                address: \"\",\n                area: \"\",\n                date: \"\",\n                time: \"\",\n                paymentMethod: \"cash\",\n                pointsToRedeem: 0,\n              });\n              setStep(1);\n              setLocation(`/payment/checkout/${paymentData.paymentId}`);\n              return;\n            } else {\n              // Payment creation failed - fallback to cash and continue\n              toast({\n                title: getLocalizedText(\"تنبيه\", \"Notice\", \"Avis\"),\n                description: getLocalizedText(\n                  \"فشل إنشاء عملية الدفع. سيتم التعامل مع طلبك كدفع نقدي.\",\n                  \"Failed to create payment. Your order will be processed as cash payment.\",\n                  \"Échec de la création du paiement. Votre commande sera traitée en espèces.\"\n                ),\n              });\n              // Update order to cash payment as fallback\n              await fetch(`/api/orders/${data.id}`, {\n                method: \"PATCH\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({ paymentMethod: \"cash\" }),\n              });\n              // Continue to success flow with cash payment\n            }\n          } catch (paymentError) {\n            console.error(\"Payment creation failed:\", paymentError);\n            toast({\n              title: getLocalizedText(\"تنبيه\", \"Notice\", \"Avis\"),\n              description: getLocalizedText(\n                \"حدث خطأ في الاتصال. سيتم التعامل مع طلبك كدفع نقدي.\",\n                \"Connection error. Your order will be processed as cash payment.\",\n                \"Erreur de connexion. Votre commande sera traitée en espèces.\"\n              ),\n            });\n            // Update order to cash payment as fallback\n            try {\n              await fetch(`/api/orders/${data.id}`, {\n                method: \"PATCH\",\n                headers: { \"Content-Type\": \"application/json\" },\n                body: JSON.stringify({ paymentMethod: \"cash\" }),\n              });\n            } catch {}\n            // Continue to success flow with cash payment\n          }\n        }\n        \n        toast({\n          title: t(\"booking.success\"),\n          description: `${t(\"booking.orderNumber\")}: ${data.id}`,\n        });\n        setFormData({\n          carType: \"sedan\",\n          carDetails: \"\",\n          packageId: \"\",\n          address: \"\",\n          area: \"\",\n          date: \"\",\n          time: \"\",\n          paymentMethod: \"cash\",\n          pointsToRedeem: 0,\n        });\n        setStep(1);\n        setLocation(\"/account\");\n      } else {\n        // Use localized error message if available\n        const errorMessage = data.errorAr && i18n.language === \"ar\" \n          ? data.errorAr \n          : data.errorFr && i18n.language === \"fr\"\n            ? data.errorFr\n            : data.error || getLocalizedText(\"فشل إنشاء الحجز\", \"Failed to create booking\", \"Échec de la création de la réservation\");\n        \n        toast({\n          title: t(\"common.error\"),\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: t(\"common.error\"),\n        description: getLocalizedText(\"حدث خطأ في الاتصال. حاول مرة أخرى\", \"Connection error. Please try again\", \"Erreur de connexion. Veuillez réessayer\"),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const validateStep3 = (): boolean => {\n    const errors: typeof fieldErrors = {};\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    if (!formData.area) {\n      errors.area = getLocalizedText(\"برجاء اختيار المنطقة\", \"Please select an area\", \"Veuillez sélectionner une zone\");\n    }\n\n    if (!formData.address.trim()) {\n      errors.address = getLocalizedText(\"برجاء إدخال العنوان التفصيلي\", \"Please enter a detailed address\", \"Veuillez entrer une adresse détaillée\");\n    }\n\n    if (!formData.date) {\n      errors.date = getLocalizedText(\"برجاء اختيار التاريخ\", \"Please select a date\", \"Veuillez sélectionner une date\");\n    } else {\n      const selectedDate = new Date(formData.date);\n      selectedDate.setHours(0, 0, 0, 0);\n      if (selectedDate < today) {\n        errors.date = getLocalizedText(\"التاريخ يجب أن يكون اليوم أو في المستقبل\", \"Date must be today or in the future\", \"La date doit être aujourd'hui ou dans le futur\");\n      }\n    }\n\n    if (!formData.time) {\n      errors.time = getLocalizedText(\"برجاء اختيار الوقت\", \"Please select a time\", \"Veuillez sélectionner une heure\");\n    } else {\n      const [hours, minutes] = formData.time.split(\":\").map(Number);\n      if (hours < 6 || hours > 22 || (hours === 22 && minutes > 0)) {\n        errors.time = getLocalizedText(\"الوقت يجب أن يكون بين 6 صباحاً و 10 مساءً\", \"Time must be between 6:00 AM and 10:00 PM\", \"L'heure doit être entre 6h00 et 22h00\");\n      }\n      \n      if (formData.date === today.toISOString().split(\"T\")[0]) {\n        const now = new Date();\n        const selectedTime = new Date();\n        selectedTime.setHours(hours, minutes, 0, 0);\n        if (selectedTime <= now) {\n          errors.time = getLocalizedText(\"الوقت يجب أن يكون في المستقبل\", \"Time must be in the future\", \"L'heure doit être dans le futur\");\n        }\n      }\n    }\n\n    setFieldErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const handleNextStep = () => {\n    if (step === 3) {\n      if (validateStep3()) {\n        setFieldErrors({});\n        setStep(step + 1);\n      }\n    } else {\n      setStep(step + 1);\n    }\n  };\n\n  const canProceed = () => {\n    switch (step) {\n      case 1: return formData.carType;\n      case 2: return formData.packageId;\n      case 3: return formData.address.trim() && formData.area && formData.date && formData.time;\n      case 4: return formData.paymentMethod;\n      default: return false;\n    }\n  };\n\n  return (\n    <div className=\"py-12\">\n      <div className=\"container mx-auto px-4 max-w-4xl\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl md:text-4xl font-bold mb-2\">{t(\"booking.title\")}</h1>\n        </div>\n\n        {/* Progress Steps */}\n        <div className=\"flex items-center justify-center mb-8\">\n          {steps.map((s, index) => (\n            <div key={s.number} className=\"flex items-center\">\n              <div\n                className={`flex items-center justify-center w-10 h-10 rounded-full ${\n                  step >= s.number ? \"bg-primary text-primary-foreground\" : \"bg-muted text-muted-foreground\"\n                }`}\n              >\n                {step > s.number ? <Check className=\"h-5 w-5\" /> : <s.icon className=\"h-5 w-5\" />}\n              </div>\n              {index < steps.length - 1 && (\n                <div className={`w-12 md:w-20 h-1 mx-2 ${step > s.number ? \"bg-primary\" : \"bg-muted\"}`} />\n              )}\n            </div>\n          ))}\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>{steps[step - 1].label}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {/* Step 1: Car Type */}\n            {step === 1 && (\n              <div className=\"space-y-6\">\n                <RadioGroup\n                  value={formData.carType}\n                  onValueChange={(value) => setFormData({ ...formData, carType: value as any })}\n                  className=\"grid grid-cols-1 md:grid-cols-3 gap-4\"\n                >\n                  {[\"sedan\", \"suv\", \"other\"].map((type) => (\n                    <Label\n                      key={type}\n                      className={`flex flex-col items-center p-6 rounded-lg border-2 cursor-pointer transition-colors ${\n                        formData.carType === type ? \"border-primary bg-primary/5\" : \"border-muted hover:border-primary/50\"\n                      }`}\n                    >\n                      <RadioGroupItem value={type} className=\"sr-only\" />\n                      <Car className=\"h-12 w-12 mb-3 text-primary\" />\n                      <span className=\"font-medium\">\n                        {type === \"sedan\" ? t(\"services.sedan\") : type === \"suv\" ? t(\"services.suv\") : getLocalizedText(\"أخرى\", \"Other\", \"Autre\")}\n                      </span>\n                    </Label>\n                  ))}\n                </RadioGroup>\n\n                <div className=\"space-y-2\">\n                  <Label>{t(\"booking.carDetails\")}</Label>\n                  <Input\n                    value={formData.carDetails}\n                    onChange={(e) => setFormData({ ...formData, carDetails: e.target.value })}\n                    placeholder={getLocalizedText(\"مثال: تويوتا كامري أبيض\", \"e.g., Toyota Camry White\", \"ex: Toyota Camry Blanche\")}\n                    data-testid=\"input-car-details\"\n                  />\n                </div>\n              </div>\n            )}\n\n            {/* Step 2: Select Package */}\n            {step === 2 && (\n              <RadioGroup\n                value={formData.packageId}\n                onValueChange={(value) => setFormData({ ...formData, packageId: value })}\n                className=\"grid grid-cols-1 md:grid-cols-2 gap-4\"\n              >\n                {displayPackages.filter(p => p.isActive).map((pkg) => (\n                  <Label\n                    key={pkg.id}\n                    className={`flex flex-col p-4 rounded-lg border-2 cursor-pointer transition-colors ${\n                      formData.packageId === pkg.id ? \"border-primary bg-primary/5\" : \"border-muted hover:border-primary/50\"\n                    }`}\n                  >\n                    <RadioGroupItem value={pkg.id} className=\"sr-only\" />\n                    <span className=\"font-semibold mb-1\">\n                      {getLocalizedText(pkg.nameAr, pkg.nameEn, pkg.nameFr)}\n                    </span>\n                    <span className=\"text-primary font-bold\">\n                      {formData.carType === \"suv\" ? pkg.priceSuvKD : pkg.priceSedanKD} {t(\"services.kd\")}\n                    </span>\n                    <span className=\"text-sm text-muted-foreground mt-1\">\n                      {pkg.estimatedMinutes} {t(\"services.minutes\")}\n                    </span>\n                  </Label>\n                ))}\n              </RadioGroup>\n            )}\n\n            {/* Step 3: Location & Time */}\n            {step === 3 && (\n              <div className=\"space-y-6\">\n                <div className=\"space-y-2\">\n                  <Label className=\"flex items-center gap-2\">\n                    <MapPin className=\"h-4 w-4 text-primary\" />\n                    {getLocalizedText(\"المنطقة\", \"Area\", \"Zone\")}\n                    <span className=\"text-destructive\">*</span>\n                  </Label>\n                  <Select\n                    value={formData.area}\n                    onValueChange={(value) => {\n                      setFormData({ ...formData, area: value });\n                      if (fieldErrors.area) setFieldErrors(prev => ({ ...prev, area: undefined }));\n                    }}\n                  >\n                    <SelectTrigger data-testid=\"select-area\" className={fieldErrors.area ? \"border-destructive\" : \"\"}>\n                      <SelectValue placeholder={getLocalizedText(\"اختر المنطقة\", \"Select area\", \"Sélectionner la zone\")} />\n                    </SelectTrigger>\n                    <SelectContent className=\"max-h-[300px]\">\n                      <SelectGroup>\n                        <SelectLabel className=\"text-green-600 font-semibold\">\n                          {getLocalizedText(\"متاحة الآن\", \"Available Now\", \"Disponible maintenant\")}\n                        </SelectLabel>\n                        {availableAreas.map((area) => (\n                          <SelectItem key={area.nameEn} value={area.nameEn} data-testid={`area-available-${area.nameEn}`}>\n                            <span className=\"flex items-center gap-2\">\n                              <Check className=\"h-3 w-3 text-green-600\" />\n                              {getLocalizedText(area.nameAr, area.nameEn, area.nameFr)}\n                            </span>\n                          </SelectItem>\n                        ))}\n                      </SelectGroup>\n                      <SelectGroup>\n                        <SelectLabel className=\"text-orange-500 font-semibold\">\n                          {getLocalizedText(\"متاحة قريباً\", \"Available Soon\", \"Bientôt disponible\")}\n                        </SelectLabel>\n                        {comingSoonAreas.map((area) => (\n                          <SelectItem key={area.nameEn} value={area.nameEn} data-testid={`area-soon-${area.nameEn}`}>\n                            <span className=\"flex items-center gap-2 text-muted-foreground\">\n                              <Clock className=\"h-3 w-3 text-orange-500\" />\n                              {getLocalizedText(area.nameAr, area.nameEn, area.nameFr)}\n                            </span>\n                          </SelectItem>\n                        ))}\n                      </SelectGroup>\n                    </SelectContent>\n                  </Select>\n                  {fieldErrors.area && (\n                    <p className=\"text-sm text-destructive\">{fieldErrors.area}</p>\n                  )}\n                  {formData.area && !isAreaAvailable && (\n                    <div className=\"p-3 rounded-md bg-orange-50 dark:bg-orange-950/20 border border-orange-200 dark:border-orange-800\">\n                      <p className=\"text-sm text-orange-700 dark:text-orange-400 flex items-center gap-2\">\n                        <Clock className=\"h-4 w-4\" />\n                        {getLocalizedText(\n                          \"الخدمة متاحة قريباً في هذه المنطقة. سجل طلبك وسنشعرك فور تغطية منطقتك.\",\n                          \"Service coming soon to this area. Register your request and we'll notify you when coverage begins.\",\n                          \"Service bientôt disponible dans cette zone. Inscrivez-vous et nous vous informerons dès le début de la couverture.\"\n                        )}\n                      </p>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"flex items-center gap-2\">\n                    <Navigation className=\"h-4 w-4 text-primary\" />\n                    {getLocalizedText(\"العنوان التفصيلي\", \"Detailed Address\", \"Adresse Détaillée\")}\n                    <span className=\"text-destructive\">*</span>\n                  </Label>\n                  <div className=\"flex gap-2\">\n                    <div className=\"relative flex-1\">\n                      <Input\n                        value={formData.address}\n                        onChange={(e) => {\n                          setFormData({ ...formData, address: e.target.value });\n                          setLocationDetected(false);\n                          if (fieldErrors.address) setFieldErrors(prev => ({ ...prev, address: undefined }));\n                        }}\n                        placeholder={getLocalizedText(\"أدخل العنوان أو اضغط على زر الموقع\", \"Enter address or click location button\", \"Entrez l'adresse ou cliquez sur le bouton de localisation\")}\n                        className={fieldErrors.address ? \"border-destructive\" : \"\"}\n                        data-testid=\"input-address\"\n                      />\n                    </div>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"icon\"\n                      onClick={() => setShowMapPicker(true)}\n                      data-testid=\"button-open-map\"\n                      title={getLocalizedText(\"اختر الموقع من الخريطة\", \"Select location from map\", \"Sélectionner l'emplacement sur la carte\")}\n                    >\n                      <Map className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      size=\"icon\"\n                      onClick={handleGetLocation}\n                      disabled={isLocating}\n                      data-testid=\"button-get-location\"\n                      title={getLocalizedText(\"تحديد الموقع تلقائياً\", \"Auto-detect location\", \"Détecter l'emplacement automatiquement\")}\n                    >\n                      {isLocating ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Navigation className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n                  </div>\n                  {fieldErrors.address && (\n                    <p className=\"text-sm text-destructive\">{fieldErrors.address}</p>\n                  )}\n                  {locationDetected && !fieldErrors.address && (\n                    <p className=\"text-sm text-green-600 flex items-center gap-1\">\n                      <Check className=\"h-3 w-3\" />\n                      {getLocalizedText(\"تم تحديد موقعك تلقائياً\", \"Location detected automatically\", \"Emplacement détecté automatiquement\")}\n                    </p>\n                  )}\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label className=\"flex items-center gap-2\">\n                      <Calendar className=\"h-4 w-4 text-primary\" />\n                      {getLocalizedText(\"التاريخ\", \"Date\", \"Date\")}\n                      <span className=\"text-destructive\">*</span>\n                    </Label>\n                    <Input\n                      type=\"date\"\n                      value={formData.date}\n                      onChange={(e) => {\n                        setFormData({ ...formData, date: e.target.value, time: \"\" });\n                        if (fieldErrors.date) setFieldErrors(prev => ({ ...prev, date: undefined }));\n                      }}\n                      min={new Date().toISOString().split(\"T\")[0]}\n                      className={`cursor-pointer ${fieldErrors.date ? \"border-destructive\" : \"\"}`}\n                      data-testid=\"input-date\"\n                    />\n                    {fieldErrors.date && (\n                      <p className=\"text-sm text-destructive\">{fieldErrors.date}</p>\n                    )}\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label className=\"flex items-center gap-2\">\n                      <Clock className=\"h-4 w-4 text-primary\" />\n                      {getLocalizedText(\"الوقت\", \"Time\", \"Heure\")}\n                      <span className=\"text-destructive\">*</span>\n                    </Label>\n                    <Input\n                      type=\"time\"\n                      value={formData.time}\n                      onChange={(e) => {\n                        setFormData({ ...formData, time: e.target.value });\n                        if (fieldErrors.time) setFieldErrors(prev => ({ ...prev, time: undefined }));\n                      }}\n                      min={getMinTime()}\n                      max=\"22:00\"\n                      className={`cursor-pointer ${fieldErrors.time ? \"border-destructive\" : \"\"}`}\n                      data-testid=\"input-time\"\n                    />\n                    {fieldErrors.time ? (\n                      <p className=\"text-sm text-destructive\">{fieldErrors.time}</p>\n                    ) : (\n                      <p className=\"text-xs text-muted-foreground\">\n                        {getLocalizedText(\"من 6 صباحاً إلى 10 مساءً\", \"6:00 AM to 10:00 PM\", \"De 6h00 à 22h00\")}\n                      </p>\n                    )}\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Step 4: Payment */}\n            {step === 4 && (\n              <div className=\"space-y-6\">\n                <RadioGroup\n                  value={formData.paymentMethod}\n                  onValueChange={(value) => setFormData({ ...formData, paymentMethod: value as any })}\n                  className=\"grid grid-cols-1 md:grid-cols-2 gap-4\"\n                >\n                  <Label\n                    className={`flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-colors ${\n                      formData.paymentMethod === \"cash\" ? \"border-primary bg-primary/5\" : \"border-muted hover:border-primary/50\"\n                    }`}\n                  >\n                    <RadioGroupItem value=\"cash\" className=\"sr-only\" />\n                    <div className=\"w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center\">\n                      <span className=\"text-2xl\">💵</span>\n                    </div>\n                    <span className=\"font-medium\">{t(\"booking.cash\")}</span>\n                  </Label>\n                  <Label\n                    className={`flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-colors ${\n                      formData.paymentMethod === \"online\" ? \"border-primary bg-primary/5\" : \"border-muted hover:border-primary/50\"\n                    }`}\n                  >\n                    <RadioGroupItem value=\"online\" className=\"sr-only\" />\n                    <div className=\"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center\">\n                      <CreditCard className=\"h-6 w-6 text-blue-600\" />\n                    </div>\n                    <span className=\"font-medium\">{t(\"booking.online\")}</span>\n                  </Label>\n                </RadioGroup>\n\n                {user && user.loyaltyPoints > 0 && (\n                  <div className=\"p-4 rounded-lg bg-muted/50 space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"font-medium\">{t(\"booking.redeemPoints\")}</span>\n                      <span className=\"text-sm text-muted-foreground\">\n                        {t(\"booking.availablePoints\")}: {user.loyaltyPoints}\n                      </span>\n                    </div>\n                    <Slider\n                      value={[formData.pointsToRedeem]}\n                      onValueChange={([value]) => setFormData({ ...formData, pointsToRedeem: value })}\n                      max={maxAllowedPoints}\n                      step={10}\n                    />\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span>{t(\"booking.pointsToRedeem\")}: {formData.pointsToRedeem}</span>\n                      <span className=\"text-primary font-medium\">\n                        {t(\"booking.discount\")}: {discount.toFixed(3)} {t(\"services.kd\")}\n                      </span>\n                    </div>\n                  </div>\n                )}\n\n                {/* Order Summary */}\n                <div className=\"p-4 rounded-lg bg-card border space-y-2\">\n                  <h4 className=\"font-semibold mb-3\">\n                    {getLocalizedText(\"ملخص الطلب\", \"Order Summary\", \"Résumé de la Commande\")}\n                  </h4>\n                  {selectedPackage && (\n                    <>\n                      <div className=\"flex justify-between\">\n                        <span>{getLocalizedText(selectedPackage.nameAr, selectedPackage.nameEn, selectedPackage.nameFr)}</span>\n                        <span>{basePrice} {t(\"services.kd\")}</span>\n                      </div>\n                      {discount > 0 && (\n                        <div className=\"flex justify-between text-green-600\">\n                          <span>{t(\"booking.discount\")}</span>\n                          <span>-{discount.toFixed(3)} {t(\"services.kd\")}</span>\n                        </div>\n                      )}\n                      <div className=\"flex justify-between font-bold text-lg pt-2 border-t\">\n                        <span>{t(\"booking.total\")}</span>\n                        <span className=\"text-primary\">{finalPrice.toFixed(3)} {t(\"services.kd\")}</span>\n                      </div>\n                    </>\n                  )}\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Navigation Buttons */}\n        <div className=\"flex justify-between mt-6\">\n          <Button\n            variant=\"outline\"\n            onClick={() => setStep(step - 1)}\n            disabled={step === 1}\n            data-testid=\"button-back\"\n          >\n            {i18n.language === \"ar\" ? <ChevronRight className=\"h-4 w-4 me-2\" /> : <ChevronLeft className=\"h-4 w-4 me-2\" />}\n            {t(\"booking.back\")}\n          </Button>\n\n          {step < 4 ? (\n            <Button\n              onClick={handleNextStep}\n              disabled={!canProceed()}\n              data-testid=\"button-next\"\n            >\n              {t(\"booking.next\")}\n              {i18n.language === \"ar\" ? <ChevronLeft className=\"h-4 w-4 ms-2\" /> : <ChevronRight className=\"h-4 w-4 ms-2\" />}\n            </Button>\n          ) : (\n            <Button\n              onClick={handleSubmit}\n              disabled={!canProceed() || isSubmitting}\n              data-testid=\"button-confirm\"\n            >\n              {isSubmitting ? t(\"common.loading\") : t(\"booking.confirm\")}\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* Map Picker Modal */}\n      {showMapPicker && (\n        <MapPicker\n          language={i18n.language}\n          onLocationSelect={(lat, lng, address) => {\n            setFormData(prev => ({ ...prev, address }));\n            setLocationDetected(true);\n            setShowMapPicker(false);\n            if (fieldErrors.address) setFieldErrors(prev => ({ ...prev, address: undefined }));\n            toast({\n              title: getLocalizedText(\"تم تحديد الموقع\", \"Location Selected\", \"Emplacement Sélectionné\"),\n              description: getLocalizedText(\n                \"تم تحديد موقعك بنجاح\",\n                \"Your location has been set successfully\",\n                \"Votre emplacement a été défini avec succès\"\n              ),\n            });\n          }}\n          onClose={() => setShowMapPicker(false)}\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":38238,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { useEffect } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider } from \"@/context/AuthContext\";\nimport { ThemeProvider } from \"@/context/ThemeContext\";\nimport { Layout } from \"@/components/layout/Layout\";\nimport \"@/lib/i18n\";\n\nimport Home from \"@/pages/Home\";\nimport About from \"@/pages/About\";\nimport Services from \"@/pages/Services\";\nimport Booking from \"@/pages/Booking\";\nimport Loyalty from \"@/pages/Loyalty\";\nimport FriendsClub from \"@/pages/FriendsClub\";\nimport Contact from \"@/pages/Contact\";\nimport Login from \"@/pages/Login\";\nimport Register from \"@/pages/Register\";\nimport Account from \"@/pages/Account\";\nimport AdminDashboard from \"@/pages/admin/Dashboard\";\nimport DelegateDashboard from \"@/pages/delegate/Dashboard\";\nimport TrackOrder from \"@/pages/TrackOrder\";\nimport Blog from \"@/pages/Blog\";\nimport Offers from \"@/pages/Offers\";\nimport PrivacyPolicy from \"@/pages/PrivacyPolicy\";\nimport TermsOfService from \"@/pages/TermsOfService\";\nimport DeleteAccount from \"@/pages/DeleteAccount\";\nimport Checkout from \"@/pages/Checkout\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Home} />\n      <Route path=\"/about\" component={About} />\n      <Route path=\"/services\" component={Services} />\n      <Route path=\"/offers\" component={Offers} />\n      <Route path=\"/booking\" component={Booking} />\n      <Route path=\"/loyalty\" component={Loyalty} />\n      <Route path=\"/friends-club\" component={FriendsClub} />\n      <Route path=\"/contact\" component={Contact} />\n      <Route path=\"/login\" component={Login} />\n      <Route path=\"/register\" component={Register} />\n      <Route path=\"/account\" component={Account} />\n      <Route path=\"/track-order\" component={TrackOrder} />\n      <Route path=\"/blog\" component={Blog} />\n      <Route path=\"/blog/:id\" component={Blog} />\n      <Route path=\"/admin\" component={AdminDashboard} />\n      <Route path=\"/admin/:section\" component={AdminDashboard} />\n      <Route path=\"/delegate\" component={DelegateDashboard} />\n      <Route path=\"/delegate/:section\" component={DelegateDashboard} />\n      <Route path=\"/privacy-policy\" component={PrivacyPolicy} />\n      <Route path=\"/terms-of-service\" component={TermsOfService} />\n      <Route path=\"/delete-account\" component={DeleteAccount} />\n      <Route path=\"/payment/checkout/:paymentId\" component={Checkout} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  const { i18n } = useTranslation();\n\n  useEffect(() => {\n    document.documentElement.dir = i18n.language === \"ar\" ? \"rtl\" : \"ltr\";\n    document.documentElement.lang = i18n.language;\n  }, [i18n.language]);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <AuthProvider>\n          <TooltipProvider>\n            <Layout>\n              <Router />\n            </Layout>\n            <Toaster />\n          </TooltipProvider>\n        </AuthProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":3315,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"server/storage.ts":{"content":"import { db } from \"./db\";\nimport { eq, desc, and, gte, lte, lt, sql, count } from \"drizzle-orm\";\nimport { randomUUID } from \"crypto\";\nimport {\n  users, servicePackages, orders, loyaltyConfig, loyaltyTransactions,\n  referrals, blogPosts, testimonials, galleryItems, contactMessages, auditLogs, orderRatings, offers, payments,\n  type User, type InsertUser, type ServicePackage, type InsertServicePackage,\n  type Order, type InsertOrder, type LoyaltyConfig, type InsertLoyaltyConfig,\n  type LoyaltyTransaction, type InsertLoyaltyTransaction, type Referral, type InsertReferral,\n  type BlogPost, type InsertBlogPost, type Testimonial, type InsertTestimonial,\n  type GalleryItem, type InsertGalleryItem, type ContactMessage, type InsertContactMessage,\n  type AuditLog, type InsertAuditLog, type OrderRating, type InsertOrderRating,\n  type Offer, type InsertOffer, type Payment, type InsertPayment\n} from \"@shared/schema\";\n\nfunction generateReferralCode(): string {\n  const chars = \"ABCDEFGHJKLMNPQRSTUVWXYZ23456789\";\n  let code = \"GS\";\n  for (let i = 0; i < 6; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return code;\n}\n\nexport interface IStorage {\n  // Users\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByReferralCode(code: string): Promise<User | undefined>;\n  createUser(user: InsertUser & { id: string }): Promise<User>;\n  updateUser(id: string, data: Partial<User>): Promise<User | undefined>;\n  getUsers(filters?: { role?: string; status?: string }): Promise<User[]>;\n\n  // Service Packages\n  getServicePackage(id: string): Promise<ServicePackage | undefined>;\n  getServicePackages(activeOnly?: boolean): Promise<ServicePackage[]>;\n  createServicePackage(pkg: InsertServicePackage): Promise<ServicePackage>;\n  updateServicePackage(id: string, data: Partial<ServicePackage>): Promise<ServicePackage | undefined>;\n  deleteServicePackage(id: string): Promise<boolean>;\n\n  // Orders\n  getOrder(id: string): Promise<Order | undefined>;\n  getOrderByPartialId(partialId: string): Promise<Order | undefined>;\n  getOrdersByCustomer(customerId: string): Promise<Order[]>;\n  getOrders(filters?: { status?: string; startDate?: Date; endDate?: Date; assignedDriver?: string }): Promise<Order[]>;\n  createOrder(order: InsertOrder): Promise<Order>;\n  updateOrder(id: string, data: Partial<Order>): Promise<Order | undefined>;\n\n  // Loyalty Config\n  getLoyaltyConfig(): Promise<LoyaltyConfig>;\n  updateLoyaltyConfig(data: Partial<LoyaltyConfig>): Promise<LoyaltyConfig>;\n\n  // Loyalty Transactions\n  getLoyaltyTransactions(customerId: string): Promise<LoyaltyTransaction[]>;\n  createLoyaltyTransaction(tx: InsertLoyaltyTransaction): Promise<LoyaltyTransaction>;\n\n  // Referrals\n  getReferral(id: string): Promise<Referral | undefined>;\n  getReferralsByReferrer(referrerId: string): Promise<Referral[]>;\n  getReferralByReferred(referredId: string): Promise<Referral | undefined>;\n  createReferral(ref: InsertReferral): Promise<Referral>;\n  updateReferral(id: string, data: Partial<Referral>): Promise<Referral | undefined>;\n\n  // Blog Posts\n  getBlogPost(id: string): Promise<BlogPost | undefined>;\n  getBlogPosts(publishedOnly?: boolean): Promise<BlogPost[]>;\n  createBlogPost(post: InsertBlogPost): Promise<BlogPost>;\n  updateBlogPost(id: string, data: Partial<BlogPost>): Promise<BlogPost | undefined>;\n  deleteBlogPost(id: string): Promise<boolean>;\n\n  // Testimonials\n  getTestimonial(id: string): Promise<Testimonial | undefined>;\n  getTestimonials(approvedOnly?: boolean): Promise<Testimonial[]>;\n  createTestimonial(testimonial: InsertTestimonial): Promise<Testimonial>;\n  updateTestimonial(id: string, data: Partial<Testimonial>): Promise<Testimonial | undefined>;\n  deleteTestimonial(id: string): Promise<boolean>;\n\n  // Gallery Items\n  getGalleryItem(id: string): Promise<GalleryItem | undefined>;\n  getGalleryItems(publishedOnly?: boolean): Promise<GalleryItem[]>;\n  createGalleryItem(item: InsertGalleryItem): Promise<GalleryItem>;\n  updateGalleryItem(id: string, data: Partial<GalleryItem>): Promise<GalleryItem | undefined>;\n  deleteGalleryItem(id: string): Promise<boolean>;\n\n  // Contact Messages\n  getContactMessage(id: string): Promise<ContactMessage | undefined>;\n  getContactMessages(): Promise<ContactMessage[]>;\n  createContactMessage(msg: InsertContactMessage): Promise<ContactMessage>;\n  markContactMessageRead(id: string): Promise<boolean>;\n  deleteContactMessage(id: string): Promise<boolean>;\n\n  // Audit Logs\n  getAuditLogs(filters?: { performedBy?: string; targetCollection?: string }): Promise<AuditLog[]>;\n  createAuditLog(log: InsertAuditLog): Promise<AuditLog>;\n  clearAuditLogs(olderThanDays?: number): Promise<number>;\n\n  // Order Ratings\n  getOrderRating(orderId: string): Promise<OrderRating | undefined>;\n  getOrderRatingsByDelegate(delegateId: string): Promise<OrderRating[]>;\n  createOrderRating(rating: InsertOrderRating): Promise<OrderRating>;\n\n  // Offers\n  getOffer(id: string): Promise<Offer | undefined>;\n  getOffers(activeOnly?: boolean): Promise<Offer[]>;\n  getActiveOffers(): Promise<Offer[]>;\n  createOffer(offer: InsertOffer): Promise<Offer>;\n  updateOffer(id: string, data: Partial<Offer>): Promise<Offer | undefined>;\n  deleteOffer(id: string): Promise<boolean>;\n\n  // Payments\n  getPayment(id: string): Promise<Payment | undefined>;\n  getPaymentByOrderId(orderId: string): Promise<Payment | undefined>;\n  getPaymentByGatewayId(gatewayChargeId: string): Promise<Payment | undefined>;\n  getPaymentsByCustomer(customerId: string): Promise<Payment[]>;\n  createPayment(payment: InsertPayment): Promise<Payment>;\n  updatePayment(id: string, data: Partial<Payment>): Promise<Payment | undefined>;\n\n  // Analytics\n  getAnalytics(startDate: Date, endDate: Date): Promise<{\n    totalIncome: number;\n    totalOrders: number;\n    completedOrders: number;\n    cancelledOrders: number;\n    newCustomers: number;\n    pointsIssued: number;\n    pointsRedeemed: number;\n    referralCount: number;\n  }>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Users\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async getUserByReferralCode(code: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.referralCode, code));\n    return user;\n  }\n\n  async createUser(user: InsertUser & { id: string }): Promise<User> {\n    const referralCode = generateReferralCode();\n    const [created] = await db.insert(users).values({\n      ...user,\n      referralCode,\n      loyaltyPoints: 0,\n    }).returning();\n    return created;\n  }\n\n  async updateUser(id: string, data: Partial<User>): Promise<User | undefined> {\n    const [updated] = await db.update(users).set(data).where(eq(users.id, id)).returning();\n    return updated;\n  }\n\n  async getUsers(filters?: { role?: string; status?: string }): Promise<User[]> {\n    let query = db.select().from(users);\n    const conditions = [];\n    if (filters?.role) conditions.push(eq(users.role, filters.role as any));\n    if (filters?.status) conditions.push(eq(users.status, filters.status as any));\n    if (conditions.length > 0) {\n      return db.select().from(users).where(and(...conditions)).orderBy(desc(users.createdAt));\n    }\n    return db.select().from(users).orderBy(desc(users.createdAt));\n  }\n\n  // Service Packages\n  async getServicePackage(id: string): Promise<ServicePackage | undefined> {\n    const [pkg] = await db.select().from(servicePackages).where(eq(servicePackages.id, id));\n    return pkg;\n  }\n\n  async getServicePackages(activeOnly = false): Promise<ServicePackage[]> {\n    if (activeOnly) {\n      return db.select().from(servicePackages).where(eq(servicePackages.isActive, true)).orderBy(servicePackages.priceSedanKD);\n    }\n    return db.select().from(servicePackages).orderBy(servicePackages.priceSedanKD);\n  }\n\n  async createServicePackage(pkg: InsertServicePackage): Promise<ServicePackage> {\n    const id = randomUUID();\n    const [created] = await db.insert(servicePackages).values({ ...pkg, id }).returning();\n    return created;\n  }\n\n  async updateServicePackage(id: string, data: Partial<ServicePackage>): Promise<ServicePackage | undefined> {\n    const [updated] = await db.update(servicePackages).set(data).where(eq(servicePackages.id, id)).returning();\n    return updated;\n  }\n\n  async deleteServicePackage(id: string): Promise<boolean> {\n    const result = await db.delete(servicePackages).where(eq(servicePackages.id, id));\n    return true;\n  }\n\n  // Orders\n  async getOrder(id: string): Promise<Order | undefined> {\n    const [order] = await db.select().from(orders).where(eq(orders.id, id));\n    return order;\n  }\n\n  async getOrderByPartialId(partialId: string): Promise<Order | undefined> {\n    // First try exact match\n    const [exactOrder] = await db.select().from(orders).where(eq(orders.id, partialId));\n    if (exactOrder) return exactOrder;\n    \n    // Then try partial match (ID starts with the given partial)\n    const [partialOrder] = await db.select().from(orders)\n      .where(sql`${orders.id} LIKE ${partialId + '%'}`)\n      .limit(1);\n    return partialOrder;\n  }\n\n  async getOrdersByCustomer(customerId: string): Promise<Order[]> {\n    return db.select().from(orders).where(eq(orders.customerId, customerId)).orderBy(desc(orders.createdAt));\n  }\n\n  async getOrders(filters?: { status?: string; startDate?: Date; endDate?: Date; assignedDriver?: string }): Promise<Order[]> {\n    const conditions = [];\n    if (filters?.status) conditions.push(eq(orders.status, filters.status as any));\n    if (filters?.startDate) conditions.push(gte(orders.createdAt, filters.startDate));\n    if (filters?.endDate) conditions.push(lte(orders.createdAt, filters.endDate));\n    if (filters?.assignedDriver) conditions.push(eq(orders.assignedDriver, filters.assignedDriver));\n    if (conditions.length > 0) {\n      return db.select().from(orders).where(and(...conditions)).orderBy(desc(orders.createdAt));\n    }\n    return db.select().from(orders).orderBy(desc(orders.createdAt));\n  }\n\n  async createOrder(order: InsertOrder): Promise<Order> {\n    const id = randomUUID();\n    const [created] = await db.insert(orders).values({ ...order, id }).returning();\n    return created;\n  }\n\n  async updateOrder(id: string, data: Partial<Order>): Promise<Order | undefined> {\n    const updateData = { ...data, updatedAt: new Date() };\n    const [updated] = await db.update(orders).set(updateData).where(eq(orders.id, id)).returning();\n    return updated;\n  }\n\n  // Loyalty Config\n  async getLoyaltyConfig(): Promise<LoyaltyConfig> {\n    const [config] = await db.select().from(loyaltyConfig);\n    if (!config) {\n      const id = \"default\";\n      const [created] = await db.insert(loyaltyConfig).values({\n        id,\n        pointsPerKD: 35,\n        conversionRate: 0.004,\n        maxRedeemPercentage: 0.15,\n        welcomeBonusPoints: 200,\n        referrerBonusPoints: 400,\n        referredWelcomePoints: 200,\n        firstOrderDiscount: 0.15,\n      }).returning();\n      return created;\n    }\n    return config;\n  }\n\n  async updateLoyaltyConfig(data: Partial<LoyaltyConfig>): Promise<LoyaltyConfig> {\n    const config = await this.getLoyaltyConfig();\n    const [updated] = await db.update(loyaltyConfig).set({ ...data, updatedAt: new Date() }).where(eq(loyaltyConfig.id, config.id)).returning();\n    return updated;\n  }\n\n  // Loyalty Transactions\n  async getLoyaltyTransactions(customerId: string): Promise<LoyaltyTransaction[]> {\n    return db.select().from(loyaltyTransactions).where(eq(loyaltyTransactions.customerId, customerId)).orderBy(desc(loyaltyTransactions.createdAt));\n  }\n\n  async createLoyaltyTransaction(tx: InsertLoyaltyTransaction): Promise<LoyaltyTransaction> {\n    const id = randomUUID();\n    const [created] = await db.insert(loyaltyTransactions).values({ ...tx, id }).returning();\n    return created;\n  }\n\n  // Referrals\n  async getReferral(id: string): Promise<Referral | undefined> {\n    const [ref] = await db.select().from(referrals).where(eq(referrals.id, id));\n    return ref;\n  }\n\n  async getReferralsByReferrer(referrerId: string): Promise<Referral[]> {\n    return db.select().from(referrals).where(eq(referrals.referrerId, referrerId)).orderBy(desc(referrals.createdAt));\n  }\n\n  async getReferralByReferred(referredId: string): Promise<Referral | undefined> {\n    const [ref] = await db.select().from(referrals).where(eq(referrals.referredCustomerId, referredId));\n    return ref;\n  }\n\n  async createReferral(ref: InsertReferral): Promise<Referral> {\n    const id = randomUUID();\n    const [created] = await db.insert(referrals).values({ ...ref, id }).returning();\n    return created;\n  }\n\n  async updateReferral(id: string, data: Partial<Referral>): Promise<Referral | undefined> {\n    const [updated] = await db.update(referrals).set(data).where(eq(referrals.id, id)).returning();\n    return updated;\n  }\n\n  // Blog Posts\n  async getBlogPost(id: string): Promise<BlogPost | undefined> {\n    const [post] = await db.select().from(blogPosts).where(eq(blogPosts.id, id));\n    return post;\n  }\n\n  async getBlogPosts(publishedOnly = false): Promise<BlogPost[]> {\n    if (publishedOnly) {\n      return db.select().from(blogPosts).where(eq(blogPosts.isPublished, true)).orderBy(desc(blogPosts.createdAt));\n    }\n    return db.select().from(blogPosts).orderBy(desc(blogPosts.createdAt));\n  }\n\n  async createBlogPost(post: InsertBlogPost): Promise<BlogPost> {\n    const id = randomUUID();\n    const [created] = await db.insert(blogPosts).values({ ...post, id }).returning();\n    return created;\n  }\n\n  async updateBlogPost(id: string, data: Partial<BlogPost>): Promise<BlogPost | undefined> {\n    const [updated] = await db.update(blogPosts).set({ ...data, updatedAt: new Date() }).where(eq(blogPosts.id, id)).returning();\n    return updated;\n  }\n\n  async deleteBlogPost(id: string): Promise<boolean> {\n    await db.delete(blogPosts).where(eq(blogPosts.id, id));\n    return true;\n  }\n\n  // Testimonials\n  async getTestimonial(id: string): Promise<Testimonial | undefined> {\n    const [t] = await db.select().from(testimonials).where(eq(testimonials.id, id));\n    return t;\n  }\n\n  async getTestimonials(approvedOnly = false): Promise<Testimonial[]> {\n    if (approvedOnly) {\n      return db.select().from(testimonials).where(eq(testimonials.isApproved, true)).orderBy(desc(testimonials.createdAt));\n    }\n    return db.select().from(testimonials).orderBy(desc(testimonials.createdAt));\n  }\n\n  async createTestimonial(testimonial: InsertTestimonial): Promise<Testimonial> {\n    const id = randomUUID();\n    const [created] = await db.insert(testimonials).values({ ...testimonial, id }).returning();\n    return created;\n  }\n\n  async updateTestimonial(id: string, data: Partial<Testimonial>): Promise<Testimonial | undefined> {\n    const [updated] = await db.update(testimonials).set(data).where(eq(testimonials.id, id)).returning();\n    return updated;\n  }\n\n  async deleteTestimonial(id: string): Promise<boolean> {\n    await db.delete(testimonials).where(eq(testimonials.id, id));\n    return true;\n  }\n\n  // Gallery Items\n  async getGalleryItem(id: string): Promise<GalleryItem | undefined> {\n    const [item] = await db.select().from(galleryItems).where(eq(galleryItems.id, id));\n    return item;\n  }\n\n  async getGalleryItems(publishedOnly = false): Promise<GalleryItem[]> {\n    if (publishedOnly) {\n      return db.select().from(galleryItems).where(eq(galleryItems.isPublished, true)).orderBy(desc(galleryItems.createdAt));\n    }\n    return db.select().from(galleryItems).orderBy(desc(galleryItems.createdAt));\n  }\n\n  async createGalleryItem(item: InsertGalleryItem): Promise<GalleryItem> {\n    const id = randomUUID();\n    const [created] = await db.insert(galleryItems).values({ ...item, id }).returning();\n    return created;\n  }\n\n  async updateGalleryItem(id: string, data: Partial<GalleryItem>): Promise<GalleryItem | undefined> {\n    const [updated] = await db.update(galleryItems).set(data).where(eq(galleryItems.id, id)).returning();\n    return updated;\n  }\n\n  async deleteGalleryItem(id: string): Promise<boolean> {\n    await db.delete(galleryItems).where(eq(galleryItems.id, id));\n    return true;\n  }\n\n  // Contact Messages\n  async getContactMessage(id: string): Promise<ContactMessage | undefined> {\n    const [msg] = await db.select().from(contactMessages).where(eq(contactMessages.id, id));\n    return msg;\n  }\n\n  async getContactMessages(): Promise<ContactMessage[]> {\n    return db.select().from(contactMessages).orderBy(desc(contactMessages.createdAt));\n  }\n\n  async createContactMessage(msg: InsertContactMessage): Promise<ContactMessage> {\n    const id = randomUUID();\n    const [created] = await db.insert(contactMessages).values({ ...msg, id }).returning();\n    return created;\n  }\n\n  async markContactMessageRead(id: string): Promise<boolean> {\n    await db.update(contactMessages).set({ isRead: true }).where(eq(contactMessages.id, id));\n    return true;\n  }\n\n  async deleteContactMessage(id: string): Promise<boolean> {\n    await db.delete(contactMessages).where(eq(contactMessages.id, id));\n    return true;\n  }\n\n  // Audit Logs\n  async getAuditLogs(filters?: { performedBy?: string; targetCollection?: string }): Promise<AuditLog[]> {\n    const conditions = [];\n    if (filters?.performedBy) conditions.push(eq(auditLogs.performedBy, filters.performedBy));\n    if (filters?.targetCollection) conditions.push(eq(auditLogs.targetCollection, filters.targetCollection));\n    if (conditions.length > 0) {\n      return db.select().from(auditLogs).where(and(...conditions)).orderBy(desc(auditLogs.performedAt));\n    }\n    return db.select().from(auditLogs).orderBy(desc(auditLogs.performedAt));\n  }\n\n  async createAuditLog(log: InsertAuditLog): Promise<AuditLog> {\n    const id = randomUUID();\n    const [created] = await db.insert(auditLogs).values({ ...log, id }).returning();\n    return created;\n  }\n\n  async clearAuditLogs(olderThanDays?: number): Promise<number> {\n    if (olderThanDays && olderThanDays > 0) {\n      const cutoffDate = new Date();\n      cutoffDate.setDate(cutoffDate.getDate() - olderThanDays);\n      const result = await db.delete(auditLogs).where(lt(auditLogs.performedAt, cutoffDate)).returning();\n      return result.length;\n    }\n    const result = await db.delete(auditLogs).returning();\n    return result.length;\n  }\n\n  // Order Ratings\n  async getOrderRating(orderId: string): Promise<OrderRating | undefined> {\n    const [rating] = await db.select().from(orderRatings).where(eq(orderRatings.orderId, orderId));\n    return rating;\n  }\n\n  async getOrderRatingsByDelegate(delegateId: string): Promise<OrderRating[]> {\n    return db.select().from(orderRatings).where(eq(orderRatings.delegateId, delegateId)).orderBy(desc(orderRatings.createdAt));\n  }\n\n  async createOrderRating(rating: InsertOrderRating): Promise<OrderRating> {\n    const id = randomUUID();\n    const [created] = await db.insert(orderRatings).values({ ...rating, id }).returning();\n    return created;\n  }\n\n  // Offers\n  async getOffer(id: string): Promise<Offer | undefined> {\n    const [offer] = await db.select().from(offers).where(eq(offers.id, id));\n    return offer;\n  }\n\n  async getOffers(activeOnly?: boolean): Promise<Offer[]> {\n    if (activeOnly) {\n      return db.select().from(offers).where(eq(offers.isActive, true)).orderBy(desc(offers.createdAt));\n    }\n    return db.select().from(offers).orderBy(desc(offers.createdAt));\n  }\n\n  async getActiveOffers(): Promise<Offer[]> {\n    const now = new Date();\n    return db.select().from(offers).where(\n      and(\n        eq(offers.isActive, true),\n        lte(offers.startDate, now),\n        gte(offers.endDate, now)\n      )\n    ).orderBy(desc(offers.createdAt));\n  }\n\n  async createOffer(offer: InsertOffer): Promise<Offer> {\n    const id = randomUUID();\n    const [created] = await db.insert(offers).values({ ...offer, id }).returning();\n    return created;\n  }\n\n  async updateOffer(id: string, data: Partial<Offer>): Promise<Offer | undefined> {\n    const [updated] = await db.update(offers).set(data).where(eq(offers.id, id)).returning();\n    return updated;\n  }\n\n  async deleteOffer(id: string): Promise<boolean> {\n    await db.delete(offers).where(eq(offers.id, id));\n    return true;\n  }\n\n  // Payments\n  async getPayment(id: string): Promise<Payment | undefined> {\n    const [payment] = await db.select().from(payments).where(eq(payments.id, id));\n    return payment;\n  }\n\n  async getPaymentByOrderId(orderId: string): Promise<Payment | undefined> {\n    const [payment] = await db.select().from(payments).where(eq(payments.orderId, orderId));\n    return payment;\n  }\n\n  async getPaymentByGatewayId(gatewayChargeId: string): Promise<Payment | undefined> {\n    const [payment] = await db.select().from(payments).where(eq(payments.gatewayChargeId, gatewayChargeId));\n    return payment;\n  }\n\n  async getPaymentsByCustomer(customerId: string): Promise<Payment[]> {\n    return db.select().from(payments).where(eq(payments.customerId, customerId)).orderBy(desc(payments.createdAt));\n  }\n\n  async createPayment(payment: InsertPayment): Promise<Payment> {\n    const id = randomUUID();\n    const [created] = await db.insert(payments).values({ ...payment, id }).returning();\n    return created;\n  }\n\n  async updatePayment(id: string, data: Partial<Payment>): Promise<Payment | undefined> {\n    const [updated] = await db.update(payments).set({ ...data, updatedAt: new Date() }).where(eq(payments.id, id)).returning();\n    return updated;\n  }\n\n  // Analytics\n  async getAnalytics(startDate: Date, endDate: Date): Promise<{\n    totalIncome: number;\n    totalOrders: number;\n    completedOrders: number;\n    cancelledOrders: number;\n    newCustomers: number;\n    pointsIssued: number;\n    pointsRedeemed: number;\n    referralCount: number;\n  }> {\n    const ordersInRange = await db.select().from(orders).where(\n      and(gte(orders.createdAt, startDate), lte(orders.createdAt, endDate))\n    );\n\n    const completedOrders = ordersInRange.filter(o => o.status === \"completed\");\n    const cancelledOrders = ordersInRange.filter(o => o.status === \"cancelled\");\n    const totalIncome = completedOrders.reduce((sum, o) => sum + o.priceKD - o.discountApplied, 0);\n\n    const newCustomers = await db.select({ count: count() }).from(users).where(\n      and(\n        eq(users.role, \"customer\"),\n        gte(users.createdAt, startDate),\n        lte(users.createdAt, endDate)\n      )\n    );\n\n    const txInRange = await db.select().from(loyaltyTransactions).where(\n      and(gte(loyaltyTransactions.createdAt, startDate), lte(loyaltyTransactions.createdAt, endDate))\n    );\n    const pointsIssued = txInRange.filter(t => t.pointsChange > 0).reduce((sum, t) => sum + t.pointsChange, 0);\n    const pointsRedeemed = txInRange.filter(t => t.pointsChange < 0).reduce((sum, t) => sum + Math.abs(t.pointsChange), 0);\n\n    const referralsInRange = await db.select({ count: count() }).from(referrals).where(\n      and(gte(referrals.createdAt, startDate), lte(referrals.createdAt, endDate))\n    );\n\n    return {\n      totalIncome,\n      totalOrders: ordersInRange.length,\n      completedOrders: completedOrders.length,\n      cancelledOrders: cancelledOrders.length,\n      newCustomers: newCustomers[0]?.count || 0,\n      pointsIssued,\n      pointsRedeemed,\n      referralCount: referralsInRange[0]?.count || 0,\n    };\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":23660,"size_tokens":null},"client/src/pages/Services.tsx":{"content":"import { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Car, Sparkles, Star, Crown, Calendar, Clock } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport type { ServicePackage } from \"@shared/schema\";\n\nconst categoryIcons: Record<string, typeof Car> = {\n  exterior: Car,\n  interior: Sparkles,\n  full: Star,\n  vip: Crown,\n  monthly: Calendar,\n};\n\nconst defaultPackages: ServicePackage[] = [\n  {\n    id: \"1\",\n    nameAr: \"غسيل خارجي\",\n    nameEn: \"Exterior Wash\",\n    nameFr: \"Lavage Extérieur\",\n    descriptionAr: \"غسيل خارجي شامل للسيارة مع تنظيف الإطارات والجنوط\",\n    descriptionEn: \"Complete exterior wash including tires and rims cleaning\",\n    descriptionFr: \"Lavage extérieur complet incluant pneus et jantes\",\n    priceSedanKD: 3.5,\n    priceSuvKD: 4.5,\n    estimatedMinutes: 30,\n    category: \"exterior\",\n    isActive: true,\n    createdAt: new Date(),\n  },\n  {\n    id: \"2\",\n    nameAr: \"تنظيف داخلي\",\n    nameEn: \"Interior Clean\",\n    nameFr: \"Nettoyage Intérieur\",\n    descriptionAr: \"تنظيف داخلي شامل مع كنس وتلميع لوحة القيادة\",\n    descriptionEn: \"Full interior cleaning with vacuuming and dashboard polish\",\n    descriptionFr: \"Nettoyage intérieur complet avec aspiration et polish tableau de bord\",\n    priceSedanKD: 5,\n    priceSuvKD: 7,\n    estimatedMinutes: 45,\n    category: \"interior\",\n    isActive: true,\n    createdAt: new Date(),\n  },\n  {\n    id: \"3\",\n    nameAr: \"غسيل كامل\",\n    nameEn: \"Full Wash\",\n    nameFr: \"Lavage Complet\",\n    descriptionAr: \"غسيل خارجي وتنظيف داخلي شامل\",\n    descriptionEn: \"Complete exterior wash and interior cleaning\",\n    descriptionFr: \"Lavage extérieur complet et nettoyage intérieur\",\n    priceSedanKD: 7,\n    priceSuvKD: 10,\n    estimatedMinutes: 60,\n    category: \"full\",\n    isActive: true,\n    createdAt: new Date(),\n  },\n  {\n    id: \"4\",\n    nameAr: \"VIP / تفصيلي\",\n    nameEn: \"VIP / Detailing\",\n    nameFr: \"VIP / Détaillage\",\n    descriptionAr: \"تنظيف تفصيلي شامل مع تلميع وحماية\",\n    descriptionEn: \"Complete detailing with polish and protection\",\n    descriptionFr: \"Détaillage complet avec polish et protection\",\n    priceSedanKD: 15,\n    priceSuvKD: 20,\n    estimatedMinutes: 120,\n    category: \"vip\",\n    isActive: true,\n    createdAt: new Date(),\n  },\n  {\n    id: \"5\",\n    nameAr: \"اشتراك شهري (4 غسلات)\",\n    nameEn: \"Monthly (4 Washes)\",\n    nameFr: \"Mensuel (4 Lavages)\",\n    descriptionAr: \"اشتراك شهري يشمل 4 غسلات خارجية\",\n    descriptionEn: \"Monthly subscription with 4 exterior washes\",\n    descriptionFr: \"Abonnement mensuel avec 4 lavages extérieurs\",\n    priceSedanKD: 10,\n    priceSuvKD: 14,\n    estimatedMinutes: 30,\n    category: \"monthly\",\n    isActive: true,\n    createdAt: new Date(),\n  },\n];\n\nexport default function Services() {\n  const { t, i18n } = useTranslation();\n\n  const { data: packages, isLoading } = useQuery<ServicePackage[]>({\n    queryKey: [\"/api/packages\"],\n  });\n\n  const displayPackages = packages?.length ? packages : defaultPackages;\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const getCategoryLabel = (category: string) => {\n    const labels: Record<string, { ar: string; en: string; fr: string }> = {\n      exterior: { ar: \"خارجي\", en: \"Exterior\", fr: \"Extérieur\" },\n      interior: { ar: \"داخلي\", en: \"Interior\", fr: \"Intérieur\" },\n      full: { ar: \"كامل\", en: \"Full\", fr: \"Complet\" },\n      vip: { ar: \"VIP\", en: \"VIP\", fr: \"VIP\" },\n      monthly: { ar: \"شهري\", en: \"Monthly\", fr: \"Mensuel\" },\n    };\n    const label = labels[category] || labels.exterior;\n    return getLocalizedText(label.ar, label.en, label.fr);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"py-12\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"text-center mb-12\">\n            <Skeleton className=\"h-10 w-64 mx-auto mb-4\" />\n            <Skeleton className=\"h-6 w-96 mx-auto\" />\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {[1, 2, 3, 4, 5, 6].map((i) => (\n              <Card key={i}>\n                <CardHeader>\n                  <Skeleton className=\"h-14 w-14 rounded-full mx-auto mb-4\" />\n                  <Skeleton className=\"h-6 w-32 mx-auto\" />\n                </CardHeader>\n                <CardContent>\n                  <Skeleton className=\"h-4 w-full mb-2\" />\n                  <Skeleton className=\"h-4 w-3/4 mx-auto\" />\n                </CardContent>\n                <CardFooter>\n                  <Skeleton className=\"h-10 w-full\" />\n                </CardFooter>\n              </Card>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"py-12\">\n      <div className=\"container mx-auto px-4\">\n        {/* Header */}\n        <div className=\"text-center mb-12\">\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">{t(\"services.title\")}</h1>\n          <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n            {t(\"services.subtitle\")}\n          </p>\n        </div>\n\n        {/* Packages Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {displayPackages.filter(p => p.isActive).map((pkg) => {\n            const Icon = categoryIcons[pkg.category] || Car;\n            return (\n              <Card key={pkg.id} className=\"flex flex-col hover-elevate\" data-testid={`package-card-${pkg.id}`}>\n                <CardHeader className=\"text-center\">\n                  <div className=\"mx-auto w-16 h-16 rounded-full bg-gradient-to-br from-primary to-chart-1 flex items-center justify-center mb-4\">\n                    <Icon className=\"h-8 w-8 text-white\" />\n                  </div>\n                  <Badge variant=\"secondary\" className=\"mx-auto mb-2\">\n                    {getCategoryLabel(pkg.category)}\n                  </Badge>\n                  <CardTitle className=\"text-xl\">\n                    {getLocalizedText(pkg.nameAr, pkg.nameEn, pkg.nameFr)}\n                  </CardTitle>\n                  <CardDescription className=\"text-sm\">\n                    {getLocalizedText(pkg.descriptionAr, pkg.descriptionEn, pkg.descriptionFr)}\n                  </CardDescription>\n                </CardHeader>\n                \n                <CardContent className=\"flex-1\">\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-sm font-medium\">{t(\"services.sedan\")}</span>\n                      <span className=\"text-lg font-bold text-primary\">\n                        {pkg.priceSedanKD} {t(\"services.kd\")}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                      <span className=\"text-sm font-medium\">{t(\"services.suv\")}</span>\n                      <span className=\"text-lg font-bold text-primary\">\n                        {pkg.priceSuvKD} {t(\"services.kd\")}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-center gap-2 text-muted-foreground text-sm\">\n                      <Clock className=\"h-4 w-4\" />\n                      <span>\n                        {t(\"services.duration\")}: {pkg.estimatedMinutes} {t(\"services.minutes\")}\n                      </span>\n                    </div>\n                  </div>\n                </CardContent>\n\n                <CardFooter>\n                  <Link href={`/booking?package=${pkg.id}`} className=\"w-full\">\n                    <Button className=\"w-full\" data-testid={`select-package-${pkg.id}`}>\n                      {t(\"services.select\")}\n                    </Button>\n                  </Link>\n                </CardFooter>\n              </Card>\n            );\n          })}\n        </div>\n\n        {/* CTA */}\n        <div className=\"text-center mt-12\">\n          <p className=\"text-muted-foreground mb-4\">\n            {getLocalizedText(\n              \"لا تجد ما تبحث عنه؟ تواصل معنا للحصول على عرض مخصص\",\n              \"Can't find what you're looking for? Contact us for a custom quote\",\n              \"Vous ne trouvez pas ce que vous cherchez? Contactez-nous pour un devis personnalisé\"\n            )}\n          </p>\n          <Link href=\"/contact\">\n            <Button variant=\"outline\" size=\"lg\" data-testid=\"contact-for-quote\">\n              {t(\"nav.contact\")}\n            </Button>\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9148,"size_tokens":null},"client/src/pages/Login.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { Mail, Lock, Loader2 } from \"lucide-react\";\nimport { SiGoogle } from \"react-icons/si\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/context/AuthContext\";\n\nexport default function Login() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { loginWithEmail, loginWithGoogle } = useAuth();\n  const [isLoading, setIsLoading] = useState(false);\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\",\n  });\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const handleEmailLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      await loginWithEmail(formData.email, formData.password);\n      toast({\n        title: getLocalizedText(\"تم تسجيل الدخول\", \"Login Successful\", \"Connexion Réussie\"),\n      });\n      setLocation(\"/\");\n    } catch (error: any) {\n      console.error(\"Login error:\", error);\n      toast({\n        title: t(\"common.error\"),\n        description: error.message || getLocalizedText(\n          \"البريد الإلكتروني أو كلمة المرور غير صحيحة\",\n          \"Invalid email or password\",\n          \"Email ou mot de passe incorrect\"\n        ),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleGoogleLogin = async () => {\n    setIsLoading(true);\n    try {\n      await loginWithGoogle();\n      toast({\n        title: getLocalizedText(\"تم تسجيل الدخول\", \"Login Successful\", \"Connexion Réussie\"),\n      });\n      setLocation(\"/\");\n    } catch (error: any) {\n      toast({\n        title: t(\"common.error\"),\n        description: error.message || getLocalizedText(\n          \"فشل تسجيل الدخول بجوجل\",\n          \"Google login failed\",\n          \"Échec de connexion Google\"\n        ),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"py-12 flex items-center justify-center min-h-[70vh]\">\n      <div className=\"container mx-auto px-4 max-w-md\">\n        <Card>\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"text-2xl\">{t(\"auth.login\")}</CardTitle>\n            <CardDescription>\n              {getLocalizedText(\n                \"سجل دخولك للوصول إلى حسابك\",\n                \"Sign in to access your account\",\n                \"Connectez-vous pour accéder à votre compte\"\n              )}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Button\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={handleGoogleLogin}\n              disabled={isLoading}\n              data-testid=\"login-with-google\"\n            >\n              <SiGoogle className=\"h-4 w-4 me-2\" />\n              {t(\"auth.loginWithGoogle\")}\n            </Button>\n\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <div className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  {getLocalizedText(\"أو\", \"or\", \"ou\")}\n                </span>\n              </div>\n            </div>\n\n            <form onSubmit={handleEmailLogin} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">{t(\"auth.email\")}</Label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                    className=\"ps-10\"\n                    placeholder=\"email@example.com\"\n                    required\n                    dir=\"ltr\"\n                    data-testid=\"input-login-email\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">{t(\"auth.password\")}</Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute start-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    id=\"password\"\n                    type=\"password\"\n                    value={formData.password}\n                    onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                    className=\"ps-10\"\n                    required\n                    data-testid=\"input-login-password\"\n                  />\n                </div>\n              </div>\n\n              <Button type=\"submit\" className=\"w-full\" disabled={isLoading} data-testid=\"button-login\">\n                {isLoading ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 me-2 animate-spin\" />\n                    {t(\"common.loading\")}\n                  </>\n                ) : (\n                  t(\"auth.login\")\n                )}\n              </Button>\n            </form>\n          </CardContent>\n          <CardFooter className=\"flex flex-col gap-2 text-center text-sm\">\n            <Link href=\"/forgot-password\" className=\"text-primary hover:underline\">\n              {t(\"auth.forgotPassword\")}\n            </Link>\n            <p className=\"text-muted-foreground\">\n              {t(\"auth.noAccount\")}{\" \"}\n              <Link href=\"/register\" className=\"text-primary hover:underline\">\n                {t(\"auth.register\")}\n              </Link>\n            </p>\n          </CardFooter>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6391,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/pages/About.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Target, MapPin, Award, Users, Leaf, Clock } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nexport default function About() {\n  const { t, i18n } = useTranslation();\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const values = [\n    {\n      icon: Award,\n      titleAr: \"جودة عالية\",\n      titleEn: \"Premium Quality\",\n      titleFr: \"Qualité Premium\",\n      descAr: \"نستخدم أفضل المنتجات والتقنيات لضمان نتائج مبهرة\",\n      descEn: \"We use the best products and techniques for amazing results\",\n      descFr: \"Nous utilisons les meilleurs produits et techniques pour des résultats exceptionnels\",\n    },\n    {\n      icon: Leaf,\n      titleAr: \"صديق للبيئة\",\n      titleEn: \"Eco-Friendly\",\n      titleFr: \"Écologique\",\n      descAr: \"منتجات آمنة على البيئة وتقنيات توفير المياه\",\n      descEn: \"Environmentally safe products and water-saving techniques\",\n      descFr: \"Produits écologiques et techniques d'économie d'eau\",\n    },\n    {\n      icon: Clock,\n      titleAr: \"توفير الوقت\",\n      titleEn: \"Time Saving\",\n      titleFr: \"Gain de Temps\",\n      descAr: \"نأتي إليك ونوفر عليك عناء الذهاب لمغسلة السيارات\",\n      descEn: \"We come to you, saving you the hassle of going to a car wash\",\n      descFr: \"Nous venons à vous, vous évitant d'aller au lavage auto\",\n    },\n    {\n      icon: Users,\n      titleAr: \"فريق محترف\",\n      titleEn: \"Professional Team\",\n      titleFr: \"Équipe Professionnelle\",\n      descAr: \"فريق مدرب ومؤهل لتقديم أفضل خدمة\",\n      descEn: \"Trained and qualified team for the best service\",\n      descFr: \"Équipe formée et qualifiée pour le meilleur service\",\n    },\n  ];\n\n  const areas = [\n    { ar: \"السالمية\", en: \"Salmiya\", fr: \"Salmiya\" },\n    { ar: \"الروضة\", en: \"Rawda\", fr: \"Rawda\" },\n    { ar: \"السرة\", en: \"Surra\", fr: \"Surra\" },\n    { ar: \"كيفان\", en: \"Kaifan\", fr: \"Kaifan\" },\n    { ar: \"الخالدية\", en: \"Khaldiya\", fr: \"Khaldiya\" },\n    { ar: \"القادسية\", en: \"Qadisiya\", fr: \"Qadisiya\" },\n  ];\n\n  return (\n    <div className=\"py-12\">\n      <div className=\"container mx-auto px-4\">\n        {/* Hero */}\n        <div className=\"text-center mb-16\">\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">{t(\"about.title\")}</h1>\n          <p className=\"text-xl text-muted-foreground max-w-2xl mx-auto\">\n            {t(\"about.subtitle\")}\n          </p>\n        </div>\n\n        {/* Mission */}\n        <div className=\"max-w-4xl mx-auto mb-16\">\n          <Card className=\"overflow-hidden\">\n            <div className=\"bg-gradient-to-br from-primary to-chart-1 p-8 text-white\">\n              <div className=\"flex items-center gap-4 mb-4\">\n                <Target className=\"h-10 w-10\" />\n                <h2 className=\"text-2xl font-bold\">{t(\"about.mission\")}</h2>\n              </div>\n              <p className=\"text-lg opacity-90 leading-relaxed\">\n                {t(\"about.missionText\")}\n              </p>\n            </div>\n          </Card>\n        </div>\n\n        {/* Values */}\n        <div className=\"mb-16\">\n          <h2 className=\"text-3xl font-bold text-center mb-8\">\n            {getLocalizedText(\"قيمنا\", \"Our Values\", \"Nos Valeurs\")}\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            {values.map((value, index) => (\n              <Card key={index} className=\"text-center\" data-testid={`value-card-${index}`}>\n                <CardHeader>\n                  <div className=\"mx-auto w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center mb-4\">\n                    <value.icon className=\"h-7 w-7 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">\n                    {getLocalizedText(value.titleAr, value.titleEn, value.titleFr)}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-muted-foreground text-sm\">\n                    {getLocalizedText(value.descAr, value.descEn, value.descFr)}\n                  </p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n\n        {/* Coverage */}\n        <div className=\"max-w-4xl mx-auto\">\n          <Card>\n            <CardHeader className=\"text-center\">\n              <div className=\"mx-auto w-14 h-14 rounded-full bg-chart-1/10 flex items-center justify-center mb-4\">\n                <MapPin className=\"h-7 w-7 text-chart-1\" />\n              </div>\n              <CardTitle className=\"text-2xl\">{t(\"about.coverage\")}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-center text-muted-foreground mb-6\">\n                {t(\"about.coverageText\")}\n              </p>\n              <div className=\"flex flex-wrap justify-center gap-3\">\n                {areas.map((area, index) => (\n                  <span\n                    key={index}\n                    className=\"px-4 py-2 bg-muted rounded-full text-sm font-medium\"\n                    data-testid={`area-badge-${index}`}\n                  >\n                    {getLocalizedText(area.ar, area.en, area.fr)}\n                  </span>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5664,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 222 47% 11%;\n  --border: 220 13% 91%;\n  --card: 0 0% 98%;\n  --card-foreground: 222 47% 11%;\n  --card-border: 220 13% 94%;\n  --sidebar: 220 9% 96%;\n  --sidebar-foreground: 222 47% 11%;\n  --sidebar-border: 220 13% 92%;\n  --sidebar-primary: 25 95% 53%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 14% 91%;\n  --sidebar-accent-foreground: 222 47% 11%;\n  --sidebar-ring: 25 95% 53%;\n  --popover: 0 0% 96%;\n  --popover-foreground: 222 47% 11%;\n  --popover-border: 220 13% 93%;\n  --primary: 25 95% 53%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 220 14% 91%;\n  --secondary-foreground: 222 47% 11%;\n  --muted: 220 13% 93%;\n  --muted-foreground: 215 16% 47%;\n  --accent: 220 13% 93%;\n  --accent-foreground: 222 47% 11%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 220 13% 85%;\n  --ring: 25 95% 53%;\n  --chart-1: 215 89% 35%;\n  --chart-2: 25 95% 53%;\n  --chart-3: 173 58% 39%;\n  --chart-4: 43 96% 56%;\n  --chart-5: 340 82% 52%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 13% 91% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 13% 91% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 1px 2px -1px hsl(220 13% 91% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 1px 2px -1px hsl(220 13% 91% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 2px 4px -1px hsl(220 13% 91% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 4px 6px -1px hsl(220 13% 91% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 13% 91% / 0.00), 0px 8px 10px -1px hsl(220 13% 91% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 13% 91% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 222 47% 4%;\n  --foreground: 210 20% 98%;\n  --border: 217 19% 12%;\n  --card: 222 47% 5%;\n  --card-foreground: 210 20% 98%;\n  --card-border: 217 19% 7%;\n  --sidebar: 220 18% 7%;\n  --sidebar-foreground: 210 20% 98%;\n  --sidebar-border: 217 19% 10%;\n  --sidebar-primary: 25 95% 53%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 18% 10%;\n  --sidebar-accent-foreground: 210 20% 98%;\n  --sidebar-ring: 25 95% 53%;\n  --popover: 220 18% 8%;\n  --popover-foreground: 210 20% 98%;\n  --popover-border: 217 19% 11%;\n  --primary: 25 95% 53%;\n  --primary-foreground: 0 0% 100%;\n  --destructive: 0 62% 50%;\n  --destructive-foreground: 0 0% 100%;\n  --secondary: 220 18% 12%;\n  --secondary-foreground: 210 20% 98%;\n  --muted: 220 18% 11%;\n  --muted-foreground: 215 20% 65%;\n  --accent: 220 18% 11%;\n  --accent-foreground: 210 20% 98%;\n  --input: 217 19% 18%;\n  --ring: 25 95% 53%;\n  --chart-1: 215 89% 65%;\n  --chart-2: 25 95% 63%;\n  --chart-3: 173 58% 69%;\n  --chart-4: 43 96% 76%;\n  --chart-5: 340 82% 72%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(217 19% 12% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(217 19% 12% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(217 19% 12% / 0.00), 0px 1px 2px -1px hsl(217 19% 12% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(217 19% 12% / 0.00), 0px 1px 2px -1px hsl(217 19% 12% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(217 19% 12% / 0.00), 0px 2px 4px -1px hsl(217 19% 12% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(217 19% 12% / 0.00), 0px 4px 6px -1px hsl(217 19% 12% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(217 19% 12% / 0.00), 0px 8px 10px -1px hsl(217 19% 12% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(217 19% 12% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10745,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/layout/Footer.tsx":{"content":"import { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { Phone, Mail, MapPin } from \"lucide-react\";\nimport { SiWhatsapp, SiInstagram, SiTiktok, SiSnapchat, SiFacebook } from \"react-icons/si\";\n\nexport function Footer() {\n  const { t, i18n } = useTranslation();\n  const currentYear = new Date().getFullYear();\n\n  const quickLinks = [\n    { href: \"/\", label: t(\"nav.home\") },\n    { href: \"/services\", label: t(\"nav.services\") },\n    { href: \"/offers\", label: t(\"nav.offers\") },\n    { href: \"/booking\", label: t(\"nav.booking\") },\n    { href: \"/loyalty\", label: t(\"nav.loyalty\") },\n    { href: \"/friends-club\", label: t(\"nav.friendsClub\") },\n    { href: \"/blog\", label: t(\"nav.blog\") },\n  ];\n\n  const changeLanguage = (lang: string) => {\n    i18n.changeLanguage(lang);\n    document.documentElement.dir = lang === \"ar\" ? \"rtl\" : \"ltr\";\n    document.documentElement.lang = lang;\n  };\n\n  return (\n    <footer className=\"bg-card border-t\">\n      <div className=\"container mx-auto px-4 py-12\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8\">\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex h-10 w-10 items-center justify-center rounded-lg bg-primary\">\n                <span className=\"text-xl font-bold text-primary-foreground\">G</span>\n              </div>\n              <span className=\"text-2xl font-bold\">{t(\"brand\")}</span>\n            </div>\n            <p className=\"text-muted-foreground text-sm\">\n              {t(\"footer.description\")}\n            </p>\n            <div className=\"flex items-center gap-3 flex-wrap\">\n              <a\n                href=\"https://wa.me/96597960808\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex h-9 w-9 items-center justify-center rounded-full bg-[#25D366] text-white transition-transform hover:scale-105\"\n                data-testid=\"social-whatsapp\"\n              >\n                <SiWhatsapp className=\"h-5 w-5\" />\n              </a>\n              <a\n                href=\"https://www.instagram.com/ghaslahstyle\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex h-9 w-9 items-center justify-center rounded-full bg-gradient-to-br from-purple-600 via-pink-500 to-orange-400 text-white transition-transform hover:scale-105\"\n                data-testid=\"social-instagram\"\n              >\n                <SiInstagram className=\"h-5 w-5\" />\n              </a>\n              <a\n                href=\"https://www.tiktok.com/@ghaslah.style\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex h-9 w-9 items-center justify-center rounded-full bg-foreground text-background transition-transform hover:scale-105\"\n                data-testid=\"social-tiktok\"\n              >\n                <SiTiktok className=\"h-5 w-5\" />\n              </a>\n              <a\n                href=\"https://www.snapchat.com/add/ghaslahstyle\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex h-9 w-9 items-center justify-center rounded-full bg-[#FFFC00] text-black transition-transform hover:scale-105\"\n                data-testid=\"social-snapchat\"\n              >\n                <SiSnapchat className=\"h-5 w-5\" />\n              </a>\n              <a\n                href=\"https://www.facebook.com/share/1A6PvNuWVJ/\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"flex h-9 w-9 items-center justify-center rounded-full bg-[#1877F2] text-white transition-transform hover:scale-105\"\n                data-testid=\"social-facebook\"\n              >\n                <SiFacebook className=\"h-5 w-5\" />\n              </a>\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-semibold\">{t(\"footer.quickLinks\")}</h3>\n            <nav className=\"flex flex-col gap-2\">\n              {quickLinks.map((link) => (\n                <Link\n                  key={link.href}\n                  href={link.href}\n                  className=\"text-muted-foreground hover:text-foreground transition-colors text-sm\"\n                >\n                  {link.label}\n                </Link>\n              ))}\n            </nav>\n          </div>\n\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-semibold\">{t(\"footer.contactInfo\")}</h3>\n            <div className=\"flex flex-col gap-3\">\n              <a\n                href=\"https://wa.me/96597960808\"\n                className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors text-sm\"\n              >\n                <Phone className=\"h-4 w-4\" />\n                <span dir=\"ltr\">+965 9796 0808</span>\n              </a>\n              <a\n                href=\"mailto:info@ghaslastyle.com\"\n                className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors text-sm\"\n              >\n                <Mail className=\"h-4 w-4\" />\n                <span>info@ghaslastyle.com</span>\n              </a>\n              <div className=\"flex items-start gap-2 text-muted-foreground text-sm\">\n                <MapPin className=\"h-4 w-4 mt-0.5 flex-shrink-0\" />\n                <span>\n                  {i18n.language === \"ar\" \n                    ? \"الكويت - 19 منطقة متاحة\" \n                    : i18n.language === \"fr\"\n                    ? \"Koweït - 19 zones disponibles\"\n                    : \"Kuwait - 19 Areas Available\"}\n                </span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-semibold\">\n              {i18n.language === \"ar\" ? \"اللغة\" : i18n.language === \"fr\" ? \"Langue\" : \"Language\"}\n            </h3>\n            <div className=\"flex flex-wrap gap-2\">\n              <button\n                onClick={() => changeLanguage(\"ar\")}\n                className={`px-3 py-1.5 text-sm rounded-md transition-colors ${\n                  i18n.language === \"ar\"\n                    ? \"bg-primary text-primary-foreground\"\n                    : \"bg-muted text-muted-foreground hover:bg-muted/80\"\n                }`}\n                data-testid=\"footer-lang-ar\"\n              >\n                العربية\n              </button>\n              <button\n                onClick={() => changeLanguage(\"en\")}\n                className={`px-3 py-1.5 text-sm rounded-md transition-colors ${\n                  i18n.language === \"en\"\n                    ? \"bg-primary text-primary-foreground\"\n                    : \"bg-muted text-muted-foreground hover:bg-muted/80\"\n                }`}\n                data-testid=\"footer-lang-en\"\n              >\n                English\n              </button>\n              <button\n                onClick={() => changeLanguage(\"fr\")}\n                className={`px-3 py-1.5 text-sm rounded-md transition-colors ${\n                  i18n.language === \"fr\"\n                    ? \"bg-primary text-primary-foreground\"\n                    : \"bg-muted text-muted-foreground hover:bg-muted/80\"\n                }`}\n                data-testid=\"footer-lang-fr\"\n              >\n                Français\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mt-8 pt-8 border-t\">\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-4\">\n            <p className=\"text-sm text-muted-foreground\">\n              © {currentYear} {t(\"brand\")}. {t(\"footer.rights\")}.\n            </p>\n            <nav className=\"flex flex-wrap items-center justify-center gap-4 text-sm\">\n              <Link\n                href=\"/privacy-policy\"\n                className=\"text-muted-foreground hover:text-foreground transition-colors\"\n                data-testid=\"link-privacy-policy\"\n              >\n                {i18n.language === \"ar\" ? \"سياسة الخصوصية\" : i18n.language === \"fr\" ? \"Politique de Confidentialité\" : \"Privacy Policy\"}\n              </Link>\n              <span className=\"text-muted-foreground/50\">|</span>\n              <Link\n                href=\"/terms-of-service\"\n                className=\"text-muted-foreground hover:text-foreground transition-colors\"\n                data-testid=\"link-terms-of-service\"\n              >\n                {i18n.language === \"ar\" ? \"شروط الاستخدام\" : i18n.language === \"fr\" ? \"Conditions d'Utilisation\" : \"Terms of Service\"}\n              </Link>\n              <span className=\"text-muted-foreground/50\">|</span>\n              <Link\n                href=\"/delete-account\"\n                className=\"text-muted-foreground hover:text-foreground transition-colors\"\n                data-testid=\"link-delete-account\"\n              >\n                {i18n.language === \"ar\" ? \"حذف الحساب\" : i18n.language === \"fr\" ? \"Supprimer le Compte\" : \"Delete Account\"}\n              </Link>\n            </nav>\n          </div>\n        </div>\n      </div>\n\n      {/* Designer Credit Bar - This is the personal contact of designer Fawzy Badr, NOT Ghasla Style support */}\n      <div className=\"bg-muted/80 border-t py-3\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-3 text-sm\">\n            {/* Copyright - Left on desktop */}\n            <p className=\"text-muted-foreground order-2 md:order-1\">\n              © {currentYear} Ghasla Style\n            </p>\n\n            {/* Designer Credit - Center */}\n            <p className=\"order-1 md:order-2 flex items-center gap-1.5\">\n              <span className=\"text-muted-foreground\">Designed by</span>\n              <span \n                className=\"font-semibold text-chart-1 hover:text-primary transition-colors cursor-default\"\n                data-testid=\"text-designer-name\"\n              >\n                Fawzy Badr\n              </span>\n            </p>\n\n            {/* Designer WhatsApp - Right on desktop */}\n            {/* NOTE: This is the designer's personal WhatsApp (Fawzy Badr), NOT Ghasla Style booking/support */}\n            <a\n              href=\"https://wa.me/201281863902\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"order-3 flex items-center gap-2 text-muted-foreground hover:text-[#25D366] transition-all hover:scale-105\"\n              title=\"Contact Designer - Fawzy Badr\"\n              data-testid=\"link-designer-whatsapp\"\n            >\n              <SiWhatsapp className=\"h-5 w-5\" />\n              <span className=\"text-xs hidden sm:inline\">Designer Contact</span>\n            </a>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","path":null,"size_bytes":10846,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"server/firebase-admin.ts":{"content":"import admin from \"firebase-admin\";\nimport type { Request, Response, NextFunction } from \"express\";\n\nlet initialized = false;\n\nexport function initializeFirebaseAdmin() {\n  if (initialized) return;\n  \n  try {\n    const projectId = process.env.VITE_FIREBASE_PROJECT_ID;\n    const serviceAccountJson = process.env.FIREBASE_SERVICE_ACCOUNT;\n    \n    if (!projectId) {\n      console.warn(\"Firebase Admin: Missing VITE_FIREBASE_PROJECT_ID\");\n      return;\n    }\n\n    if (!serviceAccountJson) {\n      console.warn(\"Firebase Admin: Missing FIREBASE_SERVICE_ACCOUNT secret\");\n      console.warn(\"Admin features (custom claims, super admin setup) will not work.\");\n      console.warn(\"To fix: Add FIREBASE_SERVICE_ACCOUNT secret with your service account JSON\");\n      return;\n    }\n\n    if (admin.apps.length === 0) {\n      try {\n        const serviceAccount = JSON.parse(serviceAccountJson);\n        admin.initializeApp({\n          credential: admin.credential.cert(serviceAccount),\n          projectId,\n        });\n        console.log(\"Firebase Admin initialized with project:\", projectId);\n        initialized = true;\n      } catch (parseError) {\n        console.error(\"Firebase Admin: Could not parse service account JSON:\", parseError);\n        console.warn(\"Make sure FIREBASE_SERVICE_ACCOUNT contains valid JSON\");\n      }\n    } else {\n      initialized = true;\n    }\n  } catch (error) {\n    console.error(\"Firebase Admin initialization error:\", error);\n  }\n}\n\nexport function getFirebaseAdmin() {\n  if (!initialized) {\n    initializeFirebaseAdmin();\n  }\n  return admin;\n}\n\nexport interface AuthenticatedRequest extends Request {\n  user?: admin.auth.DecodedIdToken;\n}\n\nexport async function requireSuperAdmin(\n  req: AuthenticatedRequest,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const authHeader = req.headers.authorization || \"\";\n    const token = authHeader.startsWith(\"Bearer \") \n      ? authHeader.slice(7) \n      : null;\n    \n    if (!token) {\n      return res.status(401).json({ error: \"No token provided\" });\n    }\n\n    const firebaseAdmin = getFirebaseAdmin();\n    const decoded = await firebaseAdmin.auth().verifyIdToken(token);\n    \n    if (decoded.superAdmin === true) {\n      req.user = decoded;\n      return next();\n    }\n\n    return res.status(403).json({ error: \"Not super admin\" });\n  } catch (err) {\n    console.error(\"requireSuperAdmin error:\", err);\n    return res.status(401).json({ error: \"Invalid token\" });\n  }\n}\n\nexport async function requireAdmin(\n  req: AuthenticatedRequest,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const authHeader = req.headers.authorization || \"\";\n    const token = authHeader.startsWith(\"Bearer \") \n      ? authHeader.slice(7) \n      : null;\n    \n    if (!token) {\n      return res.status(401).json({ error: \"No token provided\" });\n    }\n\n    const firebaseAdmin = getFirebaseAdmin();\n    const decoded = await firebaseAdmin.auth().verifyIdToken(token);\n    \n    if (decoded.superAdmin === true || decoded.admin === true) {\n      req.user = decoded;\n      return next();\n    }\n\n    return res.status(403).json({ error: \"Not authorized\" });\n  } catch (err) {\n    console.error(\"requireAdmin error:\", err);\n    return res.status(401).json({ error: \"Invalid token\" });\n  }\n}\n\nexport async function optionalAuth(\n  req: AuthenticatedRequest,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const authHeader = req.headers.authorization || \"\";\n    const token = authHeader.startsWith(\"Bearer \") \n      ? authHeader.slice(7) \n      : null;\n    \n    if (token) {\n      const firebaseAdmin = getFirebaseAdmin();\n      const decoded = await firebaseAdmin.auth().verifyIdToken(token);\n      req.user = decoded;\n    }\n    \n    return next();\n  } catch (err) {\n    return next();\n  }\n}\n\nexport async function requireDelegate(\n  req: AuthenticatedRequest,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const authHeader = req.headers.authorization || \"\";\n    const token = authHeader.startsWith(\"Bearer \") \n      ? authHeader.slice(7) \n      : null;\n    \n    if (!token) {\n      return res.status(401).json({ error: \"No token provided\" });\n    }\n\n    const firebaseAdmin = getFirebaseAdmin();\n    const decoded = await firebaseAdmin.auth().verifyIdToken(token);\n    \n    if (decoded.delegate === true || decoded.admin === true || decoded.superAdmin === true) {\n      req.user = decoded;\n      return next();\n    }\n\n    return res.status(403).json({ error: \"Not authorized as delegate\" });\n  } catch (err) {\n    console.error(\"requireDelegate error:\", err);\n    return res.status(401).json({ error: \"Invalid token\" });\n  }\n}\n\nexport async function requireAuth(\n  req: AuthenticatedRequest,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const authHeader = req.headers.authorization || \"\";\n    const token = authHeader.startsWith(\"Bearer \") \n      ? authHeader.slice(7) \n      : null;\n    \n    if (!token) {\n      return res.status(401).json({ error: \"No token provided\" });\n    }\n\n    const firebaseAdmin = getFirebaseAdmin();\n    const decoded = await firebaseAdmin.auth().verifyIdToken(token);\n    req.user = decoded;\n    return next();\n  } catch (err) {\n    console.error(\"requireAuth error:\", err);\n    return res.status(401).json({ error: \"Invalid token\" });\n  }\n}\n\nexport async function setSuperAdmin(email: string): Promise<{ uid: string; success: boolean }> {\n  try {\n    const firebaseAdmin = getFirebaseAdmin();\n    const user = await firebaseAdmin.auth().getUserByEmail(email);\n    \n    const existingClaims = user.customClaims || {};\n    \n    await firebaseAdmin.auth().setCustomUserClaims(user.uid, {\n      ...existingClaims,\n      superAdmin: true,\n      admin: true,\n    });\n    \n    console.log(`Set superAdmin claim for ${email} (uid: ${user.uid})`);\n    return { uid: user.uid, success: true };\n  } catch (error) {\n    console.error(\"setSuperAdmin error:\", error);\n    throw error;\n  }\n}\n\nexport async function setAdminRole(email: string, isAdmin: boolean): Promise<{ uid: string; success: boolean }> {\n  try {\n    const firebaseAdmin = getFirebaseAdmin();\n    const user = await firebaseAdmin.auth().getUserByEmail(email);\n    \n    const existingClaims = user.customClaims || {};\n    \n    await firebaseAdmin.auth().setCustomUserClaims(user.uid, {\n      ...existingClaims,\n      admin: isAdmin,\n    });\n    \n    console.log(`Set admin=${isAdmin} for ${email} (uid: ${user.uid})`);\n    return { uid: user.uid, success: true };\n  } catch (error) {\n    console.error(\"setAdminRole error:\", error);\n    throw error;\n  }\n}\n\nexport { admin };\n","path":null,"size_bytes":6535,"size_tokens":null},"client/src/pages/delegate/Dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useLocation, useRoute } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { \n  LayoutDashboard, Package, ClipboardList, Clock, MapPin, Phone, \n  User, Car, CheckCircle, Play, Navigation, XCircle, Shield,\n  BarChart3, Calendar, DollarSign, TrendingUp, Settings, RefreshCw,\n  Star, Camera, MapPinned\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, getAuthHeaders } from \"@/lib/queryClient\";\nimport type { Order, User as UserType } from \"@shared/schema\";\n\ninterface EnrichedOrder extends Order {\n  serviceName?: string;\n  serviceNameAr?: string;\n  customerName?: string;\n  customerPhone?: string;\n  estimatedMinutes?: number;\n}\n\ninterface DelegateProfile extends UserType {\n  autoAcceptOrders: boolean;\n  isAvailable: boolean;\n  coverageAreas: string[] | null;\n  maxActiveOrders: number;\n}\n\ninterface DelegateStats {\n  completedOrdersCount: number;\n  totalRevenue: number;\n  period: string;\n  activeOrdersCount: number;\n  avgCompletionMinutes: number;\n  avgRating: number;\n  totalRatings: number;\n}\n\nexport default function DelegateDashboard() {\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const [, params] = useRoute(\"/delegate/:section\");\n  const { user, firebaseUser, loading } = useAuth();\n  const { toast } = useToast();\n  \n  const section = params?.section || \"dashboard\";\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const isDelegate = user?.role === \"delegate\" || user?.role === \"admin\" || user?.role === \"super_admin\";\n\n  const { data: profile, isLoading: profileLoading } = useQuery<DelegateProfile>({\n    queryKey: [\"/api/delegate/profile\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/delegate/profile\", { headers });\n      if (!res.ok) throw new Error(\"Failed to fetch profile\");\n      return res.json();\n    },\n    enabled: isDelegate && !!firebaseUser,\n  });\n\n  const { data: availableOrders, isLoading: availableLoading, refetch: refetchAvailable } = useQuery<EnrichedOrder[]>({\n    queryKey: [\"/api/delegate/orders/available\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/delegate/orders/available\", { headers });\n      if (!res.ok) throw new Error(\"Failed to fetch available orders\");\n      return res.json();\n    },\n    enabled: isDelegate && !!firebaseUser && (section === \"available\" || section === \"dashboard\"),\n    refetchInterval: 30000,\n  });\n\n  const { data: currentOrders, isLoading: currentLoading, refetch: refetchCurrent } = useQuery<EnrichedOrder[]>({\n    queryKey: [\"/api/delegate/orders/current\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/delegate/orders/current\", { headers });\n      if (!res.ok) throw new Error(\"Failed to fetch current orders\");\n      return res.json();\n    },\n    enabled: isDelegate && !!firebaseUser && (section === \"current\" || section === \"dashboard\"),\n    refetchInterval: 15000,\n  });\n\n  const { data: historyOrders, isLoading: historyLoading } = useQuery<EnrichedOrder[]>({\n    queryKey: [\"/api/delegate/orders/history\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/delegate/orders/history\", { headers });\n      if (!res.ok) throw new Error(\"Failed to fetch history\");\n      return res.json();\n    },\n    enabled: isDelegate && !!firebaseUser && section === \"history\",\n  });\n\n  const { data: stats, isLoading: statsLoading } = useQuery<DelegateStats>({\n    queryKey: [\"/api/delegate/stats\", \"month\"],\n    queryFn: async () => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/delegate/stats?period=month\", { headers });\n      if (!res.ok) throw new Error(\"Failed to fetch stats\");\n      return res.json();\n    },\n    enabled: isDelegate && !!firebaseUser && (section === \"stats\" || section === \"dashboard\"),\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: { autoAcceptOrders?: boolean; isAvailable?: boolean }) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/delegate/profile\", {\n        method: \"PATCH\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n      if (!res.ok) throw new Error(\"Failed to update profile\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/delegate/profile\"] });\n      toast({ title: getLocalizedText(\"تم التحديث\", \"Updated\", \"Mis à jour\") });\n    },\n  });\n\n  const acceptOrderMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/delegate/orders/${orderId}/accept`, {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to accept order\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/delegate/orders/available\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/delegate/orders/current\"] });\n      toast({ title: getLocalizedText(\"تم قبول الطلب\", \"Order Accepted\", \"Commande Acceptée\") });\n    },\n    onError: (error: Error) => {\n      toast({ title: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const rejectOrderMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/delegate/orders/${orderId}/reject`, {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ reason: \"Delegate declined\" }),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to reject order\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/delegate/orders/available\"] });\n      toast({ title: getLocalizedText(\"تم رفض الطلب\", \"Order Rejected\", \"Commande Rejetée\") });\n    },\n    onError: (error: Error) => {\n      toast({ title: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ orderId, status, finalPriceKD, isPaid }: { \n      orderId: string; \n      status: string; \n      finalPriceKD?: number;\n      isPaid?: boolean;\n    }) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/delegate/orders/${orderId}/status`, {\n        method: \"PATCH\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status, finalPriceKD, isPaid }),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update status\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/delegate/orders/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/delegate/orders/history\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/delegate/stats\"] });\n      toast({ title: getLocalizedText(\"تم تحديث الحالة\", \"Status Updated\", \"Statut Mis à Jour\") });\n    },\n    onError: (error: Error) => {\n      toast({ title: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateLocationMutation = useMutation({\n    mutationFn: async ({ latitude, longitude }: { latitude: number; longitude: number }) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(\"/api/delegate/location\", {\n        method: \"PATCH\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ latitude, longitude }),\n      });\n      if (!res.ok) throw new Error(\"Failed to update location\");\n      return res.json();\n    },\n  });\n\n  const uploadPhotoMutation = useMutation({\n    mutationFn: async ({ orderId, beforePhotoUrl, afterPhotoUrl }: { \n      orderId: string; \n      beforePhotoUrl?: string; \n      afterPhotoUrl?: string;\n    }) => {\n      const headers = await getAuthHeaders();\n      const res = await fetch(`/api/delegate/orders/${orderId}/photos`, {\n        method: \"PATCH\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ beforePhotoUrl, afterPhotoUrl }),\n      });\n      if (!res.ok) throw new Error(\"Failed to upload photo\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/delegate/orders/current\"] });\n      toast({ title: getLocalizedText(\"تم رفع الصورة\", \"Photo Uploaded\", \"Photo Téléchargée\") });\n    },\n    onError: (error: Error) => {\n      toast({ title: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Start location sharing when going on the way\n  const startLocationSharing = () => {\n    if (\"geolocation\" in navigator) {\n      navigator.geolocation.watchPosition(\n        (position) => {\n          updateLocationMutation.mutate({\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude,\n          });\n        },\n        (error) => {\n          console.error(\"Geolocation error:\", error);\n        },\n        { enableHighAccuracy: true, timeout: 10000, maximumAge: 5000 }\n      );\n    }\n  };\n\n  if (loading || profileLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\" />\n      </div>\n    );\n  }\n\n  if (!user || !isDelegate) {\n    return (\n      <div className=\"py-12\">\n        <div className=\"container mx-auto px-4 text-center\">\n          <Shield className=\"h-16 w-16 mx-auto mb-4 text-destructive\" />\n          <h1 className=\"text-2xl font-bold mb-2\">\n            {getLocalizedText(\"غير مصرح\", \"Unauthorized\", \"Non autorisé\")}\n          </h1>\n          <p className=\"text-muted-foreground mb-4\">\n            {getLocalizedText(\n              \"ليس لديك صلاحية للوصول إلى هذه الصفحة\",\n              \"You don't have permission to access this page\",\n              \"Vous n'avez pas l'autorisation d'accéder à cette page\"\n            )}\n          </p>\n          <Button onClick={() => setLocation(\"/\")} data-testid=\"button-go-home\">\n            {t(\"nav.home\")}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  const navItems = [\n    { id: \"dashboard\", icon: LayoutDashboard, labelAr: \"الرئيسية\", labelEn: \"Dashboard\", labelFr: \"Tableau de bord\" },\n    { id: \"available\", icon: Package, labelAr: \"الطلبات المتاحة\", labelEn: \"Available Orders\", labelFr: \"Commandes Disponibles\" },\n    { id: \"current\", icon: ClipboardList, labelAr: \"الطلبات الحالية\", labelEn: \"Current Orders\", labelFr: \"Commandes Actuelles\" },\n    { id: \"history\", icon: Clock, labelAr: \"السجل\", labelEn: \"History\", labelFr: \"Historique\" },\n    { id: \"stats\", icon: BarChart3, labelAr: \"الإحصائيات\", labelEn: \"Statistics\", labelFr: \"Statistiques\" },\n    { id: \"settings\", icon: Settings, labelAr: \"الإعدادات\", labelEn: \"Settings\", labelFr: \"Paramètres\" },\n  ];\n\n  const getStatusBadge = (status: string) => {\n    const config: Record<string, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n      pending: { label: getLocalizedText(\"قيد الانتظار\", \"Pending\", \"En attente\"), variant: \"secondary\" },\n      assigned: { label: getLocalizedText(\"تم التخصيص\", \"Assigned\", \"Assigné\"), variant: \"default\" },\n      on_the_way: { label: getLocalizedText(\"في الطريق\", \"On the Way\", \"En route\"), variant: \"default\" },\n      in_progress: { label: getLocalizedText(\"قيد التنفيذ\", \"In Progress\", \"En cours\"), variant: \"default\" },\n      completed: { label: getLocalizedText(\"مكتمل\", \"Completed\", \"Terminé\"), variant: \"outline\" },\n      cancelled: { label: getLocalizedText(\"ملغي\", \"Cancelled\", \"Annulé\"), variant: \"destructive\" },\n    };\n    const { label, variant } = config[status] || { label: status, variant: \"secondary\" as const };\n    return <Badge variant={variant}>{label}</Badge>;\n  };\n\n  const getNextAction = (status: string) => {\n    switch (status) {\n      case \"assigned\":\n        return { action: \"on_the_way\", labelAr: \"في الطريق\", labelEn: \"On the Way\", labelFr: \"En Route\", icon: Navigation };\n      case \"on_the_way\":\n        return { action: \"in_progress\", labelAr: \"بدء الغسيل\", labelEn: \"Start Washing\", labelFr: \"Commencer\", icon: Play };\n      case \"in_progress\":\n        return { action: \"completed\", labelAr: \"إنهاء الطلب\", labelEn: \"Complete Order\", labelFr: \"Terminer\", icon: CheckCircle };\n      default:\n        return null;\n    }\n  };\n\n  const openGoogleMaps = (lat?: number | null, lng?: number | null, address?: string) => {\n    if (lat && lng) {\n      window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, \"_blank\");\n    } else if (address) {\n      window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, \"_blank\");\n    }\n  };\n\n  const renderDashboard = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">\n            {getLocalizedText(`مرحباً ${user.name}`, `Welcome ${user.name}`, `Bienvenue ${user.name}`)}\n          </h2>\n          <p className=\"text-muted-foreground\">\n            {getLocalizedText(\"لوحة تحكم المندوب\", \"Delegate Dashboard\", \"Tableau de bord du délégué\")}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <Switch\n              id=\"available\"\n              checked={profile?.isAvailable ?? true}\n              onCheckedChange={(checked) => updateProfileMutation.mutate({ isAvailable: checked })}\n              data-testid=\"switch-availability\"\n            />\n            <Label htmlFor=\"available\">\n              {getLocalizedText(\"متاح للطلبات\", \"Available\", \"Disponible\")}\n            </Label>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">\n              {getLocalizedText(\"الطلبات النشطة\", \"Active Orders\", \"Commandes Actives\")}\n            </CardTitle>\n            <ClipboardList className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats?.activeOrdersCount || 0}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">\n              {getLocalizedText(\"طلبات اليوم\", \"Today's Orders\", \"Commandes du jour\")}\n            </CardTitle>\n            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{stats?.completedOrdersCount || 0}</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">\n              {getLocalizedText(\"الإيرادات\", \"Revenue\", \"Revenus\")}\n            </CardTitle>\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{(stats?.totalRevenue || 0).toFixed(2)} KD</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">\n              {getLocalizedText(\"الطلبات المتاحة\", \"Available Orders\", \"Commandes Disponibles\")}\n            </CardTitle>\n            <Package className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{availableOrders?.length || 0}</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {currentOrders && currentOrders.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>{getLocalizedText(\"الطلبات الحالية\", \"Current Orders\", \"Commandes Actuelles\")}</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {currentOrders.slice(0, 3).map((order) => (\n                <div key={order.id} className=\"flex items-center justify-between p-4 border rounded-lg\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <span className=\"font-medium\">{order.id.slice(0, 8)}</span>\n                      {getStatusBadge(order.status)}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground mt-1\">\n                      {order.customerName} - {order.area}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {getNextAction(order.status) && (\n                      <Button\n                        size=\"sm\"\n                        onClick={() => updateStatusMutation.mutate({ \n                          orderId: order.id, \n                          status: getNextAction(order.status)!.action,\n                          isPaid: getNextAction(order.status)!.action === \"completed\" ? true : undefined,\n                        })}\n                        disabled={updateStatusMutation.isPending}\n                        data-testid={`button-status-${order.id}`}\n                      >\n                        {getLocalizedText(\n                          getNextAction(order.status)!.labelAr,\n                          getNextAction(order.status)!.labelEn,\n                          getNextAction(order.status)!.labelFr\n                        )}\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n\n  const renderAvailableOrders = () => (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <h2 className=\"text-2xl font-bold\">\n          {getLocalizedText(\"الطلبات المتاحة\", \"Available Orders\", \"Commandes Disponibles\")}\n        </h2>\n        <Button variant=\"outline\" size=\"sm\" onClick={() => refetchAvailable()} data-testid=\"button-refresh-available\">\n          <RefreshCw className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n          {getLocalizedText(\"تحديث\", \"Refresh\", \"Actualiser\")}\n        </Button>\n      </div>\n\n      {availableLoading ? (\n        <div className=\"space-y-4\">\n          {[1, 2, 3].map((i) => <Skeleton key={i} className=\"h-32 w-full\" />)}\n        </div>\n      ) : availableOrders?.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <Package className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <p className=\"text-muted-foreground\">\n              {getLocalizedText(\"لا توجد طلبات متاحة حالياً\", \"No available orders at the moment\", \"Aucune commande disponible pour le moment\")}\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4\">\n          {availableOrders?.map((order) => (\n            <Card key={order.id} data-testid={`card-order-${order.id}`}>\n              <CardContent className=\"p-4\">\n                <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\n                  <div className=\"flex-1 space-y-2\">\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <span className=\"font-bold text-lg\">#{order.id.slice(0, 8)}</span>\n                      {getStatusBadge(order.status)}\n                      <Badge variant=\"outline\">{order.priceKD.toFixed(2)} KD</Badge>\n                    </div>\n                    <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\n                      <span className=\"flex items-center gap-1\">\n                        <MapPin className=\"h-4 w-4\" />\n                        {order.area}\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <Car className=\"h-4 w-4\" />\n                        {order.carType}\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <Package className=\"h-4 w-4\" />\n                        {i18n.language === \"ar\" ? order.serviceNameAr : order.serviceName}\n                      </span>\n                    </div>\n                    <div className=\"text-sm\">\n                      <span className=\"text-muted-foreground\">\n                        {getLocalizedText(\"الموعد:\", \"Scheduled:\", \"Prévu:\")}\n                      </span>{\" \"}\n                      {order.preferredDate} - {order.preferredTime}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => openGoogleMaps(order.latitude, order.longitude, order.address)}\n                      data-testid={`button-map-${order.id}`}\n                    >\n                      <MapPin className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => rejectOrderMutation.mutate(order.id)}\n                      disabled={rejectOrderMutation.isPending}\n                      data-testid={`button-reject-${order.id}`}\n                    >\n                      <XCircle className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                      {getLocalizedText(\"رفض\", \"Reject\", \"Rejeter\")}\n                    </Button>\n                    <Button\n                      onClick={() => acceptOrderMutation.mutate(order.id)}\n                      disabled={acceptOrderMutation.isPending}\n                      data-testid={`button-accept-${order.id}`}\n                    >\n                      {getLocalizedText(\"قبول\", \"Accept\", \"Accepter\")}\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n\n  const renderCurrentOrders = () => (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <h2 className=\"text-2xl font-bold\">\n          {getLocalizedText(\"الطلبات الحالية\", \"Current Orders\", \"Commandes Actuelles\")}\n        </h2>\n        <Button variant=\"outline\" size=\"sm\" onClick={() => refetchCurrent()} data-testid=\"button-refresh-current\">\n          <RefreshCw className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n          {getLocalizedText(\"تحديث\", \"Refresh\", \"Actualiser\")}\n        </Button>\n      </div>\n\n      {currentLoading ? (\n        <div className=\"space-y-4\">\n          {[1, 2].map((i) => <Skeleton key={i} className=\"h-48 w-full\" />)}\n        </div>\n      ) : currentOrders?.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <ClipboardList className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <p className=\"text-muted-foreground\">\n              {getLocalizedText(\"لا توجد طلبات حالية\", \"No current orders\", \"Aucune commande en cours\")}\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4\">\n          {currentOrders?.map((order) => (\n            <Card key={order.id} data-testid={`card-current-${order.id}`}>\n              <CardHeader>\n                <div className=\"flex items-center justify-between flex-wrap gap-2\">\n                  <CardTitle className=\"flex items-center gap-2\">\n                    #{order.id.slice(0, 8)}\n                    {getStatusBadge(order.status)}\n                  </CardTitle>\n                  <Badge variant=\"outline\" className=\"text-lg\">\n                    {order.priceKD.toFixed(2)} KD\n                  </Badge>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <User className=\"h-4 w-4 text-muted-foreground\" />\n                      <span className=\"font-medium\">{order.customerName}</span>\n                    </div>\n                    {order.customerPhone && (\n                      <div className=\"flex items-center gap-2\">\n                        <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                        <a href={`tel:${order.customerPhone}`} className=\"text-primary hover:underline\">\n                          {order.customerPhone}\n                        </a>\n                      </div>\n                    )}\n                    <div className=\"flex items-center gap-2\">\n                      <MapPin className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>{order.area} - {order.address}</span>\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <Car className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>{order.carType} {order.carDetails && `- ${order.carDetails}`}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Package className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>{i18n.language === \"ar\" ? order.serviceNameAr : order.serviceName}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>{order.preferredDate} - {order.preferredTime}</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Photo upload section for in_progress orders */}\n                {order.status === \"in_progress\" && (\n                  <div className=\"space-y-3 pt-4 border-t\">\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <Camera className=\"h-4 w-4\" />\n                      {getLocalizedText(\"صور الخدمة (اختياري)\", \"Service Photos (Optional)\", \"Photos du Service (Optionnel)\")}\n                    </div>\n                    <div className=\"flex flex-wrap gap-2\">\n                      {!order.beforePhotoUrl ? (\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            const url = prompt(getLocalizedText(\"أدخل رابط صورة قبل الخدمة\", \"Enter before photo URL\", \"Entrez l'URL de la photo avant\"));\n                            if (url) uploadPhotoMutation.mutate({ orderId: order.id, beforePhotoUrl: url });\n                          }}\n                          disabled={uploadPhotoMutation.isPending}\n                          data-testid={`button-upload-before-${order.id}`}\n                        >\n                          <Camera className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                          {getLocalizedText(\"صورة قبل\", \"Before Photo\", \"Photo Avant\")}\n                        </Button>\n                      ) : (\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {getLocalizedText(\"قبل: تم الرفع\", \"Before: Uploaded\", \"Avant: Téléchargé\")}\n                        </Badge>\n                      )}\n                      {!order.afterPhotoUrl ? (\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            const url = prompt(getLocalizedText(\"أدخل رابط صورة بعد الخدمة\", \"Enter after photo URL\", \"Entrez l'URL de la photo après\"));\n                            if (url) uploadPhotoMutation.mutate({ orderId: order.id, afterPhotoUrl: url });\n                          }}\n                          disabled={uploadPhotoMutation.isPending}\n                          data-testid={`button-upload-after-${order.id}`}\n                        >\n                          <Camera className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                          {getLocalizedText(\"صورة بعد\", \"After Photo\", \"Photo Après\")}\n                        </Button>\n                      ) : (\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {getLocalizedText(\"بعد: تم الرفع\", \"After: Uploaded\", \"Après: Téléchargé\")}\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                )}\n\n                {/* On the way indicator with location sharing */}\n                {order.status === \"on_the_way\" && (\n                  <div className=\"flex items-center gap-2 pt-4 border-t text-sm text-muted-foreground\">\n                    <MapPinned className=\"h-4 w-4 text-primary animate-pulse\" />\n                    {getLocalizedText(\"يتم مشاركة موقعك\", \"Sharing your location\", \"Partage de votre position\")}\n                  </div>\n                )}\n\n                <div className=\"flex items-center gap-2 flex-wrap pt-4 border-t\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => openGoogleMaps(order.latitude, order.longitude, order.address)}\n                    data-testid={`button-navigate-${order.id}`}\n                  >\n                    <Navigation className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                    {getLocalizedText(\"فتح الخريطة\", \"Open Maps\", \"Ouvrir Maps\")}\n                  </Button>\n                  {order.customerPhone && (\n                    <Button variant=\"outline\" asChild>\n                      <a href={`tel:${order.customerPhone}`} data-testid={`button-call-${order.id}`}>\n                        <Phone className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                        {getLocalizedText(\"اتصال\", \"Call\", \"Appeler\")}\n                      </a>\n                    </Button>\n                  )}\n                  {getNextAction(order.status) && (\n                    <Button\n                      onClick={() => {\n                        const nextAction = getNextAction(order.status)!.action;\n                        // Start location sharing when going \"on the way\"\n                        if (nextAction === \"on_the_way\") {\n                          startLocationSharing();\n                        }\n                        updateStatusMutation.mutate({ \n                          orderId: order.id, \n                          status: nextAction,\n                          isPaid: nextAction === \"completed\" ? true : undefined,\n                        });\n                      }}\n                      disabled={updateStatusMutation.isPending}\n                      data-testid={`button-next-${order.id}`}\n                    >\n                      {(() => {\n                        const Icon = getNextAction(order.status)!.icon;\n                        return <Icon className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />;\n                      })()}\n                      {getLocalizedText(\n                        getNextAction(order.status)!.labelAr,\n                        getNextAction(order.status)!.labelEn,\n                        getNextAction(order.status)!.labelFr\n                      )}\n                    </Button>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n\n  const renderHistory = () => (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-2xl font-bold\">\n        {getLocalizedText(\"سجل الطلبات\", \"Order History\", \"Historique des Commandes\")}\n      </h2>\n\n      {historyLoading ? (\n        <div className=\"space-y-4\">\n          {[1, 2, 3].map((i) => <Skeleton key={i} className=\"h-24 w-full\" />)}\n        </div>\n      ) : historyOrders?.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <Clock className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <p className=\"text-muted-foreground\">\n              {getLocalizedText(\"لا يوجد سجل للطلبات\", \"No order history\", \"Aucun historique de commandes\")}\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-2\">\n          {historyOrders?.map((order) => (\n            <Card key={order.id} data-testid={`card-history-${order.id}`}>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between flex-wrap gap-2\">\n                  <div>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium\">#{order.id.slice(0, 8)}</span>\n                      {getStatusBadge(order.status)}\n                    </div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {order.area} - {i18n.language === \"ar\" ? order.serviceNameAr : order.serviceName}\n                    </div>\n                  </div>\n                  <div className=\"text-right rtl:text-left\">\n                    <div className=\"font-bold\">{(order.finalPriceKD || order.priceKD).toFixed(2)} KD</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {order.completedAt ? new Date(order.completedAt).toLocaleDateString() : order.preferredDate}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n\n  const renderStats = () => (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-2xl font-bold\">\n        {getLocalizedText(\"الإحصائيات\", \"Statistics\", \"Statistiques\")}\n      </h2>\n\n      {statsLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {[1, 2, 3, 4].map((i) => <Skeleton key={i} className=\"h-32\" />)}\n        </div>\n      ) : (\n        <>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">\n                  {getLocalizedText(\"الطلبات المكتملة\", \"Completed Orders\", \"Commandes Terminées\")}\n                </CardTitle>\n                <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stats?.completedOrdersCount || 0}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {getLocalizedText(\"هذا الشهر\", \"This Month\", \"Ce mois\")}\n                </p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">\n                  {getLocalizedText(\"إجمالي الإيرادات\", \"Total Revenue\", \"Revenus Totaux\")}\n                </CardTitle>\n                <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{(stats?.totalRevenue || 0).toFixed(2)} KD</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {getLocalizedText(\"هذا الشهر\", \"This Month\", \"Ce mois\")}\n                </p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">\n                  {getLocalizedText(\"الطلبات النشطة\", \"Active Orders\", \"Commandes Actives\")}\n                </CardTitle>\n                <ClipboardList className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stats?.activeOrdersCount || 0}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {getLocalizedText(\"حالياً\", \"Currently\", \"Actuellement\")}\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">\n                  {getLocalizedText(\"متوسط لكل طلب\", \"Avg per Order\", \"Moy par Commande\")}\n                </CardTitle>\n                <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">\n                  {stats?.completedOrdersCount ? ((stats.totalRevenue || 0) / stats.completedOrdersCount).toFixed(2) : \"0.00\"} KD\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">\n                  {getLocalizedText(\"متوسط وقت الإنجاز\", \"Avg Completion Time\", \"Temps Moyen\")}\n                </CardTitle>\n                <Clock className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{stats?.avgCompletionMinutes || 0} min</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {getLocalizedText(\"لكل طلب\", \"per order\", \"par commande\")}\n                </p>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">\n                  {getLocalizedText(\"متوسط التقييم\", \"Avg Rating\", \"Note Moyenne\")}\n                </CardTitle>\n                <Star className=\"h-4 w-4 text-muted-foreground\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold flex items-center gap-1\">\n                  {stats?.avgRating || 0}\n                  <Star className=\"h-5 w-5 text-yellow-500 fill-yellow-500\" />\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {stats?.totalRatings || 0} {getLocalizedText(\"تقييم\", \"ratings\", \"évaluations\")}\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </>\n      )}\n    </div>\n  );\n\n  const renderSettings = () => (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-2xl font-bold\">\n        {getLocalizedText(\"الإعدادات\", \"Settings\", \"Paramètres\")}\n      </h2>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>{getLocalizedText(\"إعدادات الطلبات\", \"Order Settings\", \"Paramètres des Commandes\")}</CardTitle>\n          <CardDescription>\n            {getLocalizedText(\"تحكم في كيفية استقبال الطلبات\", \"Control how you receive orders\", \"Contrôlez comment vous recevez les commandes\")}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <Label>{getLocalizedText(\"القبول التلقائي\", \"Auto-Accept Orders\", \"Acceptation Automatique\")}</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                {getLocalizedText(\n                  \"قبول الطلبات الجديدة تلقائياً\",\n                  \"Automatically accept new orders\",\n                  \"Accepter automatiquement les nouvelles commandes\"\n                )}\n              </p>\n            </div>\n            <Switch\n              checked={profile?.autoAcceptOrders ?? false}\n              onCheckedChange={(checked) => updateProfileMutation.mutate({ autoAcceptOrders: checked })}\n              data-testid=\"switch-auto-accept\"\n            />\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-1\">\n              <Label>{getLocalizedText(\"متاح للطلبات\", \"Available for Orders\", \"Disponible\")}</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                {getLocalizedText(\n                  \"عند الإيقاف لن تستقبل طلبات جديدة\",\n                  \"When off, you won't receive new orders\",\n                  \"Lorsqu'il est désactivé, vous ne recevrez pas de nouvelles commandes\"\n                )}\n              </p>\n            </div>\n            <Switch\n              checked={profile?.isAvailable ?? true}\n              onCheckedChange={(checked) => updateProfileMutation.mutate({ isAvailable: checked })}\n              data-testid=\"switch-available\"\n            />\n          </div>\n          <div className=\"pt-4 border-t\">\n            <div className=\"space-y-1\">\n              <Label>{getLocalizedText(\"الحد الأقصى للطلبات النشطة\", \"Max Active Orders\", \"Commandes Actives Max\")}</Label>\n              <p className=\"text-sm text-muted-foreground\">\n                {getLocalizedText(\n                  `يمكنك قبول حتى ${profile?.maxActiveOrders || 3} طلبات في وقت واحد`,\n                  `You can accept up to ${profile?.maxActiveOrders || 3} orders at once`,\n                  `Vous pouvez accepter jusqu'à ${profile?.maxActiveOrders || 3} commandes à la fois`\n                )}\n              </p>\n            </div>\n          </div>\n          {profile?.coverageAreas && profile.coverageAreas.length > 0 && (\n            <div className=\"pt-4 border-t\">\n              <div className=\"space-y-2\">\n                <Label>{getLocalizedText(\"مناطق التغطية\", \"Coverage Areas\", \"Zones de Couverture\")}</Label>\n                <div className=\"flex flex-wrap gap-2\">\n                  {profile.coverageAreas.map((area) => (\n                    <Badge key={area} variant=\"secondary\">{area}</Badge>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n\n  const renderContent = () => {\n    switch (section) {\n      case \"available\":\n        return renderAvailableOrders();\n      case \"current\":\n        return renderCurrentOrders();\n      case \"history\":\n        return renderHistory();\n      case \"stats\":\n        return renderStats();\n      case \"settings\":\n        return renderSettings();\n      default:\n        return renderDashboard();\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"flex flex-col lg:flex-row gap-6\">\n          <aside className=\"lg:w-64 shrink-0\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <nav className=\"space-y-1\">\n                  {navItems.map((item) => {\n                    const isActive = section === item.id;\n                    return (\n                      <Button\n                        key={item.id}\n                        variant={isActive ? \"secondary\" : \"ghost\"}\n                        className=\"w-full justify-start\"\n                        onClick={() => setLocation(item.id === \"dashboard\" ? \"/delegate\" : `/delegate/${item.id}`)}\n                        data-testid={`nav-${item.id}`}\n                      >\n                        <item.icon className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />\n                        {getLocalizedText(item.labelAr, item.labelEn, item.labelFr)}\n                      </Button>\n                    );\n                  })}\n                </nav>\n              </CardContent>\n            </Card>\n          </aside>\n\n          <main className=\"flex-1 min-w-0\">\n            {renderContent()}\n          </main>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":46188,"size_tokens":null},"client/src/pages/Blog.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useParams } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\nimport { motion } from \"framer-motion\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { ArrowLeft, ArrowRight, Calendar, Clock, FileText } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport type { BlogPost } from \"@shared/schema\";\n\nconst fadeInUp = {\n  hidden: { opacity: 0, y: 20 },\n  visible: { opacity: 1, y: 0, transition: { duration: 0.4 } }\n};\n\nconst staggerContainer = {\n  hidden: { opacity: 0 },\n  visible: { opacity: 1, transition: { staggerChildren: 0.1 } }\n};\n\nexport default function Blog() {\n  const { t, i18n } = useTranslation();\n  const params = useParams<{ id?: string }>();\n  const isRTL = i18n.language === \"ar\";\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const { data: posts, isLoading } = useQuery<BlogPost[]>({\n    queryKey: [\"/api/blog\"]\n  });\n\n  const { data: singlePost } = useQuery<BlogPost>({\n    queryKey: [\"/api/blog\", params.id],\n    enabled: !!params.id\n  });\n\n  const formatDate = (date: Date | string | null) => {\n    if (!date) return \"\";\n    const d = new Date(date);\n    return d.toLocaleDateString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\", {\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\"\n    });\n  };\n\n  if (params.id && singlePost) {\n    return (\n      <motion.div\n        initial=\"hidden\"\n        animate=\"visible\"\n        variants={staggerContainer}\n        className=\"py-12\"\n      >\n        <div className=\"container mx-auto px-4 max-w-4xl\">\n          <motion.div variants={fadeInUp}>\n            <Link href=\"/blog\">\n              <Button variant=\"ghost\" className=\"mb-6\" data-testid=\"button-back-to-blog\">\n                {isRTL ? <ArrowRight className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" /> : <ArrowLeft className=\"h-4 w-4 ltr:mr-2 rtl:ml-2\" />}\n                {getLocalizedText(\"العودة للمدونة\", \"Back to Blog\", \"Retour au Blog\")}\n              </Button>\n            </Link>\n          </motion.div>\n\n          <motion.article variants={fadeInUp} className=\"space-y-6\">\n            {singlePost.imageUrl && (\n              <img\n                src={singlePost.imageUrl}\n                alt={getLocalizedText(singlePost.titleAr, singlePost.titleEn, singlePost.titleFr)}\n                className=\"w-full h-64 md:h-96 object-cover rounded-lg\"\n              />\n            )}\n\n            <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\n              <span className=\"flex items-center gap-1\">\n                <Calendar className=\"h-4 w-4\" />\n                {formatDate(singlePost.createdAt)}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <Clock className=\"h-4 w-4\" />\n                {getLocalizedText(\"5 دقائق قراءة\", \"5 min read\", \"5 min de lecture\")}\n              </span>\n            </div>\n\n            <h1 className=\"text-3xl md:text-4xl font-bold\">\n              {getLocalizedText(singlePost.titleAr, singlePost.titleEn, singlePost.titleFr)}\n            </h1>\n\n            <div className=\"prose prose-lg dark:prose-invert max-w-none\">\n              <p className=\"whitespace-pre-wrap text-muted-foreground leading-relaxed\">\n                {getLocalizedText(singlePost.contentAr, singlePost.contentEn, singlePost.contentFr)}\n              </p>\n            </div>\n          </motion.article>\n        </div>\n      </motion.div>\n    );\n  }\n\n  return (\n    <motion.div\n      initial=\"hidden\"\n      animate=\"visible\"\n      variants={staggerContainer}\n      className=\"py-12\"\n    >\n      <div className=\"container mx-auto px-4\">\n        <motion.div variants={fadeInUp} className=\"text-center mb-12\">\n          <h1 className=\"text-3xl md:text-4xl font-bold mb-4\">\n            {getLocalizedText(\"مدونة غسلة ستايل\", \"Ghasla Style Blog\", \"Blog Ghasla Style\")}\n          </h1>\n          <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n            {getLocalizedText(\n              \"نصائح وإرشادات للعناية بسيارتك وآخر أخبار خدماتنا\",\n              \"Tips and guidance for car care and our latest service news\",\n              \"Conseils et astuces pour l'entretien de votre voiture et nos dernières actualités\"\n            )}\n          </p>\n        </motion.div>\n\n        {isLoading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {[1, 2, 3, 4].map((i) => (\n              <Skeleton key={i} className=\"h-80\" />\n            ))}\n          </div>\n        ) : posts && posts.length > 0 ? (\n          <motion.div\n            variants={staggerContainer}\n            className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\"\n          >\n            {posts.map((post) => (\n              <motion.div key={post.id} variants={fadeInUp}>\n                <Link href={`/blog/${post.id}`}>\n                  <Card className=\"h-full hover-elevate cursor-pointer overflow-hidden\" data-testid={`card-blog-${post.id}`}>\n                    {post.imageUrl && (\n                      <img\n                        src={post.imageUrl}\n                        alt={getLocalizedText(post.titleAr, post.titleEn, post.titleFr)}\n                        className=\"w-full h-48 object-cover\"\n                      />\n                    )}\n                    <CardContent className=\"p-4 space-y-3\">\n                      <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                        <Calendar className=\"h-3 w-3\" />\n                        {formatDate(post.createdAt)}\n                      </div>\n                      <h3 className=\"font-semibold text-lg line-clamp-2\">\n                        {getLocalizedText(post.titleAr, post.titleEn, post.titleFr)}\n                      </h3>\n                      <p className=\"text-sm text-muted-foreground line-clamp-3\">\n                        {getLocalizedText(post.contentAr, post.contentEn, post.contentFr)}\n                      </p>\n                      <Button variant=\"ghost\" className=\"p-0 h-auto text-primary\">\n                        {getLocalizedText(\"اقرأ المزيد\", \"Read More\", \"Lire la suite\")}\n                        {isRTL ? <ArrowLeft className=\"h-4 w-4 ltr:ml-1 rtl:mr-1\" /> : <ArrowRight className=\"h-4 w-4 ltr:ml-1 rtl:mr-1\" />}\n                      </Button>\n                    </CardContent>\n                  </Card>\n                </Link>\n              </motion.div>\n            ))}\n          </motion.div>\n        ) : (\n          <div className=\"text-center py-12\">\n            <FileText className=\"h-16 w-16 mx-auto mb-4 text-muted-foreground\" />\n            <p className=\"text-muted-foreground\">\n              {getLocalizedText(\"لا توجد مقالات حالياً\", \"No articles yet\", \"Aucun article pour le moment\")}\n            </p>\n          </div>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":7189,"size_tokens":null},"server/security.ts":{"content":"import rateLimit from \"express-rate-limit\";\n\n// General API Rate Limit: 100 requests per minute per IP\nexport const generalApiLimiter = rateLimit({\n  windowMs: 60 * 1000,\n  max: 100,\n  message: { error: \"Too many requests, please try again later.\" },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Strict Rate Limit for Auth: 10 requests per minute per IP\nexport const authLimiter = rateLimit({\n  windowMs: 60 * 1000,\n  max: 10,\n  message: { error: \"Too many authentication attempts, please try again later.\" },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Order Creation Rate Limit: 20 requests per minute per IP\nexport const orderLimiter = rateLimit({\n  windowMs: 60 * 1000,\n  max: 20,\n  message: { error: \"Too many order requests, please try again later.\" },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Internal Routes Rate Limit: 5 requests per hour per IP (very strict)\nexport const internalLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000,\n  max: 5,\n  message: { error: \"Too many internal requests, please try again later.\" },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Contact Form Rate Limit: 5 requests per minute per IP\nexport const contactLimiter = rateLimit({\n  windowMs: 60 * 1000,\n  max: 5,\n  message: { error: \"Too many contact requests, please try again later.\" },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/pages/Offers.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { motion } from \"framer-motion\";\nimport { Link } from \"wouter\";\nimport { Tag, Calendar, Users, Gift, ShoppingCart } from \"lucide-react\";\nimport { SiWhatsapp } from \"react-icons/si\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport type { Offer } from \"@shared/schema\";\n\nconst fadeInUp = {\n  hidden: { opacity: 0, y: 30 },\n  visible: { opacity: 1, y: 0, transition: { duration: 0.6, ease: \"easeOut\" } }\n};\n\nconst staggerContainer = {\n  hidden: { opacity: 0 },\n  visible: { opacity: 1, transition: { staggerChildren: 0.1 } }\n};\n\nexport default function Offers() {\n  const { i18n } = useTranslation();\n\n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const { data: offers, isLoading } = useQuery<Offer[]>({\n    queryKey: [\"/api/offers/active\"],\n  });\n\n  const getAudienceLabel = (audience: string) => {\n    const labels: Record<string, { ar: string; en: string; fr: string }> = {\n      all: { ar: \"للجميع\", en: \"For Everyone\", fr: \"Pour tous\" },\n      new_customers: { ar: \"للعملاء الجدد\", en: \"New Customers\", fr: \"Nouveaux clients\" },\n      existing_customers: { ar: \"للعملاء الحاليين\", en: \"Existing Customers\", fr: \"Clients existants\" },\n    };\n    const label = labels[audience] || labels.all;\n    return getLocalizedText(label.ar, label.en, label.fr);\n  };\n\n  const getLoyaltyLabel = (scope: string) => {\n    const labels: Record<string, { ar: string; en: string; fr: string }> = {\n      inside_loyalty: { ar: \"ضمن نظام الولاء\", en: \"Loyalty Program\", fr: \"Programme fidélité\" },\n      outside_loyalty: { ar: \"متاح للجميع\", en: \"Open to All\", fr: \"Ouvert à tous\" },\n    };\n    const label = labels[scope] || labels.outside_loyalty;\n    return getLocalizedText(label.ar, label.en, label.fr);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-background to-muted/30\">\n      <section className=\"py-16 md:py-24\">\n        <div className=\"container mx-auto px-4\">\n          <motion.div\n            initial=\"hidden\"\n            animate=\"visible\"\n            variants={staggerContainer}\n            className=\"max-w-4xl mx-auto\"\n          >\n            <motion.div variants={fadeInUp} className=\"text-center mb-12\">\n              <div className=\"flex items-center justify-center gap-3 mb-4\">\n                <div className=\"p-3 bg-primary/10 rounded-full\">\n                  <Tag className=\"h-8 w-8 text-primary\" />\n                </div>\n              </div>\n              <h1 className=\"text-3xl md:text-5xl font-bold mb-4\">\n                {getLocalizedText(\"عروضنا الحصرية\", \"Our Exclusive Offers\", \"Nos Offres Exclusives\")}\n              </h1>\n              <p className=\"text-muted-foreground text-lg max-w-2xl mx-auto\">\n                {getLocalizedText(\n                  \"استفد من عروضنا المميزة واحصل على أفضل خدمات غسيل السيارات بأسعار استثنائية\",\n                  \"Take advantage of our special offers and get the best car wash services at exceptional prices\",\n                  \"Profitez de nos offres spéciales et obtenez les meilleurs services de lavage auto à des prix exceptionnels\"\n                )}\n              </p>\n            </motion.div>\n\n            {isLoading ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {[1, 2, 3, 4].map((i) => (\n                  <Skeleton key={i} className=\"h-64 rounded-lg\" />\n                ))}\n              </div>\n            ) : offers && offers.length > 0 ? (\n              <motion.div variants={staggerContainer} className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {offers.map((offer) => (\n                  <motion.div key={offer.id} variants={fadeInUp}>\n                    <Card className=\"border-2 border-primary/10 hover-elevate\" data-testid={`offer-page-card-${offer.id}`}>\n                      {offer.imageUrl && (\n                        <div className=\"relative h-48 overflow-hidden rounded-t-lg\">\n                          <img \n                            src={offer.imageUrl} \n                            alt={getLocalizedText(offer.titleAr, offer.titleEn, offer.titleFr)} \n                            className=\"w-full h-full object-cover\"\n                          />\n                          <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent\" />\n                          {(offer.discountPercentage || offer.discountAmountKD) && (\n                            <div className=\"absolute top-4 end-4\">\n                              <Badge className=\"bg-primary text-primary-foreground text-lg px-3 py-1\">\n                                {offer.discountPercentage ? `${offer.discountPercentage}%` : `${offer.discountAmountKD} KD`}\n                              </Badge>\n                            </div>\n                          )}\n                        </div>\n                      )}\n                      <CardContent className={`${offer.imageUrl ? \"pt-4\" : \"pt-6\"} pb-6`}>\n                        <h3 className=\"text-xl font-bold mb-2\">\n                          {getLocalizedText(offer.titleAr, offer.titleEn, offer.titleFr)}\n                        </h3>\n                        <p className=\"text-muted-foreground mb-4\">\n                          {getLocalizedText(offer.descriptionAr, offer.descriptionEn, offer.descriptionFr)}\n                        </p>\n                        \n                        <div className=\"flex flex-wrap gap-2 mb-4\">\n                          <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                            <Users className=\"h-3 w-3\" />\n                            {getAudienceLabel(offer.targetAudience || \"all\")}\n                          </Badge>\n                          <Badge \n                            variant={offer.loyaltyScope === \"inside_loyalty\" ? \"secondary\" : \"outline\"} \n                            className=\"flex items-center gap-1\"\n                          >\n                            <Gift className=\"h-3 w-3\" />\n                            {getLoyaltyLabel(offer.loyaltyScope || \"outside_loyalty\")}\n                          </Badge>\n                        </div>\n\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-4\">\n                          <Calendar className=\"h-4 w-4\" />\n                          <span>\n                            {getLocalizedText(\"صالح حتى:\", \"Valid until:\", \"Valable jusqu'au:\")} {new Date(offer.endDate).toLocaleDateString(i18n.language === \"ar\" ? \"ar-KW\" : i18n.language === \"fr\" ? \"fr-FR\" : \"en-US\")}\n                          </span>\n                        </div>\n\n                        <div className=\"flex flex-col sm:flex-row gap-2 mt-4\">\n                          <Link href=\"/booking\" className=\"flex-1\">\n                            <Button className=\"w-full\" data-testid={`offer-page-book-regular-${offer.id}`}>\n                              <ShoppingCart className=\"h-5 w-5 me-2\" />\n                              {getLocalizedText(\"احجز الآن\", \"Book Now\", \"Réserver\")}\n                            </Button>\n                          </Link>\n                          <a \n                            href=\"https://wa.me/96597960808\" \n                            target=\"_blank\" \n                            rel=\"noopener noreferrer\"\n                            className=\"flex-1\"\n                          >\n                            <Button variant=\"outline\" className=\"w-full border-[#25D366] text-[#25D366] hover:bg-[#25D366]/10\" data-testid={`offer-page-book-whatsapp-${offer.id}`}>\n                              <SiWhatsapp className=\"h-5 w-5 me-2\" />\n                              {getLocalizedText(\"واتساب\", \"WhatsApp\", \"WhatsApp\")}\n                            </Button>\n                          </a>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </motion.div>\n                ))}\n              </motion.div>\n            ) : (\n              <motion.div variants={fadeInUp}>\n                <Card className=\"text-center py-16\">\n                  <CardContent>\n                    <Tag className=\"h-16 w-16 mx-auto mb-6 text-muted-foreground\" />\n                    <h2 className=\"text-2xl font-bold mb-3\">\n                      {getLocalizedText(\"لا توجد عروض حالياً\", \"No Active Offers\", \"Aucune offre active\")}\n                    </h2>\n                    <p className=\"text-muted-foreground mb-6\">\n                      {getLocalizedText(\n                        \"ترقبوا عروضنا القادمة! تابعونا على واتساب للحصول على آخر العروض\",\n                        \"Stay tuned for upcoming offers! Follow us on WhatsApp for the latest deals\",\n                        \"Restez à l'écoute pour les prochaines offres! Suivez-nous sur WhatsApp\"\n                      )}\n                    </p>\n                    <a href=\"https://wa.me/96597960808\" target=\"_blank\" rel=\"noopener noreferrer\">\n                      <Button className=\"bg-[#25D366] hover:bg-[#20BD5A]\">\n                        <SiWhatsapp className=\"h-5 w-5 me-2\" />\n                        {getLocalizedText(\"تواصل معنا\", \"Contact Us\", \"Contactez-nous\")}\n                      </Button>\n                    </a>\n                  </CardContent>\n                </Card>\n              </motion.div>\n            )}\n          </motion.div>\n        </div>\n      </section>\n    </div>\n  );\n}\n","path":null,"size_bytes":9895,"size_tokens":null},"client/src/pages/Checkout.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useRoute, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { motion } from \"framer-motion\";\nimport { CreditCard, CheckCircle, XCircle, Loader2, Shield, ArrowRight, ArrowLeft } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Payment, Order, ServicePackage } from \"@shared/schema\";\n\nexport default function Checkout() {\n  const { t, i18n } = useTranslation();\n  const [, params] = useRoute(\"/payment/checkout/:paymentId\");\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const isRTL = i18n.language === \"ar\";\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const paymentId = params?.paymentId;\n\n  const { data: payment, isLoading: paymentLoading, refetch: refetchPayment } = useQuery<Payment>({\n    queryKey: [\"/api/payments\", paymentId],\n    enabled: !!paymentId,\n  });\n\n  const { data: order, isLoading: orderLoading } = useQuery<Order>({\n    queryKey: [\"/api/orders\", payment?.orderId],\n    enabled: !!payment?.orderId,\n  });\n\n  const { data: servicePackage } = useQuery<ServicePackage>({\n    queryKey: [\"/api/packages\", order?.servicePackageId],\n    enabled: !!order?.servicePackageId,\n  });\n\n  const simulateSuccessMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", `/api/payments/${paymentId}/simulate-success`);\n    },\n    onSuccess: () => {\n      refetchPayment();\n      queryClient.invalidateQueries({ queryKey: [\"/api/orders\"] });\n      toast({\n        title: isRTL ? \"تم الدفع بنجاح\" : \"Payment Successful\",\n        description: isRTL ? \"شكراً لك! تم تأكيد طلبك.\" : \"Thank you! Your order has been confirmed.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: isRTL ? \"خطأ\" : \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const simulateFailureMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", `/api/payments/${paymentId}/simulate-failure`, { errorMessage: \"Payment declined by bank\" });\n    },\n    onSuccess: () => {\n      refetchPayment();\n      toast({\n        title: isRTL ? \"فشل الدفع\" : \"Payment Failed\",\n        description: isRTL ? \"تم رفض الدفع. يرجى المحاولة مرة أخرى.\" : \"Payment was declined. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handlePayWithKNET = async () => {\n    setIsProcessing(true);\n    await simulateSuccessMutation.mutateAsync();\n    setIsProcessing(false);\n  };\n\n  const handleCancel = async () => {\n    await simulateFailureMutation.mutateAsync();\n    navigate(\"/account\");\n  };\n\n  const getServiceName = () => {\n    if (!servicePackage) return \"\";\n    if (i18n.language === \"ar\") return servicePackage.nameAr;\n    if (i18n.language === \"fr\") return servicePackage.nameFr;\n    return servicePackage.nameEn;\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"captured\":\n        return <Badge variant=\"default\" className=\"bg-green-500\">{isRTL ? \"تم الدفع\" : \"Paid\"}</Badge>;\n      case \"failed\":\n        return <Badge variant=\"destructive\">{isRTL ? \"فشل\" : \"Failed\"}</Badge>;\n      case \"cancelled\":\n        return <Badge variant=\"secondary\">{isRTL ? \"ملغي\" : \"Cancelled\"}</Badge>;\n      case \"pending\":\n      case \"initiated\":\n        return <Badge variant=\"outline\">{isRTL ? \"في انتظار الدفع\" : \"Pending\"}</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  if (paymentLoading || orderLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!payment) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Card className=\"max-w-md w-full mx-4\">\n          <CardContent className=\"pt-6 text-center\">\n            <XCircle className=\"h-16 w-16 text-destructive mx-auto mb-4\" />\n            <h2 className=\"text-xl font-bold mb-2\">\n              {isRTL ? \"الدفع غير موجود\" : \"Payment Not Found\"}\n            </h2>\n            <p className=\"text-muted-foreground mb-4\">\n              {isRTL ? \"لم يتم العثور على تفاصيل الدفع المطلوبة.\" : \"The requested payment details could not be found.\"}\n            </p>\n            <Button onClick={() => navigate(\"/\")}>\n              {isRTL ? \"العودة للرئيسية\" : \"Go to Home\"}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (payment.status === \"captured\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center py-12\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          transition={{ duration: 0.5 }}\n        >\n          <Card className=\"max-w-md w-full mx-4\">\n            <CardContent className=\"pt-6 text-center\">\n              <motion.div\n                initial={{ scale: 0 }}\n                animate={{ scale: 1 }}\n                transition={{ delay: 0.2, type: \"spring\", stiffness: 200 }}\n              >\n                <CheckCircle className=\"h-20 w-20 text-green-500 mx-auto mb-4\" />\n              </motion.div>\n              <h2 className=\"text-2xl font-bold mb-2 text-green-600\">\n                {isRTL ? \"تم الدفع بنجاح!\" : \"Payment Successful!\"}\n              </h2>\n              <p className=\"text-muted-foreground mb-6\">\n                {isRTL \n                  ? \"شكراً لك! تم تأكيد طلبك وسيتم التواصل معك قريباً.\" \n                  : \"Thank you! Your order has been confirmed and we will contact you soon.\"}\n              </p>\n              \n              <div className=\"bg-muted rounded-lg p-4 mb-6 text-start\">\n                <div className=\"flex justify-between mb-2\">\n                  <span className=\"text-muted-foreground\">{isRTL ? \"رقم الطلب:\" : \"Order ID:\"}</span>\n                  <span className=\"font-mono text-sm\">{payment.orderId?.slice(0, 8)}...</span>\n                </div>\n                <div className=\"flex justify-between mb-2\">\n                  <span className=\"text-muted-foreground\">{isRTL ? \"المبلغ:\" : \"Amount:\"}</span>\n                  <span className=\"font-bold\">{payment.amountKD} KD</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-muted-foreground\">{isRTL ? \"طريقة الدفع:\" : \"Payment Method:\"}</span>\n                  <span>{payment.cardBrand || \"KNET\"}</span>\n                </div>\n              </div>\n              \n              <div className=\"flex flex-col gap-3\">\n                <Button onClick={() => navigate(\"/track-order\")} className=\"w-full\">\n                  {isRTL ? \"تتبع الطلب\" : \"Track Order\"}\n                </Button>\n                <Button variant=\"outline\" onClick={() => navigate(\"/\")}>\n                  {isRTL ? \"العودة للرئيسية\" : \"Go to Home\"}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n    );\n  }\n\n  if (payment.status === \"failed\" || payment.status === \"cancelled\") {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center py-12\">\n        <Card className=\"max-w-md w-full mx-4\">\n          <CardContent className=\"pt-6 text-center\">\n            <XCircle className=\"h-20 w-20 text-destructive mx-auto mb-4\" />\n            <h2 className=\"text-2xl font-bold mb-2 text-destructive\">\n              {isRTL ? \"فشل الدفع\" : \"Payment Failed\"}\n            </h2>\n            <p className=\"text-muted-foreground mb-6\">\n              {payment.errorMessage || (isRTL \n                ? \"تعذر إتمام عملية الدفع. يرجى المحاولة مرة أخرى.\" \n                : \"The payment could not be completed. Please try again.\")}\n            </p>\n            \n            <div className=\"flex flex-col gap-3\">\n              <Button onClick={() => navigate(\"/booking\")} className=\"w-full\">\n                {isRTL ? \"حاول مرة أخرى\" : \"Try Again\"}\n              </Button>\n              <Button variant=\"outline\" onClick={() => navigate(\"/\")}>\n                {isRTL ? \"العودة للرئيسية\" : \"Go to Home\"}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen py-12\">\n      <div className=\"container mx-auto px-4 max-w-2xl\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.5 }}\n        >\n          <Card>\n            <CardHeader className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-2 mb-4\">\n                <CreditCard className=\"h-8 w-8 text-primary\" />\n              </div>\n              <CardTitle className=\"text-2xl\">\n                {isRTL ? \"إتمام الدفع\" : \"Complete Payment\"}\n              </CardTitle>\n              <CardDescription>\n                {isRTL \n                  ? \"أكمل عملية الدفع لتأكيد طلبك\" \n                  : \"Complete your payment to confirm your order\"}\n              </CardDescription>\n            </CardHeader>\n            \n            <CardContent className=\"space-y-6\">\n              <div className=\"bg-muted rounded-lg p-4\">\n                <h3 className=\"font-semibold mb-3 flex items-center gap-2\">\n                  {isRTL ? \"تفاصيل الطلب\" : \"Order Summary\"}\n                </h3>\n                \n                {order && (\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">{isRTL ? \"الخدمة:\" : \"Service:\"}</span>\n                      <span className=\"font-medium\">{getServiceName()}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">{isRTL ? \"نوع السيارة:\" : \"Car Type:\"}</span>\n                      <span>{order.carType === \"sedan\" ? (isRTL ? \"سيدان\" : \"Sedan\") : (isRTL ? \"دفع رباعي\" : \"SUV\")}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">{isRTL ? \"المنطقة:\" : \"Area:\"}</span>\n                      <span>{order.area}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">{isRTL ? \"التاريخ:\" : \"Date:\"}</span>\n                      <span>{order.preferredDate}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">{isRTL ? \"الوقت:\" : \"Time:\"}</span>\n                      <span>{order.preferredTime}</span>\n                    </div>\n                  </div>\n                )}\n                \n                <Separator className=\"my-4\" />\n                \n                <div className=\"flex justify-between items-center\">\n                  <span className=\"font-semibold text-lg\">{isRTL ? \"المجموع:\" : \"Total:\"}</span>\n                  <span className=\"text-2xl font-bold text-primary\">{payment.amountKD} KD</span>\n                </div>\n              </div>\n              \n              <div className=\"bg-blue-50 dark:bg-blue-950/30 rounded-lg p-4 flex items-start gap-3\">\n                <Shield className=\"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <p className=\"text-sm text-blue-800 dark:text-blue-200 font-medium\">\n                    {isRTL ? \"دفع آمن\" : \"Secure Payment\"}\n                  </p>\n                  <p className=\"text-xs text-blue-600 dark:text-blue-400\">\n                    {isRTL \n                      ? \"معاملاتك محمية ومشفرة بالكامل\" \n                      : \"Your transaction is protected and fully encrypted\"}\n                  </p>\n                </div>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <h4 className=\"font-semibold text-center\">\n                  {isRTL ? \"اختر طريقة الدفع\" : \"Select Payment Method\"}\n                </h4>\n                \n                <Button \n                  className=\"w-full h-14 text-lg gap-2\" \n                  onClick={handlePayWithKNET}\n                  disabled={isProcessing || simulateSuccessMutation.isPending}\n                  data-testid=\"button-pay-knet\"\n                >\n                  {isProcessing || simulateSuccessMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"h-5 w-5 animate-spin\" />\n                      {isRTL ? \"جاري المعالجة...\" : \"Processing...\"}\n                    </>\n                  ) : (\n                    <>\n                      <CreditCard className=\"h-5 w-5\" />\n                      {isRTL ? \"الدفع عبر كي نت\" : \"Pay with KNET\"}\n                      {isRTL ? <ArrowLeft className=\"h-5 w-5\" /> : <ArrowRight className=\"h-5 w-5\" />}\n                    </>\n                  )}\n                </Button>\n                \n                <div className=\"text-center text-xs text-muted-foreground\">\n                  {isRTL \n                    ? \"بيئة اختبار - لن يتم خصم أي مبلغ حقيقي\" \n                    : \"Test environment - No real charges will be made\"}\n                </div>\n              </div>\n              \n              <div className=\"flex justify-center pt-4\">\n                <Button \n                  variant=\"ghost\" \n                  onClick={handleCancel}\n                  disabled={simulateFailureMutation.isPending}\n                  data-testid=\"button-cancel-payment\"\n                >\n                  {isRTL ? \"إلغاء الدفع\" : \"Cancel Payment\"}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14787,"size_tokens":null},"client/src/hooks/use-postgres-orders.ts":{"content":"import { useState, useEffect, useCallback } from \"react\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport type { Order } from \"@shared/schema\";\n\nexport type OrderFilter = \"all\" | \"active\" | \"completed\" | \"cancelled\";\n\ninterface UsePostgresOrdersReturn {\n  orders: Order[];\n  filteredOrders: Order[];\n  lastCompletedOrder: Order | null;\n  isLoading: boolean;\n  error: string | null;\n  filter: OrderFilter;\n  setFilter: (filter: OrderFilter) => void;\n  refetch: () => void;\n}\n\nexport function usePostgresOrders(): UsePostgresOrdersReturn {\n  const { user } = useAuth();\n  const [orders, setOrders] = useState<Order[]>([]);\n  const [lastCompletedOrder, setLastCompletedOrder] = useState<Order | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [filter, setFilter] = useState<OrderFilter>(\"all\");\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n\n  const refetch = useCallback(() => {\n    setRefreshTrigger(prev => prev + 1);\n  }, []);\n\n  useEffect(() => {\n    if (!user?.id) {\n      setOrders([]);\n      setIsLoading(false);\n      return;\n    }\n\n    const fetchOrders = async () => {\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const res = await fetch(`/api/orders/customer/${user.id}`);\n        if (!res.ok) {\n          throw new Error(\"Failed to fetch orders\");\n        }\n        const data = await res.json();\n        setOrders(data);\n\n        const completedOrders = data.filter((o: Order) => o.status === \"completed\");\n        if (completedOrders.length > 0) {\n          setLastCompletedOrder(completedOrders[0]);\n        }\n      } catch (err: any) {\n        console.error(\"Error fetching orders:\", err);\n        setError(err.message || \"Failed to load orders\");\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchOrders();\n  }, [user?.id, refreshTrigger]);\n\n  const filteredOrders = orders.filter(order => {\n    if (filter === \"all\") return true;\n    if (filter === \"active\") {\n      return ![\"completed\", \"cancelled\"].includes(order.status);\n    }\n    if (filter === \"completed\") return order.status === \"completed\";\n    if (filter === \"cancelled\") return order.status === \"cancelled\";\n    return true;\n  });\n\n  return {\n    orders,\n    filteredOrders,\n    lastCompletedOrder,\n    isLoading,\n    error,\n    filter,\n    setFilter,\n    refetch\n  };\n}\n","path":null,"size_bytes":2400,"size_tokens":null},"client/src/components/ui/map-picker.tsx":{"content":"import { useEffect, useRef, useState } from \"react\";\nimport L from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport { Button } from \"@/components/ui/button\";\nimport { MapPin, Navigation, X, Check } from \"lucide-react\";\n\n// Fix for default marker icons in Leaflet\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png\",\n  iconUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png\",\n  shadowUrl: \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png\",\n});\n\ninterface MapPickerProps {\n  initialLat?: number;\n  initialLng?: number;\n  onLocationSelect: (lat: number, lng: number, address: string) => void;\n  onClose: () => void;\n  language: string;\n}\n\nexport function MapPicker({\n  initialLat = 29.3759,\n  initialLng = 47.9774,\n  onLocationSelect,\n  onClose,\n  language,\n}: MapPickerProps) {\n  const mapRef = useRef<HTMLDivElement>(null);\n  const mapInstanceRef = useRef<L.Map | null>(null);\n  const markerRef = useRef<L.Marker | null>(null);\n  const [selectedLat, setSelectedLat] = useState(initialLat);\n  const [selectedLng, setSelectedLng] = useState(initialLng);\n  const [address, setAddress] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isLocating, setIsLocating] = useState(false);\n\n  const getLocalizedText = (ar: string, en: string) => {\n    return language === \"ar\" ? ar : en;\n  };\n\n  const reverseGeocode = async (lat: number, lng: number) => {\n    try {\n      const response = await fetch(\n        `/api/geocode/reverse?lat=${lat}&lon=${lng}&lang=${language}`\n      );\n      const data = await response.json();\n      if (data.display_name) {\n        return data.display_name.split(\",\").slice(0, 3).join(\",\");\n      }\n      return `${lat.toFixed(6)}, ${lng.toFixed(6)}`;\n    } catch {\n      return `${lat.toFixed(6)}, ${lng.toFixed(6)}`;\n    }\n  };\n\n  const updateMarkerPosition = async (lat: number, lng: number) => {\n    setSelectedLat(lat);\n    setSelectedLng(lng);\n    if (markerRef.current) {\n      markerRef.current.setLatLng([lat, lng]);\n    }\n    setIsLoading(true);\n    const newAddress = await reverseGeocode(lat, lng);\n    setAddress(newAddress);\n    setIsLoading(false);\n  };\n\n  const handleLocateMe = () => {\n    if (!navigator.geolocation) return;\n    \n    setIsLocating(true);\n    navigator.geolocation.getCurrentPosition(\n      async (position) => {\n        const { latitude, longitude } = position.coords;\n        if (mapInstanceRef.current) {\n          mapInstanceRef.current.setView([latitude, longitude], 16);\n        }\n        await updateMarkerPosition(latitude, longitude);\n        setIsLocating(false);\n      },\n      async () => {\n        setIsLocating(false);\n        // Try IP-based fallback\n        try {\n          const response = await fetch(\"/api/geocode/ip-location\");\n          const data = await response.json();\n          if (data.success && mapInstanceRef.current) {\n            mapInstanceRef.current.setView([data.lat, data.lon], 14);\n            await updateMarkerPosition(data.lat, data.lon);\n          }\n        } catch {}\n      },\n      { enableHighAccuracy: true, timeout: 10000 }\n    );\n  };\n\n  const handleConfirm = () => {\n    onLocationSelect(selectedLat, selectedLng, address);\n  };\n\n  useEffect(() => {\n    if (!mapRef.current || mapInstanceRef.current) return;\n\n    const map = L.map(mapRef.current).setView([initialLat, initialLng], 14);\n    mapInstanceRef.current = map;\n\n    L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\n      attribution: \"&copy; OpenStreetMap contributors\",\n    }).addTo(map);\n\n    const marker = L.marker([initialLat, initialLng], {\n      draggable: true,\n    }).addTo(map);\n    markerRef.current = marker;\n\n    marker.on(\"dragend\", async () => {\n      const pos = marker.getLatLng();\n      await updateMarkerPosition(pos.lat, pos.lng);\n    });\n\n    map.on(\"click\", async (e: L.LeafletMouseEvent) => {\n      await updateMarkerPosition(e.latlng.lat, e.latlng.lng);\n    });\n\n    // Initial reverse geocode\n    reverseGeocode(initialLat, initialLng).then(setAddress);\n\n    // Try to get user's location on mount\n    handleLocateMe();\n\n    return () => {\n      map.remove();\n      mapInstanceRef.current = null;\n    };\n  }, []);\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\n      <div className=\"bg-card rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] flex flex-col\">\n        <div className=\"flex items-center justify-between gap-2 p-4 border-b\">\n          <div className=\"flex items-center gap-2\">\n            <MapPin className=\"h-5 w-5 text-primary\" />\n            <h2 className=\"font-semibold\">\n              {getLocalizedText(\"حدد موقعك على الخريطة\", \"Select your location on the map\")}\n            </h2>\n          </div>\n          <Button size=\"icon\" variant=\"ghost\" onClick={onClose} data-testid=\"button-close-map\">\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n\n        <div className=\"relative flex-1 min-h-[400px]\">\n          <div ref={mapRef} className=\"absolute inset-0\" />\n          \n          <Button\n            size=\"sm\"\n            variant=\"secondary\"\n            className=\"absolute top-2 ltr:right-2 rtl:left-2 z-[1000] shadow-md\"\n            onClick={handleLocateMe}\n            disabled={isLocating}\n            data-testid=\"button-locate-me\"\n          >\n            <Navigation className={`h-4 w-4 ${isLocating ? \"animate-pulse\" : \"\"}`} />\n            <span className=\"ml-1 rtl:mr-1 rtl:ml-0\">\n              {getLocalizedText(\"موقعي\", \"My Location\")}\n            </span>\n          </Button>\n        </div>\n\n        <div className=\"p-4 border-t space-y-3\">\n          <div className=\"text-sm\">\n            <span className=\"text-muted-foreground\">\n              {getLocalizedText(\"العنوان المحدد:\", \"Selected address:\")}\n            </span>\n            <p className=\"font-medium mt-1\">\n              {isLoading ? getLocalizedText(\"جاري التحميل...\", \"Loading...\") : address}\n            </p>\n          </div>\n\n          <div className=\"text-xs text-muted-foreground\">\n            {getLocalizedText(\n              \"اسحب العلامة أو انقر على الخريطة لتحديد موقعك بدقة\",\n              \"Drag the marker or click on the map to pinpoint your location\"\n            )}\n          </div>\n\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={onClose} className=\"flex-1\" data-testid=\"button-cancel-map\">\n              {getLocalizedText(\"إلغاء\", \"Cancel\")}\n            </Button>\n            <Button onClick={handleConfirm} className=\"flex-1\" disabled={isLoading} data-testid=\"button-confirm-location\">\n              <Check className=\"h-4 w-4 ltr:mr-1 rtl:ml-1\" />\n              {getLocalizedText(\"تأكيد الموقع\", \"Confirm Location\")}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7060,"size_tokens":null},"client/src/pages/TermsOfService.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { FileText, Mail, Phone, MapPin, Calendar } from \"lucide-react\";\n\nexport default function TermsOfService() {\n  const { i18n } = useTranslation();\n  \n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const lastUpdated = \"2024-12-21\";\n\n  return (\n    <div className=\"min-h-screen bg-background py-12\">\n      <div className=\"container mx-auto px-4 max-w-4xl\">\n        <Card>\n          <CardHeader className=\"text-center border-b\">\n            <div className=\"flex justify-center mb-4\">\n              <div className=\"p-3 rounded-full bg-primary/10\">\n                <FileText className=\"h-8 w-8 text-primary\" />\n              </div>\n            </div>\n            <CardTitle className=\"text-3xl\" data-testid=\"terms-of-service-title\">\n              {getLocalizedText(\"شروط الاستخدام\", \"Terms of Service\", \"Conditions d'Utilisation\")}\n            </CardTitle>\n            <p className=\"text-muted-foreground flex items-center justify-center gap-2 mt-2\">\n              <Calendar className=\"h-4 w-4\" />\n              {getLocalizedText(`آخر تحديث: ${lastUpdated}`, `Last Updated: ${lastUpdated}`, `Dernière mise à jour: ${lastUpdated}`)}\n            </p>\n          </CardHeader>\n          <CardContent className=\"prose prose-gray dark:prose-invert max-w-none p-6 md:p-8 space-y-8\">\n            \n            {/* Introduction */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"مقدمة\", \"Introduction\", \"Introduction\")}\n              </h2>\n              <p className=\"text-muted-foreground leading-relaxed mt-4\">\n                {getLocalizedText(\n                  \"مرحباً بكم في غسلة ستايل. باستخدامكم لتطبيقنا وخدماتنا، فإنكم توافقون على الالتزام بهذه الشروط والأحكام. يرجى قراءتها بعناية قبل استخدام خدماتنا.\",\n                  \"Welcome to Ghasla Style. By using our application and services, you agree to be bound by these Terms and Conditions. Please read them carefully before using our services.\",\n                  \"Bienvenue chez Ghasla Style. En utilisant notre application et nos services, vous acceptez d'être lié par ces conditions générales.\"\n                )}\n              </p>\n            </section>\n\n            {/* Service Description */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"وصف الخدمة\", \"Service Description\", \"Description du Service\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"غسلة ستايل هي خدمة غسيل سيارات متنقلة تعمل في دولة الكويت. نقدم خدمات غسيل وتنظيف السيارات في موقعكم المحدد من خلال فريق من المندوبين المدربين.\",\n                  \"Ghasla Style is a mobile car wash service operating in Kuwait. We provide car washing and cleaning services at your specified location through a team of trained delegates.\",\n                  \"Ghasla Style est un service de lavage de voiture mobile opérant au Koweït. Nous fournissons des services de lavage à votre emplacement.\"\n                )}\n              </p>\n            </section>\n\n            {/* User Accounts */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"حسابات المستخدمين\", \"User Accounts\", \"Comptes Utilisateurs\")}\n              </h2>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-4 space-y-2\">\n                <li>{getLocalizedText(\"يجب أن يكون عمرك 18 عاماً أو أكثر لإنشاء حساب\", \"You must be 18 years or older to create an account\", \"Vous devez avoir 18 ans ou plus pour créer un compte\")}</li>\n                <li>{getLocalizedText(\"أنت مسؤول عن الحفاظ على سرية معلومات حسابك\", \"You are responsible for maintaining the confidentiality of your account information\", \"Vous êtes responsable de la confidentialité de votre compte\")}</li>\n                <li>{getLocalizedText(\"يجب تقديم معلومات دقيقة وحديثة\", \"You must provide accurate and current information\", \"Vous devez fournir des informations exactes et à jour\")}</li>\n                <li>{getLocalizedText(\"أنت مسؤول عن جميع الأنشطة التي تتم تحت حسابك\", \"You are responsible for all activities under your account\", \"Vous êtes responsable de toutes les activités sous votre compte\")}</li>\n              </ul>\n            </section>\n\n            {/* Booking and Payment */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"الحجز والدفع\", \"Booking and Payment\", \"Réservation et Paiement\")}\n              </h2>\n              <div className=\"mt-4 space-y-4 text-muted-foreground\">\n                <p>\n                  {getLocalizedText(\n                    \"عند إجراء حجز، فإنك توافق على دفع السعر المحدد للخدمة المختارة. الأسعار قابلة للتغيير وسيتم إخطارك بأي تغييرات قبل تأكيد الحجز.\",\n                    \"When making a booking, you agree to pay the specified price for the selected service. Prices are subject to change and you will be notified of any changes before booking confirmation.\",\n                    \"Lors d'une réservation, vous acceptez de payer le prix spécifié pour le service sélectionné.\"\n                  )}\n                </p>\n                <p>\n                  <strong>{getLocalizedText(\"طرق الدفع المقبولة:\", \"Accepted Payment Methods:\", \"Méthodes de paiement acceptées:\")}</strong>\n                </p>\n                <ul className=\"list-disc list-inside space-y-1\">\n                  <li>{getLocalizedText(\"الدفع النقدي عند الخدمة\", \"Cash payment upon service\", \"Paiement en espèces\")}</li>\n                  <li>{getLocalizedText(\"التحويل البنكي\", \"Bank transfer\", \"Virement bancaire\")}</li>\n                  <li>{getLocalizedText(\"نقاط الولاء (حسب الرصيد المتاح)\", \"Loyalty points (subject to available balance)\", \"Points de fidélité\")}</li>\n                </ul>\n              </div>\n            </section>\n\n            {/* Cancellation Policy */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"سياسة الإلغاء\", \"Cancellation Policy\", \"Politique d'Annulation\")}\n              </h2>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-4 space-y-2\">\n                <li>{getLocalizedText(\"يمكنك إلغاء الحجز مجاناً قبل ساعتين من الموعد المحدد\", \"You can cancel a booking free of charge up to 2 hours before the scheduled time\", \"Vous pouvez annuler gratuitement jusqu'à 2 heures avant\")}</li>\n                <li>{getLocalizedText(\"الإلغاء بعد هذا الوقت قد يخضع لرسوم إلغاء\", \"Cancellations after this time may be subject to a cancellation fee\", \"Les annulations après ce délai peuvent être soumises à des frais\")}</li>\n                <li>{getLocalizedText(\"نحتفظ بالحق في إلغاء الخدمة في حالات الطوارئ أو الظروف الجوية السيئة\", \"We reserve the right to cancel services in case of emergencies or bad weather conditions\", \"Nous nous réservons le droit d'annuler en cas d'urgence ou de mauvais temps\")}</li>\n              </ul>\n            </section>\n\n            {/* Service Guarantee */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"ضمان الخدمة\", \"Service Guarantee\", \"Garantie de Service\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"نلتزم بتقديم خدمة عالية الجودة. إذا لم تكن راضياً عن الخدمة، يرجى إخطارنا خلال 24 ساعة وسنعمل على حل المشكلة أو إعادة الخدمة مجاناً.\",\n                  \"We are committed to providing high-quality service. If you are not satisfied with the service, please notify us within 24 hours and we will work to resolve the issue or re-do the service free of charge.\",\n                  \"Nous nous engageons à fournir un service de haute qualité. Si vous n'êtes pas satisfait, veuillez nous informer dans les 24 heures.\"\n                )}\n              </p>\n            </section>\n\n            {/* Loyalty Program */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"برنامج الولاء\", \"Loyalty Program\", \"Programme de Fidélité\")}\n              </h2>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-4 space-y-2\">\n                <li>{getLocalizedText(\"تكسب نقاطاً على كل خدمة مكتملة\", \"You earn points on every completed service\", \"Vous gagnez des points sur chaque service\")}</li>\n                <li>{getLocalizedText(\"يمكن استبدال النقاط بخصومات على الخدمات المستقبلية\", \"Points can be redeemed for discounts on future services\", \"Les points peuvent être échangés contre des réductions\")}</li>\n                <li>{getLocalizedText(\"النقاط غير قابلة للتحويل أو الاسترداد النقدي\", \"Points are non-transferable and have no cash value\", \"Les points ne sont pas transférables\")}</li>\n                <li>{getLocalizedText(\"نحتفظ بالحق في تعديل أو إنهاء البرنامج بإخطار مسبق\", \"We reserve the right to modify or terminate the program with prior notice\", \"Nous nous réservons le droit de modifier le programme\")}</li>\n              </ul>\n            </section>\n\n            {/* User Conduct */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"سلوك المستخدم\", \"User Conduct\", \"Conduite de l'Utilisateur\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\"عند استخدام خدماتنا، توافق على:\", \"When using our services, you agree to:\", \"En utilisant nos services, vous acceptez de:\")}\n              </p>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-2\">\n                <li>{getLocalizedText(\"معاملة موظفينا باحترام\", \"Treat our staff with respect\", \"Traiter notre personnel avec respect\")}</li>\n                <li>{getLocalizedText(\"توفير موقع آمن ومناسب للخدمة\", \"Provide a safe and suitable location for service\", \"Fournir un emplacement sûr pour le service\")}</li>\n                <li>{getLocalizedText(\"عدم استخدام التطبيق لأغراض غير قانونية\", \"Not use the app for illegal purposes\", \"Ne pas utiliser l'application à des fins illégales\")}</li>\n                <li>{getLocalizedText(\"عدم محاولة التلاعب بالنظام أو النقاط\", \"Not attempt to manipulate the system or points\", \"Ne pas tenter de manipuler le système\")}</li>\n              </ul>\n            </section>\n\n            {/* Limitation of Liability */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"حدود المسؤولية\", \"Limitation of Liability\", \"Limitation de Responsabilité\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"نبذل قصارى جهدنا لتقديم خدمة آمنة وعالية الجودة. ومع ذلك، لن نكون مسؤولين عن أي أضرار غير مباشرة أو عرضية أو تبعية ناتجة عن استخدام خدماتنا، إلى أقصى حد يسمح به القانون.\",\n                  \"We do our best to provide a safe and high-quality service. However, we will not be liable for any indirect, incidental, or consequential damages resulting from the use of our services, to the maximum extent permitted by law.\",\n                  \"Nous faisons de notre mieux pour fournir un service sûr et de qualité. Cependant, nous ne serons pas responsables des dommages indirects.\"\n                )}\n              </p>\n            </section>\n\n            {/* Governing Law */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"القانون الحاكم\", \"Governing Law\", \"Loi Applicable\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"تخضع هذه الشروط وتفسر وفقاً لقوانين دولة الكويت. أي نزاعات تنشأ عن هذه الشروط ستخضع للاختصاص القضائي الحصري لمحاكم الكويت.\",\n                  \"These terms are governed by and construed in accordance with the laws of the State of Kuwait. Any disputes arising from these terms shall be subject to the exclusive jurisdiction of Kuwaiti courts.\",\n                  \"Ces conditions sont régies par les lois de l'État du Koweït. Tout litige sera soumis à la juridiction exclusive des tribunaux koweïtiens.\"\n                )}\n              </p>\n            </section>\n\n            {/* Contact Information */}\n            <section className=\"bg-muted/50 rounded-lg p-6\">\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"اتصل بنا\", \"Contact Us\", \"Contactez-Nous\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"لأي استفسارات حول شروط الاستخدام:\",\n                  \"For any questions about these Terms of Service:\",\n                  \"Pour toute question sur ces conditions:\"\n                )}\n              </p>\n              <div className=\"mt-4 space-y-3\">\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <Mail className=\"h-5 w-5 text-primary\" />\n                  <span>support@ghaslastyle.com</span>\n                </div>\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <Phone className=\"h-5 w-5 text-primary\" />\n                  <span dir=\"ltr\">+965 9796 0808</span>\n                </div>\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <MapPin className=\"h-5 w-5 text-primary\" />\n                  <span>{getLocalizedText(\"الكويت\", \"Kuwait\", \"Koweït\")}</span>\n                </div>\n              </div>\n            </section>\n\n            {/* Changes to Terms */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"تغييرات الشروط\", \"Changes to Terms\", \"Modifications des Conditions\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"نحتفظ بالحق في تعديل هذه الشروط في أي وقت. سنخطركم بأي تغييرات جوهرية. استمراركم في استخدام الخدمة بعد التعديلات يعني قبولكم للشروط المحدثة.\",\n                  \"We reserve the right to modify these terms at any time. We will notify you of any material changes. Your continued use of the service after modifications constitutes acceptance of the updated terms.\",\n                  \"Nous nous réservons le droit de modifier ces conditions à tout moment. Votre utilisation continue après les modifications constitue une acceptation.\"\n                )}\n              </p>\n            </section>\n\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":16788,"size_tokens":null},"client/src/pages/DeleteAccount.tsx":{"content":"import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { UserX, AlertTriangle, Mail, Phone, MapPin, Calendar, Loader2 } from \"lucide-react\";\nimport { useAuth } from \"@/context/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function DeleteAccount() {\n  const { i18n } = useTranslation();\n  const { user, logout } = useAuth();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [confirmText, setConfirmText] = useState(\"\");\n  const [understood, setUnderstood] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n  \n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const handleDeleteAccount = async () => {\n    if (!user) return;\n    \n    const expectedText = getLocalizedText(\"حذف حسابي\", \"DELETE MY ACCOUNT\", \"SUPPRIMER MON COMPTE\");\n    if (confirmText !== expectedText) {\n      toast({\n        title: getLocalizedText(\"خطأ\", \"Error\", \"Erreur\"),\n        description: getLocalizedText(\n          \"يرجى كتابة نص التأكيد بشكل صحيح\",\n          \"Please type the confirmation text correctly\",\n          \"Veuillez taper le texte de confirmation correctement\"\n        ),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!understood) {\n      toast({\n        title: getLocalizedText(\"خطأ\", \"Error\", \"Erreur\"),\n        description: getLocalizedText(\n          \"يرجى تأكيد فهمك للعواقب\",\n          \"Please confirm your understanding of the consequences\",\n          \"Veuillez confirmer votre compréhension des conséquences\"\n        ),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsDeleting(true);\n    try {\n      const response = await fetch(`/api/users/${user.id}/delete-request`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n\n      if (response.ok) {\n        toast({\n          title: getLocalizedText(\"تم إرسال الطلب\", \"Request Submitted\", \"Demande Soumise\"),\n          description: getLocalizedText(\n            \"سيتم حذف حسابك خلال 30 يوماً. ستتلقى تأكيداً بالبريد الإلكتروني.\",\n            \"Your account will be deleted within 30 days. You will receive email confirmation.\",\n            \"Votre compte sera supprimé dans les 30 jours. Vous recevrez une confirmation par e-mail.\"\n          ),\n        });\n        await logout();\n        setLocation(\"/\");\n      } else {\n        throw new Error(\"Failed to submit deletion request\");\n      }\n    } catch (error) {\n      toast({\n        title: getLocalizedText(\"خطأ\", \"Error\", \"Erreur\"),\n        description: getLocalizedText(\n          \"حدث خطأ. يرجى التواصل مع الدعم.\",\n          \"An error occurred. Please contact support.\",\n          \"Une erreur s'est produite. Veuillez contacter le support.\"\n        ),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsDeleting(false);\n    }\n  };\n\n  const lastUpdated = \"2024-12-21\";\n\n  return (\n    <div className=\"min-h-screen bg-background py-12\">\n      <div className=\"container mx-auto px-4 max-w-4xl\">\n        <Card>\n          <CardHeader className=\"text-center border-b\">\n            <div className=\"flex justify-center mb-4\">\n              <div className=\"p-3 rounded-full bg-destructive/10\">\n                <UserX className=\"h-8 w-8 text-destructive\" />\n              </div>\n            </div>\n            <CardTitle className=\"text-3xl\" data-testid=\"delete-account-title\">\n              {getLocalizedText(\"حذف الحساب\", \"Account Deletion\", \"Suppression du Compte\")}\n            </CardTitle>\n            <CardDescription className=\"flex items-center justify-center gap-2 mt-2\">\n              <Calendar className=\"h-4 w-4\" />\n              {getLocalizedText(`آخر تحديث: ${lastUpdated}`, `Last Updated: ${lastUpdated}`, `Dernière mise à jour: ${lastUpdated}`)}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-6 md:p-8 space-y-8\">\n            \n            {/* Policy Information */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"سياسة حذف الحساب\", \"Account Deletion Policy\", \"Politique de Suppression\")}\n              </h2>\n              <p className=\"text-muted-foreground leading-relaxed mt-4\">\n                {getLocalizedText(\n                  \"نحترم حقك في حذف حسابك وبياناتك الشخصية. توضح هذه الصفحة كيفية طلب حذف حسابك وما يترتب على ذلك.\",\n                  \"We respect your right to delete your account and personal data. This page explains how to request account deletion and what it entails.\",\n                  \"Nous respectons votre droit de supprimer votre compte et vos données personnelles.\"\n                )}\n              </p>\n            </section>\n\n            {/* What Gets Deleted */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"ما الذي سيتم حذفه\", \"What Will Be Deleted\", \"Ce Qui Sera Supprimé\")}\n              </h2>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-4 space-y-2\">\n                <li>{getLocalizedText(\"معلومات حسابك الشخصية (الاسم، البريد، الهاتف)\", \"Your personal account information (name, email, phone)\", \"Vos informations personnelles\")}</li>\n                <li>{getLocalizedText(\"سجل الطلبات والحجوزات\", \"Order and booking history\", \"Historique des commandes\")}</li>\n                <li>{getLocalizedText(\"رصيد نقاط الولاء\", \"Loyalty points balance\", \"Solde des points de fidélité\")}</li>\n                <li>{getLocalizedText(\"بيانات السيارة المحفوظة\", \"Saved vehicle information\", \"Informations de véhicule enregistrées\")}</li>\n                <li>{getLocalizedText(\"تفضيلات الإشعارات\", \"Notification preferences\", \"Préférences de notification\")}</li>\n              </ul>\n            </section>\n\n            {/* What May Be Retained */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"ما قد نحتفظ به\", \"What May Be Retained\", \"Ce Qui Peut Être Conservé\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"قد نحتفظ ببعض البيانات لأغراض قانونية أو تنظيمية:\",\n                  \"We may retain some data for legal or regulatory purposes:\",\n                  \"Nous pouvons conserver certaines données pour des raisons légales:\"\n                )}\n              </p>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-2\">\n                <li>{getLocalizedText(\"سجلات المعاملات المالية (للمتطلبات الضريبية)\", \"Financial transaction records (for tax requirements)\", \"Registres financiers (pour les impôts)\")}</li>\n                <li>{getLocalizedText(\"سجلات الاتصال بالدعم الفني\", \"Customer support communication logs\", \"Journaux de communication support\")}</li>\n                <li>{getLocalizedText(\"بيانات مجهولة المصدر للتحليلات\", \"Anonymized data for analytics\", \"Données anonymisées pour analyses\")}</li>\n              </ul>\n            </section>\n\n            {/* Deletion Timeline */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"الجدول الزمني للحذف\", \"Deletion Timeline\", \"Délai de Suppression\")}\n              </h2>\n              <div className=\"mt-4 space-y-3 text-muted-foreground\">\n                <p>\n                  <strong>{getLocalizedText(\"الفوري:\", \"Immediate:\", \"Immédiat:\")}</strong> {getLocalizedText(\"تعليق الوصول إلى الحساب\", \"Account access suspension\", \"Suspension de l'accès\")}\n                </p>\n                <p>\n                  <strong>{getLocalizedText(\"خلال 7 أيام:\", \"Within 7 days:\", \"Sous 7 jours:\")}</strong> {getLocalizedText(\"حذف بيانات الحساب من الأنظمة النشطة\", \"Deletion of account data from active systems\", \"Suppression des systèmes actifs\")}\n                </p>\n                <p>\n                  <strong>{getLocalizedText(\"خلال 30 يوماً:\", \"Within 30 days:\", \"Sous 30 jours:\")}</strong> {getLocalizedText(\"حذف البيانات من النسخ الاحتياطية\", \"Deletion from backup systems\", \"Suppression des sauvegardes\")}\n                </p>\n              </div>\n            </section>\n\n            {/* How to Request */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"كيفية طلب الحذف\", \"How to Request Deletion\", \"Comment Demander la Suppression\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\"يمكنك طلب حذف حسابك بإحدى الطرق التالية:\", \"You can request account deletion through:\", \"Vous pouvez demander la suppression via:\")}\n              </p>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-2\">\n                <li>{getLocalizedText(\"استخدام النموذج أدناه (للمستخدمين المسجلين)\", \"Using the form below (for logged-in users)\", \"En utilisant le formulaire ci-dessous\")}</li>\n                <li>{getLocalizedText(\"إرسال بريد إلكتروني إلى privacy@ghaslastyle.com\", \"Sending an email to privacy@ghaslastyle.com\", \"En envoyant un e-mail à privacy@ghaslastyle.com\")}</li>\n                <li>{getLocalizedText(\"الاتصال بخدمة العملاء على الرقم أدناه\", \"Contacting customer service at the number below\", \"En contactant le service client\")}</li>\n              </ul>\n            </section>\n\n            {/* Deletion Form */}\n            <section className=\"border-2 border-destructive/20 rounded-lg p-6 bg-destructive/5\">\n              {user ? (\n                <div>\n                  <div className=\"flex items-center gap-3 mb-4\">\n                    <AlertTriangle className=\"h-6 w-6 text-destructive\" />\n                    <h2 className=\"text-xl font-bold text-destructive\">\n                      {getLocalizedText(\"طلب حذف الحساب\", \"Request Account Deletion\", \"Demander la Suppression\")}\n                    </h2>\n                  </div>\n                  \n                  <p className=\"text-muted-foreground mb-6\">\n                    {getLocalizedText(\n                      \"تحذير: هذا الإجراء لا يمكن التراجع عنه. ستفقد جميع بياناتك ونقاط الولاء.\",\n                      \"Warning: This action cannot be undone. You will lose all your data and loyalty points.\",\n                      \"Avertissement: Cette action est irréversible. Vous perdrez toutes vos données.\"\n                    )}\n                  </p>\n\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"confirm-text\">\n                        {getLocalizedText(\n                          `اكتب \"${getLocalizedText(\"حذف حسابي\", \"DELETE MY ACCOUNT\", \"SUPPRIMER MON COMPTE\")}\" للتأكيد`,\n                          `Type \"${getLocalizedText(\"حذف حسابي\", \"DELETE MY ACCOUNT\", \"SUPPRIMER MON COMPTE\")}\" to confirm`,\n                          `Tapez \"${getLocalizedText(\"حذف حسابي\", \"DELETE MY ACCOUNT\", \"SUPPRIMER MON COMPTE\")}\" pour confirmer`\n                        )}\n                      </Label>\n                      <Input\n                        id=\"confirm-text\"\n                        value={confirmText}\n                        onChange={(e) => setConfirmText(e.target.value)}\n                        placeholder={getLocalizedText(\"حذف حسابي\", \"DELETE MY ACCOUNT\", \"SUPPRIMER MON COMPTE\")}\n                        data-testid=\"input-delete-confirm\"\n                      />\n                    </div>\n\n                    <div className=\"flex items-start gap-3\">\n                      <Checkbox\n                        id=\"understood\"\n                        checked={understood}\n                        onCheckedChange={(checked) => setUnderstood(checked === true)}\n                        data-testid=\"checkbox-delete-understand\"\n                      />\n                      <Label htmlFor=\"understood\" className=\"text-sm text-muted-foreground leading-relaxed\">\n                        {getLocalizedText(\n                          \"أفهم أن حذف حسابي سيؤدي إلى فقدان جميع بياناتي ونقاط الولاء بشكل دائم ولا يمكن استعادتها.\",\n                          \"I understand that deleting my account will permanently erase all my data and loyalty points, which cannot be recovered.\",\n                          \"Je comprends que la suppression de mon compte effacera définitivement toutes mes données et points de fidélité.\"\n                        )}\n                      </Label>\n                    </div>\n\n                    <Button\n                      variant=\"destructive\"\n                      className=\"w-full\"\n                      onClick={handleDeleteAccount}\n                      disabled={isDeleting || !understood || confirmText !== getLocalizedText(\"حذف حسابي\", \"DELETE MY ACCOUNT\", \"SUPPRIMER MON COMPTE\")}\n                      data-testid=\"button-delete-account\"\n                    >\n                      {isDeleting ? (\n                        <>\n                          <Loader2 className=\"h-4 w-4 me-2 animate-spin\" />\n                          {getLocalizedText(\"جاري المعالجة...\", \"Processing...\", \"Traitement...\")}\n                        </>\n                      ) : (\n                        getLocalizedText(\"حذف حسابي نهائياً\", \"Delete My Account Permanently\", \"Supprimer Mon Compte Définitivement\")\n                      )}\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"text-center space-y-4\">\n                  <div className=\"flex items-center justify-center gap-3 mb-4\">\n                    <AlertTriangle className=\"h-6 w-6 text-destructive\" />\n                    <h2 className=\"text-xl font-bold text-destructive\">\n                      {getLocalizedText(\"طلب حذف الحساب\", \"Request Account Deletion\", \"Demander la Suppression\")}\n                    </h2>\n                  </div>\n                  <p className=\"text-muted-foreground\">\n                    {getLocalizedText(\n                      \"لحذف حسابك، يرجى تسجيل الدخول أولاً أو إرسال طلب عبر البريد الإلكتروني:\",\n                      \"To delete your account, please log in first or send a request via email:\",\n                      \"Pour supprimer votre compte, veuillez vous connecter d'abord ou envoyer une demande par e-mail:\"\n                    )}\n                  </p>\n                  <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => setLocation(\"/login\")}\n                      data-testid=\"button-login-to-delete\"\n                    >\n                      {getLocalizedText(\"تسجيل الدخول\", \"Log In\", \"Se Connecter\")}\n                    </Button>\n                    <a href=\"mailto:privacy@ghaslastyle.com?subject=Account%20Deletion%20Request\">\n                      <Button variant=\"destructive\" data-testid=\"button-email-deletion\">\n                        <Mail className=\"h-4 w-4 me-2\" />\n                        {getLocalizedText(\"إرسال طلب بالبريد\", \"Send Email Request\", \"Envoyer par E-mail\")}\n                      </Button>\n                    </a>\n                  </div>\n                </div>\n              )}\n              </section>\n\n            {/* Contact Information */}\n            <section className=\"bg-muted/50 rounded-lg p-6\">\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"اتصل بنا\", \"Contact Us\", \"Contactez-Nous\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"للمساعدة في حذف حسابك أو أي استفسارات:\",\n                  \"For help with account deletion or any questions:\",\n                  \"Pour de l'aide avec la suppression ou toute question:\"\n                )}\n              </p>\n              <div className=\"mt-4 space-y-3\">\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <Mail className=\"h-5 w-5 text-primary\" />\n                  <span>privacy@ghaslastyle.com</span>\n                </div>\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <Phone className=\"h-5 w-5 text-primary\" />\n                  <span dir=\"ltr\">+965 9796 0808</span>\n                </div>\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <MapPin className=\"h-5 w-5 text-primary\" />\n                  <span>{getLocalizedText(\"الكويت\", \"Kuwait\", \"Koweït\")}</span>\n                </div>\n              </div>\n            </section>\n\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":18319,"size_tokens":null},"client/src/pages/PrivacyPolicy.tsx":{"content":"import { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Shield, Mail, Phone, MapPin, Calendar } from \"lucide-react\";\n\nexport default function PrivacyPolicy() {\n  const { i18n } = useTranslation();\n  \n  const getLocalizedText = (ar: string, en: string, fr: string) => {\n    return i18n.language === \"ar\" ? ar : i18n.language === \"fr\" ? fr : en;\n  };\n\n  const lastUpdated = \"2024-12-21\";\n\n  return (\n    <div className=\"min-h-screen bg-background py-12\">\n      <div className=\"container mx-auto px-4 max-w-4xl\">\n        <Card>\n          <CardHeader className=\"text-center border-b\">\n            <div className=\"flex justify-center mb-4\">\n              <div className=\"p-3 rounded-full bg-primary/10\">\n                <Shield className=\"h-8 w-8 text-primary\" />\n              </div>\n            </div>\n            <CardTitle className=\"text-3xl\" data-testid=\"privacy-policy-title\">\n              {getLocalizedText(\"سياسة الخصوصية\", \"Privacy Policy\", \"Politique de Confidentialité\")}\n            </CardTitle>\n            <p className=\"text-muted-foreground flex items-center justify-center gap-2 mt-2\">\n              <Calendar className=\"h-4 w-4\" />\n              {getLocalizedText(`آخر تحديث: ${lastUpdated}`, `Last Updated: ${lastUpdated}`, `Dernière mise à jour: ${lastUpdated}`)}\n            </p>\n          </CardHeader>\n          <CardContent className=\"prose prose-gray dark:prose-invert max-w-none p-6 md:p-8 space-y-8\">\n            \n            {/* Introduction */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"مقدمة\", \"Introduction\", \"Introduction\")}\n              </h2>\n              <p className=\"text-muted-foreground leading-relaxed mt-4\">\n                {getLocalizedText(\n                  \"مرحباً بكم في غسلة ستايل (Ghasla Style). نحن نقدر ثقتكم ونلتزم بحماية خصوصيتكم. توضح سياسة الخصوصية هذه كيفية جمع واستخدام وحماية معلوماتكم الشخصية عند استخدام تطبيقنا وخدماتنا لغسيل السيارات المتنقل في الكويت.\",\n                  \"Welcome to Ghasla Style. We value your trust and are committed to protecting your privacy. This Privacy Policy explains how we collect, use, and protect your personal information when you use our mobile car wash application and services in Kuwait.\",\n                  \"Bienvenue chez Ghasla Style. Nous apprécions votre confiance et nous nous engageons à protéger votre vie privée. Cette politique de confidentialité explique comment nous collectons, utilisons et protégeons vos informations personnelles.\"\n                )}\n              </p>\n            </section>\n\n            {/* Data We Collect */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"البيانات التي نجمعها\", \"Data We Collect\", \"Données que Nous Collectons\")}\n              </h2>\n              <div className=\"mt-4 space-y-4\">\n                <div>\n                  <h3 className=\"font-semibold text-foreground\">\n                    {getLocalizedText(\"المعلومات الشخصية\", \"Personal Information\", \"Informations Personnelles\")}\n                  </h3>\n                  <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-1\">\n                    <li>{getLocalizedText(\"الاسم الكامل\", \"Full name\", \"Nom complet\")}</li>\n                    <li>{getLocalizedText(\"البريد الإلكتروني\", \"Email address\", \"Adresse e-mail\")}</li>\n                    <li>{getLocalizedText(\"رقم الهاتف\", \"Phone number\", \"Numéro de téléphone\")}</li>\n                    <li>{getLocalizedText(\"عنوان الموقع للخدمة\", \"Service location address\", \"Adresse du lieu de service\")}</li>\n                  </ul>\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-foreground\">\n                    {getLocalizedText(\"معلومات السيارة\", \"Vehicle Information\", \"Informations sur le Véhicule\")}\n                  </h3>\n                  <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-1\">\n                    <li>{getLocalizedText(\"نوع وموديل السيارة\", \"Car make and model\", \"Marque et modèle de voiture\")}</li>\n                    <li>{getLocalizedText(\"لون السيارة\", \"Car color\", \"Couleur de la voiture\")}</li>\n                    <li>{getLocalizedText(\"رقم اللوحة\", \"License plate number\", \"Numéro de plaque\")}</li>\n                  </ul>\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-foreground\">\n                    {getLocalizedText(\"بيانات الاستخدام\", \"Usage Data\", \"Données d'Utilisation\")}\n                  </h3>\n                  <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-1\">\n                    <li>{getLocalizedText(\"سجل الطلبات والحجوزات\", \"Order and booking history\", \"Historique des commandes\")}</li>\n                    <li>{getLocalizedText(\"نقاط الولاء والمكافآت\", \"Loyalty points and rewards\", \"Points de fidélité\")}</li>\n                    <li>{getLocalizedText(\"تفضيلات الخدمة\", \"Service preferences\", \"Préférences de service\")}</li>\n                  </ul>\n                </div>\n              </div>\n            </section>\n\n            {/* How We Use Data */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"كيف نستخدم بياناتكم\", \"How We Use Your Data\", \"Comment Nous Utilisons Vos Données\")}\n              </h2>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-4 space-y-2\">\n                <li>{getLocalizedText(\"معالجة وتنفيذ طلبات غسيل السيارات\", \"Process and fulfill car wash orders\", \"Traiter et exécuter les commandes de lavage\")}</li>\n                <li>{getLocalizedText(\"التواصل معكم بخصوص الحجوزات والعروض\", \"Communicate with you about bookings and offers\", \"Communiquer avec vous concernant les réservations\")}</li>\n                <li>{getLocalizedText(\"إدارة برنامج نقاط الولاء\", \"Manage the loyalty points program\", \"Gérer le programme de fidélité\")}</li>\n                <li>{getLocalizedText(\"تحسين خدماتنا وتجربة المستخدم\", \"Improve our services and user experience\", \"Améliorer nos services\")}</li>\n                <li>{getLocalizedText(\"الامتثال للمتطلبات القانونية\", \"Comply with legal requirements\", \"Respecter les exigences légales\")}</li>\n              </ul>\n            </section>\n\n            {/* Data Sharing */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"مشاركة البيانات\", \"Data Sharing\", \"Partage des Données\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"نحن لا نبيع معلوماتكم الشخصية. قد نشارك بياناتكم مع:\",\n                  \"We do not sell your personal information. We may share your data with:\",\n                  \"Nous ne vendons pas vos informations personnelles. Nous pouvons partager vos données avec:\"\n                )}\n              </p>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-2\">\n                <li>{getLocalizedText(\"فريق المندوبين لتنفيذ الخدمة\", \"Our service delegates to fulfill orders\", \"Nos délégués de service\")}</li>\n                <li>{getLocalizedText(\"مزودي خدمات الدفع الآمن\", \"Secure payment service providers\", \"Fournisseurs de paiement sécurisé\")}</li>\n                <li>{getLocalizedText(\"خدمات Firebase للمصادقة\", \"Firebase Authentication services\", \"Services d'authentification Firebase\")}</li>\n                <li>{getLocalizedText(\"السلطات القانونية عند الطلب الرسمي\", \"Legal authorities when officially required\", \"Autorités légales si requis\")}</li>\n              </ul>\n            </section>\n\n            {/* Data Security */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"أمان البيانات\", \"Data Security\", \"Sécurité des Données\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"نستخدم تقنيات أمان متقدمة لحماية بياناتكم، تشمل: التشفير أثناء النقل والتخزين، المصادقة الآمنة عبر Firebase، مراقبة مستمرة للوصول غير المصرح به، ونسخ احتياطي منتظم للبيانات.\",\n                  \"We use advanced security technologies to protect your data, including: encryption during transit and storage, secure Firebase authentication, continuous monitoring for unauthorized access, and regular data backups.\",\n                  \"Nous utilisons des technologies de sécurité avancées pour protéger vos données, notamment: le chiffrement pendant le transit et le stockage, l'authentification Firebase sécurisée, la surveillance continue.\"\n                )}\n              </p>\n            </section>\n\n            {/* Your Rights */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"حقوقكم\", \"Your Rights\", \"Vos Droits\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\"لديكم الحق في:\", \"You have the right to:\", \"Vous avez le droit de:\")}\n              </p>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-2\">\n                <li>{getLocalizedText(\"الوصول إلى بياناتكم الشخصية\", \"Access your personal data\", \"Accéder à vos données personnelles\")}</li>\n                <li>{getLocalizedText(\"تصحيح أي معلومات غير دقيقة\", \"Correct any inaccurate information\", \"Corriger toute information inexacte\")}</li>\n                <li>{getLocalizedText(\"طلب حذف حسابكم وبياناتكم\", \"Request deletion of your account and data\", \"Demander la suppression de votre compte\")}</li>\n                <li>{getLocalizedText(\"سحب الموافقة في أي وقت\", \"Withdraw consent at any time\", \"Retirer votre consentement à tout moment\")}</li>\n                <li>{getLocalizedText(\"تصدير بياناتكم بصيغة قابلة للقراءة\", \"Export your data in a readable format\", \"Exporter vos données dans un format lisible\")}</li>\n              </ul>\n            </section>\n\n            {/* Data Retention */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"الاحتفاظ بالبيانات\", \"Data Retention\", \"Conservation des Données\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"نحتفظ ببياناتكم طالما حسابكم نشط أو حسب الحاجة لتقديم الخدمات. يمكنكم طلب حذف حسابكم في أي وقت من صفحة الحساب أو بالتواصل معنا. سيتم حذف البيانات خلال 30 يوماً من طلب الحذف، باستثناء البيانات المطلوبة قانونياً.\",\n                  \"We retain your data as long as your account is active or as needed to provide services. You can request account deletion at any time from your account page or by contacting us. Data will be deleted within 30 days of the deletion request, except for legally required data.\",\n                  \"Nous conservons vos données tant que votre compte est actif. Vous pouvez demander la suppression de votre compte à tout moment. Les données seront supprimées dans les 30 jours suivant la demande.\"\n                )}\n              </p>\n            </section>\n\n            {/* Third-Party Services */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"خدمات الطرف الثالث\", \"Third-Party Services\", \"Services Tiers\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\"نستخدم الخدمات التالية:\", \"We use the following services:\", \"Nous utilisons les services suivants:\")}\n              </p>\n              <ul className=\"list-disc list-inside text-muted-foreground mt-2 space-y-2\">\n                <li><strong>Firebase Authentication:</strong> {getLocalizedText(\"للمصادقة الآمنة\", \"For secure authentication\", \"Pour l'authentification sécurisée\")}</li>\n                <li><strong>Google Analytics:</strong> {getLocalizedText(\"لتحليل استخدام التطبيق\", \"For app usage analytics\", \"Pour l'analyse de l'utilisation\")}</li>\n              </ul>\n            </section>\n\n            {/* Children's Privacy */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"خصوصية الأطفال\", \"Children's Privacy\", \"Confidentialité des Enfants\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"خدماتنا غير موجهة للأطفال دون سن 18 عاماً. لا نجمع عن علم معلومات شخصية من الأطفال. إذا علمنا بجمع بيانات طفل، سنحذفها فوراً.\",\n                  \"Our services are not directed to children under 18 years of age. We do not knowingly collect personal information from children. If we learn that we have collected data from a child, we will delete it immediately.\",\n                  \"Nos services ne s'adressent pas aux enfants de moins de 18 ans. Nous ne collectons pas sciemment d'informations personnelles auprès d'enfants.\"\n                )}\n              </p>\n            </section>\n\n            {/* Contact Information */}\n            <section className=\"bg-muted/50 rounded-lg p-6\">\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"اتصل بنا\", \"Contact Us\", \"Contactez-Nous\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"لأي استفسارات حول سياسة الخصوصية أو لممارسة حقوقكم:\",\n                  \"For any questions about this Privacy Policy or to exercise your rights:\",\n                  \"Pour toute question sur cette politique de confidentialité:\"\n                )}\n              </p>\n              <div className=\"mt-4 space-y-3\">\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <Mail className=\"h-5 w-5 text-primary\" />\n                  <span>privacy@ghaslastyle.com</span>\n                </div>\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <Phone className=\"h-5 w-5 text-primary\" />\n                  <span dir=\"ltr\">+965 9796 0808</span>\n                </div>\n                <div className=\"flex items-center gap-3 text-muted-foreground\">\n                  <MapPin className=\"h-5 w-5 text-primary\" />\n                  <span>{getLocalizedText(\"الكويت\", \"Kuwait\", \"Koweït\")}</span>\n                </div>\n              </div>\n            </section>\n\n            {/* Policy Changes */}\n            <section>\n              <h2 className=\"text-xl font-bold text-foreground border-b pb-2\">\n                {getLocalizedText(\"تغييرات السياسة\", \"Policy Changes\", \"Modifications de la Politique\")}\n              </h2>\n              <p className=\"text-muted-foreground mt-4\">\n                {getLocalizedText(\n                  \"قد نحدث سياسة الخصوصية هذه من وقت لآخر. سنخطركم بأي تغييرات جوهرية عبر البريد الإلكتروني أو إشعار داخل التطبيق. استمراركم في استخدام الخدمة بعد التحديثات يعني موافقتكم على السياسة المحدثة.\",\n                  \"We may update this Privacy Policy from time to time. We will notify you of any material changes via email or in-app notification. Your continued use of the service after updates constitutes acceptance of the updated policy.\",\n                  \"Nous pouvons mettre à jour cette politique de temps en temps. Nous vous informerons de tout changement important par e-mail ou notification dans l'application.\"\n                )}\n              </p>\n            </section>\n\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":17438,"size_tokens":null}},"version":2}